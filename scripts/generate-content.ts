#!/usr/bin/env ts-node

/**
 * AI Content Generator Script
 *
 * This script generates themed word problem templates for math modules.
 * It demonstrates the content injection architecture by creating new
 * templates.json content based on a theme.
 *
 * Usage:
 *   npx ts-node scripts/generate-content.ts --theme "Pirates"
 *   npx ts-node scripts/generate-content.ts --theme "Space"
 *   npx ts-node scripts/generate-content.ts --theme "Dinosaurs"
 */

import * as fs from 'fs';
import * as path from 'path';

// Theme templates - in production, this would be generated by an LLM
const themeTemplates: Record<string, any> = {
  Pirates: {
    division: {
      wordProblems: {
        he: [
          {
            text: "×œ×§×¤×˜×Ÿ ×™×© {total} ××˜×‘×¢×•×ª ×–×”×‘. ×”×•× ×¨×•×¦×” ×œ×—×œ×§ ××•×ª×Ÿ ×©×•×•×” ×œ-{groups} ×©×•×“×“×™ ×™×. ×›××” ××˜×‘×¢×•×ª ×™×§×‘×œ ×›×œ ×©×•×“×“?",
            vars: ["total", "groups"]
          },
          {
            text: "×™×© {total} ×ª×•×ª×—×™× ×¢×œ {groups} ×¡×¤×™× ×•×ª. ×›××” ×ª×•×ª×—×™× ×‘×××•×¦×¢ ×¢×œ ×›×œ ×¡×¤×™× ×”?",
            vars: ["total", "groups"]
          },
          {
            text: "×”×§×¤×˜×Ÿ ××¦× {total} ×¤× ×™× ×™× ×‘-{groups} ×ª×™×‘×•×ª ××•×¦×¨. ×›××” ×¤× ×™× ×™× ×‘×›×œ ×ª×™×‘×” ×× ××—×œ×§×™× ×©×•×•×”?",
            vars: ["total", "groups"]
          }
        ],
        en: [
          {
            text: "The captain has {total} gold coins. He wants to divide them equally among {groups} pirates. How many coins will each pirate get?",
            vars: ["total", "groups"]
          },
          {
            text: "There are {total} cannons on {groups} ships. How many cannons on average per ship?",
            vars: ["total", "groups"]
          },
          {
            text: "The captain found {total} pearls in {groups} treasure chests. How many pearls per chest if divided equally?",
            vars: ["total", "groups"]
          }
        ]
      }
    },
    multiplication: {
      wordProblems: {
        he: [
          {
            text: "×œ×§×¤×˜×Ÿ ×™×© {groups} ×¡×¤×™× ×•×ª, ×•×‘×›×œ ×¡×¤×™× ×” {items} ×©×•×“×“×™ ×™×. ×›××” ×©×•×“×“×™× ×™×© ×œ×• ×‘×¡×š ×”×›×œ?",
            vars: ["groups", "items"]
          },
          {
            text: "×‘×›×œ ×ª×™×‘×ª ××•×¦×¨ ×™×© {items} ××˜×‘×¢×•×ª ×–×”×‘. ×× ×™×© {groups} ×ª×™×‘×•×ª, ×›××” ××˜×‘×¢×•×ª ×™×© ×‘×¡×š ×”×›×œ?",
            vars: ["items", "groups"]
          },
          {
            text: "×”×§×¤×˜×Ÿ ××¤×œ×™×’ {items} ×©×¢×•×ª ×‘×›×œ ×™×•×. ×›××” ×©×¢×•×ª ×”×•× ×™×¤×œ×™×’ ×‘-{groups} ×™××™×?",
            vars: ["items", "groups"]
          }
        ],
        en: [
          {
            text: "The captain has {groups} ships, and each ship has {items} pirates. How many pirates does he have in total?",
            vars: ["groups", "items"]
          },
          {
            text: "Each treasure chest has {items} gold coins. If there are {groups} chests, how many coins in total?",
            vars: ["items", "groups"]
          },
          {
            text: "The captain sails {items} hours every day. How many hours will he sail in {groups} days?",
            vars: ["items", "groups"]
          }
        ]
      }
    },
    fraction: {
      wordProblems: {
        he: [
          {
            text: "×œ×§×¤×˜×Ÿ ×™×© ××¤×ª ××•×¦×¨. ×”×•× ×—×§×¨ {numerator}/{denominator} ××”××¤×”. ××™×–×” ×—×œ×§ × ×©××¨?",
            vars: ["numerator", "denominator"]
          },
          {
            text: "×‘×¦×•×•×ª ×™×© {total} ×©×•×“×“×™ ×™×. {numerator}/{denominator} ××”× ×™×•×“×¢×™× ×œ×©×—×•×ª. ×›××” ×©×•×“×“×™× ×™×•×“×¢×™× ×œ×©×—×•×ª?",
            vars: ["total", "numerator", "denominator"]
          }
        ],
        en: [
          {
            text: "The captain has a treasure map. He explored {numerator}/{denominator} of the map. What fraction is left?",
            vars: ["numerator", "denominator"]
          },
          {
            text: "The crew has {total} pirates. {numerator}/{denominator} of them can swim. How many pirates can swim?",
            vars: ["total", "numerator", "denominator"]
          }
        ]
      }
    },
    decimal: {
      wordProblems: {
        he: [
          {
            text: "×œ×§×¤×˜×Ÿ ×™×© {whole}.{decimal} ×§×™×œ×•×’×¨× ×–×”×‘. ×›××” ×’×¨× ×–×”?",
            vars: ["whole", "decimal"]
          },
          {
            text: "×”××¨×—×§ ×œ××™ ×”××•×¦×¨ ×”×•× {whole}.{decimal} ××™×™×œ×™× ×™××™×™×. ×›××” ×–×” ×‘××˜×¨×™×?",
            vars: ["whole", "decimal"]
          }
        ],
        en: [
          {
            text: "The captain has {whole}.{decimal} kilograms of gold. How many grams is that?",
            vars: ["whole", "decimal"]
          },
          {
            text: "The distance to Treasure Island is {whole}.{decimal} nautical miles. How many meters is that?",
            vars: ["whole", "decimal"]
          }
        ]
      }
    },
    distributive: {
      wordProblems: {
        he: [
          {
            text: "×”×§×¤×˜×Ÿ ×§× ×” {groups} ×ª×™×‘×•×ª. ×‘×›×œ ×ª×™×‘×” ×™×© {items1} ××˜×‘×¢×•×ª ×–×”×‘ ×•-{items2} ×¤× ×™× ×™×. ×›××” ××•×¦×¨×•×ª ×§× ×” ×‘×¡×š ×”×›×œ?",
            vars: ["groups", "items1", "items2"]
          }
        ],
        en: [
          {
            text: "The captain bought {groups} chests. Each chest has {items1} gold coins and {items2} pearls. How many treasures did he buy in total?",
            vars: ["groups", "items1", "items2"]
          }
        ]
      }
    },
    "number-line": {
      wordProblems: {
        he: [
          {
            text: "×”×¡×¤×™× ×” ×¢×•××“×ª ×¢×œ ×”××™×§×•× {start} ×‘×™×. ×”×™× ××¤×œ×™×’×” {steps} ×§×©×¨×™× ×§×“×™××”. ×œ××™×–×” ××™×§×•× ×ª×’×™×¢?",
            vars: ["start", "steps"]
          },
          {
            text: "×™×© ××™ ×¢×œ ×”××™×§×•× {position}. ××™×¤×” ×”××™ ×¢×œ ×”××¤×”?",
            vars: ["position"]
          }
        ],
        en: [
          {
            text: "The ship is at position {start} at sea. It sails {steps} knots forward. What position will it reach?",
            vars: ["start", "steps"]
          },
          {
            text: "There is an island at position {position}. Where is the island on the map?",
            vars: ["position"]
          }
        ]
      }
    },
    "order-operations": {
      wordProblems: {
        he: [
          {
            text: "×”×§×¤×˜×Ÿ ×§× ×” {num1} ××¤×•×ª ×‘-{num2} ×©×§×œ×™× ×›×œ ××—×ª, ×•×¢×•×“ {num3} ××©×§×¤×•×ª. ×›××” ×©×™×œ× ×‘×¡×š ×”×›×œ?",
            vars: ["num1", "num2", "num3"]
          }
        ],
        en: [
          {
            text: "The captain bought {num1} maps for {num2} dollars each, and {num3} more telescopes. How much did he pay in total?",
            vars: ["num1", "num2", "num3"]
          }
        ]
      }
    }
  },
  Space: {
    division: {
      wordProblems: {
        he: [
          {
            text: "×œ×××” ×™×© {total} ×›×•×›×‘×™× ×‘×’×œ×§×¡×™×”. ×”×™× ×¨×•×¦×” ×œ×—×œ×§ ××•×ª× ×©×•×•×” ×œ-{groups} ××¢×¨×›×•×ª ×©××©. ×›××” ×›×•×›×‘×™× ×‘×›×œ ××¢×¨×›×ª?",
            vars: ["total", "groups"]
          },
          {
            text: "×™×© {total} ××¡×˜×¨×•× ××•×˜×™× ×•-{groups} ×—×œ×œ×™×•×ª. ×›××” ××¡×˜×¨×•× ××•×˜×™× ×‘×›×œ ×—×œ×œ×™×ª ×× × ×—×œ×§ ×©×•×•×”?",
            vars: ["total", "groups"]
          },
          {
            text: "×”×—×œ×œ×™×ª ×¢×‘×¨×” {total} ×©× ×•×ª ××•×¨ ×‘-{groups} ×™××™×. ×›××” ×©× ×•×ª ××•×¨ ×‘×™×•× ×‘×××•×¦×¢?",
            vars: ["total", "groups"]
          }
        ],
        en: [
          {
            text: "Emma has {total} stars in the galaxy. She wants to divide them equally into {groups} solar systems. How many stars per system?",
            vars: ["total", "groups"]
          },
          {
            text: "There are {total} astronauts and {groups} spaceships. How many astronauts per spaceship if divided equally?",
            vars: ["total", "groups"]
          },
          {
            text: "The spaceship traveled {total} light years in {groups} days. How many light years per day on average?",
            vars: ["total", "groups"]
          }
        ]
      }
    },
    multiplication: {
      wordProblems: {
        he: [
          {
            text: "×œ×××” ×™×© {groups} ×›×•×›×‘×™ ×œ×›×ª, ×•×‘×›×œ ×›×•×›×‘ {items} ×™×¨×—×™×. ×›××” ×™×¨×—×™× ×™×© ×œ×” ×‘×¡×š ×”×›×œ?",
            vars: ["groups", "items"]
          },
          {
            text: "×‘×›×œ ×—×œ×œ×™×ª ×™×© {items} ××¡×˜×¨×•× ××•×˜×™×. ×× ×™×© {groups} ×—×œ×œ×™×•×ª, ×›××” ××¡×˜×¨×•× ××•×˜×™× ×™×© ×‘×¡×š ×”×›×œ?",
            vars: ["items", "groups"]
          },
          {
            text: "×××” ×¨×•××” {items} ×›×•×›×‘×™× ×‘×›×œ ×œ×™×œ×”. ×›××” ×›×•×›×‘×™× ×”×™× ×ª×¨××” ×‘-{groups} ×œ×™×œ×•×ª?",
            vars: ["items", "groups"]
          }
        ],
        en: [
          {
            text: "Emma has {groups} planets, and each planet has {items} moons. How many moons does she have in total?",
            vars: ["groups", "items"]
          },
          {
            text: "Each spaceship has {items} astronauts. If there are {groups} spaceships, how many astronauts in total?",
            vars: ["items", "groups"]
          },
          {
            text: "Emma sees {items} stars every night. How many stars will she see in {groups} nights?",
            vars: ["items", "groups"]
          }
        ]
      }
    },
    fraction: {
      wordProblems: {
        he: [
          {
            text: "×œ×××” ×™×© ×˜×œ×¡×§×•×¤. ×”×™× ×¡×¨×§×” {numerator}/{denominator} ××”×©××™×™×. ××™×–×” ×—×œ×§ × ×©××¨?",
            vars: ["numerator", "denominator"]
          },
          {
            text: "×‘×ª×—× ×ª ×”×—×œ×œ ×™×© {total} ××¡×˜×¨×•× ××•×˜×™×. {numerator}/{denominator} ××”× ×™×•×“×¢×™× ×œ×˜×•×¡. ×›××” ××¡×˜×¨×•× ××•×˜×™× ×™×•×“×¢×™× ×œ×˜×•×¡?",
            vars: ["total", "numerator", "denominator"]
          }
        ],
        en: [
          {
            text: "Emma has a telescope. She scanned {numerator}/{denominator} of the sky. What fraction is left?",
            vars: ["numerator", "denominator"]
          },
          {
            text: "There are {total} astronauts at the space station. {numerator}/{denominator} of them can fly. How many astronauts can fly?",
            vars: ["total", "numerator", "denominator"]
          }
        ]
      }
    },
    decimal: {
      wordProblems: {
        he: [
          {
            text: "×œ×××” ×™×© {whole}.{decimal} ×§×™×œ×•×’×¨× ××˜××•×¨×™×˜×™×. ×›××” ×’×¨× ×–×”?",
            vars: ["whole", "decimal"]
          },
          {
            text: "×”××¨×—×§ ×œ×™×¨×— ×”×•× {whole}.{decimal} ××™×œ×™×•×Ÿ ×§×™×œ×•××˜×¨×™×. ×›××” ×–×” ×‘××˜×¨×™×?",
            vars: ["whole", "decimal"]
          }
        ],
        en: [
          {
            text: "Emma has {whole}.{decimal} kilograms of meteorites. How many grams is that?",
            vars: ["whole", "decimal"]
          },
          {
            text: "The distance to the moon is {whole}.{decimal} million kilometers. How many meters is that?",
            vars: ["whole", "decimal"]
          }
        ]
      }
    },
    distributive: {
      wordProblems: {
        he: [
          {
            text: "×××” ×§× ×ª×” {groups} ×—×‘×™×œ×•×ª. ×‘×›×œ ×—×‘×™×œ×” ×™×© {items1} ××˜××•×¨×™×˜×™× ×•-{items2} ××‘× ×™ ×—×œ×œ. ×›××” ×¤×¨×™×˜×™× ×§× ×ª×” ×‘×¡×š ×”×›×œ?",
            vars: ["groups", "items1", "items2"]
          }
        ],
        en: [
          {
            text: "Emma bought {groups} packages. Each package has {items1} meteorites and {items2} space rocks. How many items did she buy in total?",
            vars: ["groups", "items1", "items2"]
          }
        ]
      }
    },
    "number-line": {
      wordProblems: {
        he: [
          {
            text: "×”×—×œ×œ×™×ª ×¢×•××“×ª ×¢×œ × ×§×•×“×” {start} ×‘××¡×œ×•×œ. ×”×™× ××ª×§×“××ª {steps} × ×§×•×“×•×ª ×§×“×™××”. ×œ××™×–×• × ×§×•×“×” ×ª×’×™×¢?",
            vars: ["start", "steps"]
          },
          {
            text: "×™×© ×›×•×›×‘ ×¢×œ × ×§×•×“×” {position}. ××™×¤×” ×”×›×•×›×‘ ×¢×œ ×”××¤×”?",
            vars: ["position"]
          }
        ],
        en: [
          {
            text: "The spaceship is at point {start} in orbit. It advances {steps} points forward. What point will it reach?",
            vars: ["start", "steps"]
          },
          {
            text: "There is a star at point {position}. Where is the star on the map?",
            vars: ["position"]
          }
        ]
      }
    },
    "order-operations": {
      wordProblems: {
        he: [
          {
            text: "×××” ×§× ×ª×” {num1} ×—×œ×™×¤×•×ª ×—×œ×œ ×‘-{num2} ×©×§×œ×™× ×›×œ ××—×ª, ×•×¢×•×“ {num3} ×§×¡×“×•×ª. ×›××” ×©×™×œ××” ×‘×¡×š ×”×›×œ?",
            vars: ["num1", "num2", "num3"]
          }
        ],
        en: [
          {
            text: "Emma bought {num1} spacesuits for {num2} dollars each, and {num3} more helmets. How much did she pay in total?",
            vars: ["num1", "num2", "num3"]
          }
        ]
      }
    }
  }
};

/**
 * Parse command line arguments
 */
function parseArgs(): { theme: string } {
  const args = process.argv.slice(2);
  let theme = 'Pirates'; // Default theme

  for (let i = 0; i < args.length; i++) {
    if (args[i] === '--theme' && args[i + 1]) {
      theme = args[i + 1];
      i++;
    }
  }

  return { theme };
}

/**
 * Generate content using AI (mocked for now)
 *
 * In production, this would call an LLM API like:
 * - OpenAI GPT-4
 * - Anthropic Claude
 * - Google Gemini
 *
 * Prompt example:
 * "Generate Hebrew and English word problem templates for math modules
 *  with a {theme} theme. Include division, multiplication, fraction, etc.
 *  Use placeholders like {total}, {groups}, {items} for variables."
 */
async function generateWithAI(theme: string): Promise<any> {
  console.log(`\nğŸ¤– [AI Generator] Generating content for theme: "${theme}"`);
  console.log('ğŸ“ [AI Generator] In production, this would call an LLM API...\n');

  // Check if we have a pre-made template for this theme
  if (themeTemplates[theme]) {
    console.log(`âœ… [AI Generator] Using pre-generated template for "${theme}"\n`);
    return themeTemplates[theme];
  }

  // If no template exists, show what the LLM prompt would look like
  const llmPrompt = `
You are an AI content generator for a children's math education platform.

Generate word problem templates for math modules with a "${theme}" theme.

Requirements:
- Support both Hebrew (he) and English (en)
- Include templates for: division, multiplication, fraction, decimal, distributive, number-line, order-operations
- Use placeholder variables like {total}, {groups}, {items}, {numerator}, {denominator}, etc.
- Keep problems simple and appropriate for elementary school children
- Make them fun and engaging with the ${theme} theme

Return JSON matching this structure:
{
  "division": {
    "wordProblems": {
      "he": [{ "text": "...", "vars": ["total", "groups"] }],
      "en": [{ "text": "...", "vars": ["total", "groups"] }]
    }
  },
  ...
}
`;

  console.log('ğŸ¯ [AI Generator] LLM Prompt that would be sent:');
  console.log('â”€'.repeat(60));
  console.log(llmPrompt);
  console.log('â”€'.repeat(60));
  console.log('\nâš ï¸  [AI Generator] No pre-made template for this theme.');
  console.log('ğŸ’¡ [AI Generator] Available themes: Pirates, Space');
  console.log('ğŸ”§ [AI Generator] To add a new theme, integrate an LLM API here.\n');

  throw new Error(`No template available for theme: ${theme}. Use "Pirates" or "Space".`);
}

/**
 * Save content to templates.json
 */
function saveContent(content: any) {
  // Use relative path from current working directory
  const templatesPath = path.join(
    process.cwd(),
    'learningisfun-app',
    'lib',
    'math',
    'content',
    'templates.json'
  );

  console.log(`ğŸ’¾ [Save] Writing to: ${templatesPath}`);

  // Create backup of existing file
  if (fs.existsSync(templatesPath)) {
    const backupPath = templatesPath.replace('.json', '.backup.json');
    fs.copyFileSync(templatesPath, backupPath);
    console.log(`ğŸ“¦ [Backup] Created backup at: ${backupPath}`);
  }

  // Write new content
  fs.writeFileSync(
    templatesPath,
    JSON.stringify(content, null, 2),
    'utf-8'
  );

  console.log(`âœ… [Save] Content saved successfully!\n`);
}

/**
 * Main execution
 */
async function main() {
  console.log('ğŸš€ AI Content Generator - Story 15\n');

  try {
    // Parse arguments
    const { theme } = parseArgs();

    // Generate content
    const content = await generateWithAI(theme);

    // Save to file
    saveContent(content);

    console.log('âœ¨ Generation complete!');
    console.log(`ğŸ¨ Theme: ${theme}`);
    console.log('ğŸ“‚ Location: learningisfun-app/lib/math/content/templates.json');
    console.log('\nğŸ’¡ Next steps:');
    console.log('   1. Restart your Next.js dev server (npm run dev)');
    console.log('   2. Test the API: POST /api/math/generate with moduleName="division"');
    console.log('   3. Verify the new themed content appears in questions\n');

  } catch (error) {
    console.error('âŒ Error:', error instanceof Error ? error.message : error);
    process.exit(1);
  }
}

// Run the script
main();

export { generateWithAI, saveContent, parseArgs };
