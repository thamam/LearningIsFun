# Story 15 Acceptance Criteria: AI Content Injection System

**Target Branch:** `feature/story-15-ai-content`
**Goal:** Verify that the math engine is fully decoupled from hardcoded text and can dynamically load new story themes generated by an LLM script.

---

## Test Case 1: The Schema Contract (Static Analysis)
**Objective:** Ensure the logic modules are reading from a JSON file and not using hardcoded strings.

**Agent Instructions (MCP):**
1.  **Check File Existence:**
    * Use `read_file` to verify `learningisfun-app/lib/math/content/templates.json` exists.
2.  **Validate JSON Structure:**
    * The file content must match this schema structure:
        ```json
        {
          "division": {
            "wordProblems": [
              { "text": "string", "vars": ["array", "of", "strings"] }
            ]
          }
        }
        ```
3.  **Code Audit (Grep):**
    * Use `read_file` on `learningisfun-app/lib/math/modules/division.ts`.
    * **ASSERT FAILURE:** If the file contains the exact string `"Emma has {total} cookies"`.
    * **ASSERT SUCCESS:** If the file contains `import templates` or logic that references `templates.json`.

---

## Test Case 2: The "Pirate Theme" Generation (Script Execution)
**Objective:** Verify the generator script successfully calls the LLM (or mock) and overwrites the template file with new content.

**Agent Instructions (MCP):**
1.  **Snapshot State:**
    * Read `learningisfun-app/lib/math/content/templates.json` and store the first word problem text in memory (e.g., "Original text").
2.  **Execute Generator:**
    * Run the following command from the `learningisfun-app` directory:
        ```bash
        npx ts-node scripts/generate-content.ts --theme "Pirates"
        ```
3.  **Verify Change:**
    * Read `learningisfun-app/lib/math/content/templates.json` again.
4.  **Assertions:**
    * The file content MUST be different from the snapshot.
    * The text MUST contain at least one "Pirate" keyword: `ship`, `gold`, `coins`, `parrot`, `captain`, or `sea`.
    * The text MUST NOT contain the previous "Original text".

---

## Test Case 3: End-to-End Integration (API Verification)
**Objective:** Verify that the running Next.js API serves the newly generated content immediately.

**Agent Instructions (MCP):**
1.  **Prerequisite:** Ensure Test Case 2 passed (Pirate theme is active).
2.  **Start Server (if not running):**
    * *Note: If the agent cannot maintain a server process, assume `npm run dev` is running in background or skip to step 3 if checking static files.*
3.  **API Call:**
    * Use `fetch_url` (or `curl` via `run_command`) to POST to the local API:
        * **URL:** `http://localhost:3000/api/math/generate`
        * **Method:** `POST`
        * **Body:** `{ "moduleName": "division", "level": "medium" }`
4.  **Assertions:**
    * Parse the JSON response.
    * `response.question.questionText` MUST contain one of the "Pirate" keywords found in Test Case 2.
    * It must NOT be a generic number-only question (e.g., "10 / 2") if a word problem type was selected/generated.

---

## Final QA Sign-Off
* [ ] Test Case 1 Passed (Static Analysis)
* [ ] Test Case 2 Passed (Script Generation)
* [ ] Test Case 3 Passed (Runtime Integration)
