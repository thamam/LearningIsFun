/**  Minification & Merging Summary: 
     - kotarapp\resources\touchutils.js
     - kotarapp\resources\pointerevents.js
     - kotarapp\resources\iscroll-probe.js
     - kotarapp\resources\url.js
     - kotarapp\viewer\controls\toolbar\toolbar.js
     - kotarapp\viewer\controls\toolbar\toolbarsubmenu.js
     - kotarapp\viewer\controls\toolbar\sidebar.js
     - kotarapp\viewer\controls\toolbar\toc.js
     - kotarapp\viewer\controls\toolbar\search.js
     - kotarapp\viewer\controls\toolbar\bookinfo.js
     - kotarapp\viewer\controls\toolbar\booklayers.js
     - kotarapp\viewer\controls\toolbar\booktools.js
     - kotarapp\system\js\masterdrawer.js
     - kotarapp\resources\md5.js
     - kotarapp\viewer\js\postload\bandwidth.js
     - kotarapp\viewer\js\postload\cart.js
     - kotarapp\viewer\js\postload\lms.js
     - kotarapp\viewer\js\postload\onpostload.js
     - kotarapp\viewer\js\postload\restorepoints.js
     - kotarapp\viewer\js\postload\selectregion.js
     - kotarapp\viewer\js\postload\smartlogin.js
     - kotarapp\viewer\js\postload\viewerworker.js
     - kotarapp\viewer\js\postload\bookwords\accessibility.js
     - kotarapp\viewer\js\postload\bookwords\builder.js
     - kotarapp\viewer\js\postload\bookwords\manager.js
     - kotarapp\viewer\js\postload\bookwords\selection.js
     - kotarapp\viewer\js\postload\embeded\builder.js
     - kotarapp\viewer\js\postload\embeded\list.js
     - kotarapp\viewer\js\postload\embeded\manager.js
     - kotarapp\viewer\js\postload\embeded\multimediaapi.js
     - kotarapp\viewer\js\postload\embeded\status.js
     - kotarapp\viewer\js\postload\markers\builder.js
     - kotarapp\viewer\js\postload\markers\dal.js
     - kotarapp\viewer\js\postload\markers\display.js
     - kotarapp\viewer\js\postload\markers\drag.js
     - kotarapp\viewer\js\postload\markers\events.js
     - kotarapp\viewer\js\postload\markers\frame.js
     - kotarapp\viewer\js\postload\markers\layers.js
     - kotarapp\viewer\js\postload\markers\list.js
     - kotarapp\viewer\js\postload\markers\lmstasks.js
     - kotarapp\viewer\js\postload\markers\manager.js
     - kotarapp\viewer\js\postload\markers\pushpins.js
     - kotarapp\viewer\js\postload\markers\resize.js
     - kotarapp\viewer\js\postload\markers\selections.js
     - kotarapp\viewer\js\postload\markers\selectwords.js
     - kotarapp\viewer\js\postload\markers\style.js
     - kotarapp\viewer\js\postload\markers\taskformwrapper.js
     - kotarapp\viewer\js\postload\tools\bookbibliography.js
     - kotarapp\viewer\js\postload\tools\copy.js
     - kotarapp\viewer\js\postload\tools\print.js
     - kotarapp\viewer\js\postload\windows\utils.js
     - kotarapp\viewer\js\postload\wordselection\copytoclipboard.js
     - kotarapp\viewer\js\postload\wordselection\dictionarymanager.js
     - kotarapp\viewer\js\postload\wordselection\list.js
     - kotarapp\viewer\js\postload\wordselection\manager.js
     - kotarapp\viewer\js\postload\windows\newnote\audiences.js
     - kotarapp\viewer\js\postload\windows\newnote\editor.js
     - kotarapp\viewer\js\postload\windows\newnote\projects.js
     - kotarapp\viewer\js\postload\windows\newnote\utils.js
     - kotarapp\viewer\js\postload\windows\newnote\viewer.js
**/

/** ========== kotarapp\resources\touchutils.js ========== **/
var TouchUtils=TouchUtils||{};(function(k){var h=window.navigator.pointerEnabled;var g=!h&&window.navigator.msPointerEnabled;var i=("ontouchstart" in window);no_mouseevents=i&&is_mobile;var d=e();k.EventStart=d[0];k.EventMove=d[1];k.EventEnd=d[2];function f(l){if(l.originalEvent.changedTouches[0].pageX||l.originalEvent.changedTouches[0].pageY){return{x:l.originalEvent.changedTouches[0].pageX,y:l.originalEvent.changedTouches[0].pageY};}else{var m=l.originalEvent.changedTouches[0].clientX+document.body.scrollLeft-document.body.clientLeft;var n=l.originalEvent.changedTouches[0].clientY+document.body.scrollTop-document.body.clientTop;return{x:m,y:n};}}function j(l){var m=l;if(i&&(l.type==="touchstart"||l.type==="touchmove"||l.type==="touchend")){var n=l.touches||l.originalEvent.touches;if(n.length>0){m.clientX=n[0].clientX;m.clientY=n[0].clientY;}m.button=0;}return m;}function a(m){var l=document.createEvent("Event");l.initEvent(m,true,true);l.button=0;if(i&&(m==="touchstart"||m==="touchmove"||m==="touchend")){l.touches=[];}return l;}function e(){var l;if(h){l=[["pointerdown"],["pointermove"],["pointerup","pointercancel"]];}else{if(g){l=[["MSPointerDown"],["MSPointerMove"],["MSPointerUp","MSPointerCancel"]];}else{if(no_mouseevents){l=[["touchstart"],["touchmove"],["touchend","touchcancel"]];}else{l=[["touchstart","mousedown"],["touchmove","mousemove"],["touchend","touchcancel","mouseup"]];}}}return l;}function b(){document.body.style.msTouchAction="none";BV_oBook.style.overflowX="hidden";}function c(){document.body.style.msTouchAction="auto";BV_oBook.style.overflowX="visible";}k.GetSingleMouseCords=f;k.NormalizeEvent=j;k.DisableMsScrolling=b;k.EnableMsScrolling=c;k.CreateEvent=a;})(TouchUtils);

/** ========== kotarapp\resources\pointerevents.js ========== **/
var Pointers=Pointers||{};(function(c){function a(g){if(Toolbar&&Toolbar.isSreaching){var j=g.srcElement?g.srcElement:g.target;var i=$(j).closest("#searchwarpper");if(i.length===0){Toolbar.SubMenu.Hide();BookScroll.MoveOnScreen();}}if(BookScroll&&BookScroll.inGotoMode){BookScroll.inGotoMode=false;var k=document.getElementById("scrollpagesindicatorText");k.blur();var h=document.getElementById("trFooterContainer");h.style.display="";var l=document.getElementById("mytoolbar");l.style.display="";}if(is_IOS&&Notes&&Notes.Editor.Visible()){var j=g.srcElement?g.srcElement:g.target;var i=$(j).closest("#BV_oNotesEditor");if(i.length===0){Notes.Editor.Blur(true);}}var m=TouchUtils.NormalizeEvent(g);mousePos=mouseCoords(m);if(typeof(book_OnMouseDown)!=="undefined"){book_OnMouseDown(g);}}function b(f){var g=TouchUtils.NormalizeEvent(f);mousePos=mouseCoords(g);if(Toolbar!==undefined){if(!Toolbar.Visible()&&f.clientY<=5){Toolbar.Show();BookScroll.Show();}}if(typeof(book_OnMouseMove)!=="undefined"){book_OnMouseMove(f);}}function d(f){if(typeof(book_OnMouseUp)!=="undefined"){book_OnMouseUp(f);}}c.pointerdown=a;c.pointermove=b;c.pointerup=d;})(Pointers);

/** ========== kotarapp\resources\iscroll-probe.js ========== **/
/* iScroll v5.1.3 ~ (c) 2008-2014 Matteo Spinelli ~ http://cubiq.org/license */
(function(h,b,e){var f=h.requestAnimationFrame||h.webkitRequestAnimationFrame||h.mozRequestAnimationFrame||h.oRequestAnimationFrame||h.msRequestAnimationFrame||function(i){h.setTimeout(i,1000/60);};var g=(function(){var n={};var i=b.createElement("div").style;var l=(function(){var r=["t","webkitT","MozT","msT","OT"],q,o=0,p=r.length;for(;o<p;o++){q=r[o]+"ransform";if(q in i){return r[o].substr(0,r[o].length-1);}}return false;})();function j(o){if(l===false){return false;}if(l===""){return o;}return l+o.charAt(0).toUpperCase()+o.substr(1);}n.getTime=Date.now||function m(){return new Date().getTime();};n.extend=function(q,p){for(var o in p){q[o]=p[o];}};n.addEvent=function(p,r,q,o){p.addEventListener(r,q,!!o);};n.removeEvent=function(p,r,q,o){p.removeEventListener(r,q,!!o);};n.prefixPointerEvent=function(o){return h.MSPointerEvent?"MSPointer"+o.charAt(9).toUpperCase()+o.substr(10):o;};n.momentum=function(o,v,w,t,x,p){var r=o-v,u=e.abs(r)/w,q,s;p=p===undefined?0.0006:p;q=o+(u*u)/(2*p)*(r<0?-1:1);s=u/p;if(q<t){q=x?t-(x/2.5*(u/8)):t;r=e.abs(q-o);s=r/u;}else{if(q>0){q=x?x/2.5*(u/8):0;r=e.abs(o)+q;s=r/u;}}return{destination:e.round(q),duration:s};};var k=j("transform");n.extend(n,{hasTransform:k!==false,hasPerspective:j("perspective") in i,hasTouch:"ontouchstart" in h,hasPointer:h.PointerEvent||h.MSPointerEvent,hasTransition:j("transition") in i});n.isBadAndroid=/Android /.test(h.navigator.appVersion)&&!(/Chrome\/\d/.test(h.navigator.appVersion));n.extend(n.style={},{transform:k,transitionTimingFunction:j("transitionTimingFunction"),transitionDuration:j("transitionDuration"),transitionDelay:j("transitionDelay"),transformOrigin:j("transformOrigin")});n.hasClass=function(p,o){var q=new RegExp("(^|\\s)"+o+"(\\s|$)");return q.test(p.className);};n.addClass=function(p,o){if(n.hasClass(p,o)){return;}var q=p.className.split(" ");q.push(o);p.className=q.join(" ");};n.removeClass=function(p,o){if(!n.hasClass(p,o)){return;}var q=new RegExp("(^|\\s)"+o+"(\\s|$)","g");p.className=p.className.replace(q," ");};n.offset=function(o){var p=-o.offsetLeft,q=-o.offsetTop;while(o=o.offsetParent){p-=o.offsetLeft;q-=o.offsetTop;}return{left:p,top:q};};n.preventDefaultException=function(o,p){for(var q in p){if(p[q].test(o[q])){return true;}}return false;};n.extend(n.eventType={},{touchstart:1,touchmove:1,touchend:1,mousedown:2,mousemove:2,mouseup:2,pointerdown:3,pointermove:3,pointerup:3,MSPointerDown:3,MSPointerMove:3,MSPointerUp:3});n.extend(n.ease={},{quadratic:{style:"cubic-bezier(0.25, 0.46, 0.45, 0.94)",fn:function(o){return o*(2-o);}},circular:{style:"cubic-bezier(0.1, 0.57, 0.1, 1)",fn:function(o){return e.sqrt(1-(--o*o));}},back:{style:"cubic-bezier(0.175, 0.885, 0.32, 1.275)",fn:function(p){var o=4;return(p=p-1)*p*((o+1)*p+o)+1;}},bounce:{style:"",fn:function(o){if((o/=1)<(1/2.75)){return 7.5625*o*o;}else{if(o<(2/2.75)){return 7.5625*(o-=(1.5/2.75))*o+0.75;}else{if(o<(2.5/2.75)){return 7.5625*(o-=(2.25/2.75))*o+0.9375;}else{return 7.5625*(o-=(2.625/2.75))*o+0.984375;}}}}},elastic:{style:"",fn:function(q){var p=0.22,o=0.4;if(q===0){return 0;}if(q==1){return 1;}return(o*e.pow(2,-10*q)*e.sin((q-p/4)*(2*e.PI)/p)+1);}}});n.tap=function(o,q){var p=b.createEvent("Event");p.initEvent(q,true,true);p.pageX=o.pageX;p.pageY=o.pageY;o.target.dispatchEvent(p);};n.click=function(o){var q=o.target,p,r=0;if(!(/(SELECT|INPUT|TEXTAREA)/i).test(q.tagName)){p=b.createEvent("MouseEvents");p.initMouseEvent("click",true,true,o.view,1,q.screenX,q.screenY,q.clientX,q.clientY,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,0,null);p._constructed=true;if(is_phone){r=300;}setTimeout(function(){q.dispatchEvent(p);},r);}};return n;})();function d(j,l){this.wrapper=typeof j=="string"?b.querySelector(j):j;this.scroller=this.wrapper.children[0];this.scrollerStyle=this.scroller.style;this.options={resizeScrollbars:true,mouseWheelSpeed:20,snapThreshold:0.334,preventWrapperScroll:false,startX:0,startY:0,scrollY:true,directionLockThreshold:5,momentum:true,bounce:true,bounceTime:600,bounceEasing:"",preventDefault:true,preventDefaultException:{tagName:/^(INPUT|TEXTAREA|BUTTON|SELECT)$/},HWCompositing:true,useTransition:true,useTransform:true};for(var k in l){this.options[k]=l[k];}this.translateZ=this.options.HWCompositing&&g.hasPerspective?" translateZ(0)":"";this.options.useTransition=g.hasTransition&&this.options.useTransition;this.options.useTransform=g.hasTransform&&this.options.useTransform;this.options.eventPassthrough=this.options.eventPassthrough===true?"vertical":this.options.eventPassthrough;this.options.preventDefault=!this.options.eventPassthrough&&this.options.preventDefault;this.options.scrollY=this.options.eventPassthrough=="vertical"?false:this.options.scrollY;this.options.scrollX=this.options.eventPassthrough=="horizontal"?false:this.options.scrollX;this.options.freeScroll=this.options.freeScroll&&!this.options.eventPassthrough;this.options.directionLockThreshold=this.options.eventPassthrough?0:this.options.directionLockThreshold;this.options.bounceEasing=typeof this.options.bounceEasing=="string"?g.ease[this.options.bounceEasing]||g.ease.circular:this.options.bounceEasing;this.options.resizePolling=this.options.resizePolling===undefined?60:this.options.resizePolling;if(this.options.tap===true){this.options.tap="tap";}if(this.options.shrinkScrollbars=="scale"){this.options.useTransition=false;}this.options.invertWheelDirection=this.options.invertWheelDirection?-1:1;if(this.options.probeType==3){this.options.useTransition=false;}this.x=0;this.y=0;this.directionX=0;this.directionY=0;this._events={};this._init();this.refresh();this.scrollTo(this.options.startX,this.options.startY);this.enable();}d.prototype={version:"5.1.3",_init:function(){this._initEvents();if(this.options.scrollbars||this.options.indicators){this._initIndicators();}if(this.options.mouseWheel){this._initWheel();}if(this.options.snap){this._initSnap();}if(this.options.keyBindings){this._initKeys();}},destroy:function(){this._initEvents(true);this._execEvent("destroy");},_transitionEnd:function(i){if(i.target!=this.scroller||!this.isInTransition){return;}this._transitionTime();if(!this.resetPosition(this.options.bounceTime)){this.isInTransition=false;this._execEvent("scrollEnd");}},_start:function(i){if(g.eventType[i.type]!=1){if(i.button!==0){return;}}if(!this.enabled||(this.initiated&&g.eventType[i.type]!==this.initiated)){return;}if(this.options.preventDefault&&!g.isBadAndroid&&!g.preventDefaultException(i.target,this.options.preventDefaultException)){i.preventDefault();}var j=i.touches?i.touches[0]:i,k;this.initiated=g.eventType[i.type];this.moved=false;this.distX=0;this.distY=0;this.directionX=0;this.directionY=0;this.directionLocked=0;this._transitionTime();this.startTime=g.getTime();if(this.options.useTransition&&this.isInTransition){this.isInTransition=false;k=this.getComputedPosition();this._translate(e.round(k.x),e.round(k.y));this._execEvent("scrollEnd");}else{if(!this.options.useTransition&&this.isAnimating){this.isAnimating=false;this._execEvent("scrollEnd");}}this.startX=this.x;this.startY=this.y;this.absStartX=this.x;this.absStartY=this.y;this.pointX=j.pageX;this.pointY=j.pageY;this._execEvent("beforeScrollStart");},_move:function(m){if(!this.enabled||g.eventType[m.type]!==this.initiated){return;}if(this.options.preventDefault){m.preventDefault();}var p=m.touches?m.touches[0]:m,k=p.pageX-this.pointX,l=p.pageY-this.pointY,q=g.getTime(),n,o,i,j;this.pointX=p.pageX;this.pointY=p.pageY;this.distX+=k;this.distY+=l;i=e.abs(this.distX);j=e.abs(this.distY);if(q-this.endTime>300&&(i<10&&j<10)){return;}if(!this.directionLocked&&!this.options.freeScroll){if(i>j+this.options.directionLockThreshold){this.directionLocked="h";}else{if(j>=i+this.options.directionLockThreshold){this.directionLocked="v";}else{this.directionLocked="n";}}}if(this.directionLocked=="h"){if(this.options.eventPassthrough=="vertical"){m.preventDefault();}else{if(this.options.eventPassthrough=="horizontal"){this.initiated=false;return;}}l=0;}else{if(this.directionLocked=="v"){if(this.options.eventPassthrough=="horizontal"){m.preventDefault();}else{if(this.options.eventPassthrough=="vertical"){this.initiated=false;return;}}k=0;}}k=this.hasHorizontalScroll?k:0;l=this.hasVerticalScroll?l:0;n=this.x+k;o=this.y+l;if(n>0||n<this.maxScrollX){n=this.options.bounce?this.x+k/3:n>0?0:this.maxScrollX;}if(o>0||o<this.maxScrollY){o=this.options.bounce?this.y+l/3:o>0?0:this.maxScrollY;}this.directionX=k>0?-1:k<0?1:0;this.directionY=l>0?-1:l<0?1:0;if(!this.moved){this._execEvent("scrollStart");}this.moved=true;this._translate(n,o);if(q-this.startTime>300){this.startTime=q;this.startX=this.x;this.startY=this.y;if(this.options.probeType==1){this._execEvent("scroll");}}if(this.options.probeType>1){this._execEvent("scroll");}},_end:function(l){if(!this.enabled||g.eventType[l.type]!==this.initiated){return;}if(this.options.preventDefault&&!g.preventDefaultException(l.target,this.options.preventDefaultException)){l.preventDefault();}var r=l.changedTouches?l.changedTouches[0]:l,n,o,k=g.getTime()-this.startTime,p=e.round(this.x),q=e.round(this.y),i=e.abs(p-this.startX),j=e.abs(q-this.startY),t=0,m="";this.isInTransition=0;this.initiated=0;this.endTime=g.getTime();if(this.resetPosition(this.options.bounceTime)){return;}this.scrollTo(p,q);if(!this.moved){if(this.options.tap){g.tap(l,this.options.tap);}if(this.options.click){g.click(l);}this._execEvent("scrollCancel");return;}if(this._events.flick&&k<200&&i<100&&j<100){this._execEvent("flick");return;}if(this.options.momentum&&k<300){n=this.hasHorizontalScroll?g.momentum(this.x,this.startX,k,this.maxScrollX,this.options.bounce?this.wrapperWidth:0,this.options.deceleration):{destination:p,duration:0};o=this.hasVerticalScroll?g.momentum(this.y,this.startY,k,this.maxScrollY,this.options.bounce?this.wrapperHeight:0,this.options.deceleration):{destination:q,duration:0};p=n.destination;q=o.destination;t=e.max(n.duration,o.duration);this.isInTransition=1;}if(this.options.snap){var s=this._nearestSnap(p,q);this.currentPage=s;t=this.options.snapSpeed||e.max(e.max(e.min(e.abs(p-s.x),1000),e.min(e.abs(q-s.y),1000)),300);p=s.x;q=s.y;this.directionX=0;this.directionY=0;m=this.options.bounceEasing;}if(p!=this.x||q!=this.y){if(p>0||p<this.maxScrollX||q>0||q<this.maxScrollY){m=g.ease.quadratic;}this.scrollTo(p,q,t,m);return;}this._execEvent("scrollEnd");},_resize:function(){var i=this;clearTimeout(this.resizeTimeout);this.resizeTimeout=setTimeout(function(){i.refresh();},this.options.resizePolling);},resetPosition:function(i){var j=this.x,k=this.y;i=i||0;if(!this.hasHorizontalScroll||this.x>0){j=0;}else{if(this.x<this.maxScrollX){j=this.maxScrollX;}}if(!this.hasVerticalScroll||this.y>0){k=0;}else{if(this.y<this.maxScrollY){k=this.maxScrollY;}}if(j==this.x&&k==this.y){return false;}this.scrollTo(j,k,i,this.options.bounceEasing);return true;},disable:function(){this.enabled=false;},enable:function(){this.enabled=true;},refresh:function(){var i=this.wrapper.offsetHeight;this.wrapperWidth=this.wrapper.clientWidth;this.wrapperHeight=this.wrapper.clientHeight;this.scrollerWidth=this.scroller.offsetWidth;this.scrollerHeight=this.scroller.offsetHeight;this.maxScrollX=this.wrapperWidth-this.scrollerWidth;this.maxScrollY=this.wrapperHeight-this.scrollerHeight;this.hasHorizontalScroll=this.options.scrollX&&this.maxScrollX<0;this.hasVerticalScroll=this.options.scrollY&&this.maxScrollY<0;if(!this.hasHorizontalScroll){this.maxScrollX=0;this.scrollerWidth=this.wrapperWidth;}if(!this.hasVerticalScroll){this.maxScrollY=0;this.scrollerHeight=this.wrapperHeight;}this.endTime=0;this.directionX=0;this.directionY=0;this.wrapperOffset=g.offset(this.wrapper);this._execEvent("refresh");this.resetPosition();},on:function(j,i){if(!this._events[j]){this._events[j]=[];}this._events[j].push(i);},off:function(k,i){if(!this._events[k]){return;}var j=this._events[k].indexOf(i);if(j>-1){this._events[k].splice(j,1);}},_execEvent:function(m){if(!this._events[m]){return;}var j=0,k=this._events[m].length;if(!k){return;}for(;j<k;j++){this._events[m][j].apply(this,[].slice.call(arguments,1));}},scrollBy:function(k,l,j,i){k=this.x+k;l=this.y+l;j=j||0;this.scrollTo(k,l,j,i);},scrollTo:function(k,l,j,i){i=i||g.ease.circular;this.isInTransition=this.options.useTransition&&j>0;if(!j||(this.options.useTransition&&i.style)){this._transitionTimingFunction(i.style);this._transitionTime(j);this._translate(k,l);}else{this._animate(k,l,j,i.fn);}},scrollToElement:function(j,n,k,l,i){j=j.nodeType?j:this.scroller.querySelector(j);if(!j){return;}var m=g.offset(j);m.left-=this.wrapperOffset.left;m.top-=this.wrapperOffset.top;if(k===true){k=e.round(j.offsetWidth/2-this.wrapper.offsetWidth/2);}if(l===true){l=e.round(j.offsetHeight/2-this.wrapper.offsetHeight/2);}m.left-=k||0;m.top-=l||0;m.left=m.left>0?0:m.left<this.maxScrollX?this.maxScrollX:m.left;m.top=m.top>0?0:m.top<this.maxScrollY?this.maxScrollY:m.top;n=n===undefined||n===null||n==="auto"?e.max(e.abs(this.x-m.left),e.abs(this.y-m.top)):n;this.scrollTo(m.left,m.top,n,i);},_transitionTime:function(k){k=k||0;this.scrollerStyle[g.style.transitionDuration]=k+"ms";if(!k&&g.isBadAndroid){this.scrollerStyle[g.style.transitionDuration]="0.001s";}if(this.indicators){for(var j=this.indicators.length;j--;){this.indicators[j].transitionTime(k);}}},_transitionTimingFunction:function(j){this.scrollerStyle[g.style.transitionTimingFunction]=j;if(this.indicators){for(var k=this.indicators.length;k--;){this.indicators[k].transitionTimingFunction(j);}}},_translate:function(k,l){if(this.options.useTransform){this.scrollerStyle[g.style.transform]="translate("+k+"px,"+l+"px)"+this.translateZ;}else{k=e.round(k);l=e.round(l);this.scrollerStyle.left=k+"px";this.scrollerStyle.top=l+"px";}this.x=k;this.y=l;if(this.indicators){for(var j=this.indicators.length;j--;){this.indicators[j].updatePosition();}}},_initEvents:function(j){var i=j?g.removeEvent:g.addEvent,k=this.options.bindToWrapper?this.wrapper:h;i(h,"orientationchange",this);i(h,"resize",this);if(this.options.preventWrapperScroll){i(this.wrapper,"scroll",this);}if(this.options.click){i(this.wrapper,"click",this,true);}if(!this.options.disableMouse){i(this.wrapper,"mousedown",this);i(k,"mousemove",this);i(k,"mousecancel",this);i(k,"mouseup",this);}if(g.hasPointer&&!this.options.disablePointer){i(this.wrapper,g.prefixPointerEvent("pointerdown"),this);i(k,g.prefixPointerEvent("pointermove"),this);i(k,g.prefixPointerEvent("pointercancel"),this);i(k,g.prefixPointerEvent("pointerup"),this);}if(g.hasTouch&&!this.options.disableTouch){i(this.wrapper,"touchstart",this);i(k,"touchmove",this);i(k,"touchcancel",this);i(k,"touchend",this);}i(this.scroller,"transitionend",this);i(this.scroller,"webkitTransitionEnd",this);i(this.scroller,"oTransitionEnd",this);i(this.scroller,"MSTransitionEnd",this);},getComputedPosition:function(){var i=h.getComputedStyle(this.scroller,null),j,k;if(this.options.useTransform){i=i[g.style.transform].split(")")[0].split(", ");j=+(i[12]||i[4]);k=+(i[13]||i[5]);}else{j=+i.left.replace(/[^-\d.]/g,"");k=+i.top.replace(/[^-\d.]/g,"");}return{x:j,y:k};},_initIndicators:function(){var o=this.options.interactiveScrollbars,k=typeof this.options.scrollbars!="string",n=[],m;var p=this;this.indicators=[];if(this.options.scrollbars){if(this.options.scrollY){m={el:a("v",o,this.options.scrollbars),interactive:o,defaultScrollbars:true,customStyle:k,resize:this.options.resizeScrollbars,shrink:this.options.shrinkScrollbars,fade:this.options.fadeScrollbars,listenX:false};this.wrapper.appendChild(m.el);n.push(m);}if(this.options.scrollX){m={el:a("h",o,this.options.scrollbars),interactive:o,defaultScrollbars:true,customStyle:k,resize:this.options.resizeScrollbars,shrink:this.options.shrinkScrollbars,fade:this.options.fadeScrollbars,listenY:false};this.wrapper.appendChild(m.el);n.push(m);}}if(this.options.indicators){n=n.concat(this.options.indicators);}for(var l=n.length;l--;){this.indicators.push(new c(this,n[l]));}function j(q){for(var r=p.indicators.length;r--;){q.call(p.indicators[r]);}}if(this.options.fadeScrollbars){this.on("scrollEnd",function(){j(function(){this.fade();});});this.on("scrollCancel",function(){j(function(){this.fade();});});this.on("scrollStart",function(){j(function(){this.fade(1);});});this.on("beforeScrollStart",function(){j(function(){this.fade(1,true);});});}this.on("refresh",function(){j(function(){this.refresh();});});this.on("destroy",function(){j(function(){this.destroy();});delete this.indicators;});},_initWheel:function(){g.addEvent(this.wrapper,"wheel",this);g.addEvent(this.wrapper,"mousewheel",this);g.addEvent(this.wrapper,"DOMMouseScroll",this);this.on("destroy",function(){g.removeEvent(this.wrapper,"wheel",this);g.removeEvent(this.wrapper,"mousewheel",this);g.removeEvent(this.wrapper,"DOMMouseScroll",this);});},_wheel:function(i){if(!this.enabled){return;}i.preventDefault();i.stopPropagation();var m,n,j,k,l=this;if(this.wheelTimeout===undefined){l._execEvent("scrollStart");}clearTimeout(this.wheelTimeout);this.wheelTimeout=setTimeout(function(){l._execEvent("scrollEnd");l.wheelTimeout=undefined;},400);if("deltaX" in i){if(i.deltaMode===1){m=-i.deltaX*this.options.mouseWheelSpeed;n=-i.deltaY*this.options.mouseWheelSpeed;}else{m=-i.deltaX;n=-i.deltaY;}}else{if("wheelDeltaX" in i){m=i.wheelDeltaX/120*this.options.mouseWheelSpeed;n=i.wheelDeltaY/120*this.options.mouseWheelSpeed;}else{if("wheelDelta" in i){m=n=i.wheelDelta/120*this.options.mouseWheelSpeed;}else{if("detail" in i){m=n=-i.detail/3*this.options.mouseWheelSpeed;}else{return;}}}}m*=this.options.invertWheelDirection;n*=this.options.invertWheelDirection;if(!this.hasVerticalScroll){m=n;n=0;}if(this.options.snap){j=this.currentPage.pageX;k=this.currentPage.pageY;if(m>0){j--;}else{if(m<0){j++;}}if(n>0){k--;}else{if(n<0){k++;}}this.goToPage(j,k);return;}j=this.x+e.round(this.hasHorizontalScroll?m:0);k=this.y+e.round(this.hasVerticalScroll?n:0);if(j>0){j=0;}else{if(j<this.maxScrollX){j=this.maxScrollX;}}if(k>0){k=0;}else{if(k<this.maxScrollY){k=this.maxScrollY;}}this.scrollTo(j,k,0);if(this.options.probeType>1){this._execEvent("scroll");}},_initSnap:function(){this.currentPage={};if(typeof this.options.snap=="string"){this.options.snap=this.scroller.querySelectorAll(this.options.snap);}this.on("refresh",function(){var p=0,q,r=0,s,j,k,v=0,w,t=this.options.snapStepX||this.wrapperWidth,u=this.options.snapStepY||this.wrapperHeight,o;this.pages=[];if(!this.wrapperWidth||!this.wrapperHeight||!this.scrollerWidth||!this.scrollerHeight){return;}if(this.options.snap===true){j=e.round(t/2);k=e.round(u/2);while(v>-this.scrollerWidth){this.pages[p]=[];q=0;w=0;while(w>-this.scrollerHeight){this.pages[p][q]={x:e.max(v,this.maxScrollX),y:e.max(w,this.maxScrollY),width:t,height:u,cx:v-j,cy:w-k};w-=u;q++;}v-=t;p++;}}else{o=this.options.snap;q=o.length;s=-1;for(;p<q;p++){if(p===0||o[p].offsetLeft<=o[p-1].offsetLeft){r=0;s++;}if(!this.pages[r]){this.pages[r]=[];}v=e.max(-o[p].offsetLeft,this.maxScrollX);w=e.max(-o[p].offsetTop,this.maxScrollY);j=v-e.round(o[p].offsetWidth/2);k=w-e.round(o[p].offsetHeight/2);this.pages[r][s]={x:v,y:w,width:o[p].offsetWidth,height:o[p].offsetHeight,cx:j,cy:k};if(v>this.maxScrollX){r++;}}}this.goToPage(this.currentPage.pageX||0,this.currentPage.pageY||0,0);if(this.options.snapThreshold%1===0){this.snapThresholdX=this.options.snapThreshold;this.snapThresholdY=this.options.snapThreshold;}else{this.snapThresholdX=e.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].width*this.options.snapThreshold);this.snapThresholdY=e.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].height*this.options.snapThreshold);}});this.on("flick",function(){var i=this.options.snapSpeed||e.max(e.max(e.min(e.abs(this.x-this.startX),1000),e.min(e.abs(this.y-this.startY),1000)),300);this.goToPage(this.currentPage.pageX+this.directionX,this.currentPage.pageY+this.directionY,i);});},_nearestSnap:function(o,p){if(!this.pages.length){return{x:0,y:0,pageX:0,pageY:0};}var j=0,k=this.pages.length,n=0;if(e.abs(o-this.absStartX)<this.snapThresholdX&&e.abs(p-this.absStartY)<this.snapThresholdY){return this.currentPage;}if(o>0){o=0;}else{if(o<this.maxScrollX){o=this.maxScrollX;}}if(p>0){p=0;}else{if(p<this.maxScrollY){p=this.maxScrollY;}}for(;j<k;j++){if(o>=this.pages[j][0].cx){o=this.pages[j][0].x;break;}}k=this.pages[j].length;for(;n<k;n++){if(p>=this.pages[0][n].cy){p=this.pages[0][n].y;break;}}if(j==this.currentPage.pageX){j+=this.directionX;if(j<0){j=0;}else{if(j>=this.pages.length){j=this.pages.length-1;}}o=this.pages[j][0].x;}if(n==this.currentPage.pageY){n+=this.directionY;if(n<0){n=0;}else{if(n>=this.pages[0].length){n=this.pages[0].length-1;}}p=this.pages[0][n].y;}return{x:o,y:p,pageX:j,pageY:n};},goToPage:function(m,n,l,i){i=i||this.options.bounceEasing;if(m>=this.pages.length){m=this.pages.length-1;}else{if(m<0){m=0;}}if(n>=this.pages[m].length){n=this.pages[m].length-1;}else{if(n<0){n=0;}}var j=this.pages[m][n].x,k=this.pages[m][n].y;l=l===undefined?this.options.snapSpeed||e.max(e.max(e.min(e.abs(j-this.x),1000),e.min(e.abs(k-this.y),1000)),300):l;this.currentPage={x:j,y:k,pageX:m,pageY:n};this.scrollTo(j,k,l,i);},next:function(j,i){var k=this.currentPage.pageX,l=this.currentPage.pageY;k++;if(k>=this.pages.length&&this.hasVerticalScroll){k=0;l++;}this.goToPage(k,l,j,i);},prev:function(j,i){var k=this.currentPage.pageX,l=this.currentPage.pageY;k--;if(k<0&&this.hasVerticalScroll){k=0;l--;}this.goToPage(k,l,j,i);},_initKeys:function(j){var l={pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40};var k;if(typeof this.options.keyBindings=="object"){for(k in this.options.keyBindings){if(typeof this.options.keyBindings[k]=="string"){this.options.keyBindings[k]=this.options.keyBindings[k].toUpperCase().charCodeAt(0);}}}else{this.options.keyBindings={};}for(k in l){this.options.keyBindings[k]=this.options.keyBindings[k]||l[k];}g.addEvent(h,"keydown",this);this.on("destroy",function(){g.removeEvent(h,"keydown",this);});},_key:function(j){if(!this.enabled){return;}var p=this.options.snap,k=p?this.currentPage.pageX:this.x,l=p?this.currentPage.pageY:this.y,m=g.getTime(),o=this.keyTime||0,i=0.25,n;if(this.options.useTransition&&this.isInTransition){n=this.getComputedPosition();this._translate(e.round(n.x),e.round(n.y));this.isInTransition=false;}this.keyAcceleration=m-o<200?e.min(this.keyAcceleration+i,50):0;switch(j.keyCode){case this.options.keyBindings.pageUp:if(this.hasHorizontalScroll&&!this.hasVerticalScroll){k+=p?1:this.wrapperWidth;}else{l+=p?1:this.wrapperHeight;}break;case this.options.keyBindings.pageDown:if(this.hasHorizontalScroll&&!this.hasVerticalScroll){k-=p?1:this.wrapperWidth;}else{l-=p?1:this.wrapperHeight;}break;case this.options.keyBindings.end:k=p?this.pages.length-1:this.maxScrollX;l=p?this.pages[0].length-1:this.maxScrollY;break;case this.options.keyBindings.home:k=0;l=0;break;case this.options.keyBindings.left:k+=p?-1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.up:l+=p?1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.right:k-=p?-1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.down:l-=p?1:5+this.keyAcceleration>>0;break;default:return;}if(p){this.goToPage(k,l);return;}if(k>0){k=0;this.keyAcceleration=0;}else{if(k<this.maxScrollX){k=this.maxScrollX;this.keyAcceleration=0;}}if(l>0){l=0;this.keyAcceleration=0;}else{if(l<this.maxScrollY){l=this.maxScrollY;this.keyAcceleration=0;}}this.scrollTo(k,l,0);this.keyTime=m;},_animate:function(j,k,l,m){var r=this,o=this.x,p=this.y,n=g.getTime(),i=n+l;function q(){var v=g.getTime(),t,u,s;if(v>=i){r.isAnimating=false;r._translate(j,k);if(!r.resetPosition(r.options.bounceTime)){r._execEvent("scrollEnd");}return;}v=(v-n)/l;s=m(v);t=(j-o)*s+o;u=(k-p)*s+p;r._translate(t,u);if(r.isAnimating){f(q);}if(r.options.probeType==3){r._execEvent("scroll");}}this.isAnimating=true;q();},_preventWrraperScroll:function(j){var i=this.wrapper.scrollTop;if(i>0){var k=this;this.wrapper.scrollTop=0;setTimeout(function(l){k.scrollBy(0,-l);k.wrapper.style.display="none";var m=k.wrapper.offsetHeight;k.wrapper.style.display="";},0,i);}},handleEvent:function(i){switch(i.type){case"touchstart":case"pointerdown":case"MSPointerDown":case"mousedown":this._start(i);break;case"touchmove":case"pointermove":case"MSPointerMove":case"mousemove":this._move(i);break;case"touchend":case"pointerup":case"MSPointerUp":case"mouseup":case"touchcancel":case"pointercancel":case"MSPointerCancel":case"mousecancel":this._end(i);break;case"orientationchange":case"resize":this._resize();break;case"scroll":this._preventWrraperScroll(i);break;case"transitionend":case"webkitTransitionEnd":case"oTransitionEnd":case"MSTransitionEnd":this._transitionEnd(i);break;case"wheel":case"DOMMouseScroll":case"mousewheel":this._wheel(i);break;case"keydown":this._key(i);break;case"click":if(!i._constructed){i.preventDefault();i.stopPropagation();}break;}}};function a(i,k,m){var l=b.createElement("div"),j=b.createElement("div");if(m===true){l.style.cssText="position:absolute;z-index:9999";j.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);border-radius:3px";}j.className="iScrollIndicator";if(i=="h"){if(m===true){l.style.cssText+=";height:7px;left:2px;right:2px;bottom:0";j.style.height="100%";}l.className="iScrollHorizontalScrollbar";}else{if(m===true){l.style.cssText+=BaseMaster_sDirection==="ltr"?";width:7px;bottom:2px;top:2px;left:1px":";width:7px;bottom:2px;top:2px;right:1px";j.style.width="100%";}l.className="iScrollVerticalScrollbar";}l.style.cssText+=";overflow:hidden";if(!k){l.style.pointerEvents="none";}l.appendChild(j);return l;}function c(l,k){this.wrapper=typeof k.el=="string"?b.querySelector(k.el):k.el;this.wrapperStyle=this.wrapper.style;this.indicator=this.wrapper.children[0];this.indicatorStyle=this.indicator.style;this.scroller=l;this.options={listenX:true,listenY:true,interactive:false,resize:true,defaultScrollbars:false,shrink:false,fade:false,speedRatioX:0,speedRatioY:0};for(var j in k){this.options[j]=k[j];}this.sizeRatioX=1;this.sizeRatioY=1;this.maxPosX=0;this.maxPosY=0;if(this.options.interactive){if(!this.options.disableTouch){g.addEvent(this.indicator,"touchstart",this);g.addEvent(h,"touchend",this);}if(!this.options.disablePointer){g.addEvent(this.indicator,g.prefixPointerEvent("pointerdown"),this);g.addEvent(h,g.prefixPointerEvent("pointerup"),this);}if(!this.options.disableMouse){g.addEvent(this.indicator,"mousedown",this);g.addEvent(h,"mouseup",this);}}if(this.options.fade){this.wrapperStyle[g.style.transform]=this.scroller.translateZ;this.wrapperStyle[g.style.transitionDuration]=g.isBadAndroid?"0.001s":"0ms";this.wrapperStyle.opacity="0";}}c.prototype={handleEvent:function(i){switch(i.type){case"touchstart":case"pointerdown":case"MSPointerDown":case"mousedown":this._start(i);break;case"touchmove":case"pointermove":case"MSPointerMove":case"mousemove":this._move(i);break;case"touchend":case"pointerup":case"MSPointerUp":case"mouseup":case"touchcancel":case"pointercancel":case"MSPointerCancel":case"mousecancel":this._end(i);break;}},destroy:function(){if(this.options.interactive){g.removeEvent(this.indicator,"touchstart",this);g.removeEvent(this.indicator,g.prefixPointerEvent("pointerdown"),this);g.removeEvent(this.indicator,"mousedown",this);g.removeEvent(h,"touchmove",this);g.removeEvent(h,g.prefixPointerEvent("pointermove"),this);g.removeEvent(h,"mousemove",this);g.removeEvent(h,"touchend",this);g.removeEvent(h,g.prefixPointerEvent("pointerup"),this);g.removeEvent(h,"mouseup",this);}if(this.options.defaultScrollbars){this.wrapper.parentNode.removeChild(this.wrapper);}},_start:function(i){var j=i.touches?i.touches[0]:i;i.preventDefault();i.stopPropagation();this.transitionTime();this.initiated=true;this.moved=false;this.lastPointX=j.pageX;this.lastPointY=j.pageY;this.startTime=g.getTime();if(!this.options.disableTouch){g.addEvent(h,"touchmove",this);}if(!this.options.disablePointer){g.addEvent(h,g.prefixPointerEvent("pointermove"),this);}if(!this.options.disableMouse){g.addEvent(h,"mousemove",this);}this.scroller._execEvent("beforeScrollStart");},_move:function(k){var n=k.touches?k.touches[0]:k,i,j,l,m,o=g.getTime();if(!this.moved){this.scroller._execEvent("scrollStart");}this.moved=true;i=n.pageX-this.lastPointX;this.lastPointX=n.pageX;j=n.pageY-this.lastPointY;this.lastPointY=n.pageY;l=this.x+i;m=this.y+j;this._pos(l,m);if(this.scroller.options.probeType==1&&o-this.startTime>300){this.startTime=o;this.scroller._execEvent("scroll");}else{if(this.scroller.options.probeType>1){this.scroller._execEvent("scroll");}}k.preventDefault();k.stopPropagation();},_end:function(i){if(!this.initiated){return;}this.initiated=false;i.preventDefault();i.stopPropagation();g.removeEvent(h,"touchmove",this);g.removeEvent(h,g.prefixPointerEvent("pointermove"),this);g.removeEvent(h,"mousemove",this);if(this.scroller.options.snap){var j=this.scroller._nearestSnap(this.scroller.x,this.scroller.y);var k=this.options.snapSpeed||e.max(e.max(e.min(e.abs(this.scroller.x-j.x),1000),e.min(e.abs(this.scroller.y-j.y),1000)),300);if(this.scroller.x!=j.x||this.scroller.y!=j.y){this.scroller.directionX=0;this.scroller.directionY=0;this.scroller.currentPage=j;this.scroller.scrollTo(j.x,j.y,k,this.scroller.options.bounceEasing);}}if(this.moved){this.scroller._execEvent("scrollEnd");}},transitionTime:function(i){i=i||0;this.indicatorStyle[g.style.transitionDuration]=i+"ms";if(!i&&g.isBadAndroid){this.indicatorStyle[g.style.transitionDuration]="0.001s";}},transitionTimingFunction:function(i){this.indicatorStyle[g.style.transitionTimingFunction]=i;},refresh:function(){this.transitionTime();if(this.options.listenX&&!this.options.listenY){this.indicatorStyle.display=this.scroller.hasHorizontalScroll?"block":"none";}else{if(this.options.listenY&&!this.options.listenX){this.indicatorStyle.display=this.scroller.hasVerticalScroll?"block":"none";}else{this.indicatorStyle.display=this.scroller.hasHorizontalScroll||this.scroller.hasVerticalScroll?"block":"none";}}if(this.scroller.hasHorizontalScroll&&this.scroller.hasVerticalScroll){g.addClass(this.wrapper,"iScrollBothScrollbars");g.removeClass(this.wrapper,"iScrollLoneScrollbar");if(this.options.defaultScrollbars&&this.options.customStyle){if(this.options.listenX){this.wrapper.style.right="8px";}else{this.wrapper.style.bottom="8px";}}}else{g.removeClass(this.wrapper,"iScrollBothScrollbars");g.addClass(this.wrapper,"iScrollLoneScrollbar");if(this.options.defaultScrollbars&&this.options.customStyle){if(this.options.listenX){this.wrapper.style.right="2px";}else{this.wrapper.style.bottom="2px";}}}var i=this.wrapper.offsetHeight;if(this.options.listenX){this.wrapperWidth=this.wrapper.clientWidth;if(this.options.resize){this.indicatorWidth=e.max(e.round(this.wrapperWidth*this.wrapperWidth/(this.scroller.scrollerWidth||this.wrapperWidth||1)),8);this.indicatorStyle.width=this.indicatorWidth+"px";}else{this.indicatorWidth=this.indicator.clientWidth;}this.maxPosX=this.wrapperWidth-this.indicatorWidth;if(this.options.shrink=="clip"){this.minBoundaryX=-this.indicatorWidth+8;this.maxBoundaryX=this.wrapperWidth-8;}else{this.minBoundaryX=0;this.maxBoundaryX=this.maxPosX;}this.sizeRatioX=this.options.speedRatioX||(this.scroller.maxScrollX&&(this.maxPosX/this.scroller.maxScrollX));}if(this.options.listenY){this.wrapperHeight=this.wrapper.clientHeight;if(this.options.resize){this.indicatorHeight=e.max(e.round(this.wrapperHeight*this.wrapperHeight/(this.scroller.scrollerHeight||this.wrapperHeight||1)),8);this.indicatorStyle.height=this.indicatorHeight+"px";}else{this.indicatorHeight=this.indicator.clientHeight;}this.maxPosY=this.wrapperHeight-this.indicatorHeight;if(this.options.shrink=="clip"){this.minBoundaryY=-this.indicatorHeight+8;this.maxBoundaryY=this.wrapperHeight-8;}else{this.minBoundaryY=0;this.maxBoundaryY=this.maxPosY;}this.maxPosY=this.wrapperHeight-this.indicatorHeight;this.sizeRatioY=this.options.speedRatioY||(this.scroller.maxScrollY&&(this.maxPosY/this.scroller.maxScrollY));}this.updatePosition();},updatePosition:function(){var i=this.options.listenX&&e.round(this.sizeRatioX*this.scroller.x)||0,j=this.options.listenY&&e.round(this.sizeRatioY*this.scroller.y)||0;if(!this.options.ignoreBoundaries){if(i<this.minBoundaryX){if(this.options.shrink=="scale"){this.width=e.max(this.indicatorWidth+i,8);this.indicatorStyle.width=this.width+"px";}i=this.minBoundaryX;}else{if(i>this.maxBoundaryX){if(this.options.shrink=="scale"){this.width=e.max(this.indicatorWidth-(i-this.maxPosX),8);this.indicatorStyle.width=this.width+"px";i=this.maxPosX+this.indicatorWidth-this.width;}else{i=this.maxBoundaryX;}}else{if(this.options.shrink=="scale"&&this.width!=this.indicatorWidth){this.width=this.indicatorWidth;this.indicatorStyle.width=this.width+"px";}}}if(j<this.minBoundaryY){if(this.options.shrink=="scale"){this.height=e.max(this.indicatorHeight+j*3,8);this.indicatorStyle.height=this.height+"px";}j=this.minBoundaryY;}else{if(j>this.maxBoundaryY){if(this.options.shrink=="scale"){this.height=e.max(this.indicatorHeight-(j-this.maxPosY)*3,8);this.indicatorStyle.height=this.height+"px";j=this.maxPosY+this.indicatorHeight-this.height;}else{j=this.maxBoundaryY;}}else{if(this.options.shrink=="scale"&&this.height!=this.indicatorHeight){this.height=this.indicatorHeight;this.indicatorStyle.height=this.height+"px";}}}}this.x=i;this.y=j;if(this.scroller.options.useTransform){this.indicatorStyle[g.style.transform]="translate("+i+"px,"+j+"px)"+this.scroller.translateZ;}else{this.indicatorStyle.left=i+"px";this.indicatorStyle.top=j+"px";}},_pos:function(i,j){if(i<0){i=0;}else{if(i>this.maxPosX){i=this.maxPosX;}}if(j<0){j=0;}else{if(j>this.maxPosY){j=this.maxPosY;}}i=this.options.listenX?e.round(i/this.sizeRatioX):this.scroller.x;j=this.options.listenY?e.round(j/this.sizeRatioY):this.scroller.y;this.scroller.scrollTo(i,j);},fade:function(l,j){if(j&&!this.visible){return;}clearTimeout(this.fadeTimeout);this.fadeTimeout=null;var k=l?250:500,i=l?0:300;l=l?"1":"0";this.wrapperStyle[g.style.transitionDuration]=k+"ms";this.fadeTimeout=setTimeout((function(m){this.wrapperStyle.opacity=m;this.visible=+m;}).bind(this,l),i);}};d.utils=g;if(typeof module!="undefined"&&module.exports){module.exports=d;}else{h.IScroll=d;}})(window,document,Math);

/** ========== kotarapp\resources\url.js ========== **/
var url=url||{};(function(c){function a(f){var e={};var d=document.createElement("a");f=f||document.location.href;d.href=f;e.protocol=d.protocol.replace(/:$/,"");e.host=d.hostname;e.path=d.pathname;e.query=d.search.replace(/^\?/,"");e.hash=d.hash.replace(/^#/,"");e.queryparsed=b(e.query);if(e.path&&e.path.length>0&&e.path[0]!=="/"){e.path="/"+e.path;}return e;}function b(f){var h={};var g=/([^=&]+)(=([^&]*))?/g,e;while((e=g.exec(f))){var d=decodeURIComponent(e[1].replace(/\+/g," ")),i=e[3]?decodeURIComponent(e[3].replace(/\+/g," ")):"";if(h[d]!=null){if(!(h[d] instanceof Array)){h[d]=[h[d]];}h[d].push(i);}else{h[d]=i;}}return h;}c.parse=a;c.parseQs=b;})(url);

/** ========== kotarapp\viewer\controls\toolbar\toolbar.js ========== **/
var Toolbar=Toolbar||{};Toolbar.ToogleToolBarTimeout=0;Toolbar.iscroll={};Toolbar.UserMenuHtml="";Toolbar.isSreaching=false;(function(Toolbar){var mytoolbar;var footer;var floatingToolbar;var mobileSubMenu;var intransition=false;var cartfunc="GotoCart()";function Load(element,bookid,isEmbeded,platform){var params=new Array({name:"nBookID",value:bookid},{name:"platform",value:platform});callAppKotarCommandSync("loadtoolbar",params,{onSuccessFunction:BuildToolBar,onFailureFunction:ShowErrorMessage,element:element,isEmbeded:isEmbeded,platform:platform},false,"json");Toolbar.UserMenuHtml="";}function Visible(){var retVal=true;if(mytoolbar&&mytoolbar.hasClass("hide")){retVal=false;}return retVal;}function SetBookMarkStyle(){var oPage=oPagesInfo.pages[BV_nTopPageInView];var $mobileBookMarkEdit=$("#mobileBookMarksEdit");if(oPage.b){$mobileBookMarkEdit.html(TXT_MobileBookMarksRemove);$mobileBookMarkEdit.addClass("remove");$mobileBookMarkEdit.removeClass("add");}else{$mobileBookMarkEdit.html(TXT_MobileBookMarksAdd);$mobileBookMarkEdit.addClass("add");$mobileBookMarkEdit.removeClass("remove");}}function Show(){var submenu=document.getElementById("submenu");mytoolbar.css("display","block");footer.css("display","block");mytoolbar.removeClass("hide").addClass("show");footer.removeClass("hide").addClass("show");if(is_phone){BookScroll.DisplayCurrentPage();if(submenu.classList.contains("hidden")){ShowMobileMenus();}if(BV_nCurrentSizeStep<BV_nMaxSizeStep){$(".zoomin").removeClass("disabled");}else{$(".zoomin").addClass("disabled");}if(BV_nCurrentSizeStep>BV_nMinSizeStep){$(".zoomout").removeClass("disabled");}else{$(".zoomout").addClass("disabled");}}}function Hide(){mytoolbar.removeClass("show").addClass("hide");footer.removeClass("show").addClass("hide");if(!$("#mobileScrollPagesText").is(":focus")){floatingToolbar.removeClass("show").addClass("hide");}}function HideMobileMenus(){$("#floating-toolbar").hide(10);$("#mobileSubMenu").hide(10);}function ShowMobileMenus(){if($("#mysidebar").is(":hidden")){floatingToolbar.removeClass("hide").addClass("show");$("#floating-toolbar").show(10);$("#mobileSubMenu").show(10);}}function HideAll(){if(mytoolbar){clearTimeout(Toolbar.ToogleToolBarTimeout);Toolbar.SubMenu.Hide();Toolbar.Sidebar.Hide();Hide();}}function Remove(){Hide();if(is_IOS){setTimeout(function(){mytoolbar.css("display","none");footer.css("display","none");},750);}}function GetNewItem(title,parentClassName,className,subClassName){var html=[];html.push("<li title='",title,"' class='",parentClassName," ",className," ",subClassName,"'></li>");return html.join("");}function ToolbarSearchReady(){var $txtsearch=$("#txtsearch");var width=document.documentElement?document.documentElement.clientWidth:screen.width;clearTimeout(Toolbar.ToogleToolBarTimeout);if(is_IOS8){FIXIOSBUG();}Toolbar.Search.HasKeyboard=BV_HasKeybaord;if(is_phone){Toolbar.SubMenu.Toogle($(".toolbaricon.search"),width,75,Toolbar.Search.GetHtml(),Toolbar.Search.BindEvents);}else{Toolbar.SubMenu.Toogle($(".toolbaricon.search"),378,75,Toolbar.Search.GetHtml(),Toolbar.Search.BindEvents);}if(is_IOS&&!is_IOS8){FIXIOSBUG();}if(is_IOS8){setTimeout(function(){var tb=mytoolbar[0];tb.style.marginTop=window.pageYOffset+"px";},200);}$txtsearch.focus();Toolbar.Search.SyncTocToPages();Toolbar.ActivateButton("","Search","");}function FIXIOSBUG(){Toolbar.isSreaching=true;var tb=mytoolbar[0];tb.style.marginTop=window.pageYOffset+"px";tb.style.position="absolute";BookScroll.MoveOffScreen();}function LoadBookInfo(tab){Toolbar.Toc.Tab=tab;if(Toolbar.Toc.Tab=="toc"){if(Toolbar.Toc.HTML===""){Toolbar.SubMenu.ShowPreloader($(".toolbaricon.bookinfo"),Toolbar.Toc.GetPreloaderHtml());Toolbar.Toc.LoadTocData(Toolbar.ToolbarTocReady,TOC_LoadTocJS_OnError);}else{ToolbarTocReady();}Toolbar.ActivateButton("","BookInfo-toc","");}else{if(Toolbar.Toc.Tab=="bookinfo"){if(Toolbar.BookInfo.HTML===""){setTimeout(function(){Toolbar.SubMenu.ShowPreloader($(".toolbaricon.bookinfo"),Toolbar.Toc.GetPreloaderHtml());Toolbar.Toc.LoadBookInfoData(Toolbar.ToolbarBookInfoReady,Toolbar.Toc.BookInfoLoadFail);},300);}else{ToolbarBookInfoReady();}Toolbar.ActivateButton("","BookInfo-bookinfo","");}}}function ToolbarTocReady(data){var width=document.documentElement?document.documentElement.clientWidth:screen.width;clearTimeout(Toolbar.ToogleToolBarTimeout);if(is_phone){Toolbar.SubMenu.Toogle($(".toolbaricon.bookinfo"),width,40,Toolbar.Toc.GetHtml(data),Toolbar.Toc.BindEvents);}else{Toolbar.SubMenu.Toogle($(".toolbaricon.bookinfo"),420,40,Toolbar.Toc.GetHtml(data),Toolbar.Toc.BindEvents);}Toolbar.Toc.SyncTocToPages();Toolbar.Toc.SelectedTabStyle();}function ToolbarBookInfoReady(data){clearTimeout(Toolbar.ToogleToolBarTimeout);Toolbar.SubMenu.Toogle($(".toolbaricon.bookinfo"),420,40,Toolbar.Toc.GetHtml(data),Toolbar.Toc.BindEvents);Toolbar.Toc.SelectedTabStyle();}function ToolbarBookLayersReady(){delaycount=0;clearTimeout(Toolbar.ToogleToolBarTimeout);if(!(MarkersMgr_bLoaded&&EmbededMgr_bLoaded)){Toolbar.SubMenu.ShowPreloader($(".toolbaricon.layers"),"<div class='preloading' style='margin: 5px;'></div>");DelayLoadBookLayersMenu(function(){Toolbar.SubMenu.Toogle($(".toolbaricon.layers"),378,40,Toolbar.BookLayers.GetHtml(),Toolbar.BookLayers.BindEvents);Toolbar.BookLayers.SyncTocToPages();});}else{Toolbar.SubMenu.Toogle($(".toolbaricon.layers"),378,40,Toolbar.BookLayers.GetHtml(),Toolbar.BookLayers.BindEvents);Toolbar.BookLayers.SyncTocToPages();}}function ToolbarAdminMenuReady(){delaycount=0;clearTimeout(Toolbar.ToogleToolBarTimeout);if(!(MarkersMgr_bLoaded&&EmbededMgr_bLoaded)){Toolbar.SubMenu.ShowPreloader($(".toolbaricon.admintool"),"<div class='preloading' style='margin: 5px;'></div>");DelayLoadBookLayersMenu(function(){Toolbar.SubMenu.Toogle($(".toolbaricon.admintool"),452,40,Toolbar.AdminMenu.GetHtml(),Toolbar.AdminMenu.BindEvents);Toolbar.BookLayers.SyncTocToPages();});}else{Toolbar.SubMenu.Toogle($(".toolbaricon.admintool"),452,40,Toolbar.AdminMenu.GetHtml(),Toolbar.AdminMenu.BindEvents);Toolbar.BookLayers.SyncTocToPages();}}function ToolbarBookToolsReady(data){clearTimeout(Toolbar.ToogleToolBarTimeout);Toolbar.BookTools.BuildCache(data);Toolbar.SubMenu.Toogle($(".toolbaricon.booktools"),220,40,Toolbar.BookTools.GetHTML(),Toolbar.BookTools.BindEvents);}var delaycount=0;function DelayLoadBookLayersMenu(callback){if(delaycount<60){if(!(MarkersMgr_bLoaded&&EmbededMgr_bLoaded)){setTimeout(function(){DelayLoadBookLayersMenu(callback);},100);}else{callback();}delaycount++;}else{callback();}}function ActivateButton(buttonName,funcName,sTool){AddUsageLog(funcName);if(sTool==""){sTool=BV_DEFAULTTOOL;}BV_SetActiveTool(sTool);if(buttonName!=""){$("."+buttonName).addClass("on");}}function ResetButton(buttonName){if($("."+buttonName).hasClass("on")){$("."+buttonName).removeClass("on");}}function RefreshScroll(){if(Toolbar.iscroll.refresh){setTimeout(function(){Toolbar.iscroll.refresh();},0);}}function BuildToolBar(data,info){var html=[],floatingHtml=[];var $element=$(info.element);var isEmbeded=info.isEmbeded;var platform=info.platform;var ipname=GetIpSubscriptionName(data);var item,itemtype;var mobileScrollPagesText,mobileScrollPagesLabel;var addFloatingHtmlSP=true;mytoolbar=$("#mytoolbar");footer=$("#trFooterContainer");floatingToolbar=$("#floating-toolbar");mobileSubMenu=$("#mobileSubMenu");Toolbar.isLoggedin=data.IsLoggedIn;Toolbar.showProjects=data.ShowProjects;Toolbar.mybagLink=data.mybaglink;Toolbar.NumItemsInCart=data.NumItemsInCart;Toolbar.NumOpenTasksInLMS=data.NumOpenTasksInLMS;BV_bCanApproveEmbeded=data.CanApproveEmbeded;if(isEmbeded=="true"){html.push("<h1><div id='fullscreen' class='in' onclick='ToolBar_Embeded_OnClickFull();'></div></h1>");}else{if(is_phone||platform=="barebone"){html.push("<h1><span><div class='toolbarlogo'></div></span></h1>");}else{html.push("<h1><a href='",GetDefaultPage(),"' onmouseup='event.preventDefault();'><div class='toolbarlogo'></div></a></h1>");}}if(platform=="barebone"){html.push("<ul>","<li class='toolbarusermenu style = visibility:hidden;'></li>");}else{if(platform!==""&&platform!=="barebone"){html.push("<ul>","<li class='toolbarusermenu'></li>");html.push(GetBackToAppHtml());}else{html.push("<ul>","<li class='toolbarusermenu'></li>");}}html.push("<li class='sidebar-toggle'><div id='mysidebar'></div></li>");for(var i=0;i<data.items.length;i++){item=data.items[i];itemtype=item.t;if(itemtype==="i"){if(is_phone&&(item.c==="zoomin"||item.c==="zoomout")){floatingHtml.push("<div title='",item.l,"' class='toolbaricon ",item.c," ",item.s,"'></div>");if(addFloatingHtmlSP){floatingHtml.push("<div class='sep'></div>");addFloatingHtmlSP=false;}}else{html.push(GetNewItem(item.l,"toolbaricon",item.c,item.s));}}else{if(itemtype==="s"){html.push("<li class='toolbarsep ",item.c,"'></li>");}}}if(is_phone){floatingHtml.push("<div class='pagenumber'><label id='mobileScrollPagesLabel'>",TXT_Toolbar_Page,"</label>&nbsp;<input id='mobileScrollPagesText' maxlength='4' /></div>");}if(ipname===""){html.push("<li><div class='toolbarname'>",TXT_Toolbar_Hello," ",data.username,"</div></li></ul>");}else{html.push("<li><div class='toolbarname'><span style='display: block;'>",TXT_Toolbar_Hello," ",data.username," </span><span style='display: block;'>",ipname,"</span></div></li></ul>");}html.push("<div id='submenu' class='hidden'></div>");info.element.style.display="none";$element.html(html.join("")).addClass("toolbarcontainer");floatingToolbar.html(floatingHtml.join(""));info.element.style.display="block";Toolbar.Sidebar.Build(data,document.getElementById("mysidebar"));BindToolbarEvents(data);BindUserMenuEvents();if(is_phone){$(".group2").removeClass("group2").addClass("group3");mobileScrollPagesText=document.getElementById("mobileScrollPagesText");mobileScrollPagesLabel=document.getElementById("mobileScrollPagesLabel");if(BV_nCurrentSizeStep>=BV_nMaxSizeStep){$(".zoomin").addClass("disabled");}else{if(BV_nCurrentSizeStep<=BV_nMinSizeStep){$(".zoomout").addClass("disabled");}}if(mobileScrollPagesText){mobileScrollPagesText.addEventListener("click",function(e){e.stopPropagation();Toolbar.preventToolbarHide=true;});mobileScrollPagesText.addEventListener("focus",function(e){var self=this;e.stopPropagation();clearTimeout(Toolbar.ToogleToolBarTimeout);Show();mytoolbar.removeClass("show").addClass("hide");footer.removeClass("show").addClass("hide");HideAjaxMessageBox();setTimeout(function(){self.setSelectionRange(0,self.value.length);},10);});mobileScrollPagesText.addEventListener("keydown",function(e){if(e.keyCode===13){mobileScrollPagesText.blur();}});mobileScrollPagesText.addEventListener("change",function(e){BookScroll.GoToPage(e);Toolbar.preventToolbarHide=false;this.blur();});mobileScrollPagesText.addEventListener("blur",function(e){setTimeout(function(){Toolbar.preventToolbarHide=false;},500);});}}$("#mysidebar").css("display","none");}function GetIpSubscriptionName(data){var retVal="";if(data.instituteName!=""){var s=data.instituteName;if(s.length>25){s=s.substring(0,21)+"...";}retVal="["+s+"]";}return retVal;}function ShowErrorMessage(){}function GetBackToAppHtml(){return html="<li class='backtoapp'></li>";}function GetDefaultPage(){var sHost=window.location.host;return"//"+sHost;}function AddToCart(nBookID){ActivateButton("cart","AddToCart");location.href="/KotarApp/Shop/AddToCart.aspx?nBookID="+nBookID;}function GotoCart(){ActivateButton("cart","GotoCart");location.href=cartlink;}function OpenAdminTools(baseurl){var url="http://school.admin"+baseurl+"/KotarApp/Viewer.aspx?nBookID="+BV_nBookID+"&admin=true"+window.location.hash;location.href=url;}function GetUserMenuHTML(){if(Toolbar.UserMenuHtml===""){var showminiscroll=(typeof MiniScroll!=="undefined");Toolbar.UserMenuHtml=MasterPage.GetUserMenuHTML(Toolbar.isLoggedin,Toolbar.mybagLink,Toolbar.NumOpenTasksInLMS,Toolbar.showProjects,Toolbar.NumItemsInCart,showminiscroll);}return Toolbar.UserMenuHtml;}Toolbar.login=function(){if(Toolbar.isLoggedin){cet.accessmanagement.logout(document.location.origin+"/default.aspx?logout=true");}else{if(typeof(ShowLoginTouchPage)!="undefined"){ShowLoginTouchPage(window.location);}}};function BindUserMenuEvents(){var $submenu=$("#submenu");$submenu.delegate("#login","click",Toolbar.login);$submenu.delegate("#myaccount","click",function(){OpenLogedinArea("/KotarApp/Account.aspx");});$submenu.delegate("#mybag","click",function(){SetWindowLocation(Toolbar.mybagLink);});$submenu.delegate("#addshelf","click",function(){if(Toolbar.isLoggedin){AddBookToFavorites(BV_nBookID,false);}else{OpenSmartTouchLoginPage("AddBookToFavorites");}});$submenu.on("click","#addtoprojects",function(){if(Toolbar.isLoggedin){Open_AddBookToProjectPopup(BV_nBookID,false,false,BV_GetCurrentPageID());}else{OpenSmartTouchLoginPage("AddBookToProjects");}});$submenu.delegate("#myshelf","click",function(){OpenLogedinArea("/KotarApp/FavoriteBooks.aspx");});$submenu.delegate("#myprojects","click",function(){OpenLogedinArea("/KotarApp/Projects.aspx");});$submenu.delegate("#cart","click",function(){eval(cartfunc);});$submenu.delegate("#help","click",function(){window.location.href=TXT_UserMenu_Help;});$submenu.delegate("#showminiscroll","click",function(e){ToggleMiniScroll(e);Toolbar.UserMenuHtml="";});}function ToggleMiniScroll(e){var newval=false;var el=e.srcElement?e.srcElement:e.target;if(MasterPage.IsMiniScrollVisible()){MiniScroll.Hide();newval=false;el.textContent=TXT_Toolbar_ShowMiniScroll;}else{MiniScroll.Show();newval=true;el.textContent=TXT_Toolbar_HideMiniScroll;}var params=new Array({name:"newval",value:newval});callAppKotarCommand("ChangeMiniScrollVisability",params,{onSuccessFunction:MasterPage_Callback,onFailureFunction:MasterPage_Callback},false);}function MasterPage_Callback(){}function BindToolbarEvents(data){for(var i=0;i<data.items.length;i++){var item=data.items[i];var itemtype=item.t;if(item.c=="cart"){cartfunc=item.f;}if(itemtype==="i"&&item.f!=undefined){$("."+item.c).bind("click",{func:item.f},function(event){if(zooming){return;}if(!Toolbar_AutoHide){Toolbar_AutoHide=true;PreventBookClick=false;}if(event){event.stopPropagation();}else{window.event.cancelBubble=true;}var show=!$(this).hasClass("on");Toolbar.SubMenu.Hide();if(!$(this).hasClass("zoomin")&&!$(this).hasClass("zoomout")){Toolbar.Sidebar.Hide();}if(show){eval(event.data.func);}event.preventDefault();});}}$("#mytoolbar").bind("mouseover mousedown touchstart",function(e){clearTimeout(Toolbar.ToogleToolBarTimeout);Show();});$("#mytoolbar").bind("transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd",function(){intransition=false;});$(".toolbarusermenu").bind("click touchend",function(e){clearTimeout(Toolbar.ToogleToolBarTimeout);Toolbar.SubMenu.Toogle(this,200,0,GetUserMenuHTML());e.preventDefault();});$(".backtoapp").bind("click touchend",function(e){var pagenum=GetBackToAppPage();switch(BV_ViewerClosefunction){case 1:var win=window.open("","_self");win.close();break;case 2:window.location.href="kotar://back_to_app?action=load_book&book_id="+BV_nBookID+"&page_num="+pagenum;setTimeout(function(){window.close();},250);break;case 3:android.OpenBook(BV_nBookID,pagenum);break;default:}});$(".sidebar-toggle").bind("mouseup touchend",function(e){if(UTILS_HasCLass(e.target,"sidebar-toggle")){BV_HideMarkerBubble("sidebar-toggle click",false);Toolbar.Sidebar.Toogle();e.preventDefault();}});$(".toolbarname").bind("click",function(e){if(event){event.stopPropagation();}else{window.event.cancelBubble=true;}e.preventDefault();if(BV_bAdminUser){var b=document.getElementById("BV_oBook");var l=document.getElementById("masterlayer");if(b.style.transform===""||b.style.webkitTransform===""){var winw=window.outerWidth;var newx=(winw*0.9)-$("#BV_oPageWrapper_0").offset().left;b.style.transform="translateX("+newx+"px)";b.style.webkitTransform="translateX("+newx+"px)";l.classList.toggle("on");setTimeout(function(){var ifrm=document.createElement("iframe");ifrm.style.width="85%";ifrm.style.height="100%";ifrm.src="https://mybag.ebag.testing.cet.ac.il/content/player.aspx?manifest=%2fapi%2fmanifests%2fitem%2fhe%2fc085a96d-8faf-4bc9-b053-5eb78002aecf#?page=content-1";l.appendChild(ifrm);l.style.position="absolute";},550);}else{b.style.transform="";b.style.webkitTransform="";l.classList.toggle("on");l.innerHTML="";}}});$(".toolbarsep").bind("dblclick",function(e){ShowIAmTheWalrusPopup(BV_nBookID);});}function OpenLogedinArea(href){if(Toolbar.isLoggedin){window.location.href=href;}else{Utils_OpenSmartLoginPapgeForRedirect(href);}}function Toggle(){if(!intransition){intransition=true;if(Toolbar.Visible()){HideAll();BookScroll.Hide();}else{Show();BookScroll.Show();BookScroll.UpdatePagesDiv();}}WordSelectionMgr_ClearWordSelection();}function GetBackToAppPage(){var retVal=BV_nTopPageInView+1;if(is_IOS){if(!BV_BookAppHasFiller){retVal-=1;}}else{if(BV_BookAppHasFiller){retVal+=1;}}return retVal;}Toolbar.Load=Load;Toolbar.GetNewItem=GetNewItem;Toolbar.ToolbarTocReady=ToolbarTocReady;Toolbar.ToolbarBookInfoReady=ToolbarBookInfoReady;Toolbar.ToolbarSearchReady=ToolbarSearchReady;Toolbar.ToolbarBookLayersReady=ToolbarBookLayersReady;Toolbar.ToolbarAdminMenuReady=ToolbarAdminMenuReady;Toolbar.ToolbarBookToolsReady=ToolbarBookToolsReady;Toolbar.ActivateButton=ActivateButton;Toolbar.ResetButton=ResetButton;Toolbar.Hide=Hide;Toolbar.Show=Show;Toolbar.Remove=Remove;Toolbar.Visible=Visible;Toolbar.HideAll=HideAll;Toolbar.RefreshScroll=RefreshScroll;Toolbar.Toggle=Toggle;Toolbar.LoadBookInfo=LoadBookInfo;Toolbar.SetBookMarkStyle=SetBookMarkStyle;Toolbar.HideMobileMenus=HideMobileMenus;Toolbar.ShowMobileMenus=ShowMobileMenus;})(Toolbar);

/** ========== kotarapp\viewer\controls\toolbar\toolbarsubmenu.js ========== **/
var Toolbar=Toolbar||{};Toolbar.SubMenu={};Toolbar.SubMenu.scrolled=false;(function(g){var b=false;var c=0;function f(l,m,j,k,i){var h;Toolbar.Sidebar.Hide();CloseOtherElements("toolbarsubmenu");h=$("#submenu");h.empty();if(h.hasClass("hidden")||b){h.removeClass("hidden");d(h,l,m,j,k,i);$(l).addClass("on");}else{if($(l).hasClass("on")){h.addClass("hidden");$(l).removeClass("on");if(typeof(Toolbar.iscroll.destroy)==="function"&&Toolbar.iscroll.indicators){Toolbar.iscroll.destroy();}}else{$(".toolbaricon,.sidebaricon").removeClass("on");$(".toolbarusermenu").removeClass("on");d(h,l,m,j,k);$(l).addClass("on");}}b=false;}function d(i,r,C,p,q,o){var h=$(r);var s=h.offset().left;var k=s+(h.width()/2);var y;var v=0;var m=$(document).width();var B=parseInt(C/3);var n=k-(2*B);var A=k-B;var z=20;v=m-z-C;if(v>k){if(n>0&&n+C<m){v=n;}else{if(A+C<m){v=A;}else{var t=0;var x=0;v=-1;while(v===-1){x=n-t;if(x<m-C-20){v=x;}else{if(x<0){v=0;}}t++;}}}}v=Math.max(v,0);var u=s-v;i.append("<div id='knobb'></div><div id='knoba'></div>");i.append(q);y=i.find(".submenuscroll");i.css({left:v+"px",top:"48px",width:C+"px"});i.find("#knobb").css("left",u+"px");i.find("#knoba").css("left",(u+1)+"px");if(is_phone){Toolbar.HideMobileMenus();i.find("#knobb").on("click",function(j){a();});}if(y.length===1){var l=is_IOS?window.innerHeight:$(window).height();var w=l-110-p;if(is_phone){w=l-102;y.css("height",w+"px");}y.css("max-height",w+"px");Toolbar.iscroll=new IScroll(y[0],{scrollbars:true,mouseWheel:true,interactiveScrollbars:true,click:true,probeType:3});Toolbar.iscroll.on("scroll",function(j){clearTimeout(c);Toolbar.SubMenu.scrolled=true;c=setTimeout(function(){Toolbar.SubMenu.scrolled=false;},250);});}if(o){o();}}function a(){var h=$("#txtsearch");if(h.length>0){h.blur();}$("#submenu").addClass("hidden");$(".toolbaricon,.sidebaricon").removeClass("on");$(".toolbarusermenu").removeClass("on");if(typeof(Toolbar.iscroll.destroy)==="function"&&Toolbar.iscroll.indicators){Toolbar.iscroll.destroy();}if(is_IOS){var i=document.getElementById("mytoolbar");i.style.top="0";i.style.marginTop="0";i.style.position="fixed";}Toolbar.isSreaching=false;if(GetQueryParameterByName("action")=="info"){var j=window.location.href.replace("&action=info","");history.replaceState({},"",j);}if(is_phone){}}function e(h,i){if(!is_phone){f(h,300,40,i);}b=true;}g.Toogle=f;g.Hide=a;g.ShowPreloader=e;})(Toolbar.SubMenu);

/** ========== kotarapp\viewer\controls\toolbar\sidebar.js ========== **/
var Toolbar=Toolbar||{};Toolbar.Sidebar={};(function(d){function c(){d.SubMenu.Hide();if($(".sidebar-toggle").hasClass("on")){$(".sidebar-toggle").removeClass("on");$("#mysidebar").css("display","none");if(is_phone){d.ShowMobileMenus();}}else{$(".sidebar-toggle").addClass("on");$("#mysidebar").css("display","");if(is_phone){d.HideMobileMenus();}}}function a(f,g){var h=[];var e=$(g);h.push("<ul>");for(var j=0;j<f.items.length;j++){var k=f.items[j];var l=k.t;if(l==="i"){if(!is_phone||(k.c!=="zoomin"&&k.c!=="zoomout")){h.push(d.GetNewItem(k.l,"sidebaricon",k.c,k.s));}}else{if(l==="s"){h.push("<li class='sidebarsep ",k.c,"'></li>");}}}h.push("<br class='clear' />");g.style.display="none";e.html(h.join("")).addClass("sidebarcontainer");g.style.display="block";}function b(){if($(".sidebar-toggle").hasClass("on")){$(".sidebar-toggle").removeClass("on");$("#mysidebar").css("display","none");}}d.Sidebar.Toogle=c;d.Sidebar.Hide=b;d.Sidebar.Build=a;})(Toolbar);

/** ========== kotarapp\viewer\controls\toolbar\toc.js ========== **/
var Toolbar=Toolbar||{};Toolbar.Toc={};Toolbar.Toc.Tab="";Toolbar.Toc.HTML="";Toolbar.Toc.TabHTML="";Toolbar.Toc.PreventTocClick=false;(function(r){var t=0;var w=Number.MAX_VALUE;var x=0;var s=Number.MAX_VALUE;function g(y){var z=[];z.push(k());if(Toolbar.Toc.Tab==="toc"){z.push(i(y));}else{if(Toolbar.Toc.Tab==="bookinfo"){z.push(Toolbar.BookInfo.GetHTML(y));}}z.push(f());return z.join("");}function i(y){if(r.HTML===""){var z=[];z.push(j(y,1));if(y.cn!==null){for(var A=0;A<y.cn.length;A++){var B=y.cn[A];z.push(j(B,1));if(B.c){for(var C=0;C<B.cn.length;C++){z.push(j(B.cn[C],2));}}}}r.HTML=z.join("");}return r.HTML;}function k(){var y=[];y.push("<div id='knobs'></div>","<div id='tochead'><span id='tocheadtoc' class='hselected'>",TXT_Toolbar_TOC,"</span>","| <span id='tocheadinfo'>",TXT_Toolbar_BookInfo,"</span>","</div>","<div class='toc'><div class='submenuscroll'>","<div class='tocscroller'>");return y.join("");}function f(){return"</div></div></div>";}function h(){var y=[];y.push(k());y.push("<div class='preloading'></div>");y.push(f());return y.join("");}function j(z,A){var y=[];y.push("<div class='tocitem toc",A,"' onclick='TocEntry_OnClick(",z.n,",",z.y,",",z.ID,",",z.fpID,");' ","data-pnum='",z.n,"'><span>",z.t,(A===1?"":"  ........................................................................................................................"),"</span>","<div class='pagelabel'>",z.l,"</div>","</div>");return y.join("");}function a(){b();$("#tocheadinfo").click(function(){if(!$(this).hasClass("hselected")){Toolbar.Toc.Tab="bookinfo";Toolbar.Toc.LoadBookInfo();b();setTimeout(function(){Toolbar.iscroll.refresh();},100);}});$("#tocheadtoc").click(function(){if(!$(this).hasClass("hselected")){Toolbar.Toc.Tab="toc";n();b();setTimeout(function(){Toolbar.iscroll.refresh();},100);}});}function b(){var y=$(".tocitem");var z=$(".toc");y.mouseenter(function(){y.removeClass("hover");$(this).addClass("hover");}).bind("touchstart",function(B){y.removeClass("hover");r.PreventTocClick=false;z.bind("touchmove",function(C){if(e(C)){y.removeClass("hover");r.PreventTocClick=true;z.unbind("touchmove");}});$(this).addClass("hover");}).bind("touchend",function(B){y.removeClass("hover");z.unbind("touchmove");});z.mouseleave(function(){y.removeClass("hover");});var A=document.getElementsByClassName("toc")[0].getBoundingClientRect();t=A.left;x=A.top;w=A.right;s=A.bottom;}function e(y){var A=false;var z=TouchUtils.NormalizeEvent(y);if(z.clientX<t||z.clientX>w||z.clientY<x||z.clientY>s){A=true;}return A;}function q(){$(".tocitem").removeClass("selected");var y=BV_GetCurrentPageNum();for(var z=y;z>=0;z--){var B=$(".tocitem[data-pnum='"+z+"']");if(B.length>0){var A=B.last();A.addClass("selected");Toolbar.iscroll.scrollToElement(A[0],0);break;}}}function o(z,y){callAppKotarCommandNoSession("TOC.GetTocTree",[{name:"nBookID",value:BV_nBookID}],{onSuccessFunction:z,onFailureFunction:y},true);}function m(z,y){callAppKotarCommandReadOnlySession("BookInfo.Load",[{name:"nBookID",value:BV_nBookID}],{onSuccessFunction:z,onFailureFunction:y},true);}function l(){p();if(Toolbar.BookInfo.HTML===""){var y=$("#submenu .tocscroller");y.html("<div class='preloading'></div>");m(d,c);}else{d();}}function d(y){var z=$(".tocscroller");z.html(Toolbar.BookInfo.GetHTML(y));Toolbar.RefreshScroll();}function c(){}function n(){p();if(Toolbar.Toc.HTML===""){var y=$(".tocscroller");y.html("<div class='preloading'></div>");o(v,u);}else{v();}}function v(y){var z=$(".tocscroller");z.html(i(y));Toolbar.RefreshScroll();q();}function u(){}function p(){var z=$("#tocheadtoc");var y=$("#tocheadinfo");if(Toolbar.Toc.Tab==="toc"){z.addClass("hselected");y.removeClass("hselected");$("#knobs").css({right:"",left:""});}else{if(Toolbar.Toc.Tab==="bookinfo"){y.addClass("hselected");z.removeClass("hselected");if(BaseMaster_sLanguageCode==="en"){$("#knobs").css({left:"165px"});}else{if(BaseMaster_sLanguageCode==="zh"){$("#knobs").css({left:"60px"});}else{$("#knobs").css({right:(BaseMaster_sLanguageCode==="he"?"120px":"80px")});}}}}}r.GetHtml=g;r.BindEvents=a;r.LoadBookInfo=l;r.BookInfoLoadFail=c;r.GetPreloaderHtml=h;r.LoadTocData=o;r.LoadBookInfoData=m;r.SyncTocToPages=q;r.SelectedTabStyle=p;})(Toolbar.Toc);

/** ========== kotarapp\viewer\controls\toolbar\search.js ========== **/
var Toolbar=Toolbar||{};Toolbar.Search={};Toolbar.Search.HTML="";Toolbar.Search.Text="";Toolbar.Search.Result="";Toolbar.Search.FromSearch=false;Toolbar.Search.MaxLength=30;Toolbar.Search.HasKeyboard=false;(function(l){var p;var f="";function c(){if(l.HTML===""){var q=[];var s=(Toolbar.Search.Result===""||is_IOS)?"":"reset";var t=Toolbar.Search.Result===""?"hidden":"";var r=t;q.push("<div id='searchwarpper'>","<div id='searchbar'>","<input id='txtsearch' type='text' maxlength='",Toolbar.Search.MaxLength,"' value='",Toolbar.Search.Text,Toolbar.Search.HasKeyboard?"' class='keyboardInput'":"'","/>",Toolbar.Search.HasKeyboard?"<img src='/KotarApp/Resources/keyboard/keyboard.png' class='keyboardInputInitiator' />":"","<div id='iconcontainer'>","<div id='searchicon' class='",s,"'></div>","<div id='preloader' class='hidden'></div>","</div>",(is_IOS?"<div id='iosblock'></div>":""),"</div>","<div id='searchscroller' class='",t,"'>","<div class='submenuscroll'>","<div id='respanel' class='",r,"'>",Toolbar.Search.Result,"</div>","</div>","</div>","</div>");l.HTML=q.join("");}return l.HTML;}function d(q){var r=[];for(var s=0;s<q.length;s++){var t=q[s];r.push(e(t));}var u=r.join("");return u;}function e(r){var q=[];q.push("<div class='resbox' data-pnum='",r.pg,"'onclick='Toolbar.Search.ResultOnClick("+r.pg+","+r.os+");'>","<div class='respage'>",TXT_Page," ",BookPageState_GetPageLabel(r.pg-1),"</div>","<div class='restext'>",r.tx,"</div>","</div>");return q.join("");}function a(){var q=$("#txtsearch");q.focus();Toolbar.preventToolbarHide=true;q.keypress(function(s){var r=s.keyCode||s.which;if(r==13){return false;}});q.bind("click touchstart",function(r){if(is_IOS){Toolbar.isSreaching=true;setTimeout(function(){var s=document.getElementById("mytoolbar");s.style.marginTop=window.pageYOffset+"px";s.style.position="absolute";BookScroll.MoveOffScreen();},250);}});q.bind("input propertychange",function(){var r=$("#txtsearch").val();clearTimeout(p);if(r.replace("\\","").trim().length>1||Toolbar.Search.Text.replace("\\","").trim().length>1){if(r.replace("\\","").trim().length>1){p=setTimeout(function(){b(r);},750);}else{Toolbar.Search.Text=r;i(false);}}});$("#searchicon").on("click",function(){if($("#searchicon").hasClass("reset")){i(true);}});$("#searchscroller").bind("touchstart",function(){q.blur();});if(is_IOS){$("#iosblock").on("touchstart",function(r){r.preventDefault();r.stopPropagation();});}if(Toolbar.Search.HasKeyboard){if(typeof VKI_buildKeyboardInputs!=="undefined"){$("#txtsearch").attr("VKI_attached","");VKI_buildKeyboardInputs();}}}function b(q){Toolbar.Search.Text=q;$("#respanel").removeClass("hidden");if(!is_IOS){$("#searchicon").addClass("reset");}g(Toolbar.Search.Text);}function g(s){try{s=decodeKotar(s);}catch(q){}s=s.trim();if(ReplaceAll(s,"-","")==""){s="";}if(s==""){return;}if(s==f){return;}f=s;var r=new Array({name:"nBookID",value:BV_nBookID},{name:"sSearchText",value:encodeKotar(s)},{name:"nImageWidth",value:BV_nPageImageWidth},{name:"nImageHeight",value:BV_nPageImageHeight},{name:"tmp",value:"tmp"});$("#searchicon").addClass("hidden");$("#preloader").removeClass("hidden");k();callAppKotarCommandNoSession("Search.SearchInBook",r,{onSuccessFunction:n,onFailureFunction:m},true);}function n(q){var r=$("#respanel");var s=d(q);if(Toolbar.Search.FromSearch){Toolbar.Search.Result=s;}else{Toolbar.Search.Result="";}$("#preloader").addClass("hidden");$("#searchicon").removeClass("hidden");if(s!==""){r.html(s);$("#searchscroller").removeClass("hidden");Toolbar.RefreshScroll();$("#txtsearch").attr("value",Toolbar.Search.Text);l.HTML=$("#searchwarpper")[0].outerHTML;Hightlights_MarkPagesWithHighlights(f,q);}else{s=h();r.html(s);$("#searchscroller").removeClass("hidden");Toolbar.RefreshScroll();}}function m(){i(false);}function i(r){Toolbar.Search.HTML="";Toolbar.Search.Result="";if(r){Toolbar.Search.Text="";$("#txtsearch").val("").focus();}if(Toolbar.Search.FromSearch){Toolbar.Search.FromSearch=false;if(!isIE||ieVer>9){var q="/KotarApp/Viewer.aspx?nBookID="+BV_nBookID+location.hash;history.replaceState("object or string","title",q);}}f="";$("#searchscroller").addClass("hidden");if(r){$("#searchicon").removeClass("reset").removeClass("hidden");}$("#preloader").addClass("hidden");Highlights_ClearAll(true);}function k(){Toolbar.Search.HTML="";Highlights_ClearAll(true);}function h(){var q=[];q.push("<div class='resbox'><div class='restext'>",TXT_SearchHadZeroResults,"</div></div>");return q.join("");}function j(r,q){Toolbar.SubMenu.Hide();Toolbar.isSreaching=false;BookScroll.MoveOnScreen();BV_GotoPage(r,q);}function o(){var q=BV_GetCurrentPageNum();for(var r=q;r>=0;r--){var t=$(".resbox[data-pnum='"+r+"']");if(t.length>0){var s=t.last();window.setTimeout(function(u){Toolbar.iscroll.scrollToElement(u,0);},10,s[0]);break;}}}l.GetHtml=c;l.BindEvents=a;l.DoSearch=b;l.ResultOnClick=j;l.SyncTocToPages=o;l.ResultReset=k;})(Toolbar.Search);

/** ========== kotarapp\viewer\controls\toolbar\bookinfo.js ========== **/
var Toolbar=Toolbar||{};Toolbar.BookInfo={};Toolbar.BookInfo.HTML="";(function(a){function b(c){if(a.HTML===""){var d=[];d.push("<div id='bookinfowrap'><div id='kotarname'>",c.KotarName,"</div>","<div id='bookname'>",c.BookName,"</div>","<table id='imgs'><tr>","<td style='width: 102px; height: 102px; background-color: white; position: relative;'>","<img src='",c.BookThumbUrl,"' style='position:absolute; bottom:0; right:0; left:0; border:1px solid #d1d1d1;'>","</td>");for(var e=0;e<c.lstPublishers.length;e++){var h=c.lstPublishers[e];d.push("<td><a href='",h.u,"'>");if(h.i===""){d.push(h.t,"</a></td>");}else{d.push("<img alt='",h.t,"' src='",h.i,"' /></a></td>");}}d.push("</tr></table>");if(c.AddToCart.i!==""){if(c.AddToCart.u!==""){d.push("<div id='addtocart'><a href='",c.AddToCart.u,"'><img alt='",c.AddToCart.t,"' src='",c.AddToCart.i,"' /></a></div>");}else{d.push("<div id='addtocart'><img alt='",c.AddToCart.t,"' src='",c.AddToCart.i,"' /></div>");}}for(var g=0;g<c.Info.length;g++){var f=c.Info[g];d.push("<div class='info'><span class='infoname'>",f.m_Item1," </span><span class='infoval",(BV_Platform!=""?" platform":""),"'> ",f.m_Item2,"</span></div>");}d.push("</div>");a.HTML=d.join("");}return a.HTML;}a.GetHTML=b;})(Toolbar.BookInfo);

/** ========== kotarapp\viewer\controls\toolbar\booklayers.js ========== **/
var Toolbar=Toolbar||{};Toolbar.BookLayers={};Toolbar.BookLayers.HTML="";Toolbar.BookLayers.ActiveLayerIndex="";Toolbar.BookLayers.HasLayers=false;Toolbar.BookLayers.MaxTitleLength=40;(function(b){var i=BaseMaster_sLanguageCode==="en";function e(){if(b.HTML===""){var l=[];c();if(Toolbar.BookLayers.HasLayers){l.push("<div id='knobs' class='knobslayers'></div>","<div id='layershead'>",f(),"</div>","<div class='layers'><div class='submenuscroll'>","<div class='layerscroller'>");l.push(g());l.push("</div></div></div>");}else{l.push("<div id='layershead'>",h(),"</div>");}b.HTML=l.join("");}return b.HTML;}function f(){var l=[];l.push("<span id='alllayers' class='hselected'  onclick='Toolbar.BookLayers.GetBookLayer(this);'>",TXT_Layers_All,"</span>");for(var m=0;m<Layers_State.length;m++){if(Layers_State[m].LineIsVisible){Toolbar.BookLayers.HasLayers=true;l.push("<span id='sep",Layers_State[m].Index,"'> | </span><span id='layer",Layers_State[m].Index,"' class='hnormal' onclick='Toolbar.BookLayers.GetBookLayer(this,",Layers_State[m].Index,")'>",Layers_State[m].Name,"</span>");}}return l.join("");}function h(){var l=[];l.push("<div class='nolayer'><div class='layerinfo'>",TXT_No_Layers,"</div></div>");return l.join("");}function d(p,o){Toolbar.BookLayers.ActiveLayerIndex=o;$(".hselected").removeClass("hselected").addClass("hnormal");$(p).removeClass("hnormal").addClass("hselected");if(o!==undefined){var l=15+$("#alllayers").outerWidth();var n;for(var m=0;m<o;m++){n=Layers_State[m].Index;l=l+$("#sep"+n).outerWidth()+$("#layer"+n).outerWidth();}n=Layers_State[o].Index;l=l+$("#sep"+n).outerWidth()+($("#layer"+n).outerWidth()/2);if(i){$("#knobs").css({left:l+"px"});}else{$("#knobs").css({right:l+"px"});}}else{if(i){$("#knobs").css({left:""});}else{$("#knobs").css({right:""});}}j(true);k();}function g(n){var o=[];var m=true;if(!BV_bSupportsLayersInViewer){return;}MarkersList_Entries=new Array();Layers_HideAllLayerLines();var l=false;var q=0;var r=0;MarkersList_MatchedLayers=",";for(var s=0;s<BV_nTotalPages;s++){q=MarkersList_RenderPage(s,MarkersMgr_GetPageMarkers(s),EmbededMgr_GetPageEmbededParts(s),l);if(q>0){l=!l;}r+=q;}if(MarkersList_nLastNumOfRenderedEntries!=r||r==0||m){MarkerList_SortPageEntries();if(r>0){o.push(MarkerList_GetHtml(n));}MarkersList_nLastNumOfRenderedEntries=r;}if(MarkersList_nLastNumOfRenderedEntries>0){}return o.join("");}function j(l){var m=g(Toolbar.BookLayers.ActiveLayerIndex);if(m!==""){$(".layerscroller").html(m);}if(l){Toolbar.RefreshScroll();}}function a(){var l=$(".layerspagehead");l.bind("mousedown touchstart",function(n){Toolbar.SubMenu.scrolled=false;}).bind("click",function(n){PreventBookClick=true;if(!Toolbar.SubMenu.scrolled){Toolbar.SubMenu.Hide();}});var m=$(".layerrow");m.bind("mouseenter",function(n){m.removeClass("hover");$(this).addClass("hover");}).bind("mousedown touchstart",function(n){m.removeClass("hover");$(this).addClass("hover");Toolbar.SubMenu.scrolled=false;}).bind("click",function(n){PreventBookClick=true;if(!Toolbar.SubMenu.scrolled){Toolbar.SubMenu.Hide();}});$(".layers").bind("mouseleave touchend",function(){m.removeClass("hover");});}function c(){Toolbar.BookLayers.HasLayers=false;for(var l=0;l<Layers_State.length;l++){if(Layers_State[l].LineIsVisible){Toolbar.BookLayers.HasLayers=true;}}}function k(){var l=BV_GetCurrentPageNum();for(var m=l;m>=0;m--){var o=$(".layerspagehead[data-pnum='"+m+"']");if(o.length>0){var n=o.last();window.setTimeout(function(p){Toolbar.iscroll.scrollToElement(p,0);},10,n[0]);break;}}}b.GetHtml=e;b.BindEvents=a;b.GetBookLayer=d;b.RenderLayer=j;b.SyncTocToPages=k;})(Toolbar.BookLayers);

/** ========== kotarapp\viewer\controls\toolbar\booktools.js ========== **/
var Toolbar=Toolbar||{};Toolbar.BookTools={};Toolbar.BookTools.Cache=new Array();(function(b){var f="";function d(j){Toolbar.BookTools.Cache=j;}function e(){if(f===""){var j=[];j.push("<ul>");for(var k=0;k<Toolbar.BookTools.Cache.length;k++){var l=Toolbar.BookTools.Cache[k];j.push("<li id=booktool_",l.nID,"><span>",l.sTitle,"</span></li>");}j.push("</ul>");f=j.join("");}return f;}function a(){for(var k=0;k<Toolbar.BookTools.Cache.length;k++){var l=Toolbar.BookTools.Cache[k];var j=$("#booktool_"+l.nID);j.bind("click",h(l));j.bind("touchend",h(l));}}function c(){}function g(){callAppKotarCommandNoSession("BookTool.GetAll",[{name:"nBookID",value:BV_nBookID}],{onSuccessFunction:Toolbar.ToolbarBookToolsReady,onFailureFunction:c},true);}function h(j){return function(){MasterDrawer.Open({url:j.sURL,minwidth:j.nMinWidth,title:j.sTitle,tabclass:"booktool"});Toolbar.SubMenu.Hide();};}function i(){Toolbar.BookTools.Cache=null;f="";}b.Load=g;b.GetHTML=e;b.BindEvents=a;b.BuildCache=d;b.Refresh=i;})(Toolbar.BookTools);

/** ========== kotarapp\system\js\masterdrawer.js ========== **/
var MasterDrawer=MasterDrawer||{};(function(I,J){var o=null;var l=null;var P=null;var C=false;var Q=0;var z=false;var G=false;var E=false;var j=0;var h=0;var i=0;var g=0;var y=false;var B=false;var R=0;var L=0;var K=0;var M=0;var d=0;var b=0;var H=0;var n=500;var O=10;var F=true;var aa=[];var ab=0;var ac={url:"",html:"",minwidth:500,title:"",tabclass:"item",resizecallback:null,closecallback:null};var af={defaultwidth:0,maximize:1,collapsed:2};var ag=af.defaultwidth;var V=BaseMaster_sDirection=="rtl"?true:false;var q="draweritemloaded";var ai=function(ak){var aj=document.createEvent("Event");aj.initEvent(ak,true,true);document.dispatchEvent(aj);};function A(ak){var aj=false;if(ak.indexOf("ecb.co.il")>0){aj=true;}return aj;}var ad={clear:function(){aa.length=0;ab=0;},indexOf:function(al){if(A(al)){return this.indexOfECB(al);}else{var aj=LMSTasks_FixLMSUrl(al);for(var ak=0;ak<aa.length;ak++){if(aa[ak].url===al||aa[ak].url===aj){return ak;}}}return -1;},indexOfECB:function(am){var al=url.parse(am);for(var aj=0;aj<aa.length;aj++){if(aa[aj].isecb){var ak=url.parse(aa[aj].url);if(ak.queryparsed.token===al.queryparsed.token){return aj;}}}return -1;},getbyclass:function(aj){for(var ak=0;ak<aa.length;ak++){if(aa[ak].tabclass===aj){return ak;}}return -1;},get:function(aj){return aa[aj];},add:function(aw,al,an,au,ao,ar,ap,aj){this.unselectall();var aq={id:ab++,url:aw,selected:true,minwidth:ao,tabclass:ar,resizecallback:ap,closecallback:aj,isecb:false};var at=document.createElement("div");at.id="tab"+aq.id;at.title=au;at.classList.add("tabear");at.classList.add(ar);at.classList.add("selected");aq.ear=at;if(ar==="item"){aq.url=LMSTasks_FixLMSUrl(aq.url);}if(aq.url!==""){aq.url=m(aq.url);var am=document.createElement("iframe");am.style.width="100%";am.style.height="100%";am.className="draweriframe selected";am.setAttribute("allowfullscreen",true);am.setAttribute("allow","autoplay; microphone; camera; midi");aq.content=am;aq.isecb=A(aq.url);}else{var ak=document.createElement("div");ak.className="htmlcontent selected";ak.innerHTML=al;aq.content=ak;}aa.push(aq);this.fixTabEarsPosition();P.appendChild(at);if(an){aq.content.style.transform="translateX(-"+H+"px)";var av=isIE11?H:-H;l.appendChild(aq.content);ai(q);$.Velocity(aq.content,{translateX:[0,av]},{duration:350,easing:"ease-out",complete:function(){if(aq.url!==""){aq.content.src=aq.url;}}});}else{setTimeout(function(ax){if(ax.url!==""){ax.content.src=ax.url;}l.appendChild(ax.content);ai(q);},1600,aq);}return aq;},unselectall:function(){for(var aj=0;aj<aa.length;aj++){var ak=aa[aj];if(ak.selected){ak.ear.classList.remove("selected");ak.content.classList.remove("selected");ak.selected=false;}}},closeSelectedTab:function(){var an=null;var aj=false;var al=-1;for(var ak=0;ak<aa.length&&!aj;ak++){if(aa[ak].selected){an=aa[ak];al=ak;aj=true;}}if(an!==null){if(aa.length>1){var am=(al+1)>=aa.length?aa[al-1]:aa[al+1];if(am!==null){am.ear.classList.add("selected");am.content.classList.add("selected");am.selected=true;}}if(an.closecallback!=null){an.closecallback();}an.ear.parentNode.removeChild(an.ear);an.content.parentNode.removeChild(an.content);aa.splice(al,1);this.fixTabEarsPosition();}},getSelectedTab:function(){for(var aj=0;aj<aa.length;aj++){if(aa[aj].selected){return aa[aj];}}},fixTabEarsPosition:function(){var ak=false;for(var aj=0;aj<aa.length;aj++){var al=aa[aj];var am=40+(aj*66);if(ak){am+=120;}al.ear.style.top=am+"px";if(al.selected){ak=true;}}},focus:function(aj){var ak=aj.id;for(var al=0;al<aa.length;al++){var am=aa[al];if(am.ear.id===ak){am.ear.classList.add("selected");am.content.classList.add("selected");am.selected=true;}else{am.ear.classList.remove("selected");am.content.classList.remove("selected");am.selected=false;}}this.fixTabEarsPosition();}};function x(){a();o=document.getElementById("masterdrawerlayer");l=document.getElementById("masterdrawerlayercontent");P=document.getElementById("materlayerresizer");Q=P.clientWidth;L=document.body.clientWidth-50;K=V?L:document.body.clientWidth;M=V?0:50;if(is_mobile){O=450;}C=false;ad.clear();f();}function S(ak){z=false;G=false;var an=C;var al=$.extend({},ac,ak);al.minwidth=J.max(al.minwidth,n);al.minwidth=J.min(al.minwidth,L);var ao=w(al.minwidth);ao=V?ao:-ao;if(C){if(ag===af.collapsed||l.offsetWidth<al.minwidth){ag=af.defaultwidth;E=true;ah(ao,false,600);H=ao;}}else{C=true;Y();g=J.min(j,3);ag=af.defaultwidth;o.style.width=L+"px";if(V){o.style.left=(-L)+"px";}else{o.style.left=(document.body.clientWidth)+"px";P.style.left=-10+"px";}l.classList.add("opening");l.style.width=J.abs(ao)+"px";W(J.abs(ao),v(document.body.clientWidth-J.abs(ao)-Q));ah(ao,false,1000);H=ao;}if(ao===L||is_IOS){ag=af.maximize;P.classList.add("maximized");if(is_IOS){BV_oBook.style.display="none";o.style.height=window.innerHeight+"px";}}var aj=-1;if(al.url!==""){aj=ad.indexOf(al.url);}else{aj=ad.getbyclass(al.tabclass);}if(aj>=0){var am=ad.get(aj);ad.focus(am.ear);ai(q);}else{ad.add(al.url,al.html,an,al.title,al.minwidth,al.tabclass,al.resizecallback,al.closecallback);}Toolbar.Hide();}function k(aj){sessionStorage.setItem("currentEmbeddedId","");clearTimeout(d);if(C){ad.closeSelectedTab();if(aa.length===0){ad.clear();aj=aj||false;y=aj;if(!aj){o.style.left=-(2*document.body.clientWidth)+"px";}ah(0);H=0;ag=af.defaultwidth;z=true;C=false;}}}function X(aj){if(C){F=aj;c();}}function T(aj){clearTimeout(d);d=setTimeout(function(al){var am=document.body.clientWidth-50;al=J.min(al,am);var ak=am/L;if(C&&(ak!==1||al>0)){E=true;var an=H*ak;var ao=document.body.clientWidth-J.abs(an)-Q;if(al>J.abs(an)){an=al;}if(an!==H||(an==0&&V==false)){if(V){o.style.left=(-ao)+"px";}else{o.style.left=(document.body.clientWidth)+"px";an=-J.abs(an);}W(J.abs(an),v(ao));ah({translateX:an,width:ao+"px"});H=an;}}if(C&&is_IOS){o.style.height=window.innerHeight+"px";}L=am;K=V?L:document.body.clientWidth;M=V?0:50*ak;},250,aj||-1);}function D(){return C;}function Y(){Z();j=BV_nCurrentSizeStep;}function Z(){var aj=BV_GetVerifiedPosition();if(aj!=null&&aj.length>1){h=aj[0];i=aj[1];}}function a(){var aj=document.createElement("div");aj.id="masterdrawerlayer";var ak=[];ak.push('<div id="materlayerresizer">',"</div>",'<div id="masterdrawerlayercontent"></div>');aj.innerHTML=ak.join("");document.body.appendChild(aj);}function f(){TouchUtils.EventStart.forEach(function(aj){P.addEventListener(aj,function(ak){var am=ad.getSelectedTab();if(ak.target.id===am.ear.id){var al=TouchUtils.NormalizeEvent(ak);var an=al.clientY-al.target.offsetTop;if(an<50){ae(am.minwidth);}else{if(an>140){k(true);}else{if(!is_IOS){R=al.offsetX||0;B=true;o.classList.add("moving");l.style.width=l.clientWidth+"px";TouchUtils.EventMove.forEach(function(ao){document.addEventListener(ao,N);});}}}}else{if(ak.target.classList.contains("tabear")){ad.focus(ak.target);}}});});TouchUtils.EventEnd.forEach(function(aj){document.addEventListener(aj,function(){if(B){o.classList.remove("moving");t();c();TouchUtils.EventMove.forEach(function(ak){document.removeEventListener(ak,N);});}B=false;});});}function t(){if(J.abs(H)<50){ag=af.maximize;ae(n);}else{if(J.abs(H)>L-50){ag=af.defaultwidth;ae(n);}}}function ae(aj){G=true;var ak=0;switch(ag){case af.defaultwidth:ak=V?L:-L;break;case af.maximize:ak=0;break;case af.collapsed:ak=w(aj);ak=V?ak:-ak;ag=-1;if(ak===L||is_IOS){ag=af.defaultwidth;P.classList.add("maximized");if(is_IOS){BV_oBook.style.display="none";o.style.height=window.innerHeight+"px";}}break;}ag++;if(is_IOS){s();}ah({translateX:[ak,H]});H=ak;}function w(aj){var ak=document.body.clientWidth/2;ak=J.max(ak,aj);ak=J.min(ak,L);if(is_IOS){ak=L;}return ak;}function p(){if(z){l.innerHTML="";l.style.width="";o.style.left="";o.style.width="0";if(y){W(0,j);}if(P.classList.contains("maximized")){P.classList.remove("maximized");}if(P.classList.contains("collapsed")){P.classList.remove("collapsed");}if(is_IOS){BV_oBook.style.display="";o.style.height="";U();}}else{if(l.classList.contains("opening")){l.classList.remove("opening");}}if(G){e();if(ag===af.maximize){P.classList.add("maximized");}else{if(is_IOS){BV_oBook.style.display="";o.style.height="";U();}if(P.classList.contains("maximized")){P.classList.remove("maximized");}}if(ag===af.collapsed){P.classList.add("collapsed");}else{if(P.classList.contains("collapsed")){P.classList.remove("collapsed");}}}if(E){e();}if(BV_oBook.classList.contains("moving")){BV_oBook.classList.remove("moving");}z=false;G=false;E=false;}function U(){setTimeout(function(){BV_GotoPage(h,i);},750);}function v(ak){var aj=0;var al=bookpages_getHighestZoomToFitWith(ak);aj=J.max(al,g);aj=J.min(j,aj);return aj;}function N(aj){aj.preventDefault();if(B){var ak=TouchUtils.NormalizeEvent(aj);var al=ak.clientX-R;al=J.max(al,M);al=J.min(al,K);if(J.abs(al-r())>2){al=V?al:-(document.body.clientWidth-al);clearTimeout(d);var am="translateX("+al+"px)";o.style.transform=am;H=al;d=setTimeout(e,O);}}}function e(){clearTimeout(b);l.style.width=J.max(J.abs(H),0)+"px";b=setTimeout(c,250);var aj=ad.getSelectedTab();if(aj!=null&&typeof aj.resizecallback=="function"){aj.resizecallback();}}function W(am,ap){if(!is_IOS){var al=0;var ao=0;zoomBook(ap);if(!z){var ak=BookPages_GetSizeStepWidth(ap);var an=((document.body.clientWidth-ak)/2)-15;an=J.max(an,0);ao=(am+Q)/2;ao=J.min(ao,an);al=200;}ao=V==false?-ao:ao;var aj=document.getElementById("BV_oBook");$.Velocity(aj,{translateX:ao},{duration:300,delay:al,easing:"ease-out"});}}function c(){var aj=J.abs(H);var ak=BV_nCurrentSizeStep;if(F){ak=v(document.body.clientWidth-aj-Q);}W(aj,ak);}function ah(am,al,ak){var aj=500;ak=ak||0;if(typeof am==="number"){am={translateX:am};}if(typeof al==="number"){aj=al;}$.Velocity(o,am,{duration:aj,delay:ak,easing:"ease-out",complete:function(){p();}});}function u(){return h;}function s(aj){}function r(){var aj=V?H:document.body.clientWidth+H;return aj;}function m(ak){var aj=ak;if(ak.indexOf("cet.ac.il")>-1){aj=ak.replace("http://","//");}return aj;}I.Resize=T;I.Open=S;I.Close=k;I.Init=x;I.SetIsSticky=X;I.FixDrawerPosition=s;I.IsOpen=D;I.GetBookOriginalPageNum=u;})(MasterDrawer,Math);document.addEventListener("DOMContentLoaded",function(a){MasterDrawer.Init();});

/** ========== kotarapp\resources\md5.js ========== **/
var CryptoJS=CryptoJS||function(w,i){var f={},e=f.lib={},h=function(){},o=e.Base={extend:function(a){h.prototype=this;var g=new h;a&&g.mixIn(a);g.hasOwnProperty("init")||(g.init=function(){g.$super.init.apply(this,arguments);});g.init.prototype=g;g.$super=this;return g;},create:function(){var a=this.extend();a.init.apply(a,arguments);return a;},init:function(){},mixIn:function(a){for(var g in a){a.hasOwnProperty(g)&&(this[g]=a[g]);}a.hasOwnProperty("toString")&&(this.toString=a.toString);},clone:function(){return this.init.prototype.extend(this);}},j=e.WordArray=o.extend({init:function(a,g){a=this.words=a||[];this.sigBytes=g!=i?g:4*a.length;},toString:function(a){return(a||x).stringify(this);},concat:function(l){var n=this.words,k=l.words,p=this.sigBytes;l=l.sigBytes;this.clamp();if(p%4){for(var m=0;m<l;m++){n[p+m>>>2]|=(k[m>>>2]>>>24-8*(m%4)&255)<<24-8*((p+m)%4);}}else{if(65535<k.length){for(m=0;m<l;m+=4){n[p+m>>>2]=k[m>>>2];}}else{n.push.apply(n,k);}}this.sigBytes+=l;return this;},clamp:function(){var a=this.words,g=this.sigBytes;a[g>>>2]&=4294967295<<32-8*(g%4);a.length=w.ceil(g/4);},clone:function(){var a=o.clone.call(this);a.words=this.words.slice(0);return a;},random:function(k){for(var l=[],g=0;g<k;g+=4){l.push(4294967296*w.random()|0);}return new j.init(l,k);}}),z=f.enc={},x=z.Hex={stringify:function(m){var l=m.words;m=m.sigBytes;for(var n=[],p=0;p<m;p++){var q=l[p>>>2]>>>24-8*(p%4)&255;n.push((q>>>4).toString(16));n.push((q&15).toString(16));}return n.join("");},parse:function(l){for(var k=l.length,m=[],n=0;n<k;n+=2){m[n>>>3]|=parseInt(l.substr(n,2),16)<<24-4*(n%8);}return new j.init(m,k/2);}},b=z.Latin1={stringify:function(l){var k=l.words;l=l.sigBytes;for(var m=[],n=0;n<l;n++){m.push(String.fromCharCode(k[n>>>2]>>>24-8*(n%4)&255));}return m.join("");},parse:function(l){for(var k=l.length,m=[],n=0;n<k;n++){m[n>>>2]|=(l.charCodeAt(n)&255)<<24-8*(n%4);}return new j.init(m,k);}},y=z.Utf8={stringify:function(a){try{return decodeURIComponent(escape(b.stringify(a)));}catch(k){throw Error("Malformed UTF-8 data");}},parse:function(a){return b.parse(unescape(encodeURIComponent(a)));}},c=e.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new j.init;this._nDataBytes=0;},_append:function(a){"string"==typeof a&&(a=y.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes;},_process:function(p){var n=this._data,q=n.words,r=n.sigBytes,s=this.blockSize,u=r/(4*s),u=p?w.ceil(u):w.max((u|0)-this._minBufferSize,0);p=u*s;r=w.min(4*p,r);if(p){for(var t=0;t<p;t+=s){this._doProcessBlock(q,t);}t=q.splice(0,p);n.sigBytes-=r;}return new j.init(t,r);},clone:function(){var a=o.clone.call(this);a._data=this._data.clone();return a;},_minBufferSize:0});e.Hasher=c.extend({cfg:o.extend(),init:function(a){this.cfg=this.cfg.extend(a);this.reset();},reset:function(){c.reset.call(this);this._doReset();},update:function(a){this._append(a);this._process();return this;},finalize:function(a){a&&this._append(a);return this._doFinalize();},blockSize:16,_createHelper:function(a){return function(k,l){return(new a.init(l)).finalize(k);};},_createHmacHelper:function(a){return function(k,l){return(new d.HMAC.init(a,l)).finalize(k);};}});var d=f.algo={};return f;}(Math);(function(i){function f(n,s,p,q,t,r,u){n=n+(s&p|~s&q)+t+u;return(n<<r|n>>>32-r)+s;}function d(n,s,p,q,t,r,u){n=n+(s&q|p&~q)+t+u;return(n<<r|n>>>32-r)+s;}function c(n,s,p,q,t,r,u){n=n+(s^p^q)+t+u;return(n<<r|n>>>32-r)+s;}function e(n,s,p,q,t,r,u){n=n+(p^(s|~q))+t+u;return(n<<r|n>>>32-r)+s;}for(var h=CryptoJS,g=h.lib,o=g.WordArray,j=g.Hasher,g=h.algo,b=[],k=0;64>k;k++){b[k]=4294967296*i.abs(i.sin(k+1))|0;}g=g.MD5=j.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878]);},_doProcessBlock:function(I,L){for(var l=0;16>l;l++){var J=L+l,S=I[J];I[J]=(S<<8|S>>>24)&16711935|(S<<24|S>>>8)&4278255360;}var l=this._hash.words,J=I[L+0],S=I[L+1],K=I[L+2],M=I[L+3],N=I[L+4],O=I[L+5],P=I[L+6],Q=I[L+7],R=I[L+8],T=I[L+9],U=I[L+10],V=I[L+11],a=I[L+12],m=I[L+13],p=I[L+14],F=I[L+15],n=l[0],E=l[1],G=l[2],H=l[3],n=f(n,E,G,H,J,7,b[0]),H=f(H,n,E,G,S,12,b[1]),G=f(G,H,n,E,K,17,b[2]),E=f(E,G,H,n,M,22,b[3]),n=f(n,E,G,H,N,7,b[4]),H=f(H,n,E,G,O,12,b[5]),G=f(G,H,n,E,P,17,b[6]),E=f(E,G,H,n,Q,22,b[7]),n=f(n,E,G,H,R,7,b[8]),H=f(H,n,E,G,T,12,b[9]),G=f(G,H,n,E,U,17,b[10]),E=f(E,G,H,n,V,22,b[11]),n=f(n,E,G,H,a,7,b[12]),H=f(H,n,E,G,m,12,b[13]),G=f(G,H,n,E,p,17,b[14]),E=f(E,G,H,n,F,22,b[15]),n=d(n,E,G,H,S,5,b[16]),H=d(H,n,E,G,P,9,b[17]),G=d(G,H,n,E,V,14,b[18]),E=d(E,G,H,n,J,20,b[19]),n=d(n,E,G,H,O,5,b[20]),H=d(H,n,E,G,U,9,b[21]),G=d(G,H,n,E,F,14,b[22]),E=d(E,G,H,n,N,20,b[23]),n=d(n,E,G,H,T,5,b[24]),H=d(H,n,E,G,p,9,b[25]),G=d(G,H,n,E,M,14,b[26]),E=d(E,G,H,n,R,20,b[27]),n=d(n,E,G,H,m,5,b[28]),H=d(H,n,E,G,K,9,b[29]),G=d(G,H,n,E,Q,14,b[30]),E=d(E,G,H,n,a,20,b[31]),n=c(n,E,G,H,O,4,b[32]),H=c(H,n,E,G,R,11,b[33]),G=c(G,H,n,E,V,16,b[34]),E=c(E,G,H,n,p,23,b[35]),n=c(n,E,G,H,S,4,b[36]),H=c(H,n,E,G,N,11,b[37]),G=c(G,H,n,E,Q,16,b[38]),E=c(E,G,H,n,U,23,b[39]),n=c(n,E,G,H,m,4,b[40]),H=c(H,n,E,G,J,11,b[41]),G=c(G,H,n,E,M,16,b[42]),E=c(E,G,H,n,P,23,b[43]),n=c(n,E,G,H,T,4,b[44]),H=c(H,n,E,G,a,11,b[45]),G=c(G,H,n,E,F,16,b[46]),E=c(E,G,H,n,K,23,b[47]),n=e(n,E,G,H,J,6,b[48]),H=e(H,n,E,G,Q,10,b[49]),G=e(G,H,n,E,p,15,b[50]),E=e(E,G,H,n,O,21,b[51]),n=e(n,E,G,H,a,6,b[52]),H=e(H,n,E,G,M,10,b[53]),G=e(G,H,n,E,U,15,b[54]),E=e(E,G,H,n,S,21,b[55]),n=e(n,E,G,H,R,6,b[56]),H=e(H,n,E,G,F,10,b[57]),G=e(G,H,n,E,P,15,b[58]),E=e(E,G,H,n,m,21,b[59]),n=e(n,E,G,H,N,6,b[60]),H=e(H,n,E,G,V,10,b[61]),G=e(G,H,n,E,K,15,b[62]),E=e(E,G,H,n,T,21,b[63]);l[0]=l[0]+n|0;l[1]=l[1]+E|0;l[2]=l[2]+G|0;l[3]=l[3]+H|0;},_doFinalize:function(){var m=this._data,q=m.words,n=8*this._nDataBytes,p=8*m.sigBytes;q[p>>>5]|=128<<24-p%32;var r=i.floor(n/4294967296);q[(p+64>>>9<<4)+15]=(r<<8|r>>>24)&16711935|(r<<24|r>>>8)&4278255360;q[(p+64>>>9<<4)+14]=(n<<8|n>>>24)&16711935|(n<<24|n>>>8)&4278255360;m.sigBytes=4*(q.length+1);this._process();m=this._hash;q=m.words;for(n=0;4>n;n++){p=q[n],q[n]=(p<<8|p>>>24)&16711935|(p<<24|p>>>8)&4278255360;}return m;},clone:function(){var l=j.clone.call(this);l._hash=this._hash.clone();return l;}});h.MD5=j._createHelper(g);h.HmacMD5=j._createHmacHelper(g);})(Math);

/** ========== kotarapp\viewer\js\postload\bandwidth.js ========== **/
var Bandwidth=Bandwidth||{};(function(a){var r=false;var s=null;var h={green:1,yellow:2,red:3};var t=0;var u={};var i=new Array(0,0,0,0,0);var j=0;var d=20;var b=2000;var c=4000;var v=1000;var w=2000;function q(){r=true;}function x(y,z){u[y]={l:false,z:z};setTimeout(function(A){setTimeout(g,p(A.z),{i:A.i,z:A.z});},m(),{i:y,z:z});}function k(y,A){var z=u[y];if(z!==undefined&&z.z===A){z.l=true;}}function n(){var y=j;if(y===0){y=1;}return y;}function o(z){var y=c;if(z<6){y=w;}return y;}function p(z){var y=b;if(z<6){y=v;}return y;}function m(){var y=d;if(j===0){y=0;}return y;}function g(y){if(!u[y.i].l){setTimeout(f,o(y.z),{i:y.i,z:y.z});}else{e(h.green);}}function f(y){if(!u[y.i].l){e(h.red);}else{e(h.yellow);}}function e(z){var y=l(z);if(j!==z){j=z;}}function l(z){i.pop();i.unshift(z);var A=0;for(var y=0;y<5;y++){if(i[y]>0){A+=i[y];}else{A+=z;}}return Math.round(A/5);}a.StartLoadPageImage=x;a.FinishLoadPageImage=k;a.GetCurrentColor=n;a.Init=q;})(Bandwidth);

/** ========== kotarapp\viewer\js\postload\cart.js ========== **/
function Cart_CoverPage(a){BV_AddElementToPage(a,cart_CreatePageCover(a));BookPageState_SetHasCartCover(a,true);bookpages_SetAddToBasketStyleRule();if(BaseMaster_bUserIsLoggedIn){HideMembersLoginLink();}}function Cart_UpdateCoverStatus(b){var a=BookPageState_GetHasCartCover(b);if(BookPageState_GetIsOpen(b)){if(a){BV_RemoveHTMLCover(b);}}else{if(BaseMaster_bUserIsLoggedIn){HideMembersLoginLink();}}}function BV_RemoveHTMLCover(c){var d=BV_GetPageImageElement(c);var a=null;if(isIE){for(var b=0;b<d.children.length;b++){if(d.children[b].className=="BV_AddToBasket_Wrapper"){a=d.children[b];}}if(a!=null){a.removeNode(true);}}else{for(var b=0;b<d.childNodes.length;b++){if(d.childNodes[b].className=="BV_AddToBasket_Wrapper"){a=d.childNodes[b];}}if(a!=null){d.removeChild(a);}}}function cart_CreatePageCover(a){var c=UTILS_CreateElement("DIV");c.className="BV_AddToBasket_Wrapper";c.style.cursor="default";UTILS_AddHandler(c,"mousedown touchstart",function(d){Page_OnMouseDown(d);});var b=UTILS_CreateElement("DIV");b.id="BV_AddToBasket";b.className="BV_AddToBasket";b.style.display="";UTILS_AddHandler(b,"mousedown touchstart",function(d){Page_IgnoreMouseDown(d);});b.innerHTML=getElement("BV_oClosedPageCoverHTML").innerHTML.replace("hrefOpenSmartLogin","hrefOpenSmartLogin_"+a);c.appendChild(b);return c;}function HideMembersLoginLink(){$(".LoginLinkButtonWrapper").removeClass("show").addClass("hidden");}

/** ========== kotarapp\viewer\js\postload\lms.js ========== **/
var lmsDialog=new function(){this.open=function(a){var b="/KotarApp/Viewer/Popups/UnifiedMembershipSelector.aspx?nBookExtensionID="+a;cetModalOpen({url:escape(b),iframe:true,overlayClose:false,width:"750px",height:"550px",title:"",onCloseCallback:"lmsDialog.closeModal"});};this.closeModal=function(){lmsDialog._oSuccess();};this._oSuccess=function(){};this._oFailure=function(){};};

/** ========== kotarapp\viewer\js\postload\onpostload.js ========== **/
function Viewer_PostLoadScripts_OnLoad(){BV_bPostLoadScriptsAvailable=true;BV_bMarkerScriptsLoaded=true;BV_SetMarkersStyle();bookinit_InitTools(BaseMaster_bUserIsLoggedIn);if(!is_phone||is_mobile){EmbededMgr_LoadEmbededParts();}WordsMgr_Init();if(BaseMaster_bUserIsLoggedIn){if(!is_phone||is_mobile){WordsSelectionMgr_LoadBookWordsSelection();}}else{WordSelectionMgr_bLoaded=true;}if(BV_bAdminUser){Status_GetBookEmbededStatus(false);UTILS_AddHandler(document,"onkeydown",function(a){return Viewer_OnKeyCommand(a);});}if(!is_phone||is_mobile){viewerWorker.getallbookextensions();}var b=BV_oBook.scrollHeight+BV_oBook.scrollTop;}function AddViewerPreformanceLog(){var a=new Date();var b=(a-VIEWER_START_TIME);var e=parseFloat(b/1000);var c=new Array({name:"tmp",value:"tmp"},{name:"nPageID",value:BV_GetCurrentPageID()},{name:"nBookID",value:BV_nBookID},{name:"gResponseID",value:G_RESPONSE_ID},{name:"TimeInSeconds",value:e},{name:"dtTime",value:VIEWER_START_TIME.format("dd/MM/yyyy HH:mm:ss")});executeWebRequest("Statistics.UpdatePerformanceData",c,null,null,"UpdateCurrentBookUrl_OnComplete");}

/** ========== kotarapp\viewer\js\postload\restorepoints.js ========== **/
var BV_oRestorePoint=null;function BV_SaveRestorePoint(a){if(BV_oRestorePoint==null||a.nMarkerID!=BV_oRestorePoint.nMarkerID){BV_RestoreMarkerProperties(true,"BV_SaveRestorePoint");BV_oRestorePoint=[];BV_oRestorePoint.nMarkerID=a.nMarkerID;BV_oRestorePoint.sText=a.sText;BV_oRestorePoint.nProjectID=a.nProjectID;BV_oRestorePoint.sType=a.sType;BV_oRestorePoint.sSubType=a.sSubType;BV_oRestorePoint.sUrl=a.sUrl;BV_oRestorePoint.top=a.style.top.replace("px","")+"";BV_oRestorePoint.left=a.style.left.replace("px","")+"";BV_oRestorePoint.width=a.style.width.replace("px","")+"";BV_oRestorePoint.height=a.style.height.replace("px","")+"";BV_oRestorePoint.nAudience=a.nAudience;}}function BV_RestoreMarkerProperties(a,c){if(BV_oRestorePoint==null){return;}var b=BV_GetMarkerByID(BV_oRestorePoint.nMarkerID);if(b==null){return;}UTILS_RemoveDomElement(b);BV_InstantiateUserMarker(b.nPageIndex,MarkersMgr_Get(b.nMarkerID));if(a){BV_HideMarkerBubble("BV_RestoreMarkerProperties",false);}BV_ClearRestorePoint();}function BV_ClearRestorePoint(){BV_oRestorePoint=null;}

/** ========== kotarapp\viewer\js\postload\selectregion.js ========== **/
function BV_StartRegionSelection(b,a,e){var c=BV_GetPageImageElement(b);UTILS_PreventBrowserDefaultAction(a);BV_nSelectionMinX=0;BV_nSelectionMaxX=c.offsetWidth-1;BV_nSelectionMinY=0;BV_nSelectionMaxY=c.offsetHeight-1;BV_oSelection=UTILS_CreateElement("DIV");BV_oSelection.className=e;BV_oSelection.nPageIndex=b;BV_AddElementToPage(b,BV_oSelection);BV_nSelectionPage=b;BV_nSelectionPageID=BookPageState_GetPageID(b);BV_oSelection.style.width="1px";BV_oSelection.style.height="1px";BV_nStartSelectionMouseX=mousePos.x;BV_nStartSelectionMouseY=mousePos.y;var d=UTILS_GetElementPos(c);BV_nStartSelectionX=mousePos.x-d.nLeft-BV_nScrollbarWidth-(isIE||isIE11||isIE10?20:2);BV_nStartSelectionY=mousePos.y-d.nTop-2;BV_oSelection.style.left=BV_nStartSelectionX+"px";BV_oSelection.style.top=BV_nStartSelectionY+"px";BV_oSelection.style.display="inline";BV_bOnSelection=true;}function BV_ContinueRegionSelection(a){if(BV_bOnSelection){var b=mousePos.x-BV_nStartSelectionMouseX;var c=mousePos.y-BV_nStartSelectionMouseY;var h=b+1;var d=c+1;var f=BV_nStartSelectionX;var g=BV_nStartSelectionY;if(b<0){h=-b+1;f=BV_nStartSelectionX-h+1;}if(c<0){d=-c+1;g=BV_nStartSelectionY-d+1;}if(f<BV_nSelectionMinX){h-=BV_nSelectionMinX-f;f=BV_nSelectionMinX;}if(f+h>=BV_nSelectionMaxX){h=BV_nSelectionMaxX-f+1;}if(g<BV_nSelectionMinY){d-=BV_nSelectionMinY-g;g=BV_nSelectionMinY;}if(g+d>=BV_nSelectionMaxY){d=BV_nSelectionMaxY-g+1;}if(h<0||d<0){return;}BV_oSelection.style.width=h+"px";BV_oSelection.style.height=d+"px";BV_oSelection.style.left=f+"px";BV_oSelection.style.top=g+"px";}}function BV_IsValidRegionSelection(){if(BV_bOnSelection){if(BV_oSelection.offsetWidth>10&&BV_oSelection.offsetHeight>8){return true;}}return false;}function BV_EndRegionSelection(a){var b=false;BV_SetActiveTool(BV_DEFAULTTOOL);Toolbar.ResetButton("crop");if(BV_bOnSelection){BV_nSelectionLeft=BV_oSelection.offsetLeft;BV_nSelectionTop=BV_oSelection.offsetTop;BV_nSelectionWidth=BV_oSelection.offsetWidth;BV_nSelectionHeight=BV_oSelection.offsetHeight;if(BV_oSelection.offsetWidth>10&&BV_oSelection.offsetHeight>8){b=true;}if(a){UTILS_RemoveDomElement(BV_oSelection);}BV_bOnSelection=false;}return b;}

/** ========== kotarapp\viewer\js\postload\smartlogin.js ========== **/
var bInPlaceLogin=false;var _sJSAction="";function OpenSmartLoginPopup(sJSAction){if(typeof(BaseMaster_bUserIsLoggedIn)=="undefined"){return;}sJSAction=ReplaceAll(sJSAction,"[A]","'");if(bInPlaceLogin==true||BaseMaster_bUserIsLoggedIn){eval(sJSAction);return true;}_sJSAction=sJSAction;ShowLoginPopup(true,"Toolbar_SmartLogin_OnSuccess",(sJSAction!=""));}function OpenSmartTouchLoginPage(a){ShowLoginTouchPage(window.location,a);}function OpenSmartTouchLoginPopup(logindelegate){if(typeof(BaseMaster_bUserIsLoggedIn)=="undefined"){return;}logindelegate=ReplaceAll(logindelegate,"[A]","'");if(bInPlaceLogin==true||BaseMaster_bUserIsLoggedIn){eval(logindelegate);return true;}_sJSAction=logindelegate;ShowLoginTouchPopup("Toolbar_SmartLogin_OnSuccess",logindelegate!=="");}function Toolbar_SmartLogin_OnSuccess(gUserID,sUsername,bIsAdmin,bIsCoordinator,bIsSchoolUser,bIsTeacher,nDefaultProjectID,sMySpaceUrl,numOpenTasksInLMS,bCanCreateLMSTasks,gInstituteID,nSchoolID){if(bIsAdmin){location.reload(true);return;}BV_InitToolbar();var sHelloMsg=ReplaceAll(TXT_HelloUsernamePleaseWait,"[sUsername]",sUsername);ShowAjaxNotification(sHelloMsg);bInPlaceLogin=true;bUtils_bInPlaceLogin=true;BaseMaster_bUserIsLoggedIn=true;BaseMaster_gUserID=gUserID;if(BV_bSomePagesAreClosed){ReloadBookPagesInfo();}else{eval(_sJSAction);}Layers_GetBookExtensionTargetLayers(true);WordsSelectionMgr_LoadBookWordsSelection();BV_bIsSchoolUser=bIsSchoolUser;BV_bIsTeacher=bIsTeacher;BV_DefaultProjectID=nDefaultProjectID;BV_gInstituteID=gInstituteID;BV_nSchoolID=nSchoolID;}function ReloadBookPagesInfo(){var a=new Array({name:"nBookID",value:BV_nBookID},{name:"tmp",value:"tmp"});callAppKotarCommand("Pages.GetBookPages",a,{onSuccessFunction:ReloadBookPagesInfo_OnSuccess,onFailureFunction:ReloadBookPagesInfo_OnError});}function ReloadBookPagesInfo_OnError(){}function ReloadBookPagesInfo_OnSuccess(oBookPages){var bSomePagesAreClosed=false;for(var p=0;p<oBookPages.length;p++){var nPageNum=oBookPages[p].nPageNum-1;if(oBookPages[p].bIsOpen==false){bSomePagesAreClosed=true;}BookPageState_Update(nPageNum,oBookPages[p]);Cart_UpdateCoverStatus(nPageNum);}if(BV_bAdminUser){AdTools_CountPagesWithPics();AdTools_CountLockedPages();}if(!bSomePagesAreClosed){BV_bSomePagesAreClosed=bSomePagesAreClosed;BV_nMinSizeStep=BV_nRealMinSizeStep;BV_nMaxSizeStep=BV_nRealMaxSizeStep;}BookPages_ClearLastPreparedBookPageSize();BookPages_PrepareNewBookPageSize();if(AdTools_bShowWireframe||AdTools_bShowWordWireframe||AdTools_bShowLineWireframe){BV_RemoveAllWireframeElements();PageContent_LoadPagesInView(false);}eval(_sJSAction);MarkersMgr_Refresh();}

/** ========== kotarapp\viewer\js\postload\viewerworker.js ========== **/
var viewerWorker;(function(f){var g=null;function e(){g=new Worker("/KotarApp/System/js/comandhandler.js");g.addEventListener("message",function(h){switch(h.data.cmd){case"bookextensions.getallbookextensions":loadMiniMarker_OnComplete(JSON.parse(h.data.aMiniMarkers),h.data.oInfo);a();break;}},false);}function b(){if(g===null){e();}g.postMessage({cmd:"bookextensions.getallbookextensions",param:d("nBookID"),workerbaseurl:c()});}function c(){var i=window.location.host;var h=adjustCdnPattern(i);return h;}function d(i,h){i=i.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var k="[\\?&]"+i+"=([^&#]*)";var j=new RegExp(k);var l=j.exec(window.location.href);if(l==null){return h;}else{return unescape(decodeURIComponent(l[1]).replace(/\+/g," "));}}function a(){g.postMessage({cmd:"stop"});}f.getallbookextensions=b;})(viewerWorker||(viewerWorker={}));

/** ========== kotarapp\viewer\js\postload\bookwords\accessibility.js ========== **/
function WordsMgr_Accessibility_InjectText(c,d){window.addEventListener("resize",function(){setTimeout(function(){$("map").find("area").each(function(){var h=$(this).attr("data-pageidx");var j=$(this).attr("data-wordFirstText");var i=$(this).attr("data-wordFirstOrder");var k=$(this).attr("data-wordLastOrder");var l=getWordLineCoords(h,j,i,k);$(this).attr("coords",l);});});});if(!$("#BV_oPage_"+c).attr("data-accessibility")){$("#BV_oPage_"+c).attr("data-accessibility",true);var e=' src="/KotarApp/Viewer/Images/1x1transparent.svg" alt=""';var f=' usemap="#pageWorkmap_'+c+'"';$("#BV_oPage_"+c).append("<img "+e+f+' style="outline: none; draggable="false" ondragstart="return false;">');$("#BV_oPage_"+c).append(getWorkmapHTML(c,d));$("#BV_oPageWrapper_"+c).attr("wait").replace("","");var a=$("#BV_oPageWrapper_"+c);var g=a.attr("wait");if(g&&g.indexOf("")!==-1){var b=g.replace("","");a.attr("wait",b);}}}function getWorkmapHTML(a,b){var c=getWordsLines(a,b);var d=getWordsParagraphs(a,c);workmap=generateWorkmapParagraphs(a,d);return workmap;}function generateWorkmapLines(f,m){var o='"#pageWorkmap_'+f+'"';var n="<map name="+o+">";var e="";for(var d=0;d<m.length;d++){e=m[d].sText.replace(/["]/gi,"");var h='style="pointer-events: none; pointer: none; cursor: none;" shape="rect" href="#'+f+'.0.0.default" role="presentation"';var g=' data-pageidx = "'+m[d].pageidx+'"';var k=' data-wordFirstText = "'+m[d].wordFirstText+'"';var j=' data-wordFirstOrder = "'+m[d].wordFirstOrder+'"';var l=' data-wordLastOrder = "'+m[d].wordLastOrder+'"';var c=' coords = "'+m[d].oWordRowCoords+'"';var a=' alt="'+e+'"';var b="<area "+h+c+a+g+k+j+l+">";n=n+b;e="";}if(!m.length){var b='<area shape="rect" coords="0 0 0 0" alt="" role="presentation">';n=n+b;}n=n+"</map>";return n;}function generateWorkmapParagraphs(k,s){var u='"#pageWorkmap_'+k+'"';var t="<map name="+u+">";if(!s||!s[0]){var e=document.getElementById("BV_oPageWrapper_"+k);var g=e.clientLeft;var o=e.clientTop;var m=e.clientWidth-e.clientLeft;var c=e.clientTop+e.clientHeight;var j=g+" "+o+" "+m+" "+c;var b='<area style="pointer-events: none; pointer: none; cursor: default; outline:none" shape="rect" href="#'+k+'.0.0.default" coords="'+j+'" alt="" data-pageidx="'+k+'" data-wordfirsttext="" data-wordfirstorder="0" data-wordlastorder="0" role="presentation">';t=t+b;t=t+"</map>";return t;}var h="";for(var f=0;f<s.length;f++){h=s[f].sText.replace(/["]/gi,"");var n='style="pointer-events: none; pointer: none; cursor: default; outline:none" shape="rect" href="#'+k+'.0.0.default" role="presentation"';var l=' data-pageidx = "'+s[f].pageidx+'"';var q=' data-wordFirstText = "'+s[f].wordFirstText+'"';var p=' data-wordFirstOrder = "'+s[f].wordFirstOrder+'"';var r=' data-wordLastOrder = "'+s[f].wordLastOrder+'"';var d=' coords = "'+s[f].oWordRowCoords+'"';var a=' alt="'+h+'"';var b="<area "+n+d+a+l+q+p+r+">";t=t+b;h="";}t=t+"</map>";return t;}function getWorkmapCoords(a,c){var b="0 0 0 0";var f=WordsMgr_GetNormalizedBookWord(a,c);if(f&&Object.keys(f).length>0){var e=f.nLeft+parseInt(f.nWidth);var d=f.nTop+parseInt(f.nHeight);b=f.nLeft+" "+f.nTop+" "+e+" "+d;}return b;}function isRTL(c){var a="\u0591-\u07FF\u200F\u202B\u202E\uFB1D-\uFDFD\uFE70-\uFEFC",b=new RegExp("^[^"+a+"]*?["+a+"]");return b.test(c);}function getWordLineCoords(a,d,c,f){var b=getWorkmapCoords(a,c-1).split(" ");var e=getWorkmapCoords(a,f-1).split(" ");var g=e[0]+" "+e[1]+" "+b[2]+" "+b[3];if(!isRTL(d)){g=b[0]+" "+b[1]+" "+e[2]+" "+e[3];}return g;}function getWordsLines(p,q){var t=100000;var s=100000;var h=10;var u={nTop:0,nLeft:0,nWidth:0,nHeight:0,IsEmpty:true};var z=[];var w={sText:"",nOrder:0,oWordRowCoords:"",pageidx:0,wordFirstText:"",wordFirstOrder:0,wordLastOrder:0};var A="";var m=0;var g=u;var v=u;var d=0,l=0,n=0;var C=0,o=0,I=0;var J,K,D,b;var k="";for(d=0;d<q.length;d++){var E=q[d];if(d===0){var F=E;}A=A+" "+E.sText;var f=(t-h<E.nTop&&s+h<E.nTop+E.nHeight)?true:false;var e=(t!=100000&&t-E.nTop>h)?true:false;if((f||e)&&!g.IsEmpty){J=g.nTop;K=Math.ceil(C/I);D=v.nTop+v.nWidth-g.nTop;b=Math.ceil(o/I);if(m>0){var r=z[(m-1)];if(r.nLeft+r.nHeight>K){var a=Math.Abs((r.nLeft+r.nHeight)-K);if(a<h){b-=a;K=r.nLeft+r.nHeight;}}}var B=A.split(" ");k=B[B.length-1];var j="";if(d<q.length-1){for(var c=0;c<B.length-1;c++){j=j+" "+B[c];}}else{j=A;}var G=q[d-1];var H=getWordLineCoords(p,F.sText,F.nOrder,G.nOrder);var u={nTop:J,nLeft:K,nWidth:D,nHeight:b,IsEmpty:false};var w={sText:j,nOrder:++m,oWordRowCoords:H,pageidx:p,wordFirstText:F.sText,wordFirstOrder:F.nOrder,wordLastOrder:G.nOrder};z.push(w);g=u;A=k;F=q[d];}else{if(t-E.nTop<0&&g!=u){E.nLeft=g.nLeft;E.nHeight=g.nHeight;}}t=E.nTop;s=E.nTop+E.nHeight;if(g.IsEmpty){g=v=E;g.IsEmpty=false;v.IsEmpty=false;l=n=d;I=1;C=E.nLeft;o=E.nHeight;}else{I++;C+=E.nLeft;o+=E.nHeight;if(g.nTop>E.nTop){l=d;g=E;g.IsEmpty=false;}else{if(v.nTop<E.nTop){n=d;v=E;v.IsEmpty=false;}}}}if(!g.IsEmpty){J=g.nTop;K=Math.ceil(C/I);D=v.nTop+v.nWidth-g.nTop;b=Math.ceil(o/I);var B=A.split(" ");k=B[B.length-1];var j="";if(d<q.length-1){for(var c=0;c<B.length-1;c++){j=j+" "+B[c];}}else{j=A;}var G=q[d-1];var H=getWordLineCoords(p,F.sText,F.nOrder,G.nOrder);var u={nTop:J,nLeft:K,nWidth:D,nHeight:b,IsEmpty:false};var w={sText:j,nOrder:++m,oWordRowCoords:H,pageidx:p,wordFirstText:F.sText,wordFirstOrder:F.nOrder,wordLastOrder:G.nOrder};z.push(w);A=k;F=E;}return z;}function getWordsParagraphs(l,r){var m=[];var j=[];for(var g=0;g<r.length-1;g++){var c=r[g].oWordRowCoords.split(" ");var p=c[1];var a=c[3];var d=r[g+1].oWordRowCoords.split(" ");var q=d[1];var b=d[3];var f=q-p;j[j.length]=f;}var e=0;var o=0;var h=[];var n={};var k=0;for(var g=0;g<j.length-1;g++){if(!n[j[g]]){n[j[g]]=0;}n[j[g]]++;}if(j[0]-j[1]>5){h[h.length]=0;}for(var g=1;g<j.length;g++){if(j[g]-j[g-1]>3){h[h.length]=g;}}for(var g=0;g<h.length;g++){o=h[g];m[m.length]=getParagraph(l,r,e,o);e=o+1;}o=r.length-1;m[m.length]=getParagraph(l,r,e,o);return m;}function getParagraph(j,t,d,o){if(!t.length){return;}var h=t[d].nOrder;var q=t[d].wordFirstOrder;var r=t[d].wordFirstText;var s=t[o].wordLastOrder;var n="";var c=t[d].oWordRowCoords.split(" ");var f=t[o].oWordRowCoords.split(" ");var g=c[0]<f[0]?c[0]:f[0];var p=c[1];var l=c[2]>f[2]?c[2]:f[2];var b=f[3];var m=g;var a=l;for(var e=d;e<o;e++){toLineCoords=t[e].oWordRowCoords.split(" ");n=n+" "+t[e].sText;m=m<toLineCoords[0]?m:toLineCoords[0];a=a>toLineCoords[2]?a:toLineCoords[2];}n=n+" "+t[o].sText;var u=m+" "+p+" "+a+" "+b;var k={sText:n,nOrder:h,oWordRowCoords:u,pageidx:j,wordFirstText:r,wordFirstOrder:q,wordLastOrder:s};return k;}function loadTOCData(a){Toolbar.Toc.LoadTocData(function(b){a(null,b);},function(){a("Failed to load TOC data.");});}function appendTOCHeaders(b){var a=document.getElementById("BV_oPage_0");if(a&&a.parentNode){a.appendChild(createHtag("1",b.t,"0"));}oPagesInfo.pages.forEach(function(f,e){var h=findTOCEntryForPage(f.lbl,b);if(h){var d=createHtag(parseInt(h.level,10)+1,h.t,f.lbl);var c=parseInt(f.lbl,10)===0?0:parseInt(f.lbl,10)-1;var g=document.getElementById("BV_oPageWrapper_"+c);if(g){g.appendChild(d);}}});}function createHtag(b,d,c){var a=document.createElement("H"+b);a.textContent=d+" ... "+c;a.style.zIndex="-9999999";a.style.position="relative";a.style.lineHeight="0px";a.style.margin="0";a.style.height="0";a.style.width="0";return a;}function findTOCEntryForPage(a,c){function b(h,d){for(var f=0;f<h.length;f++){var e=h[f];e.level=d;if(e.l===a){return e;}if(e.cn&&e.cn.length>0){var g=b(e.cn,d+1);if(g){return g;}}}return null;}return b(c.cn,1);}function initializeBookWithTOC(){loadTOCData(function(a,b){if(a){}else{appendTOCHeaders(b);}});}window.addEventListener("load",function(){initializeBookWithTOC();});

/** ========== kotarapp\viewer\js\postload\bookwords\builder.js ========== **/
function drawMarkedWords(){$(".currentMarkedwords").remove();BV_DrawSelectedWords(BV_nSelectionPage,firstMarkedWordRec,lastMarkedWordRec,firstMakedWordIdx,lastMarkedWordIdx,"currentMarkedwords");}function BV_DrawSelectedWords(f,c,e,b,d,a){if(BV_IsBookDirectionRTL){BV_DrawSelectedWordsRTL(f,c,e,b,d,a);}else{BV_DrawSelectedWordsLTR(f,c,e,b,d,a);}}function BV_DrawSelectedWordsRTL(r,c,l,b,k,a){var n=b<k;var u;var m;var t;var x;var e;if(n){u=c[1];m=c[0];t=m+c[2];x=t-m;e=c[3];for(var f=b;f<=k;f++){var y=WordsMgr_GetNormalizedBookWord(r,f);if(isValidObject(y)){var s=[y.nLeft,y.nTop,y.nWidth,y.nHeight];var q=s[1];var o=s[0];var v=s[2];var d=s[3];var p=o+v;if(Math.abs(u-q)>(e/2)){drawMarkedWordsBlock(r,u,m,x,e,a);m=o;t=p;}m=Math.min(m,o);t=Math.max(t,p);x=t-m;u=q;e=d;}}}else{u=c[1];m=c[0];t=m+c[2];x=t-m;e=c[3];for(var g=b;g>=k;g--){var y=WordsMgr_GetNormalizedBookWord(r,g);if(isValidObject(y)){var s=[y.nLeft,y.nTop,y.nWidth,y.nHeight];var q=s[1];var o=s[0];var v=s[2];var d=s[3];var p=o+v;if(Math.abs(u-q)>(d/2)){drawMarkedWordsBlock(r,u,m,x,e,a);u=q;m=o;t=p;e=d;}m=Math.min(m,o);t=Math.max(t,p);x=t-m;}}}drawMarkedWordsBlock(r,u,m,x,e,a);}function BV_DrawSelectedWordsLTR(r,c,l,b,k,a){var n=b>k;var u;var m;var x;var e;var t;if(n){u=c[1];m=c[0];t=m+c[2];x=t-m;e=c[3];for(var f=b;f>=k;f--){var y=WordsMgr_GetNormalizedBookWord(r,f);if(isValidObject(y)){var s=[y.nLeft,y.nTop,y.nWidth,y.nHeight];var q=s[1];var o=s[0];var v=s[2];var d=s[3];var p=o+v;if(Math.abs(u-q)>(d/2)){drawMarkedWordsBlock(r,u,m,x,e,a);m=o;t=p;}m=Math.min(m,o);t=Math.max(t,p);x=t-m;u=q;e=d;}}}else{u=c[1];m=c[0];t=m+c[2];x=t-m;e=c[3];for(var g=b;g<=k;g++){var y=WordsMgr_GetNormalizedBookWord(r,g);if(isValidObject(y)){var s=[y.nLeft,y.nTop,y.nWidth,y.nHeight];var q=s[1];var o=s[0];var v=s[2];var d=s[3];var p=o+v;if(Math.abs(u-q)>(d/2)){drawMarkedWordsBlock(r,u,m,x,e,a);u=q;m=o;t=p;e=d;x=0;}m=Math.min(m,o);t=Math.max(t,p);x=t-m;}}}drawMarkedWordsBlock(r,u,m,x,e,a);}function drawMarkedWordsBlock(d,e,c,f,b,a){wordBlock=UTILS_CreateElement("DIV");$wordBlock=$(wordBlock);$wordBlock.addClass("Markedwords");$wordBlock.addClass(a);$wordBlock.addClass("load");$wordBlock.css({left:c+"px",top:e+"px",width:f+"px",height:b+"px"});BV_AddElementToPage(d,wordBlock);}function BV_OpenMarkedWordsMenu(d,c,e,b){$(".wordSelectionMenuWrapper").remove();Toolbar.SubMenu.Hide();Toolbar.Sidebar.Hide();WordSelectionMgr_MenuVisible=true;var i=UTILS_CreateElement("DIV");i.className="wordSelectionMenuWrapper "+(b!==undefined?b:"");$(i).css({left:c+"px",top:e+"px"});$(i).on("click touchstart",function(l){l.preventDefault();l.stopPropagation();return false;});var h=UTILS_CreateElement("DIV");h.className="wordSelectionMenu";var g=UTILS_CreateElement("DIV");g.className="wordSelectionMenuFirstFloor wordSelectionMarkerMenu";$(g).on("click touchend",function(l){l.preventDefault();WordSelectionMgr_ShowMarkerColorMenu(this,false);return false;});$(h).append(g);var k=UTILS_CreateElement("DIV");k.className="wordSelectionMenuFirstFloor wordSelectionUnderlineMenu";$(k).on("click touchend",function(l){l.preventDefault();WordSelectionMgr_ShowMarkerColorMenu(this,true);return false;});$(h).append(k);var j=UTILS_CreateElement("DIV");j.className="wordSelectionMenuFirstFloor wordSelectionSearchMenu";$(j).on("click touchend",function(l){l.preventDefault();if(BaseMaster_sLanguageCode==="he"){DictionaryManager.ShowDictionarySearch();WordSelectionMgr_ClearWordSelection();}else{WordSelectionMgr_ShowSearchMenu(this);}return false;});$(h).append(j);var f=UTILS_CreateElement("DIV");f.className="wordSelectionMenuFirstFloor wordSelectionCopyMenu";$(f).on("click touchend",function(l){l.preventDefault();CopyToClipboard_OnClick();return false;});$(h).append(f);var a=UTILS_CreateElement("DIV");a.className="clearboth";$(h).append(a);$(i).append(h);BV_AddElementToPage(d,i);}function ShowMeTheMoney(d){var b=BookPageState_GetPageNumberByLabel(d.value)-1;if(WordsMgr_PageWords_bLoaded[b]){for(var a=0;a<WordsMgr_PageWords[b].length;a++){var e=WordsMgr_GetNormalizedBookWord(b,a);if(isValidObject(e)){wordBlock=UTILS_CreateElement("DIV");$wordBlock=$(wordBlock);$wordBlock.addClass("Markedwords");$wordBlock.addClass("MarkedWordsColor2");var c=[e.nLeft,e.nTop,e.nWidth,e.nHeight];$wordBlock.css({left:e.nLeft+"px",top:e.nTop+"px",width:e.nWidth+"px",height:e.nHeight+"px"});$wordBlock.html(e.nOrder);BV_AddElementToPage(b,wordBlock);}}}}

/** ========== kotarapp\viewer\js\postload\bookwords\manager.js ========== **/
function WordsMgr_Init(){for(var a=0;a<BV_nTotalPages;a++){WordsMgr_PageWords_bLoaded[a]=false;}}function WordsMgr_LoadPageWords(b){if(!WordsMgr_PageWords_bLoaded[b]&&BookPageState_GetIsOpen(b)){var a=BookPageState_GetPageID(b);var c=new Array({name:"nPageID",value:a});callAppKotarCommandNoSession("Page.GetPageWords",c,{onSuccessFunction:WordsMgr_LoadPageWords_OnComplete,onFailureFunction:WordsMgr_LoadPageWords_OnError,params:c},true);}}function WordsMgr_LoadPageWords_OnComplete(g,a){var c=BookPageState_GetPageIndex(a.params[0].value);WordsMgr_PageWords_bLoaded[c]=false;WordsMgr_PageWords[c]=new Array();var f=g.split("@");var d={nOrder:0,nTop:1,nLeft:2,nWidth:3,nHeight:4,sText:5};for(var b=0;b<f.length;b++){var e=f[b].split(" ");if(e!=""){WordsMgr_PageWords[c].push({nOrder:parseInt(e[d.nOrder]),nTop:parseInt(e[d.nTop]),nLeft:parseInt(e[d.nLeft]),nWidth:parseInt(e[d.nWidth]),nHeight:parseInt(e[d.nHeight]),sText:e[d.sText]});}}WordsMgr_PageWords_bLoaded[c]=true;WordsMgr_Accessibility_InjectText(c,WordsMgr_PageWords[c]);}function WordsMgr_LoadPageWords_OnError(){}function WordsMgr_GetWordIdxByOrder(c,b){var d=-1;if(WordsMgr_PageWords_bLoaded[c]&&WordsMgr_PageWords[c]!==undefined){var e=WordsMgr_PageWords[c];for(var a=0;a<e.length;a++){if(e[a].nOrder===b){d=a;break;}}}return d;}function WordsMgr_GetNormalizedBookWord(d,g){if(!WordsMgr_PageWords_bLoaded[d]||WordsMgr_PageWords[d]===undefined){return;}var f=WordsMgr_PageWords[d][g];if(f===null||f===undefined){return;}var b=oPagesInfo.pages[d].hi;var c=oPagesInfo.pages[d].w;var e=(BV_nPageImageWidth/c)*BV_dPageRatio;var a=(BV_nPageImageHeight/b)*BV_dPageRatio;return{nOrder:parseInt(f.nOrder),nTop:parseInt(f.nTop*a),nLeft:parseInt(f.nLeft*e),nWidth:parseInt(f.nWidth*e),nHeight:parseInt(f.nHeight*a)};}

/** ========== kotarapp\viewer\js\postload\bookwords\selection.js ========== **/
var firstMakedWordIdx=-1;var lastMarkedWordIdx=-1;var firstMarkedWordRec=[0,0,0,0];var lastMarkedWordRec=[0,0,0,0];var BV_WordSelectionMouseMoved=false;function BV_StartWordSelection(c,a){if(invalidMobile()){return;}var f=a.target||a.srcElement;var b=$(f).closest(".wordSelectionMenuWrapper");if(b.length===0){BV_SetActiveTool(BV_SELECT);if(WordsMgr_PageWords_bLoaded[c]){var d=BV_GetPageImageElement(c);UTILS_PreventBrowserDefaultAction(a);firstMakedWordIdx=-1;lastMarkedWordIdx=-1;firstMarkedWordRec=[0,0,0,0];lastMarkedWordRec=[0,0,0,0];BV_nSelectionMinX=0;BV_nSelectionMaxX=d.offsetWidth-1;BV_nSelectionMinY=0;BV_nSelectionMaxY=d.offsetHeight-1;BV_nSelectionPage=c;BV_nSelectionPageID=BookPageState_GetPageID(c);BV_nStartSelectionMouseX=mousePos.x;BV_nStartSelectionMouseY=mousePos.y;var e=UTILS_GetElementPos(d);BV_nStartSelectionX=mousePos.x-e.nLeft-BV_nScrollbarWidth-2;BV_nStartSelectionY=mousePos.y-e.nTop-2;if(WordSelectionMgr_MenuVisible){PreventBookClick=true;}WordSelectionMgr_ClearWordSelection();BV_bOnWordSelection=true;BV_WordSelectionMouseMoved=false;}else{}}}function BV_UpdateStartWordSelection(a){if(BV_bOnWordSelection){BV_nStartSelectionMouseY-=a;BV_ContinueWordSelection();}}function BV_ContinueWordSelection(a){if(BV_bOnWordSelection){var b=mousePos.x-BV_nStartSelectionMouseX;var c=mousePos.y-BV_nStartSelectionMouseY;if(BV_WordSelectionMouseMoved||(b>5||b<-5)||(c>5||c<-5)){BV_WordSelectionMouseMoved=true;}if(BV_WordSelectionMouseMoved){var h=b+1;var d=c+1;var f=BV_nStartSelectionX;var g=BV_nStartSelectionY;var i=b<0?c>-6:c>6;if(!BV_IsBookDirectionRTL){i=b>0?c>-6:c>6;}if(b<0){h=-b+1;f=BV_nStartSelectionX-h+1;}if(c<0){d=-c+1;g=BV_nStartSelectionY-d+1;}if(b>0){h=b-1;f=BV_nStartSelectionX+h-1;}if(c>0){d=c-1;g=BV_nStartSelectionY+d-1;}if(f<BV_nSelectionMinX){h-=BV_nSelectionMinX-f;f=BV_nSelectionMinX;}if(f+h>=BV_nSelectionMaxX){h=BV_nSelectionMaxX-f+1;}if(g<BV_nSelectionMinY){d-=BV_nSelectionMinY-g;g=BV_nSelectionMinY;}if(g+d>=BV_nSelectionMaxY){d=BV_nSelectionMaxY-g+1;}if(h<0||d<0){return;}if(f<lastMarkedWordRec[0]||f>lastMarkedWordRec[0]+lastMarkedWordRec[2]||g<lastMarkedWordRec[1]||g>lastMarkedWordRec[1]+lastMarkedWordRec[3]){BV_SearchWordsToMark(f,g,i);BV_WordSelectionMouseMoved=true;}}}}function BV_EndWordSelection(a){if(BV_bOnWordSelection){if(firstMakedWordIdx>=0&&lastMarkedWordIdx>=0){PreventBookClick=(is_mobile&!is_IOS8)?false:true;UTILS_PreventBrowserDefaultAction(a);var c=lastMarkedWordRec[0]+(lastMarkedWordRec[2]/2)-105;var d=lastMarkedWordRec[1]-47-12;var b="";if(BV_CheckNeedToFlip(d)){d=lastMarkedWordRec[1]+lastMarkedWordRec[3]+12;b="flipdown";}c=Math.max(c,0);c=Math.min(c,BV_nPageImageWidth-210-10);CopyToClipboard_SetText(c,d,b);}else{if(BV_WordSelectionMouseMoved){PreventBookClick=is_mobile?false:true;ShowAjaxMessageBox(TXT_SelectionAreaNoText,5000);}}BV_SetActiveTool(BV_SELECT);TouchUtils.EnableMsScrolling();}BV_bOnWordSelection=false;}function BV_WordClickSelection(a){var c=a.target||a.srcElement;var b=$(c).closest(".wordSelectionMenuWrapper");if(b.length===0){BV_bOnWordSelection=true;BV_WordSelectionMouseMoved=true;BV_ContinueWordSelection(a);BV_ReEndWordSelection(a);}}function BV_ReEndWordSelection(a){a=a||window.event;BV_bOnWordSelection=true;BV_WordSelectionMouseMoved=true;drawMarkedWords();BV_EndWordSelection(a);}function BV_CheckNeedToFlip(b){var a=false;a=b-45<0;a=a||BookScroll.ScrollTop()-BV_GetPageWrapperElement(BV_nSelectionPage).offsetTop>b-45;return a;}function BV_SearchWordsToMark(d,e,j){var f=lastMarkedWordIdx;if(firstMakedWordIdx===-1){for(var c=0;c<WordsMgr_PageWords[BV_nSelectionPage].length;c++){var l=WordsMgr_GetNormalizedBookWord(BV_nSelectionPage,c);if(isValidObject(l)){var g=[l.nLeft,l.nTop,l.nWidth,l.nHeight];if(d>(g[0])){var m=g[0];var k=g[2];if(d<m+k){if(e>g[1]){var n=g[1];var b=g[3];if(e<n+b){var a=BV_GetFirstWordToMark(c,g,j);firstMakedWordIdx=a.idx;firstMarkedWordRec=a.rec;lastMarkedWordIdx=c;lastMarkedWordRec=[m,n,k,b];break;}}}}}}}else{BV_SetLastWordToMark(d,e,j);}if(firstMakedWordIdx>=0&&f!==lastMarkedWordIdx){drawMarkedWords();}}function BV_GetFirstWordToMark(e,b,d){var c={idx:e,rec:b};if(d){if(b[1]>BV_nStartSelectionY){for(var a=e-1;a>=0;a--){var f=WordsMgr_GetNormalizedBookWord(BV_nSelectionPage,a);if(isValidObject(f)){if(f.nTop>=BV_nStartSelectionY&&f.nTop<=b[1]){c.idx=a;c.rec=[f.nLeft,f.nTop,f.nWidth,f.nHeight];}else{break;}}}}}else{if(b[1]+b[3]<BV_nStartSelectionY){for(var a=e+1;a<WordsMgr_PageWords[BV_nSelectionPage].length;a++){var f=WordsMgr_GetNormalizedBookWord(BV_nSelectionPage,a);if(isValidObject(f)){if(f.nTop+f.nHeight<=BV_nStartSelectionY&&f.nTop>=b[1]){c.idx=a;c.rec=[f.nLeft,f.nTop,f.nWidth,f.nHeight];}else{break;}}}}}return c;}function BV_SetLastWordToMark(c,d,e){var b=WordsMgr_GetNormalizedBookWord(BV_nSelectionPage,firstMakedWordIdx);if(isValidObject(b)){if(e){for(var a=firstMakedWordIdx;a<WordsMgr_PageWords[BV_nSelectionPage].length;a++){var f=WordsMgr_GetNormalizedBookWord(BV_nSelectionPage,a);if(isValidObject(f)){if(f.nTop<d&&(f.nTop+f.nHeight)+(b.nHeight/2)>b.nTop+b.nHeight){if(f.nTop+f.nHeight<d){lastMarkedWordIdx=a;lastMarkedWordRec=[f.nLeft,f.nTop,f.nWidth,f.nHeight];}else{if(BV_IsBookDirectionRTL){if(f.nLeft+f.nWidth>c){lastMarkedWordIdx=a;lastMarkedWordRec=[f.nLeft,f.nTop,f.nWidth,f.nHeight];}else{break;}}else{if(f.nLeft<c){lastMarkedWordIdx=a;lastMarkedWordRec=[f.nLeft,f.nTop,f.nWidth,f.nHeight];}}}}else{break;}b=f;}}}else{for(var a=firstMakedWordIdx;a>=0;a--){var f=WordsMgr_GetNormalizedBookWord(BV_nSelectionPage,a);if(isValidObject(f)){if(f.nTop+f.nHeight>d&&f.nTop-(b.nHeight/2)<b.nTop){if(f.nTop>d){lastMarkedWordIdx=a;lastMarkedWordRec=[f.nLeft,f.nTop,f.nWidth,f.nHeight];}else{if(BV_IsBookDirectionRTL){if(f.nLeft<c){lastMarkedWordIdx=a;lastMarkedWordRec=[f.nLeft,f.nTop,f.nWidth,f.nHeight];}}else{if(f.nLeft+f.nWidth<c){lastMarkedWordIdx=a;lastMarkedWordRec=[f.nLeft,f.nTop,f.nWidth,f.nHeight];}}}}else{break;}b=f;}}}}}function BV_SwitchToWordSelection(a,b,c){if(invalidMobile()){return;}BV_SetActiveTool(BV_SELECT);BV_StartWordSelection(b,a);BV_WordSelectionMouseMoved=true;if(c){ShowAjaxNotification(TXT_TocEntryIsActive);}BV_ContinueWordSelection();}function searchword(c,d){for(var b=0;b<WordsMgr_PageWords[BV_nSelectionPage].length;b++){var g=WordsMgr_GetNormalizedBookWord(BV_nSelectionPage,b);if(isValidObject(g)){var e=[g.nLeft,g.nTop,g.nWidth,g.nHeight];if(c>(e[0])){var j=e[0];var f=e[2];if(c<j+f){if(d>e[1]){var k=e[1];var a=e[3];if(d<k+a){return g.nOrder;}}}}}}return -1;}function searchwordsmarked(b,c){var f=searchword(b,c);if(f>0){var e=WordsMgr_PageSelections[BV_nSelectionPage];if(e!=undefined&&e.length>0){for(var a=0;a<e.length;a++){var d=e[a];if(d.FromWordOrder<=f&&f<=d.ToWordOrder){WordSelectionMgr_DrawSelection(BV_nSelectionPage,d);BV_OpenMarkedWordsMenu(BV_nSelectionPage,b-100,c);BV_bOnWordSelection=false;}}}}}

/** ========== kotarapp\viewer\js\postload\embeded\builder.js ========== **/
function BV_ResetEmbededPartDomElementsArray(){BV_aEmbededParts=new Array();}function BV_GetEmbededPartByID(b){var e="BV_EmbededPart_"+b;var d=null;for(var a=0;a<BV_aEmbededParts.length;a++){var c=BV_aEmbededParts[a];if(c.id==e){d=c;}}return d;}var imageHtmlTemplate='<div class="Div_ClassName"><span class="Span_ClassName"><div id="embededImg_$idSuffix" class="generalImgNoBorder"  style="background-image:url(\'$ImageSrc\');background-size:$ImageStrech;height:$ImageHeight;"></div></span></div>';var iconTagTemplateHtml="<div class='embedediconprite $embededIconType' style='$IconStyle'></div>";var templateKeys={className:/_ClassName/gi,idSuffix:"$idSuffix",imageSource:"$ImageSrc",iconStyle:"$IconStyle",imageStrech:"$ImageStrech",embededIconType:"$embededIconType",imageHeight:"$ImageHeight"};var imageHtmlTemplateClassNames={vertical:"VerticalLayout",horizontal:"HorizontalLayout"};var imageStrech={contain:"contain",full:"100% 100%"};var embededType={image:0,video:1,item:2,audio:3,linkedItem:4,link:5,imageAccessibility:6};var embededIconType={image:"image",video:"video",item:"item",audio:"audio"};var IconType={Large:1,LargeT:2,Small:3};var EmbededStatusList={New:0,Embed_WaitApprove:1,Embed_Approved:4,Embed_WaitProcess:3,Embed_Done:2,Delete_WaitApprove:5,Delete_Approved:6,Delete_WaitProcess:7,Delete_Done:8,Rejected:9};var EmbedIconBigSizes=[28,33,38,43,48,53,58,63,68];var EmbedIconSmallSizes=[20,23,26,29,32,35,38,41,44];function RenderEmbededPart(j,o,i){if(o==null&&typeof(i)!="undefined"){o=EmbededMgr_Get(i);}if(o==null){return;}if($("#BV_EmbededPart_"+o.nID)){$("#BV_EmbededPart_"+o.nID).remove();}var l=UTILS_CreateElement("DIV");var n=GetActualPosition(o);l.id="BV_EmbededPart_"+o.nID;l.nID=o.nID;l.name="BV_EmbededPart";l.className="BV_EmbededPart";l.title=o.sTitle;l.style.top=n.nTop+"px";l.style.left=n.nLeft+"px";l.style.width=n.nWidth+"px";l.style.height=n.nHeight+"px";l.nTop=o.nTop;l.nLeft=o.nLeft;l.nWidth=o.nWidth;l.nHeight=o.nHeight;if(!BookPageState_GetIsOpen(j)){l.style.opacity=(0.35);l.style.filter="alpha(opacity=35)";l.style.zIndex=1;}l.nType=o.nType;l.nPageIndex=j;if(!o.bHasBorder){l.className+=" NoBorder";}var g=o.ImageFileURL;var a=o.EmbededFileURL;var p=o.sTitle;var c="";if(o.bShowIcon){var d,b;switch(o.nIconType){case IconType.Large:case IconType.LargeT:d=EmbedIconBigSizes[BV_nCurrentSizeStep];b=d-1;break;case IconType.Small:d=EmbedIconSmallSizes[BV_nCurrentSizeStep];b=d+1;break;default:if(o.nType==embededType.audio){d=EmbedIconSmallSizes[BV_nCurrentSizeStep];b=d+1;}else{d=EmbedIconBigSizes[BV_nCurrentSizeStep];b=d-1;}break;}c=iconTagTemplateHtml.replace(templateKeys.iconStyle,GetIconPositionStyle(o.sIconAlign,n.nWidth,n.nHeight,d,b));c=c.replace(templateKeys.embededIconType,"embededIcon"+EmbededMgr_GetsIcontype(o.nType)+EmbededMgr_GetIconTypeSuffix(o.nType,o.nIconType));}var f="";var h=(o.nImageType==0||o.nImageType==3||o.nImageType==4||o.nStatus==2?true:false);if(!h){f=imageHtmlTemplate;f=f.replace(templateKeys.imageSource,g);f=f.replace(templateKeys.idSuffix,o.nID);if(o.bPreserveImageSize){f=f.replace(templateKeys.imageStrech,imageStrech.contain).replace(templateKeys.imageHeight,n.nHeight+"px");f=f.replace(templateKeys.className,imageHtmlTemplateClassNames.horizontal);}else{f=f.replace(templateKeys.imageStrech,imageStrech.full).replace(templateKeys.imageHeight,n.nHeight+"px");}}else{l.style.background="none";}$(l).html(c+f);if(l.nType==embededType.item||l.nType==embededType.linkedItem){if(o.bPopup){if(o.nExternalPublisherID===null){}else{$(l).click(function(r){EmbededMgr_GetExternalItemURL(o,j);r.stopPropagation();return false;});}var m=UTILS_CreateElement("A");m.href=o.EmbededURL;m.target="_blank";$(m).append(l);AddEmbeded(j,m);}else{if(o.nExternalPublisherID===null){$(l).click(function(r){sessionStorage.setItem("currentEmbeddedId",JSON.stringify(o));kmobj.KotarMultmideaDoAction({type:"iframe",width:(o.bForceMinWidth?o.nFrameWidth:0),height:o.nFrameHeight,url:o.EmbededURL,title:p,fullscreenenabled:(!ieVer||ieVer>8)?(o.OpenItemType===2):false,forcefullscreen:(!ieVer||ieVer>8)?o.OpenItemType===1:false,askonclose:o.AskOnClose});r.stopPropagation();});}else{$(l).click(function(r){EmbededMgr_GetExternalItemURL(o,j);r.stopPropagation();});}AddEmbeded(j,l);}}else{if(l.nType==embededType.link){var m=UTILS_CreateElement("A");m.href=UTILS_fixProtocolRelativeURLs(o.EmbededURL);m.target="_blank";$(m).append(l);AddEmbeded(j,m);}else{AddEmbeded(j,l);}}BV_aEmbededParts[BV_aEmbededParts.length]=l;if(BV_bAdminUser){var k=n.nTop+n.nHeight;if(!isIE){k+=2;}if(BV_bShowAdminButtons&&o.nStatus!=EmbededStatusList.Delete_Approved&&o.nStatus!=EmbededStatusList.Delete_WaitProcess){RenderAdminActions(j,o.nID,o.nStatus,k,n.nLeft,n.nWidth,o.nOrder);$(l).mousedown(function(){EmbededIsDragged=true;});$(l).draggable({containment:"parent",stop:function(r,s){UpdateEmbededLoaction(l);}});}}switch(l.nType){case embededType.image:if(o.bPopup){$(l).hover(function(){$(this).addClass("ClickableCursor");},function(){$(this).removeClass("ClickableCursor");});var e=GetEmbededImageSize(o.nImageWidth,o.nImageHeight);$(l).click(function(r){kmobj.KotarMultmideaDoAction({at:$("#dialog"),type:"image",width:e.nImageWidth,height:e.nImageHeight,url:g,title:p});r.stopPropagation();});}break;case embededType.video:$(l).hover(function(){$(this).addClass("ClickableCursor");},function(){$(this).removeClass("ClickableCursor");});$(l).click(function(r){kmobj.KotarMultmideaDoAction({at:$("#dialog"),type:"video",width:512,height:384,url:o.EmbededURL,title:p});r.stopPropagation();});break;case embededType.item:case embededType.linkedItem:$(l).hover(function(){$(this).addClass("ClickableCursor");},function(){$(this).removeClass("ClickableCursor");});break;case embededType.audio:$(l).hover(function(){$(this).addClass("ClickableCursor");},function(){$(this).removeClass("ClickableCursor");});$(l).click(function(r){kmobj.KotarMultmideaDoAction({at:$("#dialog"),type:"audio",url:a,title:p});r.stopPropagation();});break;case embededType.link:if(o.nImageType==3){$(l).addClass("link");}else{if(o.nImageType==4){$(l).addClass("transparentLink");}}$(l).hover(function(){$(this).addClass("ClickableCursor");},function(){$(this).removeClass("ClickableCursor");});$(l).click(function(r){kmobj.KotarMultmideaDoAction({type:"link"});r.stopPropagation();});case embededType.imageAccessibility:var q=$(l).attr("title");$(l).attr("role","img");$(l).attr("aria-label",q);default:return"";}}function RenderAdminActions(e,b,f,g,c,h,d){$("#BV_AdminEmbededPartActions_"+b).remove();var i=UTILS_CreateElement("DIV");i.id="BV_AdminEmbededPartActions_"+b;$(i).addClass("BV_AdminEmbededPartActions");if(g>BV_nPageImageHeight-22){g=BV_nPageImageHeight-22;}BV_AddElementToPage(e,i);$(i).click(function(k){ShowActiveEmbeded(b);PreventBookClick=true;});RenderDeleteEmbededPartButton($(i),e,b);var a=250;switch(f){case EmbededStatusList.New:RenderWaitApproveEmbededPartButton($(i),b);break;case EmbededStatusList.Embed_WaitApprove:if(BV_bCanApproveEmbeded){RenderApproveEmbededPartButton($(i),b);RenderRejectEmbededPartButton($(i),b);a=265;}else{RenderWaitApproveEmbededPartStatus($(i),b);a=240;}break;case 2:a=170;break;case 3:a=170;break;case 4:a=170;break;}if(f==EmbededStatusList.Rejected){RenderEditEmbededPartButton($(i),b,TXT_FixEmbededPart);}else{RenderEditEmbededPartButton($(i),b,TXT_EditEmbededPart);}RenderResizeEmbededPartButton($(i),b);RenderEmbededPartOrder($(i),d);var j=h;if(h<a){h=a;if(c-((h-j)/2)>0&&c-((h-j)/2)+h<BV_nPageImageWidth){c-=((h-j)/2);}}if(c+h>=BV_nPageImageWidth){c=c-h+j;}$(i).css({top:g,left:c,"min-width":h});}function RenderDeleteEmbededPartButton(d,b,a){$("#BV_DeleteEmbededPart_"+a).remove();var c=UTILS_CreateElement("DIV");c.id="BV_DeleteEmbededPart_"+a;$(c).addClass("BV_DeleteEmbededPart");$(c).html(TXT_DeleteEmbededPart);d.append(c);$(c).click(function(f){if(confirm(TXT_Confirm)){EmbededMgr_OnDelete(b,a);PreventBookClick=true;}});}function RenderEditEmbededPartButton(d,b,a){$("#BV_EditEmbededPart_"+b).remove();var c=UTILS_CreateElement("DIV");c.id="BV_EditEmbededPart_"+b;$(c).addClass("BV_EditEmbededPart");$(c).html(a);d.append(c);$(c).click(function(f){ShowEmbededPopup(BV_GetEmbededPartByID(b),b);PreventBookClick=true;});}function RenderWaitApproveEmbededPartStatus(c,a){$("#BV_WaitApproveEmbededPart_"+a).remove();var b=UTILS_CreateElement("DIV");b.id="BV_WaitApproveEmbededPart_"+a;$(b).addClass("BV_WaitApproveEmbededPartStatus");$(b).html(TXT_WaitApproveEmbededPartStatus);c.append(b);}function RenderWaitApproveEmbededPartButton(c,a){$("#BV_WaitApproveEmbededPart_"+a).remove();var b=UTILS_CreateElement("DIV");b.id="BV_WaitApproveEmbededPart_"+a;$(b).addClass("BV_WaitApproveEmbededPart");$(b).html(TXT_WaitApproveEmbededPart);c.append(b);$(b).click(function(d){EmbededMgr_OnChangeStatus(a,EmbededStatusList.Embed_WaitApprove);PreventBookClick=true;});}function RenderApproveEmbededPartButton(c,a){$("#BV_ApproveEmbededPart_"+a).remove();var b=UTILS_CreateElement("DIV");b.id="BV_ApproveEmbededPart_"+a;$(b).addClass("BV_ApproveEmbededPart");$(b).html(TXT_ApproveEmbededPart);c.append(b);$(b).click(function(d){EmbededMgr_OnChangeStatus(a,EmbededStatusList.Embed_Approved);PreventBookClick=true;});}function RenderRejectEmbededPartButton(c,a){$("#BV_RejectEmbededPart_"+a).remove();var b=UTILS_CreateElement("DIV");b.id="BV_RejectEmbededPart_"+a;$(b).addClass("BV_RejectEmbededPart");$(b).html(TXT_RejectEmbededPart);c.append(b);$(b).click(function(d){ShowRejectEmbededPopup(a);PreventBookClick=true;});}function RenderResizeEmbededPartButton(c,a){PreventBookClick=true;$("#BV_ResizeEmbededPart_"+a).remove();var b=UTILS_CreateElement("DIV");b.id="BV_ResizeEmbededPart_"+a;$(b).addClass("BV_ResizeEmbededPart");$(b).html(TXT_ResizeEmbededPart);c.append(b);$(b).click(function(d){EmbededPartResize(BV_GetEmbededPartByID(a));PreventBookClick=true;});}function RenderEmbededPartOrder(c,b){var a=UTILS_CreateElement("DIV");$(a).addClass("BV_EmbededPartOrder");$(a).html(b);c.append(a);}function GetActualPosition(a){return{nLeft:UTILS_LogicalToPixelX(a.nLeft,BV_nPageImageWidth),nTop:UTILS_LogicalToPixelY(a.nTop,BV_nPageImageHeight),nWidth:UTILS_LogicalToPixelX(a.nWidth,BV_nPageImageWidth),nHeight:UTILS_LogicalToPixelY(a.nHeight,BV_nPageImageHeight)};}function GetIconPositionStyle(f,b,a,d,c){var g=[];var e="";switch(f){case"LT":e="left:0px";break;case"CT":e="left:"+(b-d)/2+"px";break;case"RT":e="right:0px";break;case"LM":e="top:"+(a-c)/2+"px;left:0px";break;case"CM":e="top:"+(a-c)/2+"px;left:"+(b-d)/2+"px";break;case"RM":e="top:"+(a-c)/2+"px;right:0px";break;case"LB":e="bottom:0px;left:0px";break;case"CB":e="bottom:0px;left:"+(b-d)/2+"px";break;case"RB":e="bottom:0px;right:0px";break;default:e="top:"+(a-c)/2+"px;left:"+(b-d)/2+"px";break;}g.push("width: ",d,"px;height: ",c,"px;",e);return g.join("");}function GetEmbededImageSize(c,b){var d=(c/b);var a=(50);if(c>$("#masterStage").width()&&b<=$("#masterStage").height()){c=$("#masterStage").width();b=(c*d);}else{if(b>BV_BookWrraper_offsetHeight){b=BV_BookWrraper_offsetHeight-a;c=b*d;}}return{nImageWidth:c,nImageHeight:b};}function AddEmbeded(a,b){$(BV_oBook.childNodes[a].childNodes[0]).append($(b).fadeIn(400));}

/** ========== kotarapp\viewer\js\postload\embeded\list.js ========== **/
var EmbededList_Entries=null;var EmbededList_nLastNumOfRenderedEntries=0;function EmbededList_ReRender(){EmbededList_Render(true);}function EmbededList_Render(b){StatusList_VerifyInit();EmbededList_Entries=new Array();EmbededList_RenderHeader();var a=false;var c=0;var d=0;for(var e=0;e<BV_nTotalPages;e++){c=EmbededList_RenderPage(e,EmbededMgr_GetPageEmbededParts(e),a);if(c>0){a=!a;}d+=c;}if(true||EmbededList_nLastNumOfRenderedEntries!=d||d==0||b){if(EmbededList_Entries.length>1){getElement("divEmbeddedList").innerHTML=EmbededList_Entries.join("");}else{getElement("divEmbeddedList").innerHTML="";}MarkersList_nLastNumOfRenderedEntries=d;}StatusList_RenderSelectorTitle();if(BV_bCanApproveEmbeded){$("#dvPublishBook").css("visibility","visible");}else{$("#dvPublishBook").css("visibility","hidden");}}function EmbededList_RenderHeader(){EmbededList_Entries[0]="<table id='tblEmbeded' cellpadding='0' cellspacing='0' border='0' width='100%'><tr><td class='pageNumTitle'>"+TXT_EmbededList_Page+"</td>"+(!BV_bShowLayerIcons||Layers_TotalNumOfLayers==0?"":"<td class='typeTitle'>"+TXT_EmbededList_Type+"</td>")+"<td class='textTitle'>"+TXT_EmbededList_Title+"</td><td class='statusTitle'>"+TXT_EmbededList_Status+"</td><td class='updateTitle'>"+TXT_LayersList_Updated+"</td></tr>";}function EmbededList_RenderPage(e,a,b){var d=0;if(EmbededList_Entries[e]===undefined){EmbededList_Entries[e]=new Array();}a.sort(EmbededList_SortByOrder);for(var c=0;c<a.length;c++){var f=a[c];if(f!=null){oStatus=StatusList_Get(f.nStatus);if(oStatus!=null){if(oStatus.Show){EmbededList_Entries[e].push({date:f.dtUpdateDate,item:f,type:1,data:f.nStatus,top:f.nTop});d++;}}}}return d;}function EmbededList_SortByOrder(c,d){var e=1;if(c.nOrder<d.nOrder){e=-1;}return e;}function EmbededList_SortByDate(c,d){var e=1;if(c.dtUpdateDate>d.dtUpdateDate){e=-1;}return e;}function EmbededList_SortByTop(c,d){var e=1;if(c.nTop<d.nTop){e=-1;}return e;}function RemoveHTMLElements(a){if(a==""){return"";}oHelper=UTILS_CreateElement("DIV");oHelper.style.display="none";document.body.appendChild(oHelper);if(isIE){oHelper.innerHTML=a;return GetInnerText(oHelper)+"";}else{if(isChrome){oHelper.innerHTML=a;return oHelper.innerText;}else{if(isFirefox){oHelper.innerHTML=a;return oHelper.textContent;}else{return a;}}}}function EmbededList_RenderRow(g,f,a,e,b,h){var i=g.sTitle.trim();i=RemoveHTMLElements(i);if(i.indexOf("<")>=0){i=RemoveHTMLElements(i);}if(i=="undefined"){i=TXT_LayersList_NoTitle+"?";}if(i==""){i=TXT_LayersList_NoTitle;}i=decodeKotar(i);if(i.length>Toolbar.BookLayers.MaxTitleLength){i=i.substring(0,Toolbar.BookLayers.MaxTitleLength)+" ...";}var d="";switch(g.nType){case 0:d="image";break;case 1:d="video";break;case 2:case 4:d="item";break;case 3:d="audio";break;case 5:d="link";break;case 6:d="imageAccessibility";break;default:return"";}var c=[];if(g.nType===6){i="  - "+i;}c.push("<div id='layerrow_",g.nID,"' class='layerrow' onclick='EmbededMgr_OnClick(",f,", ",g.nID,")' >","<div class='layericon ",d,"' ></div><div class='layerinfo",(h?" admin":""),"' >",i,"</div>");if(h){c.push("<div class='layerstatus' >",g.StatusName,"</div>");}c.push("</div>");return c.join("");}function EmbededList_GetHtml(d){var e=[];var a=false;var b=false;for(var f=0;f<EmbededList_Entries.length;f++){var h=EmbededList_Entries[f];if(h.length>0){b=true;for(var g=0;g<h.length;g++){var c=h[g];if(b){e.push(MarkerList_GetPageHeaderHtml(f));e.push("<div id='layerspagewrapper_",f,"'>");}if(c.item!=null&&c.item.bShowInAdminReport){e.push(EmbededList_RenderRow(c.item,f,a,b,false,true));}b=false;}a=!a;e.push("</div>");}}return e.join("");}function EmbededList_ReRenderPage(f){var b=[];var e=$("#layerspagewrapper_"+f);var g=EmbededMgr_GetPageEmbededParts(f);g.sort(EmbededList_SortByOrder);var a=false;if(g.length>0){for(var d=0;d<g.length;d++){var c=g[d];if(c!=null&&c.bShowInAdminReport){b.push(EmbededList_RenderRow(c,f,a,false,false,true));}}a=!a;}e.html(b.join(""));}window.addEventListener("message",function(a){if(a&&typeof(a.data)==="string"){if(a.data.indexOf("studio|editEnded")>=0){console.log("gotMessage: studio|editEnded");a.source.postMessage("studio|gotoPlayer","*");}}});

/** ========== kotarapp\viewer\js\postload\embeded\manager.js ========== **/
function HideSelection(){$("#BV_oMarkerFrame").hide();$(".BV_oMarkerHandle").hide();$(".BV_SelectMarker").remove();}function EmbededMgr_LoadEmbededParts(){if(!EmbededMgr_bLoaded){var a=new Array({name:"nBookID",value:BV_nBookID});callAppKotarCommand("BookEmbedsParts.GetAllBookEmbededParts",a,{onSuccessFunction:loadEmbededParts_OnComplete,onFailureFunction:loadEmbededParts_OnError},false);}}function EmbededMgr_OnBookLayoutModification(){EmbededMgr_ClearAllEmbededParts();}function EmbededMgr_ClearAllEmbededParts(){for(var a=0;a<BV_nTotalPages;a++){EmbededMgr_RenderedEmbededParts[a]=false;}BV_ResetEmbededPartDomElementsArray();}function loadEmbededParts_OnError(){}function EmbededMgr_ClearEmbededPartDomElements(){$(".BV_EmbededPart").remove();if(BV_bAdminUser){$(".BV_AdminEmbededPartActions").remove();}EmbededMgr_OnBookLayoutModification();}function EmbededMgr_ClearEmbededPartDomElementsInView(a,d){for(var b=0;b<BV_nTotalPages;b++){if(EmbededMgr_RenderedEmbededParts[b]){EmbededMgr_RenderedEmbededParts[b]=false;var c=$("#BV_oPage_"+b);if(b>=a&&b<=d){$("#BV_oPage_"+b+" > .BV_EmbededPart").fadeOut(150,function(){$(this).remove();});if(BV_bAdminUser){$("#BV_oPage_"+b+" > .BV_AdminEmbededPartActions").fadeOut(150,function(){$(this).remove();});}}else{$("#BV_oPage_"+b+" > .BV_EmbededPart").remove();if(BV_bAdminUser){$("#BV_oPage_"+b+" > .BV_AdminEmbededPartActions").remove();}}}}BV_ResetEmbededPartDomElementsArray();}function loadEmbededParts_OnComplete(a,f){var i=/-?\d+/;EmbededMgr_PageEmbededParts=new Array();EmbededMgr_PageWithEmbededParts=new Array();for(var g=0;g<BV_nTotalPages;g++){EmbededMgr_PageEmbededParts[g]=new Array();EmbededMgr_RenderedEmbededParts[g]=false;EmbededMgr_PageWithEmbededParts[g]=false;}for(var b=0;b<a.length;b++){var e=a[b];var c=e.nPageID;var d=BookPageState_GetPageIndex(c);EmbededMgr_PageWithEmbededParts[d]=true;var h=EmbededMgr_PageEmbededParts[d];h[h.length]={nID:e.nID,nPageID:e.nPageID,sTitle:e.sTitle,nType:e.nType,nZindex:e.nZindex,nLeft:e.nXPosition,nTop:e.nYPosition,nWidth:e.nWidth,nHeight:e.nHeight,nImageType:e.nImageType,ImageFileURL:e.ImageFileURL,EmbededFileURL:e.EmbededFileURL,nStatus:e.nStatus,StatusName:e.StatusName,bPreserveImageSize:e.bPreserveImageSize,bPopup:e.bPopup,bHasBorder:e.bHasBorder,EmbededURL:e.EmbededURL,sIconAlign:e.sIconAlign,bShowIcon:e.bShowIcon,nImageHeight:e.nImageHeight,nImageWidth:e.nImageWidth,nFrameHeight:e.nFrameHeight,nFrameWidth:e.nFrameWidth,sUpdatedTime:e.sUpdatedTime,OpenItemType:e.OpenItemType,AskOnClose:e.AskOnClose,nIconType:e.nIconType,dtUpdateDate:new Date(parseInt(i.exec(e.UpdatedTime)[0])),sExternalID:e.sExternalID,nExternalPublisherID:e.nExternalPublisherID,nOrder:e.nOrder,bShowInLayers:e.bShowInLayers,bShowInAdminReport:e.bShowInAdminReport,bForceMinWidth:e.bForceMinWidth};}for(var g=0;g<BV_nTotalPages;g++){if(EmbededMgr_PageWithEmbededParts[g]){EmbededMgr_RenderPageEmbededParts(g);}}EmbededMgr_bLoaded=true;if(typeof sefaria!="undefined"){setTimeout(function(){sefaria.link();},1500);}StatusList_HideAjaxLoader();}function EmbededMgr_GetsIcontype(a){switch(a){case 0:return"Image";case 1:return"Video";case 2:case 4:return"Item";case 3:return"Audio";case 5:return"Link";case 6:return"ImageAccessibility";default:return"";}}function EmbededMgr_GetIconTypeSuffix(b,a){switch(a){case 1:return"L";case 2:return"TL";case 3:return"S";default:if(b==3){return"S";}else{return"L";}}}function EmbededMgr_OnAdd(c){HideModalPopup();if(c==null){return;}var a=c.nPageID;var b=BookPageState_GetPageIndex(a);EmbededMgr_PageWithEmbededParts[b]=true;var d=EmbededMgr_PageEmbededParts[b];d[d.length]={nID:c.nID,nPageID:c.nPageID,sTitle:c.sTitle,nType:c.nType,nZindex:c.nZindex,nLeft:c.nXPosition,nTop:c.nYPosition,nWidth:c.nWidth,nHeight:c.nHeight,nImageType:c.nImageType,ImageFileURL:c.ImageFileURL,EmbededFileURL:c.EmbededFileURL,nStatus:c.nStatus,StatusName:c.StatusName,bPreserveImageSize:c.bPreserveImageSize,bPopup:c.bPopup,bHasBorder:c.bHasBorder,EmbededURL:c.EmbededURL,sIconAlign:c.sIconAlign,bShowIcon:c.bShowIcon,nImageHeight:c.nImageHeight,nImageWidth:c.nImageWidth,nFrameHeight:c.nFrameHeight,nFrameWidth:c.nFrameWidth,sUpdatedTime:markersMgr_GetFormatDate(),OpenItemType:c.OpenItemType,AskOnClose:c.AskOnClose,nIconType:c.nIconType,dtUpdateDate:new Date(),sExternalID:c.sExternalID,nExternalPublisherID:c.nExternalPublisherID,nOrder:c.nOrder,bShowInLayers:c.bShowInLayers,bShowInAdminReport:c.bShowInAdminReport,bForceMinWidth:c.bForceMinWidth};HideSelection();var e=EmbededMgr_RenderedEmbededParts[b];EmbededMgr_RenderedEmbededParts[b]=false;EmbededMgr_RenderPageEmbededParts(b);ShowAjaxImportantMessageBox(TXT_Embeded,2500);Toolbar.AdminMenu.ClearHtml();MarkersList_ReRender();if(e){EmbededList_ReRenderPage(b);}else{Toolbar.AdminMenu.ReRenderList();}EmbededButtonStyle(false);}function EmbededMgr_OnUpdate(d){HideModalPopup();if(d==null){return;}var b=d.nPageID;var c=BookPageState_GetPageIndex(b);EmbededMgr_PageWithEmbededParts[c]=true;var e=EmbededMgr_PageEmbededParts[c];for(var a=0;a<e.length;a++){if(e[a]!=null&&e[a].nID==d.nID){e[a].nPageID=d.nPageID,e[a].sTitle=d.sTitle,e[a].nType=d.nType,e[a].nZindex=d.nZindex,e[a].nLeft=d.nXPosition,e[a].nTop=d.nYPosition,e[a].nWidth=d.nWidth,e[a].nHeight=d.nHeight,e[a].nImageType=d.nImageType,e[a].ImageFileURL=d.ImageFileURL,e[a].EmbededFileURL=d.EmbededFileURL,e[a].nStatus=d.nStatus,e[a].StatusName=d.StatusName,e[a].bPreserveImageSize=d.bPreserveImageSize,e[a].bPopup=d.bPopup,e[a].bHasBorder=d.bHasBorder,e[a].EmbededURL=d.EmbededURL,e[a].sIconAlign=d.sIconAlign,e[a].bShowIcon=d.bShowIcon,e[a].nImageHeight=d.nImageHeight,e[a].nImageWidth=d.nImageWidth,e[a].nFrameHeight=d.nFrameHeight,e[a].nFrameWidth=d.nFrameWidth,e[a].OpenItemType=d.OpenItemType,e[a].AskOnClose=d.AskOnClose,e[a].nIconType=d.nIconType,e[a].nOrder=d.nOrder,e[a].bShowInLayers=d.bShowInLayers,e[a].bShowInAdminReport=d.bShowInAdminReport;}}HideSelection();EmbededMgr_RenderedEmbededParts[c]=false;EmbededMgr_RenderPageEmbededParts(c);ShowAjaxImportantMessageBox(TXT_Embeded,2500);EmbededButtonStyle(false);}function EmbededMgr_OnDelete(b,a){if(a==null){return;}var c=new Array({name:"nID",value:parseInt(a)});callAppKotarCommand("BookEmbedsParts.DeleteEmbededPart",c,{onSuccessFunction:DeleteEmbededPart_OnComplete,onFailureFunction:DeleteEmbededPart_OnError,nID:a,nPageIndex:b});}function EmbededMgr_OnChangeStatus(a,b){if(a==null){return;}var c=new Array({name:"nID",value:parseInt(a)},{name:"nStatus",value:parseInt(b)});callAppKotarCommand("BookEmbedsParts.ChangeStatus",c,{onSuccessFunction:ChangeStatusEmbededPart_OnComplete,onFailureFunction:ChangeStatusEmbededPart_OnError,nID:a,nStatus:b});}function DeleteEmbededPart_OnComplete(b,a){if(b){DeleteEmbededPart(a.nPageIndex,a.nID);Toolbar.AdminMenu.ClearHtml();}}function DeleteEmbededPart_OnError(){}function DeleteEmbededPart(c,b,d){if(typeof(d)!="undefined"){c=BookPageState_GetPageIndex(d);}oEmbededPart=EmbededMgr_Get(b);if(oEmbededPart.nStatus==EmbededStatusList.Embed_Done){$("#BV_AdminEmbededPartActions_"+b).remove();EmbededMgr_ChangeStatus(b,EmbededStatusList.Delete_Approved);}else{$("#BV_EmbededPart_"+b).remove();$("#BV_AdminEmbededPartActions_"+b).remove();var e=EmbededMgr_PageEmbededParts[c];for(var a=0;a<e.length;a++){if(e[a]!=null&&e[a].nID==b){e.splice(a,1);}}ShowAjaxImportantMessageBox(TXT_DeleteEmbeded,2500);}Toolbar.AdminMenu.RemoveRow(b);}function PublishEmbededPart_OnComplete(b,a){if(b){$("#BV_PublishEmbededPart_"+a.nID).remove();ShowAjaxImportantMessageBox(TXT_PublishEmbeded,2500);}}function PublishEmbededPart_OnError(){}function ChangeStatusEmbededPart_OnComplete(g,f){if(g){switch(f.nStatus){case EmbededStatusList.New:break;case EmbededStatusList.Embed_WaitApprove:EmbededMgr_ChangeStatus(f.nID,f.nStatus);oEmbededPart=EmbededMgr_Get(f.nID);var b=oEmbededPart.nPageID;var c=BookPageState_GetPageIndex(b);var d=parseInt($("#BV_EmbededPart_"+f.nID).css("top"))+parseInt($("#BV_EmbededPart_"+f.nID).css("height"));if(!isIE){d+=2;}var a=parseInt($("#BV_EmbededPart_"+f.nID).css("left"));var e=parseInt($("#BV_EmbededPart_"+f.nID).css("width"));RenderAdminActions(c,f.nID,f.nStatus,d,a,e,oEmbededPart.nOrder);ShowAjaxImportantMessageBox(TXT_WaitApproveEmbeded,2500);break;case EmbededStatusList.Embed_Approved:EmbededMgr_ChangeStatus(f.nID,f.nStatus);oEmbededPart=EmbededMgr_Get(f.nID);var b=oEmbededPart.nPageID;var c=BookPageState_GetPageIndex(b);var d=parseInt($("#BV_EmbededPart_"+f.nID).css("top"))+parseInt($("#BV_EmbededPart_"+f.nID).css("height"));if(!isIE){d+=2;}var a=parseInt($("#BV_EmbededPart_"+f.nID).css("left"));var e=parseInt($("#BV_EmbededPart_"+f.nID).css("width"));RenderAdminActions(c,f.nID,f.nStatus,d,a,e,oEmbededPart.nOrder);ShowAjaxImportantMessageBox(TXT_ApproveEmbeded,2500);break;case EmbededStatusList.Rejected:RejectEmbededPart(f.nID,f.nStatus);break;}Toolbar.AdminMenu.ClearHtml();oStatus=StatusList_Get(f.nStatus);Toolbar.AdminMenu.ChangeStatus(f.nID,oStatus.Name);}}function RejectEmbededPart(a,b){HideModalPopup();EmbededMgr_ChangeStatus(a,b);$("#BV_ApproveEmbededPart_"+a).remove();$("#BV_RejectEmbededPart_"+a).remove();ShowAjaxImportantMessageBox(TXT_RejectEmbeded,2500);Toolbar.AdminMenu.ClearHtml();}function ChangeStatusEmbededPart_OnError(){}function EmbededMgr_ChangeStatus(a,b){oPageEmbededPart=EmbededMgr_Get(a);oStatus=StatusList_Get(b);oPageEmbededPart.nStatus=oStatus.Id;oPageEmbededPart.StatusName=oStatus.Name;}function EmbededMgr_ProcessShowPageMarkersQueue(){var a=MarkersMgr_sShowPageMarkersQueue.split(".");MarkersMgr_sShowPageMarkersQueue=".";for(var b=0;b<a.length;b++){if(a[b]!=""){MarkersMgr_ShowPageMarkers(a[b]);}}}function EmbededMgr_RenderPageEmbededParts(c){if(!EmbededMgr_PageEmbededParts||typeof(EmbededMgr_PageEmbededParts)==="undefined"){return;}if(EmbededMgr_RenderedEmbededParts[c]==false){var a=EmbededMgr_PageEmbededParts[c];var e=false;for(var b=0;b<a.length;b++){var d=a[b];if(d!=null){RenderEmbededPart(c,d);e=true;}}EmbededMgr_RenderedEmbededParts[c]=e;}}function EmbededMgr_Get(d){var f=null;var a=false;for(var b=0;b<BV_nTotalPages&&!a;b++){var e=EmbededMgr_PageEmbededParts[b];if(e!==undefined&&e.length>0){for(var c=0;c<e.length&&!a;c++){if(e[c].nID===d){f=e[c];a=true;}}}}return f;}function EmbededMgr_ReRender(){EmbededMgr_ClearEmbededPartDomElements();for(var a=0;a<BV_nTotalPages;a++){if(typeof(EmbededMgr_PageWithEmbededParts)!=="undefined"&&EmbededMgr_PageWithEmbededParts[a]){EmbededMgr_RenderPageEmbededParts(a);}}}function EmbededMgr_SetAjaxLoaderVisibility(a){$("#dvEmbeddedIsLoading").css("display",(a?"":"none"));}function EmbededMgr_GetPageEmbededParts(a){if(EmbededMgr_PageEmbededParts!=null){return EmbededMgr_PageEmbededParts[a];}else{return null;}}function EmbededMgr_OnClick(d,b){if(!Toolbar.SubMenu.scrolled){BV_HideMarkerBubble("EmbededMgr_OnClick",false);var f=EmbededMgr_PageEmbededParts[d];if(f==null){return;}for(var a=0;a<f.length;a++){if(f[a]!=null&&f[a].nID==b){d=BookPageState_GetPageNumber(f[a].nPageID);var e=EmbededMgr_Get(b);var c=e.nTop-1000;BV_GotoPage(d,c);ShowActiveEmbeded(b);return;}}BV_GotoPage(d+1,0);ShowAjaxImportantMessageBox(TXT_NoSuchEmbeded,2500);}}function EmbededMgr_PublishBook(a){if(a==null){return;}var b=new Array({name:"nBookID",value:parseInt(a)});callAppKotarCommand("BookEmbedsParts.PublishBook",b,{onSuccessFunction:PublishBook_OnComplete,onFailureFunction:PublishBook_OnError,nBookID:a});}function PublishBook_OnComplete(b,a){EmbededMgr_bLoaded=false;EmbededMgr_LoadEmbededParts();ShowAjaxImportantMessageBox(TXT_PublishBook,2500);}function PublishBook_OnError(){}function EmbededMgr_GetExternalItemURL(c,b){var a=null;if(c.bPopup){a=window.open("/KotarApp/wait.html","externalitem","");}var e=BookPageState_GetPageLabel(b);var d=new Array({name:"nID",value:c.nID},{name:"sPageLabel",value:e});callAppKotarCommandSync("BookEmbedsParts.GetExternalItemURL",d,{onSuccessFunction:GetExternalItemURL_OnComplete,onFailureFunction:GetExternalItemURL_OnError,oProperties:c,mywindow:a},false);}function GetExternalItemURL_OnComplete(b,a){oProperties=a.oProperties;var c=a.mywindow;if(oProperties.bPopup){c.document.location=b;}else{kmobj.KotarMultmideaDoAction({type:"iframe",width:(oProperties.bForceMinWidth?oProperties.nFrameWidth:0),height:oProperties.nFrameHeight,url:b,fullscreenenabled:(!ieVer||ieVer>8)?(oProperties.OpenItemType===2):false,forcefullscreen:(!ieVer||ieVer>8)?oProperties.OpenItemType===1:false,askonclose:oProperties.AskOnClose});}}function GetExternalItemURL_OnError(){}

/** ========== kotarapp\viewer\js\postload\embeded\multimediaapi.js ========== **/
var kmobj=new kmapi();function kmapi(){var n={type:"",url:"",html:"",resizable:false,width:670,height:420,minwidth:300,minheight:200,title:"",fullscreenenabled:false,forcefullscreen:false,askonclose:false};var h=false;var s=false;var o={top:0,left:0};var w={audio:28,video:70,image:70,link:30,iframe:30};var d,e,a,b,f,g;this.KotarMultmideaDoAction=function(z){r();$.extend(n,z);if(typeof(CloseOtherElements)!=="undefined"){CloseOtherElements("multimedia");}var y=c();var x=$(".kotar-ui-content");g=window.clientWidth();f=window.clientHeight();b=n.width;a=n.height;var A=true;switch(n.type){case"audio":A=p(x);e=300;d=90;break;case"video":if(n.url.indexOf("youtu.be")>=0||n.url.indexOf("youtube.com")>=0||n.url.indexOf("vimeo.com")>=0){b=640;a=360;}else{b=650;a=430;}q(x);e=b;d=a+40;break;case"image":v(x);e=b;d=a+40;break;case"link":A=false;break;case"iframe":MasterDrawer.Open({url:n.url,minwidth:b,title:n.title});A=false;break;case"html":u(x);e=640;d=360;}if(A){m(y);if(n.forcefullscreen){t();}}};this.CloseMultimeDiadialog=function(){if(typeof(soundManager)!=="undefined"){soundManager.stopAll();}$(".kotar-ui-dialog").hide();$(".kotar-ui-content").html("");if(cet&&cet.display&&cet.display.change&&typeof(cet.display.change)==="function"){cet.display.inline();}};this.Reposition=function(){var x=$(".kotar-ui-dialog");if(x.length==1&&x.css("position")!=="static"){g=window.clientWidth();f=window.clientHeight();var y=is_mobile&&!is_IOS;if(!y&&(x[0].clientWidth>g||x[0].clientHeight>f)){kmobj.CloseMultimeDiadialog();}else{var D=-1;var z=-1;var C=window.pageYOffset;var B=x[0].offsetTop-(is_IOS?C:0);if(B+d>f||B<0){var A=(f-d)+(is_IOS?C:0);D=Math.max(A,0);}if(x[0].offsetLeft+e>g){z=Math.max(g-e,0);}if(D>=0){x.css("top",D);}if(z>=0){x.css("left",z);}}}};function c(){var x=$(".kotar-ui-dialog");var z=i(n.type,n.title);if(x.length==1){x.hide();$(".kotar-ui-content").html("");$(".kotar-ui-dialog-titlebar").html(z+'<div class="kotar-ui-dialog-titlebar-dragIcon"></div>');$(".kotar-ui-dialog-titlebar").attr("title",n.title);if(typeof(soundManager)!=="undefined"){soundManager.stopAll();}return x[0];}else{var y=[];y.push('<div id="kotaruidialog" class="kotar-ui-dialog">','<div class="kotar-ui-dialog-titlebar theme-background-color" title="'+n.title+'">',z,'<div class="kotar-ui-dialog-titlebar-dragIcon"></div></div>','<div class="kotar-ui-dialog-titlebar-close"></div>','<div class="kotar-ui-dialog-titlebar-fullscreen"></div>','<div class="kotar-ui-content"></div>',"</div>","");$(y.join("")).appendTo(document.body);x=$(".kotar-ui-dialog");}x.click(function(){PreventBookClick=true;});x.delegate(".kotar-ui-dialog-titlebar-close","click",function(){if(n.askonclose){k();}else{kmobj.CloseMultimeDiadialog();}});x.delegate(".kotar-ui-dialog-titlebar-fullscreen","click",function(){t();});x.draggable({cancel:".kotar-ui-content, kotar-ui-dialog-titlebar-close",handle:".kotar-ui-dialog-titlebar",containment:"window",scroll:false});return x;}function p(x){var y=$('<div id="divplayer"></div>');y.width("300px");y.appendTo(x);return true;}function q(x){x.html('<iframe unselectable="on" id="kotaruidialogiframe" width="'+b+'" height="'+a+'" src="'+encodeURI(n.url)+'" frameborder="0" allowfullscreen="1" allow="autoplay"></iframe>');}function l(x){x.html('<iframe id="kotaruidialogiframe" width="'+b+'" height="'+a+'" src="'+n.url+'" frameborder="0" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true" class="ItemBorder" allow="autoplay"></iframe>');}function v(x){x.html('<img src="'+encodeURI(n.url)+'" alt="'+n.title+'" width="'+b+'" height="'+a+'" />');}function u(x){x.html(n.html);}function m(x){var B=(f/2)-(d/2);var A=(g/2)-(e/2);var C="fixed";if(is_IOS&&n.type==="iframe"){C="absolute";B+=window.pageYOffset;}var y=$(x);y.width(e).height(d).css({position:C,top:B,left:A}).show();if(n.fullscreenenabled){y.addClass("fullscreenenabled");}else{y.removeClass("fullscreenenabled");}if(n.type==="audio"){var z=new cet.ui.soundplayer.soundplayer({url:encodeURI(n.url),autoplay:true},$("#divplayer"));}}function k(){ChangeIFrameSource("/KotarApp/Viewer/Popups/AlertOnClose.aspx?",false);ShowModalPopup("OpenAlertOnClose");}function t(){if(cet&&cet.display&&cet.display.change&&typeof(cet.display.change)==="function"){if(!h){s=true;cet.display.fullscreen();}else{cet.display.inline();}}}function j(){h=!h;if(s||is_IOS){g=$("body").width();f=window.clientHeight();var x=$(".kotar-ui-dialog");var y=$("#kotaruidialogiframe");if(cet.display.mode()==="fullscreen"){o.top=x.css("top");o.left=x.css("left");var A=(f/2)-(d/2);var z=(g/2)-(e/2);var B=is_IOS?window.pageYOffset:0;x.css({width:g+"px",height:f+"px",top:B,left:0});if(n.type==="video"){y.css({width:g+"px",height:f+"px"});}else{y.css({width:(g-20)+"px",height:(f-50)+"px"});}x.addClass("fullscreenactivated");}else{s=false;x.css({width:e+"px",height:d+"px",top:o.top,left:o.left});x.removeClass("fullscreenactivated");y.css({width:b+"px",height:a+"px"});setTimeout(function(){y.width(1);setTimeout(function(){y.width(b);},50);},50);}}}function r(){n={type:"",url:"",html:"",resizable:false,width:670,height:420,title:"",fullscreenenabled:false,forcefullscreen:false,askonclose:false};h=false;}function i(A,z){var y=z;var x=30;switch(A){case"audio":x=w.audio;break;case"video":x=w.video;break;case"image":x=w.image;break;case"link":x=w.link;break;case"iframe":x=w.iframe;break;}if(z.length>x){y=z.substr(0,(x-3))+"...";}return y;}$(function(){if(cet&&cet.display&&cet.display.change&&typeof(cet.display.change)==="function"){cet.display.change(function(){setTimeout(function(){j();},50);});}});}

/** ========== kotarapp\viewer\js\postload\embeded\status.js ========== **/
var StatusList_bVisible=false;var StatusList_nNumVisible=0;var oBookEmbededStatus=[];var StatusList_TotalNumOfStatus=0;StatusList_HideSelectorByClick();function StatusList_HideSelectorByClick(){if(StatusList_TotalNumOfStatus<=0){$("body").click(function(){if(event&&event.srcElement&&($(event.srcElement).closest("#dvEmbeddedStatusSelector").length>0||$(event.srcElement).closest("#dvEmbeddedSelectedStatus").length>0||$(event.srcElement).closest("#statusListToggleSelector").length>0)){}else{if(StatusList_bVisible){StatusList_HideSelector();StatusList_bVisible=!StatusList_bVisible;}}});}}function StatusList_VerifyInit(){if(StatusList_TotalNumOfStatus<=0){EmbededStatus_Init();}}function EmbededStatus_Init(){Status_GetBookEmbededStatus(false);}function Status_GetBookEmbededStatus(a){var b=new Array({name:"SerType",value:2},{name:"nBookID",value:BV_nBookID},{name:"tmp",value:"tmp"});callAppKotarCommandReadOnlySession("BookEmbedsParts.GetBookEmbededStatusList",b,{onSuccessFunction:Status_GetBookEmbededStatus_OnSuccess,onFailureFunction:Status_GetBookEmbededStatus_OnFailure,bRefresh:a},false);}function Status_GetBookEmbededStatus_OnFailure(){alert("Status_GetBookEmbededStatus_OnFailure");}function Status_GetBookEmbededStatus_OnSuccess(c,b){StatusList_TotalNumOfStatus=c.length;if(StatusList_TotalNumOfStatus>0){$("#divEmbeddedStatusFilter").css("display","block");}oBookEmbededStatus=c;for(var a=0;a<oBookEmbededStatus.length;a++){oBookEmbededStatus[a].Show=true;}StatusList_nNumVisible=c.length;StatusList_RenderSelectorTitle();if(b.bRefresh){EmbededList_Render(true);}}function StatusList_NumVisible(){StatusList_VerifyInit();var b=0;for(var a=0;a<oBookEmbededStatus.length;a++){b+=(oBookEmbededStatus[a].Show?1:0);}return b;}function StatusList_Get(b){StatusList_VerifyInit();for(var a=0;a<oBookEmbededStatus.length;a++){if(oBookEmbededStatus[a].Id==b){return oBookEmbededStatus[a];}}return null;}function StatusList_RenderSelectorTitle(){var a=getElement("dvEmbeddedSelectedStatus");if(a==null){return;}a.innerHTML=TXT_Status_All;}function StatusList_ToggleSelector(a){if(StatusList_bVisible){StatusList_HideSelector();}else{StatusList_ShowSelector(a);}StatusList_bVisible=!StatusList_bVisible;}function StatusList_ShowSelector(a){if(a=="False"){$("#dvEmbeddedStatusSelector").css({display:"",zIndex:2,left:$("#statusListToggleSelector").position().left-1,top:$("#statusListToggleSelector").position().top+$("#statusListToggleSelector").height()});}else{$("#dvEmbeddedStatusSelector").css({display:"",zIndex:2,left:$("#statusListToggleSelector").position().left-13,top:$("#statusListToggleSelector").position().top+$("#statusListToggleSelector").height()});}}function StatusList_HideAjaxLoader(){$("#divEmbeddedList").css("display","");}function StatusList_HideSelector(){$("#dvEmbeddedStatusSelector").css("display","none");}function StatusList_SelectorChanged(b,c,a){if(a){if(window.event){b=window.event;}}if(c<oBookEmbededStatus.length){oBookEmbededStatus[c].Show=!oBookEmbededStatus[c].Show;}else{alert("oBookEmbededStatus: ["+c+"] ?");return;}var d=getElement("chkUGCStatus"+c);if(!a){d.checked=!d.checked;}StatusList_nNumVisible+=(d.checked?1:-1);StatusList_RenderSelectorTitle();EmbededList_Render(false);if(a){b.cancelBubble=true;return false;}return true;}

/** ========== kotarapp\viewer\js\postload\markers\builder.js ========== **/
function BV_PrepareMarkers(){BV_oBook.appendChild(BV_CreateSquareMarkerFrame());BV_CreateSquareMarkerHandles();}function BV_GetLastSelection(){return{nPageIndex:BV_nSelectionPage,nPageID:BV_nSelectionPageID,nSelectLeftPx:BV_nSelectionLeft,nSelectTopPx:BV_nSelectionTop,nSelectWidthPx:BV_nSelectionWidth,nSelectHeightPx:BV_nSelectionHeight,nCurrPageWidthPx:BV_nPageImageWidth,nCurrPageHeightPx:BV_nPageImageHeight,nCurrSizeStep:BV_nCurrentSizeStep};}function BV_AddTemporaryMarkerToPage(a){a.nMarkerID=BV_TEMPORARY_MARKER_ID;a.bModified=false;a.bEditable=true;a.bCanSetFolder=true;BookPageState_SetHasMarkers(a.nPageIndex,true);BookPageState_SetMarkersLoaded(a.nPageIndex,true);}function BV_DeleteTemporaryMarker(){if(BV_oBubbledMarker!=null){MarkersMgr_RemoveMarker(BV_oBubbledMarker.nPageIndex,BV_oBubbledMarker.nMarkerID);UTILS_RemoveDomElement(BV_oBubbledMarker);BV_bInNewMarkerState=false;}}function BV_GetTempMarkerInPage(d){var c=null;var e="BV_oMarker_"+BV_TEMPORARY_MARKER_ID;for(var a=0;a<BV_aMarkers.length;a++){var b=BV_aMarkers[a];if(b.name==e&&b.nPageID==d){c=b;}}return c;}function BV_GetMarkerByID(b){var e="BV_oMarker_"+b;var d=null;for(var a=0;a<BV_aMarkers.length;a++){var c=BV_aMarkers[a];if(c.name==e){d=c;}}return d;}function BV_InstantiateUserMarker(a,e){if(e==null){return;}var c=UTILS_CreateElement("DIV");var d=BV_GetActualPosition(e);var f="";switch(e.sType.toLowerCase()){case BV_SELECT:case BV_TOC_ENTRY:c.style.top=d.nTop+"px";c.style.left=d.nLeft+"px";c.style.width=d.nWidth+"px";c.style.height=d.nHeight+"px";if(e.sType.toLowerCase()==BV_SELECT){if(isIE){$(c).css({"background-color":"#"+GetSelectionColor(e.nSelectionType),position:"absolute",overflow:"hidden",cursor:"default",opacity:".35",filter:"progid:DXImageTransform.Microsoft.Alpha(style=0,opacity=35)"});}else{$(c).css({"background-color":"#"+GetSelectionColor(e.nSelectionType),position:"absolute",overflow:"hidden",cursor:"default",opacity:".35"});}c.sSubType=e.nSelectionType;}else{c.className="BV_TocEntry";}f=TXT_TheHighlightHasNoContent;break;case BV_PUSHPIN:c.style.left=(d.nLeft-BV_nPushpinHotX)+"px";c.style.top=(d.nTop-BV_nPushpinHotY)+"px";c.className=GetNoteClass(e.sType,e.sSubType,e.bIsOwned,e.nAudience);c.sSubType=e.sSubType;f=TXT_ThePushpinHasNoContent+" "+TXT_Owner+" "+e.sOwnerFullName;break;case BV_LMS_TASK:c.style.left=(d.nLeft)+"px";c.style.top=(d.nTop)+"px";c.className=GetNoteClass(e.sType,e.sSubType,e.bIsOwned,e.nAudience);c.sSubType=e.sSubType;c.bIsCourseTask=e.bIsCourseTask;c.style.zIndex=15;break;case BV_LINK:c.style.top=d.nTop+"px";c.style.left=d.nLeft+"px";c.style.width=d.nWidth+"px";c.style.height=d.nHeight+"px";c.className=BV_GetLinkClassName(e);c.sUrl=e.sUrl;if(e.bIsOwned==false){c.title=(e.sTitle==""?e.sUrl:e.sTitle);c.style.cursor="pointer";}if(e.sUrl.indexOf("#")!=0){var b=UTILS_CreateElement("A");b.href=e.sUrl;b.target="_blank";$(b).append(c);}break;case BV_ICON_LINK:c.style.left=d.nLeft+"px";c.style.top=d.nTop+"px";c.className="BV_IconLinkMarker";c.sUrl=e.sUrl;e.bIsOwned=false;c.title=(e.sTitle==""?e.sUrl:e.sTitle);c.style.cursor="Pointer";c.style.backgroundImage="url(/KotarApp/Viewer/Images/Icons/iconlink.gif)";break;}c.nAudience=e.nAudience;c.sType=e.sType;c.sTitle=decodeKotar(e.sTitle);c.sText=decodeKotar(e.sText);c.id="BV_oMarker";c.name="BV_oMarker_"+e.nMarkerID;c.nPageID=e.nPageID;c.nMarkerID=e.nMarkerID;c.nProjectID=e.nProjectID;c.bEditable=e.bIsOwned||((e.nAudience==BV_AUDIENCE_EVERYONE_ENRICHED||e.nAudience==BV_AUDIENCE_EVERYONE_ELSE)&&BV_bAdminUser);c.bCanSetFolder=e.bCanSetFolder;c.sOwnerFullName=e.sOwnerFullName;c.nLayer=e.nLayer;if(!e.bIsOwned&&e.sTitle==""&&e.sText==""){c.title=f;}c.bIsOwned=e.bIsOwned;c.bIsPublished=e.bIsPublished;c.nPageIndex=a;c.style.display="inline";c.gLinkedItemID=e.gLinkedItemID;BV_aMarkers[BV_aMarkers.length]=c;if(!BookPageState_GetIsOpen(a)){c.style.opacity=(0.35);c.style.filter="alpha(opacity=35)";}if(e.sType.toLowerCase()!=BV_LINK||e.sUrl.indexOf("#")==0){AddNote(a,c);}else{AddNote(a,b);}BV_CreateMarkerEventHandlers(c);}function BV_GetActualPosition(a){if(a.bIsBeingEdited&&typeof(a.nTempLeft)!="undefined"){return{nLeft:UTILS_LogicalToPixelX(a.nTempLeft,BV_nPageImageWidth),nTop:UTILS_LogicalToPixelX(a.nTempTop,BV_nPageImageHeight),nWidth:UTILS_LogicalToPixelX(a.nTempWidth,BV_nPageImageWidth),nHeight:UTILS_LogicalToPixelX(a.nTempHeight,BV_nPageImageHeight)};}else{return{nLeft:UTILS_LogicalToPixelX(a.nLeft,BV_nPageImageWidth),nTop:UTILS_LogicalToPixelX(a.nTop,BV_nPageImageHeight),nWidth:UTILS_LogicalToPixelX(a.nWidth,BV_nPageImageWidth),nHeight:UTILS_LogicalToPixelX(a.nHeight,BV_nPageImageHeight)};}}function BV_GetLinkClassName(a){if(a.sUrl.indexOf("#")==0){return"BV_InternalLinkMarker";}else{return"BV_LinkMarker";}}function BV_CreateMarkerEventHandlers(a){if(a.sType==BV_LMS_TASK){BV_AddLMSTaskIconEventHandlers(a);}else{if(a.bEditable){BV_AddEditableMarkerEventHandlers(a);}else{if(a.sType==BV_LINK){BV_AddLinkMarkerEventHandlers(a);}else{if(a.sType==BV_ICON_LINK){BV_AddIconLinkMarkerEventHandlers(a);}else{BV_AddReadOnlyMarkerEventHandlers(a);}}}}}var nShowMrakerBubbleTimeoutID;var openNote=null;var noteTimeOut=400;function markerIn(a){a.title=TXT_ClickToOpenNote;openNote=a;}function markerOut(a){}function markerClick(a,b){if(BV_bInBubbleEditMode||BV_bInNewMarkerState){a.stopPropagation();return;}if(Toolbar_IsEditToolActive()){a.cancelBubble=true;a.cancel=true;}$(b).addClass("on");openNote=b;BV_ShowMarkerBubble("",openNote,false,false);a.stopPropagation();}function markerMousedown(a,b){if(BV_oBubbledMarker==null||BV_oBubbledMarker.nMarkerID!=b.nMarkerID||BV_bInBubbleEditMode==false){a.stopPropagation();return;}return false;}function markerMouseUp(a){if(Toolbar_IsEditToolActive()){return;}if(window.event){a=window.event;}if(BV_oDraggedMarker!=null){BV_EndDragMarker();a.cancelBubble=true;return false;}else{if(BV_oResizedMarker!=null){BV_EndResizeMarker();a.cancelBubble=true;return false;}}return true;}function markerMouseMove(a){if(Toolbar_IsEditToolActive()){return;}if(window.event){a=window.event;}if(BV_oDraggedMarker!=null){BV_ContinueDragMarker(a);}else{if(BV_oResizedMarker!=null){BV_ContinueResizeMarker(a);}}}function BV_AddEditableMarkerEventHandlers(b){var a=$(b);a.hover(function(c){markerIn(b);},function(){markerOut(b);});a.bind("click touchend",function(c){markerClick(c,b);});TouchUtils.EventStart.forEach(function(c){a.bind(c,function(d){markerMousedown(d,b);});});a.bind("mouseup",function(c){markerMouseUp(c);});a.bind("mousemove touchmove",function(c){markerMouseMove(c);});}function BV_AddReadOnlyMarkerEventHandlers(b){var a=$(b);a.hover(function(c){markerIn(b);},function(){markerOut(b);});a.bind("click touchend",function(c){markerClick(c,b);});a.bind("mousedown touchstart",function(c){markerMousedown(c,b);});}function BV_AddLinkMarkerEventHandlers(a){if(a.sUrl.indexOf("#")==0){UTILS_AddHandler(a,"onclick",function(b){BV_GotoPageByLabel(ReplaceAll(a.sUrl,"#",""));});}else{UTILS_AddHandler(a,"onmousemove",function(b){BV_ReadOnlyLink_OnMouseMove(b);});UTILS_AddHandler(a,"onmouseout",function(b){BV_ReadOnlyLink_OnMouseOut(b);});}}function BV_AddIconLinkMarkerEventHandlers(a){UTILS_AddHandler(a,"onclick",function(b){window.open(a.sUrl);});}function BV_AddLMSTaskIconEventHandlers(b){var a=$(b);a.hover(function(c){markerIn(b);},function(){markerOut(b);});a.click(function(c){markerClick(c,b);});if(LMSTasks_HasAdminRole(b)){TouchUtils.EventStart.forEach(function(c){a.bind(c,function(d){markerMousedown(d,b);});});}}function AddNote(a,b){$(BV_oBook.childNodes[a].childNodes[0]).append($(b).fadeIn(400));}

/** ========== kotarapp\viewer\js\postload\markers\dal.js ========== **/
function BV_AllRequiredResourcesWereLoaded(){return(MarkersMgr_bLoaded);}function BV_BuildMarkerDetailsParametersArray(b,a){var c=UTILS_GetMarkerLogicalPos(b);var g=(typeof(b.sUrl)!="undefined"?encodeKotar(b.sUrl):"");if(typeof(b.nProjectID)=="undefined"){b.nProjectID=BV_DefaultProjectID;}var f=encodeKotar(b.sTitle);var e=encodeKotar(b.sText);var d=new Array({name:"SerType",value:2},{name:"nBookID",value:BV_nBookID},{name:"nPageID",value:BookPageState_GetPageID(b.nPageIndex)},{name:"nExtensionID",value:b.nMarkerID},{name:"sType",value:b.sType},{name:"nLeft",value:c.nLeft},{name:"nTop",value:c.nTop},{name:"nWidth",value:c.nWidth},{name:"nHeight",value:c.nHeight},{name:"sTitle",value:f},{name:"sBody",value:e},{name:"nProjectID",value:b.nProjectID},{name:"sSubType",value:b.sSubType},{name:"sUrl",value:g},{name:"bRtl",value:isRTL()},{name:"nAudience",value:b.nAudience},{name:"tmp",value:"tmp"});return d;}function BV_BuildLMSTaskDetailsParametersArray(b,a){var f=(typeof(b.sUrl)!="undefined"?encodeKotar(b.sUrl):"");if(typeof(b.nProjectID)=="undefined"){b.nProjectID=BV_DefaultProjectID;}var e=encodeKotar(b.sTitle);var d=encodeKotar(b.sText);var c=new Array({name:"SerType",value:2},{name:"nBookID",value:BV_nBookID},{name:"nPageID",value:BookPageState_GetPageID(b.nPageIndex)},{name:"nExtensionID",value:b.nMarkerID},{name:"sType",value:b.sType},{name:"nLeft",value:b.nLeft},{name:"nTop",value:b.nTop},{name:"nWidth",value:b.nWidth},{name:"nHeight",value:b.nHeight},{name:"sTitle",value:e},{name:"sBody",value:d},{name:"nProjectID",value:b.nProjectID},{name:"sSubType",value:b.sSubType},{name:"sUrl",value:f},{name:"bRtl",value:isRTL()},{name:"nAudience",value:b.nAudience},{name:"tmp",value:"tmp"});return c;}function BV_BuildCloneMarkerDetailsParametersArray(f,b,c,h,g,a,e){var d=new Array({name:"nExtensionID",value:f},{name:"sType",value:h},{name:"nLeft",value:b},{name:"nTop",value:c},{name:"nProjectID",value:BV_DefaultProjectID},{name:"sSubType",value:g},{name:"nAudience",value:a},{name:"sCopyOf",value:e});return d;}var oTemporaryMarkerBeingSaved=null;var sMarkerBeingUpdatedType="";function BV_SaveTemporaryMarker_OnError(){}function BV_SaveTemporaryMarker_OnComplete(a,b){var c=oTemporaryMarkerBeingSaved;c.nMarkerID=a;var d=BV_GetMarkerByID(BV_TEMPORARY_MARKER_ID);if(d!=null){d.name="BV_oMarker_"+a;}BV_oMarkerFrame.nMarkerID=a;BV_ShowMarkerActionFeedback(TXT_Saved,TXT_fSaved);MarkersMgr_SetMarkerIdToTemporaryMarker(c);MarkersMgr_SetMarkerInfo(c,false);MarkersMgr_SetIsBeingEdited(a,false);}function BV_UpdateTemporaryMarkerLocation(a){var b=UTILS_GetMarkerLogicalPos(oNewMarker);Notes.Editor.SetNoteLocation(b);MarkersMgr_SetMarkerTemporaryPosition(a);}function BV_UpdateMarker_OnError(){alert("BV_UpdateMarker_OnError");}function BV_UpdateMarker_OnComplete(c,a){var b=a.oMarker;BV_ShowMarkerActionFeedback(TXT_Updated,TXT_fUpdated);}function BV_UpdateMarkerLocation(){var a=BV_oBubbledMarker;sMarkerBeingUpdatedType=a.sType;if(a.nMarkerID==BV_TEMPORARY_MARKER_ID){return BV_UpdateTemporaryMarkerLocation(a);}if(a.bEditable||(LMSTasks_IsCourseTask(a)&&LMSTasks_HasAdminRole(a))){var b=UTILS_GetMarkerLogicalPos(a);var c=new Array({name:"SerType",value:2},{name:"nExtensionID",value:a.nMarkerID},{name:"nLeft",value:b.nLeft},{name:"nTop",value:b.nTop},{name:"nWidth",value:b.nWidth},{name:"nHeight",value:b.nHeight});callAppKotarCommand("BookExtensions.UpdateLocation",c,{onSuccessFunction:BV_UpdateMarkerLocation_OnComplete,onFailureFunction:BV_UpdateMarkerLocation_OnError,oMarker:a});}a.bModified=false;MarkersMgr_SetMarkerInfo(a,false);}function BV_UpdateMarker_SubType(a,c){var b=new Array({name:"nExtensionID",value:a},{name:"sSubType",value:c});callAppKotarCommand("BookExtensions.UpdateSubType",b,{onSuccessFunction:BV_UpdateMarkerSubType_OnComplete,onFailureFunction:BV_UpdateMarkerSubType_OnError});}function BV_UpdateMarkerSubType_OnError(){alert("BV_UpdateMarkerSubType_OnError");}function BV_UpdateMarkerSubType_OnComplete(a){}function BV_UpdateMarkerLocation_OnError(){alert("BV_UpdateMarkerLocation_OnError");}function BV_UpdateMarkerLocation_OnComplete(b,a){BV_ShowMarkerActionFeedback(TXT_Updated,TXT_fUpdated);}function BV_DeleteMarker(c,a){if(c.bEditable||BV_bIsAdminQa){sMarkerBeingUpdatedType=c.sType;var b={nPageNum:c.nPageIndex,nMarkerID:c.nMarkerID};if(c.nMarkerID!=BV_TEMPORARY_MARKER_ID){var d=new Array({name:"nExtensionID",value:c.nMarkerID},{name:"tmp",value:"tmp"});callAppKotarCommand("BookExtensions.Remove",d,{onSuccessFunction:BV_DeleteMarker_OnComplete,onFailureFunction:BV_DeleteMarker_OnError,oMarkerDetails:b,bShowMessage:a});}}}function BV_DeleteMarker_OnError(){alert("BV_DeleteMarker_OnError");}function BV_DeleteMarker_OnComplete(c,a){if(typeof(a.bShowMessage)=="undefined"||a.bShowMessage==true){BV_ShowMarkerActionFeedback(TXT_Deleted,TXT_fDeleted);}BV_HideMarkerBubble("Notes.Editor.Delete",false);var b=BV_GetMarkerByID(a.oMarkerDetails.nMarkerID);UTILS_RemoveDomElement(b);MarkersMgr_RemoveMarker(a.oMarkerDetails.nPageNum,a.oMarkerDetails.nMarkerID);MarkersMgr_RenderPageMarkers(a.oMarkerDetails.nPageNum);cet.wall.DeletePost(a.oMarkerDetails.nMarkerID);}function BV_ShowMarkerActionFeedback(a,b){var c="";switch(sMarkerBeingUpdatedType){case BV_LINK:c=TXT_TheLink;break;case BV_TOC_ENTRY:c=TXT_TheTocEntry;break;case BV_SELECT:c=TXT_TheHighlight;break;case BV_PUSHPIN:c=TXT_TheNote;a=b;break;}ShowAjaxNotification(c+" "+a+" "+TXT_Successfully);}function BV_SetMarkerLinkedItemID(b,a){var c=new Array({name:"nExtensionID",value:b},{name:"gLinkedItemID",value:a},{name:"tmp",value:"tmp"});callAppKotarCommand("BookExtensions.SetLinkedItemID",c,{onSuccessFunction:BV_SetMarkerLinkedItemID_onSuccess,onFailureFunction:BV_SetMarkerLinkedItemID_onFailure,nMarkerID:b,gLinkedItemID:a});}function BV_SetMarkerLinkedItemID_onSuccess(c,a){var b=BV_GetMarkerByID(a.nMarkerID);if(b!=null){b.gLinkedItemID=a.gLinkedItemID;}}function BV_SetMarkerLinkedItemID_onFailure(){}function BV_CreateNewMarkerForClone(a,c){oTemporaryMarkerBeingSaved=a;var b=BV_BuildCloneMarkerDetailsParametersArray(BV_oBubbledMarker.nMarkerID,a.nLeft,a.nTop,BV_PUSHPIN,"default",BV_AUDIENCE_PERSONAL,c);callAppKotarCommand("BookExtensions.CloneNote",b,{onSuccessFunction:CreateNewMarkerForClone_OnComplete,onFailureFunction:CreateNewMarkerForClone_OnError});}function CreateNewMarkerForClone_OnError(){}function CreateNewMarkerForClone_OnComplete(a,b){var c=oTemporaryMarkerBeingSaved;c.nMarkerID=a;var d=BV_GetMarkerByID(BV_TEMPORARY_MARKER_ID);if(d!=null){d.name="BV_oMarker_"+a;}BV_oMarkerFrame.nMarkerID=a;BV_ShowMarkerActionFeedback(TXT_Saved,TXT_fSaved);MarkersMgr_SetMarkerIdToTemporaryMarker(c);MarkersMgr_SetMarkerInfo(c,false);MarkersMgr_SetIsBeingEdited(a,false);if(BV_BOOKWALL_ENABLED){cet.wall.refresh(true);}BV_HideMarkerBubble("CreateNewMarkerForClone_OnComplete",false);BV_ShowMarkerBubbleInViewMode(a);}function BV_AddBookExtensionShareExclude(){var a=new Array({name:"nBookID",value:BV_nBookID},{name:"nExtensionID",value:BV_oBubbledMarker.nMarkerID});callAppKotarCommand("BookExtensions.AddBookExtensionShareExclude",a,{onSuccessFunction:BV_AddBookExtensionShareExclude_OnComplete,onFailureFunction:BV_AddBookExtensionShareExclude_OnError});}function BV_AddBookExtensionShareExclude_OnComplete(a){var b=BV_GetMarkerByID(a);BV_ShowMarkerActionFeedback(TXT_Deleted,TXT_fDeleted);BV_HideMarkerBubble("Notes.Viewer.DeleteShare",false);UTILS_RemoveDomElement(b);var c=BookPageState_GetPageNumber(b.nPageID)-1;MarkersMgr_RemoveMarker(c,a);MarkersMgr_RenderPageMarkers(c);MarkersList_ReRender();}function BV_AddBookExtensionShareExclude_OnError(){}

/** ========== kotarapp\viewer\js\postload\markers\display.js ========== **/
function BV_ResetMarkerBackgroundImage(a){var b=BV_GetMarkerByID(a);if(b!=null){if(b.sType==BV_PUSHPIN){$(b).removeClass("on");}else{if(b.sType==BV_LMS_TASK){$(b).removeClass("on");}}}}function BV_SetMarkerBackgroundImage_Default(a){$(a).removeClass("on");a.style.zIndex=15;}function BV_SetMarkerBackgroundImage_Hover(a){$(a).addClass("on");a.style.zIndex=15;}function BV_SetMarkerBackgroundImage_Active(a){$(a).addClass("on");a.style.zIndex=15;}var draggingMarker=null;function BV_ShowResizableMarkerFrame(a){switch(a.sType){case BV_SELECT:case BV_LINK:case BV_TOC_ENTRY:case BV_EMBEDED:BV_ShowSquareMarkerFrame(a);break;default:break;}BV_ShowMarkerHandles(a);BV_WireSquareMarkerHandlesEvents();}function SetMarkerDraggable(b){var a=$(b);a.draggable({scroll:false,containment:"parent"});a.draggable({start:function(c,d){stopDraging=false;draggingMarker=this;if(BV_bInBubbleEditMode){jqEditorContainer.hide();}}});a.draggable({stop:function(c,e){BV_UpdateMarkerLocation();UTILS_AddClass(draggingMarker,"on");draggingMarker=null;if(BV_bInBubbleEditMode){var d=UTILS_GetMarkerLogicalPos(this);Notes.Editor.SetNoteLocation(d);jqEditorContainer.show();}}});}function EndMarkerDraggable(b){var a=$(b);if(a.draggable("instance")){a.draggable("destroy");}}function BV_ShowSquareMarkerFrame(e){$("#BV_oMarkerFrame").show();var g=BV_GetPageWrapperElement(e.nPageIndex);var d=BV_GetPageImageElement(e.nPageIndex);var b=d.offsetLeft+e.offsetLeft;var c=d.offsetTop+e.offsetTop;var a=(e.sType==BV_PUSHPIN?4:0);var f=getElement("BV_oMarkerFrame");f.style.left=(b-a)+"px";f.style.top=(c-a)+"px";f.style.width=(e.offsetWidth+(a*2))+"px";f.style.height=(e.offsetHeight+(a*2))+"px";f.style.visibility="visible";f.nMarkerID=e.nMarkerID;f.style.borderWidth=(e.sType==BV_PUSHPIN?0:1)+"px";}function BV_HideMarkerFrame(){getElement("BV_oMarkerFrame").style.visibility="hidden";BV_HideMarkerHandles();}function BV_ShowMarkerHandles(j){if(j.sType==BV_PUSHPIN){return;}$(".BV_oMarkerHandle").show();var k=getElement("BV_oMarkerFrame");var e=k.offsetLeft-5;var h=k.offsetLeft+k.offsetWidth-5;var f=k.offsetLeft+k.offsetWidth/2-5;var i=k.offsetTop-5;var g=k.offsetTop+k.offsetHeight/2-5;var b=k.offsetTop+k.offsetHeight-5;for(var a=0;a<BV_aMarkerHandles.length;a++){var c=BV_aMarkerHandles[a].sLeft.replace("L",e).replace("R",h).replace("M",f);var d=BV_aMarkerHandles[a].sTop.replace("T",i).replace("B",b).replace("M",g);var l=getElement("BV_oMarkerHandle_"+a);l.style.left=c+"px";l.style.top=d+"px";l.style.visibility="visible";}k.style.cursor="move";}function BV_HideMarkerHandles(){if(BV_oBubbledMarker.sType==BV_PUSHPIN){return;}for(var a=0;a<BV_aMarkerHandles.length;a++){getElement("BV_oMarkerHandle_"+a).style.visibility="hidden";}getElement("BV_oMarkerFrame").style.cursor="pointer";}

/** ========== kotarapp\viewer\js\postload\markers\drag.js ========== **/
function BV_StartDragMarker(a,b){if(b==null){return;}BV_oDraggedMarker=b;UTILS_PreventBrowserDefaultAction(a);BV_HideMarkerBubble("BV_StartDragMarker",true);BV_oDraggedMarker.nDragMouseX=mousePos.x;BV_oDraggedMarker.nDragMouseY=mousePos.y;BV_oDraggedMarker.nDragStartX=BV_oDraggedMarker.offsetLeft;BV_oDraggedMarker.nDragStartY=BV_oDraggedMarker.offsetTop;}function BV_ContinueDragMarker(a){if(BV_oDraggedMarker!=null){var b=mousePos.x-BV_oDraggedMarker.nDragMouseX;var c=mousePos.y-BV_oDraggedMarker.nDragMouseY;var d=BV_oDraggedMarker.nDragStartX+b;var g=BV_oDraggedMarker.nDragStartY+c;var h=BV_GetPageImageElement(BV_oDraggedMarker.nPageIndex);var e=h.offsetWidth-BV_oDraggedMarker.offsetWidth;var f=h.offsetHeight-BV_oDraggedMarker.offsetHeight;if(d<0){d=0;}if(g<0){g=0;}if(d>e){d=e;}if(g>f){g=f;}BV_oDraggedMarker.style.left=d+"px";BV_oDraggedMarker.style.top=g+"px";BV_oDraggedMarker.bModified=true;}}function BV_EndDragMarker(){if(BV_oDraggedMarker!=null){BV_UnHideMarkerBubble(BV_oDraggedMarker);if(BV_oDraggedMarker.bModified==true){BV_SetMarkerBackgroundImage_Active(BV_oBubbledMarker);}BV_oDraggedMarker=null;}}

/** ========== kotarapp\viewer\js\postload\markers\events.js ========== **/
function Marker_OnAdded(){ToolBar_SetDefaultTool();}function BV_ReadOnlyLink_OnMouseMove(a){if(Toolbar_IsEditToolActive()){return;}BV_ReadOnlyLink_SetClass(a,"BV_LinkMarkerHighlighted");}function BV_ReadOnlyLink_OnMouseOut(a){if(Toolbar_IsEditToolActive()){return;}BV_ReadOnlyLink_SetClass(a,"BV_LinkMarker");}function BV_ReadOnlyLink_SetClass(a,b){if(Toolbar_IsEditToolActive()){return;}if(window.event){a=window.event;}var c=a.srcElement?a.srcElement:a.target;c.className=b;}function BV_MarkerHandler_OnMouseDown(a){if(window.event){a=window.event;}var d=a.srcElement?a.srcElement:a.target;if(!BV_bInBubbleEditMode&&!BV_bInNewMarkerState&&BV_oBubbledMarker.sType!=BV_EMBEDED){return;}var b=ReplaceAll(d.id,"BV_oMarkerHandle_","")*1;var c=BV_aMarkerHandles[b].sKey;if(BV_oBubbledMarker==null){return;}switch(BV_oBubbledMarker.sType){case BV_SELECT:case BV_LINK:case BV_TOC_ENTRY:case BV_EMBEDED:BV_StartResizeMarker(a,BV_oBubbledMarker,c);break;default:BV_StartDragMarker(a,BV_oBubbledMarker);break;}a.cancelBubble=true;return false;}

/** ========== kotarapp\viewer\js\postload\markers\frame.js ========== **/
function BV_CreateSquareMarkerFrame(){var a=UTILS_CreateElement("DIV");a.id="BV_oMarkerFrame";a.style.top="0px";a.style.left="0px";return a;}function BV_CreateSquareMarkerHandles(){var b=null;for(var a=0;a<BV_aMarkerHandles.length;a++){b=UTILS_CreateElement("DIV");b.id="BV_oMarkerHandle_"+a;b.className="BV_oMarkerHandle";b.style.top="0px";b.style.left="0px";b.style.cursor=BV_aMarkerHandles[a].sCursor;b.sKey=BV_aMarkerHandles[a].sKey;BV_oBook.appendChild(b);}}function BV_WireSquareMarkerHandlesEvents(){for(var a=0;a<BV_aMarkerHandles.length;a++){UTILS_AddHandler(getElement("BV_oMarkerHandle_"+a),"onmousedown",function(b){BV_MarkerHandler_OnMouseDown(b);});}}

/** ========== kotarapp\viewer\js\postload\markers\layers.js ========== **/
var Layers_bVisible=false;var Layers_State=[];var Layers_nNumVisible=0;var Layers_oBookExtensionTargetLayers=[];function Layers_VerifyInit(){if(Layers_TotalNumOfLayers<0){Layers_Init();}}function Layers_NumTotal(){Layers_VerifyInit();return Layers_State.length;}function Layers_Init(){Layers_State=Layers_GetSiteExtensionLayers();Layers_GetBookExtensionTargetLayers(false);Layers_nNumVisible=Layers_NumVisible();if(!BV_bSupportsLayersInViewer){return;}}function Layers_GetBookExtensionTargetLayers(a){var b=new Array({name:"SerType",value:2},{name:"nBookID",value:BV_nBookID});callAppKotarCommand("BookExtensions.GetBookExtensionTargetLayers",b,{onSuccessFunction:Layers_GetBookExtensionTargetLayers_OnSuccess,onFailureFunction:Layers_GetBookExtensionTargetLayers_OnFailure,bRefresh:a},false);}function Layers_GetBookExtensionTargetLayers_OnFailure(){AddDebugMessage("Layers_GetBookExtensionTargetLayers_OnFailure");}function Layers_GetBookExtensionTargetLayers_OnSuccess(a,b){Layers_oBookExtensionTargetLayers=a;Layers_RenderSelectorTitle();if(b.bRefresh){MarkersMgr_Refresh();}}function Layers_NumVisible(){Layers_VerifyInit();var b=0;for(var a=0;a<Layers_State.length;a++){b+=(Layers_State[a].LineIsVisible&&Layers_State[a].Visible?1:0);}return b;}function Layers_Get(b){Layers_VerifyInit();for(var a=0;a<Layers_State.length;a++){if(Layers_State[a].ID==b||BV_bIsAdminQa){return Layers_State[a];}}return null;}function Layers_GetAdmin(){Layers_VerifyInit();for(var a=0;a<Layers_State.length;a++){if(Layers_State[a].Gif.indexOf("Admin.gif")>0){return Layers_State[a];}}return null;}function Layers_GetPrivate(){Layers_VerifyInit();for(var a=0;a<Layers_State.length;a++){if(Layers_State[a].Gif.indexOf("MyNotes.gif")>0){return Layers_State[a];}}return null;}function Layers_GetMatchingLayer(f,e,a,c){Layers_VerifyInit();if(a){for(var b=0;b<Layers_oBookExtensionTargetLayers.length;b++){var d=Layers_oBookExtensionTargetLayers[b];if(d.bSource==true&&d.sItemType==f&&d.nAudience==c){return d.nLayer;}}}for(var b=0;b<Layers_oBookExtensionTargetLayers.length;b++){var d=Layers_oBookExtensionTargetLayers[b];if(d.bSource==false&&d.sItemType==f&&d.nAudience==c){return d.nLayer;}}return 0;}function Layers_RenderSelectorTitle(){var a=getElement("dvUGCSelectedLayers");if(a==null){return;}Layers_nNumVisible=Layers_NumVisible();if(Layers_nNumVisible==Layers_NumLayerLinesVisibile()){a.innerHTML=TXT_Layers_All;}else{if(Layers_nNumVisible==0){a.innerHTML=TXT_Layers_None;}else{var c="<span style='color: red; font-weight: bold;'>"+Layers_nNumVisible+"</span>";var b="<span style='color: black; font-weight: bold;'>"+Layers_NumLayerLinesVisibile()+"</span>";a.innerHTML=ReplaceAll(ReplaceAll(TXT_Layers_N_of_M,"N",c),"M",b);}}}function Layers_HideAllLayerLines(){for(var a=0;a<Layers_State.length;a++){Layers_SetLayerLineVisibility(a,false);}}function Layers_SetLayerLineVisibility(b,a){Layers_State[b*1].LineIsVisible=a;}function Layers_NumLayerLinesVisibile(){var b=0;for(var a=0;a<Layers_State.length;a++){b+=Layers_State[a*1].LineIsVisible?1:0;}return b;}function Layers_EnsureLayerVisibility(d,a){var b=Layers_GetMatchingLayer(d,"",true,a);var c=Layers_Get(b);if(c!=null){Layers_SetLayerLineVisibility(c.Index,true);Layers_RenderSelectorTitle();if(!c.Visible){Layers_SelectorChanged(null,c.Index,false);}}}function Layers_SelectorChanged(b,c,a){if(a){if(window.event){b=window.event;}}var d=0;if(c<Layers_State.length){Layers_State[c].Visible=!Layers_State[c].Visible;d=MarkersMgr_GetNumMarkersInLayer(Layers_State[c].ID);}else{alert("Layers_SelectorChanged: ["+c+"] ?");return;}var e=getElement("chkUGC"+c);if(!a){e.checked=!e.checked;}Layers_nNumVisible+=(e.checked?1:-1);Layers_RenderSelectorTitle();MarkersList_Render(false);MarkersMgr_OnVisibleLayersChanged();if(a){b.cancelBubble=true;return false;}return true;}function Layers_GetPriority(e,a,c){if(a){for(var b=0;b<Layers_oBookExtensionTargetLayers.length;b++){var d=Layers_oBookExtensionTargetLayers[b];if(d.bSource==true&&d.sItemType==e&&d.nAudience==c){return d.nPriority;}}}for(var b=0;b<Layers_oBookExtensionTargetLayers.length;b++){var d=Layers_oBookExtensionTargetLayers[b];if(d.bSource==false&&d.sItemType==e&&d.nAudience==c){return d.nPriority;}}return 0;}

/** ========== kotarapp\viewer\js\postload\markers\list.js ========== **/
var MarkersList_Entries=null;var MarkersList_nLastNumOfRenderedEntries=0;function BookLayers_Load(){Toolbar.ActivateButton("","BookLayers","");if(BV_BOOKWALL_ENABLED){if(cet.wall.wallready()&&cet.wall.hasPosts){cet.wall.Show();}else{ShowAjaxNotification(TXT_No_Layers);}}else{Toolbar.ToolbarBookLayersReady();}}function MarkersList_ReRender(){MarkersList_Render(true);}var MarkersList_MatchedLayers="";function MarkersList_Render(a){if(BV_BOOKWALL_ENABLED){cet.wall.refresh(a);}else{Toolbar.BookLayers.HTML="";Toolbar.BookLayers.RenderLayer(a);}}function MarkersList_RenderPage(h,c,b,d){var g=0;if(MarkersList_Entries[h]===undefined){MarkersList_Entries[h]=new Array();}if(c!=null){for(var f=0;f<c.length;f++){var l=c[f],k=null;if(l!=null){k=Layers_Get(l.nLayer);if(k!=null){if(MarkersList_MatchedLayers.indexOf(","+k.Index+",")<0){MarkersList_MatchedLayers+=k.Index+",";Layers_SetLayerLineVisibility(k.Index,true);}}if(l.nLayer>0&&(k==null||k.Visible)){var n=Layers_GetPriority(l.sType,l.bIsOwned,l.nAudience);MarkersList_Entries[h].push({date:l.dtUpdateDate,item:l,type:1,data:k.Index,priority:n});g++;}}}}if(b!=null){var a=Layers_GetAdmin();for(var f=0;f<b.length;f++){var i=b[f];if(MarkersList_MatchedLayers.indexOf(","+a.Index+",")<0){MarkersList_MatchedLayers+=a.Index+",";Layers_SetLayerLineVisibility(a.Index,true);}if(i!=null&&(a==null||a.Visible)){var n=4;MarkersList_Entries[h].push({date:i.dtUpdateDate,item:i,type:2,data:a.Index,priority:n});g++;}}}if(WordsMgr_PageSelections[h]!==undefined&&WordsMgr_PageSelections[h].length>0){var o=Layers_GetPrivate();var q=WordsMgr_PageSelections[h];if(q!=undefined&&q.length>0){for(var e=0;e<q.length;e++){var p=q[e];if(MarkersList_MatchedLayers.indexOf(","+o.Index+",")<0){MarkersList_MatchedLayers+=o.Index+",";Layers_SetLayerLineVisibility(o.Index,true);}if(p!=null&&(o==null||o.Visible)){var n=2;MarkersList_Entries[h].push({date:p.dtUpdateDate,item:p,type:3,data:o.Index,priority:n});g++;}}}}if(BookPageState_IsBookmark(h)){var o=Layers_GetPrivate();if(MarkersList_MatchedLayers.indexOf(","+o.Index+",")<0){MarkersList_MatchedLayers+=o.Index+",";Layers_SetLayerLineVisibility(o.Index,true);}if(o==null||o.Visible){var n=1;MarkersList_Entries[h].push({date:Date.now(),item:h,type:4,data:o.Index,priority:n});g++;}}return g;}function MarkersList_SetMarkerState(c,b){var d=getElement("markerRow"+c);var a=false;if(d==null){d=getElement("markerRow"+c+"_a");a=true;}if(d!=null){d.className=(b?"bubbledMarker":(a?"altPageMarkers":"pageMarkers"));}}function MarkersList_RemoveHTMLElements(b){if(b==""){return"";}var a=null;if(a==null){a=UTILS_CreateElement("DIV");a.style.display="none";document.body.appendChild(a);}if(isIE){a.innerHTML=b;return GetInnerText(a)+"";}else{if(isChrome){a.innerHTML=b;return a.innerText;}else{if(isFirefox){a.innerHTML=b;return a.textContent;}else{return b;}}}}function MarkerList_RenderRow(h,g,f,a,e,b){var i=h.sTitle.trim();if(i==""){i=h.sText.trim();}if(h.sType==BV_LINK||h.sType==BV_ICON_LINK){if(h.sUrl.indexOf("#")==0){i=ReplaceAll(TXT_LayersList_GoToPage,"{0}",ReplaceAll(h.sUrl,"#",""));}else{if(h.sTitle!=""){i=h.sTitle;}else{i=h.sUrl;}}}i=MarkersList_RemoveHTMLElements(i);if(i.indexOf("<")>=0){i=MarkersList_RemoveHTMLElements(i);}if(i=="undefined"){i=TXT_LayersList_NoTitle+"?";}if(i==""){i=TXT_LayersList_NoTitle;}i=decodeKotar(i);if(i.length>Toolbar.BookLayers.MaxTitleLength){i=i.substring(0,Toolbar.BookLayers.MaxTitleLength)+" ...";}var d=MarkerList_GetIcon(h.sType,h.sSubType,h.bIsOwned,h.nAudience);var c=[];c.push("<div class='layerrow' onclick='MarkersMgr_OnClick(",f,", ",h.nMarkerID,")'><div class='layericon ",d,"' /><div class='layerinfo' >",i,"</div></div>");return c.join("");}function MarkerList_GetHtml(d){var e=[];var a=false;var b=false;for(var f=0;f<MarkersList_Entries.length;f++){var h=MarkersList_Entries[f];if(h.length>0){b=true;for(var g=0;g<h.length;g++){var c=h[g];if(d!==undefined&&d!=c.data){continue;}if(c.item.nType===0&&!c.item.bPopup){continue;}if(b&&ShowPageHeader(h)){e.push(MarkerList_GetPageHeaderHtml(f));}switch(c.type){case 0:e.push(c.data);break;case 1:e.push(MarkerList_RenderRow(c.item,c.data,f,a,b,false));break;case 2:if((c.item.nType!==0||c.item.bPopup)&&c.item.bShowInLayers){e.push(EmbededList_RenderRow(c.item,f,a,b,false,false));}break;case 3:e.push(WordsSelectList_RenderRow(c.item,f,a,b));break;case 4:e.push(BookmarkList_RenderRow(c.item));break;}b=false;}a=!a;}}return e.join("");}function ShowPageHeader(c){var d=false;for(var b=0;b<c.length;b++){var a=c[b];if(a.type!=2){d=true;break;}else{if((a.item.nType!==0||a.item.bPopup)&&a.item.bShowInLayers){d=true;break;}}}return d;}function MarkerList_SortPageEntries(){for(var a=0;a<MarkersList_Entries.length;a++){if(MarkersList_Entries[a].length>0){MarkersList_Entries[a].sort(MarkerList_Sort);}}}function MarkerList_Sort(c,e){var g=1;var d=c.priority;var f=e.priority;if(d<f){g=-1;}else{if(d==f){if(c.item.nOrder<e.item.nOrder){g=-1;}else{if(c.item.nOrder>e.item.nOrder){g=1;}else{if(c.date<e.date){g=-1;}}}}}return g;}function MarkerList_SortByTop(c,d){var e=1;if(c.top<d.top){e=-1;}return e;}function MarkerList_GetPageHeaderHtml(b){var a=[];a.push("<div class='layerspagehead' data-pnum='",b+1,"' onclick='MarkerList_GotoPage(",b+1,");'>",TXT_Page," ",BookPageState_GetPageLabel(b),"</div>");return a.join("");}function MarkerList_GotoPage(a){if(!Toolbar.SubMenu.scrolled){BV_GotoPage(a,0);}}function MarkerList_GetIcon(d,c,a,b){if(c=="nonattached"||c=="archive"){return"notattached";}switch(d.toLowerCase()){case BV_PUSHPIN:switch(b){case BV_AUDIENCE_EVERYONE_ENRICHED:return"admin4all";case BV_AUDIENCE_EVERYONE_ELSE:if(a){return"mypublic";}else{return"public";}case BV_AUDIENCE_PERSONAL:return"private";case BV_AUDIENCE_TEACHERS:return"admin4teacher";case BV_AUDIENCE_STUDENTS:return"teacher4student";case BV_AUDIENCE_MYSCHOOL_TEACHERS:return(a?"myshare4teacher":"share4teacher");}case BV_LMS_TASK:return"lms";default:return"";}}function BookmarkList_RenderRow(b){var a=[];a.push("<div class='layerrow'  onclick='BookmarkList_onClick(",b,")'><div class='layericon bookmark'/><div class='layerinfo'></div></div>");return a.join("");}function BookmarkList_onClick(a){if(!Toolbar.SubMenu.scrolled){BV_GotoPage(a+1,0);}}

/** ========== kotarapp\viewer\js\postload\markers\lmstasks.js ========== **/
function BV_PlaceLMSTask(b,a){var c=BV_PlaceIconicExtension(b,a,BV_LMS_TASK);LMSTasks_CreateNewTask(c);}function LMSTasks_CreateNewMarkerForClone(b,d,a){var c=BV_BuildLMSTaskDetailsParametersArray(b,true);callAppKotarCommandPost("BookExtensions.Add",c,{onSuccessFunction:BV_CreateNewMarkerForClone_OnComplete,onFailureFunction:LMSTasks_CreateNewTask_OnError,sTaskID:d,nMarkerID_ForDelete:a});}function BV_CreateNewMarkerForClone_OnComplete(a,c){var b=JSON.parse(a);var d=BV_GetMarkerByID(BV_TEMPORARY_MARKER_ID);BV_AddLMSTaskIconEventHandlers(d);if(d==null){return;}d.name="BV_oMarker_"+b.ID;d.nMarkerID=b.ID;MarkersMgr_SetTemporaryMarkerID(d,b.ID);LMS_EditingMarkerID=b.ID;LMS_IOS_PositionFix=BookScroll.ScrollTop();LMS_MarkerIsTemporary=true;LMSTasks_CreateClone(d,c.sTaskID,c.nMarkerID_ForDelete);}function LMSTasks_CreateNewTask(a){var b=BV_BuildLMSTaskDetailsParametersArray(a,true);callAppKotarCommandPost("BookExtensions.Add",b,{onSuccessFunction:BV_CreateNewTask_OnComplete,onFailureFunction:LMSTasks_CreateNewTask_OnError,oMarker:a});}function LMSTasks_CreateNewTask_OnError(a){UTILS_RemoveDomElement(a.oMarker);AddDebugMessage("LMSTasks_CreateNewTask_OnError");SetBodyOverlayState(false);}function GetLMSTaskURL(b,a){if(typeof(Viewer_IsEmbeded)!="undefined"&&Viewer_IsEmbeded){return escape("//"+window.location.host+"/KotarApp/Viewer.aspx?nBookID="+BV_nBookID+"&ShowMarker="+(b+1)+"."+a+location.hash);}else{return escape("//"+window.location.host+"/KotarApp/Viewer.aspx?nBookID="+BV_nBookID+"#ShowMarker."+(b+1)+"."+a);}}function GetLMSTaskTitle(b){var a=80;var c="";if(BV_sBookDisplayName.length>a){c=BV_sBookDisplayName.substring(0,a);}else{c=BV_sBookDisplayName;}return TXT_BookName+": "+c+","+TXT_Page+": "+BookPageState_GetPageLabel(b);}function BV_CreateNewTask_OnComplete(a,c){var b=JSON.parse(a);var d=BV_GetMarkerByID(BV_TEMPORARY_MARKER_ID);BV_AddLMSTaskIconEventHandlers(d);if(d==null){return;}d.name="BV_oMarker_"+b.ID;d.nMarkerID=b.ID;MarkersMgr_SetTemporaryMarkerID(d,b.ID);var j=d.sTitle;var e=d.sText;var i="kotar";var h="ofek";if(typeof(hostSiteName)!="undefined"){h=hostSiteName;}var k=BV_CetSubject;var g=GetLMSTaskURL(d.nPageIndex,b.ID);var f=GetLMSTaskTitle(d.nPageIndex);LMS_EditingMarkerID=b.ID;LMS_IOS_PositionFix=BookScroll.ScrollTop();LMS_MarkerIsTemporary=true;LMSTasks_OpenNewTaskForm(j,e,k,b.OfekItemID,g,f);}function LMSTasks_GetMybagEnviroment(){return{environment:BaseMaster_Environment,sitekey:"school"};}function LMSTasks_OpenNewTaskForm(k,b,h,c,f,e){var d=LMSTasks_GetMybagEnviroment();var a=d.environment;var g=d.sitekey;var j=taskFormWrapper.getDefaultOptions();var i=getElement("taskFormIframe");j.language=BaseMaster_sLanguageCode;j.type="create";j.cetDomain=BaseMaster_Environment;j.itemID=c;j.kotarParams.title=k;j.kotarParams.instructions=b;j.kotarParams.cetSubject=h;j.kotarParams.returnUrl=f;j.kotarParams.returnTitle=e;taskFormWrapper.init(i,j,LMSTasks_OpenTaskFormOnComplete,LMSTasks_onTaskCanceledInLMS);i.style.display="block";setTimeout(function(){ShowAddTaskFormPopup();},100);}function LMSTasks_OpenTaskFormOnComplete(){ClearAddTaskFormPopup();if(arguments.length>0){var a=arguments[0];if(LMS_MarkerIsTemporary&&LMS_EditingMarkerID>0){BV_SetMarkerLinkedItemID(LMS_EditingMarkerID,a.taskID);}if(is_IOS){BookScroll.ScrollTop(LMS_IOS_PositionFix);}LMSTasks_UpdateTask(a.name,!a.isLinkedToUser,a.taskID);MarkerPostManager.ShowPost(LMS_EditingMarkerID,LMS_MarkerIsTemporary);LMSTasks_ResetFlags();BV_nTemporaryMarkerID=0;}}function LMSTasks_onTaskCanceledInLMS(){ClearAddTaskFormPopup();if(LMS_MarkerIsTemporary&&LMS_EditingMarkerID>0){BV_DeleteMarker(BV_GetMarkerByID(LMS_EditingMarkerID));if(is_IOS){BookScroll.ScrollTop(LMS_IOS_PositionFix);}}LMSTasks_ResetFlags();}var LMS_IsCloned=false;function LMSTasks_OnEditTask(d,a,c,b){LMS_EditingMarkerID=d;LMS_IOS_PositionFix=BookScroll.ScrollTop();LMS_IsCloned=c;LMSTasks_OpenEditTaskForm(a,b);}function LMSTasks_OpenEditTaskForm(g,b){var c=LMSTasks_GetMybagEnviroment();var a=c.environment;var d=c.sitekey;if(!b){var f=taskFormWrapper.getDefaultOptions();var e=getElement("taskFormIframe");f.language=BaseMaster_sLanguageCode;f.type="edit";f.cetDomain=BaseMaster_Environment;f.taskID=g;taskFormWrapper.init(e,f,LMSTasks_EditTaskFormOnComplete,LMSTasks_onTaskCanceledInLMS);e.style.display="block";}else{var f=taskFormWrapper.getDefaultOptions();var e=getElement("taskFormIframe");f.language=BaseMaster_sLanguageCode;f.type="edit";f.cetDomain=BaseMaster_Environment;f.isCopy=true;f.taskID=g;taskFormWrapper.init(e,f,LMSTasks_EditTaskFormOnComplete,LMSTasks_onTaskCanceledInLMS);e.style.display="block";}setTimeout(function(){ShowAddTaskFormPopup();},100);}function LMSTasks_EditTaskFormOnClose(){if(LMS_IsCloned){BV_DeleteMarker(marker);LMSTasks_ResetFlags();return;}}function LMSTasks_EditTaskFormOnComplete(){ClearAddTaskFormPopup();if(arguments.length>0){var b=BV_GetMarkerByID(LMS_EditingMarkerID);var a=arguments[0];if(!a.isLinkedToUser){b.sSubType="nonattached";}else{b.sSubType="default";}LMSTasks_UpdateTask(a.name,false,a.taskID);if(LMS_IsCloned){if(BV_BOOKWALL_ENABLED){MarkerPostManager.ShowPost(b.nMarkerID,true);}else{Notes.Viewer.Show(b);}}else{BV_ShowMarkerBubbleInViewMode(LMS_EditingMarkerID);MarkerPostManager.ResetPostCache(b.nMarkerID);MarkerPostManager.ShowPost(b.nMarkerID,false);}LMSTasks_ResetFlags();}}function LMSTasks_OnEditTask_onSuccess(a){if(typeof(a)!="undefined"){oMarker=BV_GetMarkerByID(LMS_EditingMarkerID);if(a.IsLinkedToUser=="false"){oMarker.sSubType="nonattached";}else{oMarker.sSubType="default";}LMSTasks_UpdateTask(a.Name);}else{if(LMS_IsCloned){oMarker=BV_GetMarkerByID(LMS_EditingMarkerID);BV_DeleteMarker(oMarker);LMSTasks_ResetFlags();return;}}if(LMS_IsCloned){Notes.Viewer.Show(BV_GetMarkerByID(LMS_EditingMarkerID));LMSTasks_ResetFlags();}else{BV_ShowMarkerBubbleInViewMode(LMS_EditingMarkerID);LMSTasks_ResetFlags();}}function LMSTasks_ResetFlags(){BV_bMarkerSelected=false;MarkersMgr_SetIsBeingEdited(LMS_EditingMarkerID,false);LMS_MarkerIsTemporary=false;LMS_EditingMarkerID=0;LMS_IsCloned=false;LMS_IOS_PositionFix=0;}function LMSTasks_UpdateTask(c,a,d){var b=BV_GetMarkerByID(LMS_EditingMarkerID);if(b!=null){b.sTitle=c;if(a){b.sSubType="nonattached";}if(b.gLinkedItemID!=d){b.gLinkedItemID=d;BV_SetMarkerLinkedItemID(LMS_EditingMarkerID,d);}BV_UpdateMarker_SubType(LMS_EditingMarkerID,b.sSubType);MarkersMgr_UpdateMarkerDetails(b,false);MarkersList_ReRender();}}function LMSTasks_CloneTask(b,c,a){LMSTasks_CreateNewMarkerForClone(b,c,a);}function LMSTasks_CreateClone(b,f,a){var e=GetLMSTaskURL(b.nPageIndex,b.nMarkerID);var d=GetLMSTaskTitle(b.nPageIndex);if(a>0){sCopyOf="";}else{sCopyOf=TXT_CopyOf+" ";}var c=new Array({name:"sTaskID",value:f},{name:"sNoteUrl",value:e},{name:"sNoteTitle",value:d},{name:"sCopyOf",value:sCopyOf});callAppKotarCommand("BookExtensions.CloneLMSTask",c,{onSuccessFunction:LMSTasks_OnCloneTask_onSuccess,onFailureFunction:LMSTasks_OnCloneTask_onFailure,oNewMarker:b,nMarkerID_ForDelete:a});}function LMSTasks_OnCloneTask_onSuccess(a,b){args={taskID:a,name:"",isLinkedToUser:false};LMSTasks_OpenTaskFormOnComplete("saved",args);LMSTasks_OnEditTask(b.oNewMarker.nMarkerID,a,true);if(b.nMarkerID_ForDelete>0){BV_DeleteMarker(BV_GetMarkerByID(b.nMarkerID_ForDelete),false);}}function LMSTasks_OnCloneTask_onFailure(a){alert(TXT_CopyTaskError);if(a.oNewMarker!=null){UTILS_RemoveDomElement(a.oNewMarker);}}function LMSTasks_DeleteTask(a,c){var b=new Array({name:"sTaskID",value:c});callAppKotarCommandNoSession("BookExtensions.DeleteLMSTask",b,{onSuccessFunction:LMSTasks_DeleteTask_OnComplete,onFailureFunction:LMSTasks_DeleteTask_OnError,oMarker:a});}function LMSTasks_DeleteTask_OnComplete(a,b){if(a){BV_DeleteMarker(b.oMarker);}}function LMSTasks_DeleteTask_OnError(){alert(TXT_DeleteTaskError);}function LMSTasks_GetDeletedLMSTaskGroups(b){var a=new Array({name:"sTaskID",value:b});callAppKotarCommandNoSession("BookExtensions.GetDeletedLMSTaskGroups",a,{onSuccessFunction:LMSTasks_GetDeletedLMSTaskGroups_OnComplete,onFailureFunction:LMSTasks_GetDeletedLMSTaskGroups_OnError});}function LMSTasks_GetDeletedLMSTaskGroups_OnComplete(a){var b=TXT_DeletedLMSTaskGroups_Msg1+".\n"+TXT_DeletedLMSTaskGroups_Msg2+"\n";if(a!=""){b+=TXT_TaskGroups+":\n \n"+a.res;}if(confirm(b)){LMSTasks_DeleteTask(BV_GetMarkerByID(BV_oBubbledMarker.nMarkerID),BV_oBubbledMarker.gLinkedItemID);}}function LMSTasks_GetDeletedLMSTaskGroups_OnError(){alert(TXT_DeleteTaskError);}function LMSTasks_SyncLmsTasksWithItems(){var a=new Array({name:"nBookID",value:BV_nBookID});callAppKotarCommand("BookExtensions.SyncLmsItemTasks",a,{onSuccessFunction:LMSTasks_SyncLmsTasksWithItems_OnComplete,onFailureFunction:LMSTasks_SyncLmsTasksWithItems_OnError},false);}function LMSTasks_SyncLmsTasksWithItems_OnComplete(f){if(f.HasChanges){MarkersMgr_Refresh(0);}LMS_TasksAttitude=new Array();if(f.Attitudes!==null){for(var a=0;a<f.Attitudes.length;a++){LMS_TasksAttitude[f.Attitudes[a].Key.toString()]=f.Attitudes[a].Value;}}if(f.CourseMarkers!==null&&f.CourseMarkers.length>0){for(var b=0;b<f.CourseMarkers.length;b++){var e=f.CourseMarkers[b];var c=e.nPageID;var d=BookPageState_GetPageIndex(c);MarkersMgr_RenderedMarkers[d]=false;MarkersMgr_AddMiniMarker(e,d);}MarkersList_ReRender();PageContent_LoadPagesInView(false);}}function LMSTasks_SyncLmsTasksWithItems_OnError(){}function LMSTasks_HasAdminRole(b){var c=false;var a=LMS_TasksAttitude[b.nMarkerID];if(a!==undefined){c=a!==0;}else{c=b.bIsOwned;}return c;}function LMSTasks_IsCourseTask(a){return(a.sType===BV_LMS_TASK&&a.bIsCourseTask);}function LMSTasks_FixLMSUrl(g){var f=g;var h=url.parse(g);if(h.queryparsed.manifest){var c={};var d=h.queryparsed.manifest.split("?");if(d.length>1){c=url.parseQs(d[1]);}if(typeof c.logo==="undefined"){c.logo="false";}if(typeof c["lms-auth"]==="undefined"){c["lms-auth"]="false";}manistr="";for(var a in c){manistr+=manistr?"&":"";manistr+=a+"="+c[a];}manienc=encodeURIComponent(d[0]+"?"+manistr);var e="";for(var b in h.queryparsed){e+=e?"&":"";if(b==="manifest"){e+="manifest="+manienc;}else{e+=b+"="+h.queryparsed[b];}}f=h.protocol+"://"+h.host+h.path+"?"+e+"#"+h.hash;}return f;}

/** ========== kotarapp\viewer\js\postload\markers\manager.js ========== **/
function MarkersMgr_Init(){Layers_Init();if(BaseMaster_bUserIsLoggedIn){Notes.audiences.Init();Notes.projects.Init();}}function MarkersMgr_Refresh(a){MarkersMgr_bInitilized=false;MarkersMgr_bLoaded=false;MarkersMgr_LoadBookMiniMarkers(a);}function MarkersMgr_LoadBookMiniMarkers(b,a){if(!MarkersMgr_bLoaded){var c=new Array({name:"SerType",value:2},{name:"nBookID",value:BV_nBookID});a=a||false;callAppKotarCommand("BookExtensions.GetAllBookExtensions",c,{onSuccessFunction:loadMiniMarker_OnComplete,onFailureFunction:loadMiniMarker_OnError,nLoadMarkerAfterRefresh:b,clearDomElements:a},false);}}function MarkersMgr_OnBookLayoutModification(){MarkersMgr_ClearAllMarkers();}function MarkersMgr_OnVisibleLayersChanged(){MarkersMgr_ClearMarkerDomElements();MarkersMgr_ClearAllMarkers();for(var a=BV_nTopPageInView;a<=BV_nBottomPageInView;a++){MarkersMgr_RenderPageMarkers(a);}}function MarkersMgr_ClearAllMarkers(){for(var a=0;a<BV_nTotalPages;a++){MarkersMgr_RenderedMarkers[a]=false;}}function loadMiniMarker_OnError(){}function MarkersMgr_ClearMarkerDomElements(){BookPageState_ResetMarkersLoadedForAllPages();$('[id="BV_oMarker"]').remove();MarkersMgr_OnBookLayoutModification();}function MarkersMgr_ClearMarkerDomElementsInView(a,c){for(var b=0;b<BV_nTotalPages;b++){if(MarkersMgr_RenderedMarkers[b]){MarkersMgr_RenderedMarkers[b]=false;BookPageState_SetMarkersLoaded(b,false);if(b>=a&&b<=c){$("#BV_oPage_"+b+" > #BV_oMarker").fadeOut(150,function(){$(this).remove();});}else{$("#BV_oPage_"+b+" > #BV_oMarker").remove();}}}}function loadMiniMarker_OnComplete(a,h){var d=h.nLoadMarkerAfterRefresh*1,e=0;MarkersMgr_PageMarkers=new Array();MarkersMgr_PagesLoaded=new Array();for(var j=0;j<BV_nTotalPages;j++){MarkersMgr_PageMarkers[j]=new Array();MarkersMgr_PagesLoaded[j]=false;MarkersMgr_RenderedMarkers[j]=false;}MarkersMgr_MarkerStatistics[0]=0;for(var j=0;j<Layers_NumTotal();j++){MarkersMgr_MarkerStatistics[Layers_State[j].ID]=0;}for(var b=0;b<a.length;b++){var i=a[b];var f=i.nPageID;var g=BookPageState_GetPageIndex(f);if(i.nID==d){e=g;}var c=MarkersMgr_AddMiniMarker(i,g);MarkersMgr_MarkerStatistics[c]++;}if(h.clearDomElements){MarkersMgr_ClearMarkerDomElements();}MarkersMgr_bLoaded=true;MarkersList_Render(false);PageContent_LoadPagesInView(false);MarkersMgr_ProcessShowPageMarkersQueue();if(d>0){MarkersMgr_OnClick(e,d);}LMSTasks_SyncLmsTasksWithItems();if(BV_BOOKWALL_ENABLED){cet.wall.Init({providers:[MarkerPostManager,EmbedPostManager]});}}function MarkersMgr_AddMiniMarker(g,f){var j=/-?\d+/;var i=MarkersMgr_PageMarkers[f];BookPageState_SetHasMarkers(f,true);var a=g.Flags.split(":");var l=markersMgr_GetType(a[0]);var k=markersMgr_GetPushpinType(a[1]);var c=markersMgr_GetBool(a[2]);var b=markersMgr_GetBool(a[4]);var d=a[3]*1;var e=g.nLayer*1;var h=markersMgr_GetLogicalPosition(g);i[i.length]={nMarkerID:g.nID,nPageID:g.nPageID,sTitle:g.sTitle,sUpdated:markersMgr_FormatDate(g.sUpdated),sType:l,sSubType:k,bIsOwned:c,nAudience:d,bIsPublished:(d==BV_AUDIENCE_EVERYONE_ELSE),nLayer:e,nLeft:h.nLeft,nTop:h.nTop,nWidth:h.nWidth,nHeight:h.nHeight,sOwnerFullName:g.sOwnerFullName,sText:g.sBody,nProjectID:g.nProjectID,bCanSetFolder:c,sUrl:g.sUrl,bRtl:g.bRtl,bIsBeingEdited:false,gLinkedItemID:g.gLinkedItemID,nSelectionType:g.nSelectionType,dtUpdateDate:new Date(parseInt(j.exec(g.dtUpdated)[0])),bIsCourseTask:b,nOrder:g.nOrder,gTalkbacksID:g.gTalkbacksID};return e;}function markersMgr_GetType(a){switch(a){case"b":return"bookmark";case"l":return BV_LINK;case"i":return BV_ICON_LINK;case"p":return BV_PUSHPIN;case"s":return BV_SELECT;case"te":return BV_TOC_ENTRY;case"lt":return BV_LMS_TASK;}}function markersMgr_GetPushpinType(a){switch(a){case"v":return"video";case"s":return"sound";case"t":return"text";case"d":return"default";case"n":return"nonattached";case"a":return"archive";case"1":return"1";case"2":return"2";case"3":return"3";}}function markersMgr_GetBool(a){return(a.toLowerCase()=="t");}function markersMgr_GetFormatDate(){var a=new Date();return ZeroPad(a.getDate(),2)+"/"+ZeroPad(a.getMonth()+1,2)+"/"+a.getFullYear();}function markersMgr_FormatDate(a){return a;}function markersMgr_GetLogicalPosition(b){var a=b.sLogicalPos.split(":");return{nLeft:(a[0]*1),nTop:(a[1]*1),nWidth:(a[2]*1),nHeight:(a[3]*1)};}function MarkersMgr_GetPageMarkers(a){if(MarkersMgr_PageMarkers!=null){return MarkersMgr_PageMarkers[a];}else{return null;}}function MarkersMgr_GetNumMarkersInLayer(a){return MarkersMgr_MarkerStatistics[a*1];}function MarkersMgr_OnClick(d,b){if(!Toolbar.SubMenu.scrolled){BV_HideMarkerBubble("MarkersMgr_OnClick",false);var f=MarkersMgr_PageMarkers[d];if(f==null){return;}for(var a=0;a<f.length;a++){if(f[a]!=null&&f[a].nMarkerID==b){d=BookPageState_GetPageNumber(f[a].nPageID);var e=BV_GetMarkerByID(b);var c=f[a].nTop-1000;BV_GotoPage(d,c);window.setTimeout("MarkersMgr_ShowMarkerBubble("+b+")",(e!=null?400:2000));return;}}BV_GotoPage(d+1,0);ShowAjaxImportantMessageBox(TXT_NoSuchMarker,2500);}}function MarkersMgr_ShowMarkerBubble(a){var b=BV_GetMarkerByID(a);if(b!=null){switch(b.sType){case BV_PUSHPIN:case BV_TOC_ENTRY:case BV_SELECT:case BV_LMS_TASK:BV_SetMarkerBackgroundImage_Hover(b);BV_ShowMarkerBubble("MarkersMgr_OnClick",b,true,true);break;}}}function MarkersMgr_ProcessShowPageMarkersQueue(){var a=MarkersMgr_sShowPageMarkersQueue.split(".");MarkersMgr_sShowPageMarkersQueue=".";for(var b=0;b<a.length;b++){if(a[b]!=""){MarkersMgr_ShowPageMarkers(a[b]);}}}function MarkersMgr_SetMarkerInfo(b,a){if(a){MarkersMgr_AddMarker(b,true);}else{MarkersMgr_UpdateMarker(b);}}function MarkersMgr_RenderPageMarkers(c){if(typeof(MarkersMgr_PageMarkers)=="undefined"){return;}if(MarkersMgr_PageMarkers===null){return;}if(MarkersMgr_RenderedMarkers[c]==false){MarkersMgr_RenderedMarkers[c]=true;var a=MarkersMgr_PageMarkers[c];for(var b=0;b<a.length;b++){var e=a[b];var d=(e!=null?Layers_Get(e.nLayer):null);if(e!=null&&(d==null||d.Visible)){BV_InstantiateUserMarker(c,e);}}}}function MarkersMgr_PageMarkersWereRendered(a){if(typeof(MarkersMgr_PageMarkers)=="undefined"||typeof(MarkersMgr_RenderedMarkers)=="undefined"){return false;}return(MarkersMgr_RenderedMarkers[a]==true);}function MarkersMgr_AddMarker(d,a){if(typeof(MarkersMgr_PageMarkers)=="undefined"||MarkersMgr_PageMarkers==null){return false;}var c=d.nPageIndex;var e=MarkersMgr_PageMarkers[c];var b=Layers_GetMatchingLayer(d.sType,d.sSubType,true,d.nAudience);var f=UTILS_GetMarkerLogicalPos(d);e[e.length]={nMarkerID:d.nMarkerID,nPageID:BookPageState_GetPageID(d.nPageIndex),sTitle:d.sTitle,sUpdated:markersMgr_GetFormatDate(),sType:d.sType,sSubType:d.sSubType,bIsOwned:true,bIsAdmins:BV_bAdminUser,bIsPublished:false,nLayer:b,nLeft:f.nLeft,nTop:f.nTop,nWidth:f.nWidth,nHeight:f.nHeight,sOwnerFullName:"",sText:d.sText,nProjectID:d.nProjectID,bCanSetFolder:true,sUrl:d.sUrl,bRtl:true,bIsBeingEdited:a,nAudience:d.nAudience,nSelectionType:GetSelectionType(BV_SelectionColor),dtUpdateDate:new Date(),nOrder:d.nOrder,gTalkbacksID:d.gTalkbacksID};}function MarkersMgr_SetMarkerTemporaryPosition(a){MarkersMgr_UpdateMarkerDetails(a,true);}function MarkersMgr_UpdateMarker(a){MarkersMgr_UpdateMarkerDetails(a,false);}var BV_nTemporaryMarkerID=0;function MarkersMgr_SetTemporaryMarkerID(c,b){BV_nTemporaryMarkerID=b;var d=MarkersMgr_PageMarkers[c.nPageIndex];for(var a=0;a<d.length;a++){if(d[a]!=null&&d[a].nMarkerID==BV_TEMPORARY_MARKER_ID){d[a].nMarkerID=b;return;}}}function MarkersMgr_SetMarkerIdToTemporaryMarker(b){var c=MarkersMgr_PageMarkers[b.nPageIndex];for(var a=0;a<c.length;a++){if(c[a]!=null&&c[a].nMarkerID==BV_TEMPORARY_MARKER_ID){c[a].nMarkerID=b.nMarkerID;return;}}}function MarkersMgr_UpdateMarkerDetails(d,a){var f=UTILS_GetMarkerLogicalPos(d);var e=MarkersMgr_PageMarkers[d.nPageIndex];var c=Layers_GetMatchingLayer(d.sType,d.sSubType,true,d.nAudience);d.nLayer=c;d.className=GetNoteClass(d.sType,d.sSubType,d.bIsOwned,d.nAudience);for(var b=0;b<e.length;b++){if(e[b]!=null&&e[b].nMarkerID==d.nMarkerID){if(!a){e[b].nAudience=d.nAudience;e[b].nProjectID=d.nProjectID;e[b].bIsPublished=d.bIsPublished;e[b].sText=d.sText;e[b].sUrl=d.sUrl;e[b].sTitle=d.sTitle;e[b].sUpdated=markersMgr_GetFormatDate();e[b].nLeft=f.nLeft;e[b].nTop=f.nTop;e[b].nWidth=f.nWidth;e[b].nHeight=f.nHeight;e[b].nLayer=c;e[b].sSubType=d.sSubType;e[b].className=d.className;e[b].nOrder=d.nOrder;e[b].gLinkedItemID=d.gLinkedItemID;e[b].gTalkbacksID=d.gTalkbacksID;}else{e[b].nTempLeft=f.nLeft;e[b].nTempTop=f.nTop;e[b].nTempWidth=f.nWidth;e[b].nTempHeight=f.nHeight;}return;}}}function MarkersMgr_Get(b){var c=BV_GetMarkerByID(b);if(c!=null){var d=MarkersMgr_PageMarkers[c.nPageIndex];for(var a=0;a<d.length;a++){if(d[a]!=null&&d[a].nMarkerID==c.nMarkerID){return(d[a]);}}}return null;}function MarkersMgr_GetIsBeingEdited(b){var c=BV_GetMarkerByID(b);if(c!=null){var d=MarkersMgr_PageMarkers[c.nPageIndex];for(var a=0;a<d.length;a++){if(d[a]!=null&&d[a].nMarkerID==c.nMarkerID){return d[a].bIsBeingEdited;}}}return false;}function MarkersMgr_SetIsBeingEdited(c,a){var d=BV_GetMarkerByID(c);if(d==null){return;}var e=MarkersMgr_PageMarkers[d.nPageIndex];for(var b=0;b<e.length;b++){if(e[b]!=null&&e[b].nMarkerID==d.nMarkerID){e[b].bIsBeingEdited=a;if(a){e[b].nTempLeft=e[b].nLeft;e[b].nTempTop=e[b].nTop;e[b].nTempWidth=e[b].nWidth;e[b].nTempHeight=e[b].nHeight;}return;}}}function MarkersMgr_RemoveMarker(d,c){var f=MarkersMgr_PageMarkers[d];for(var a=0;a<f.length;a++){if(f[a]!=null&&f[a].nMarkerID==c){var g=getElement("pageNum"+c);if(g!=null){if(a+1<f.length){var b=f[a+1].nMarkerID;if(b>0){var e=getElement("pageNum"+b);if(e!=null){$(e).html($(g).html());}}}}f.splice(a,1);var h=getElement("markerRow"+c);if(h!=null){$("#markerRow"+c).remove();}else{$("#markerRow"+c+"_a").remove();}return true;}}return false;}function MarkersMgr_MarkerNotFound(a){BV_HideMarkerBubble("MarkersMgr_MarkerNotFound",false);var c=BV_GetMarkerByID(a);if(c!=null){var b=c.nPageIndex*1;if(MarkersMgr_RemoveMarker(b,a)){MarkersMgr_ClearMarkerDomElements();MarkersMgr_RenderPageMarkers(b);MarkersList_ReRender();}}ShowAjaxImportantMessageBox(TXT_NoSuchMarker,2500);}function MarkersMgr_ExtensionSettingsNotFound(a,b){MarkersMgr_MarkerNotFound(a);alert("hide the tool for creating "+b);}function MarkersMgr_ReRender(){MarkersMgr_ClearMarkerDomElements();for(var a=0;a<BV_nTotalPages;a++){MarkersMgr_RenderPageMarkers(a);}}

/** ========== kotarapp\viewer\js\postload\markers\pushpins.js ========== **/
function BV_PlacePushpin(b,a){BV_PlaceIconicExtension(b,a,BV_PUSHPIN);}function BV_PlaceIconicExtension(c,a,f){if(BV_sActiveTool!=f){return;}cet.wall.UnSelectPosts(true);BV_SetActiveTool(BV_DEFAULTTOOL);Toolbar.ResetButton("note");var d=null;switch(f){case BV_PUSHPIN:var b=GetPushpinClass("default",true,BV_AUDIENCE_PERSONAL);d=BV_CreateIconicExtension(c,a,f,"default","BV_PushpinMarker "+b,null,(BV_nPushpinHotX/2),(BV_nPushpinHotY/2),BV_AUDIENCE_PERSONAL);BV_AddEditableMarkerEventHandlers(d);break;case BV_LMS_TASK:var b=GetLMSClass("");d=BV_CreateIconicExtension(c,a,f,"","BV_PushpinMarker "+b,null,BV_LMSTaskHotX,BV_LMSTaskHotY,BV_AUDIENCE_STUDENTS);break;default:return;}BV_AddTemporaryMarkerToPage(d);switch(f){case BV_PUSHPIN:BV_LockBubbleOnEditModeUntilSaveOrCancel();BV_ShowMarkerBubble("BV_PlaceIconicExtension - "+f,d,true,false);break;case BV_LMS_TASK:break;}MarkersMgr_AddMarker(d,true);Marker_OnAdded();return d;}function BV_CreateIconicExtension(g,a,p,o,n,m,c,d,f,b,q){var j=BV_GetPageImageElement(g);var i=UTILS_CreateElement("DIV");i.id="BV_oMarker";i.name="BV_oMarker_temporary";i.className=n;i.nPageIndex=g;i.sType=p;i.sSubType="default";if(typeof(m)!="undefined"&&m!=""){i.style.backgroundImage=m;i.style.backgroundRepeat="no-repeat";}i.bIsOwned=true;i.bCanSetFolder=true;i.bEditable=true;i.nPageID=BookPageState_GetPageID(g);i.nAudience=f;var l=UTILS_GetElementPos(j);var k=BV_GetPageWrapperElement(g);if(typeof(b)!="undefined"){i.style.left=b;i.nLeft=UTILS_PixelToLogicalX(b,BV_nPageImageWidth);}else{nLeft=a.clientX-l.nLeft-BV_nScrollbarWidth-2;if(nLeft+30>k.offsetWidth){nLeft=k.offsetWidth-30;}else{if(nLeft<c){nLeft=0;}}nLeft-=c;nLeft=Math.max(25,nLeft);i.style.left=nLeft+"px";i.nLeft=UTILS_PixelToLogicalX(nLeft,BV_nPageImageWidth);}if(typeof(q)!="undefined"){i.style.top=q;i.nTop=UTILS_PixelToLogicalY(q,BV_nPageImageHeight);}else{var h=a.clientY-l.nTop-2;if(h+30>k.offsetHeight){h=k.offsetHeight-30;}else{if(h<d){h=d;}}h-=d;h=Math.max(25,h);i.style.top=h+"px";i.nTop=UTILS_PixelToLogicalY(h,BV_nPageImageHeight);}i.style.display="block";i.sText="";i.sTitle="";i.sUrl="";i.nProjectID=BV_DefaultProjectID;i.nLayer=Layers_GetMatchingLayer(p,o,true,f);i.gLinkedItemID="";BV_aMarkers[BV_aMarkers.length]=i;BV_AddElementToPage(g,i);return i;}function BV_PlaceLMSIconExtension(a,f,b,c,d,g){if(typeof(d)!="undefined"&&typeof(g)!="undefined"){oExtension=BV_CreateIconicExtension(f,a,BV_LMS_TASK,"","BV_LMSTask",null,BV_LMSTaskHotX,BV_LMSTaskHotY,BV_AUDIENCE_STUDENTS,d,g);}else{oExtension=BV_CreateIconicExtension(f,a,BV_LMS_TASK,"","BV_LMSTask",null,BV_LMSTaskHotX,BV_LMSTaskHotY,BV_AUDIENCE_STUDENTS);}BV_AddTemporaryMarkerToPage(oExtension);MarkersMgr_AddMarker(oExtension,true);Marker_OnAdded();return oExtension;}function BV_PlaceCloneIconExtension(a,c){var b=GetPushpinClass("default",true,BV_PUSHPIN);oExtension=BV_CreateIconicExtension(c,a,BV_PUSHPIN,"default","BV_PushpinMarker "+b,null,(BV_nPushpinHotX/2),(BV_nPushpinHotY/2),BV_AUDIENCE_PERSONAL);BV_AddEditableMarkerEventHandlers(oExtension);BV_AddTemporaryMarkerToPage(oExtension);MarkersMgr_AddMarker(oExtension,true);Marker_OnAdded();return oExtension;}function GetNoteClass(e,d,a,b){var c="BV_PushpinMarker ";if(e==BV_PUSHPIN){c+=GetPushpinClass(d,a,b);}else{if(e==BV_LMS_TASK){c+=GetLMSClass(d);}}if(c!=""&&!("ontouchstart" in document.documentElement)){c+=" no-touch";}return c;}function GetPushpinClass(c,a,b){if(c=="nonattached"){return"nonattachedlmsNote";}switch(b){case BV_AUDIENCE_EVERYONE_ENRICHED:return"enrichedNote";break;case BV_AUDIENCE_EVERYONE_ELSE:return(a?"myPublicNote":"publicNote");break;case BV_AUDIENCE_PERSONAL:return"privateNote";break;case BV_AUDIENCE_TEACHERS:return"enriched4teachersNote";break;case BV_AUDIENCE_STUDENTS:return"lmsNote";break;case BV_AUDIENCE_MYSCHOOL_TEACHERS:return(a?"myShared4teachersNote":"shared4teachersNote");break;}}function GetLMSClass(a){switch(a){case"nonattached":return"nonattachedlmsNote";break;case"archive":return"nonattachedlmsNote";break;default:return"lmsNote";}}

/** ========== kotarapp\viewer\js\postload\markers\resize.js ========== **/
function BV_StartResizeMarker(a,b,c){if(b==null){return;}BV_oResizedMarker=b;UTILS_PreventBrowserDefaultAction(a);BV_HideMarkerFrame();BV_oResizedMarker.nDragMouseX=mousePos.x;BV_oResizedMarker.nDragMouseY=mousePos.y;BV_oResizedMarker.nDragStartLeft=BV_oResizedMarker.offsetLeft;BV_oResizedMarker.nDragStartTop=BV_oResizedMarker.offsetTop;BV_oResizedMarker.nDragStartRight=BV_oResizedMarker.offsetLeft+BV_oResizedMarker.offsetWidth-1;BV_oResizedMarker.nDragStartBottom=BV_oResizedMarker.offsetTop+BV_oResizedMarker.offsetHeight-1;BV_sResizedMarkerHandle=c;}function BV_ContinueResizeMarker(a){if(BV_oResizedMarker!=null){var c=mousePos.x-BV_oResizedMarker.nDragMouseX;var d=mousePos.y-BV_oResizedMarker.nDragMouseY;var p=BV_GetPageImageElement(BV_oResizedMarker.nPageIndex);var e=BV_oResizedMarker.nDragStartLeft;var o=BV_oResizedMarker.nDragStartTop;var n=BV_oResizedMarker.nDragStartRight;var b=BV_oResizedMarker.nDragStartBottom;var k=0;var g=BV_oResizedMarker.nDragStartRight-10;var m=0;var i=BV_oResizedMarker.nDragStartBottom-10;var l=BV_oResizedMarker.nDragStartLeft+10;var h=p.offsetWidth-1;var j=BV_oResizedMarker.nDragStartTop+10;var f=p.offsetHeight-1;var q=BV_sResizedMarkerHandle;if(q.indexOf("left")!=-1){e+=c;}if(q.indexOf("top")!=-1){o+=d;}if(q.indexOf("right")!=-1){n+=c;}if(q.indexOf("bottom")!=-1){b+=d;}if(e<k){e=k;}if(e>g){e=g;}if(n<l){n=l;}if(n>h){n=h;}if(o<m){o=m;}if(o>i){o=i;}if(b<j){b=j;}if(b>f){b=f;}BV_oResizedMarker.style.left=e+"px";BV_oResizedMarker.style.top=o+"px";BV_oResizedMarker.style.width=(n-e+1)+"px";BV_oResizedMarker.style.height=(b-o+1)+"px";BV_oResizedMarker.bModified=true;BV_ShowSquareMarkerFrame(BV_oResizedMarker);BV_ShowMarkerHandles(BV_oResizedMarker);}}function BV_EndResizeMarker(){if(BV_oResizedMarker!=null){BV_UnHideMarkerBubble(BV_oResizedMarker);BV_SetMarkerBackgroundImage_Active(BV_oBubbledMarker);BV_oResizedMarker=null;}}

/** ========== kotarapp\viewer\js\postload\markers\selections.js ========== **/
function BV_StartSelection(b,a){if(BV_sActiveTool!=BV_SELECT&&BV_sActiveTool!=BV_TOC_ENTRY){return;}UTILS_PreventBrowserDefaultAction(a);BV_oSelection=UTILS_CreateElement("DIV");BV_oSelection.id="BV_oMarker";var c="";if(BV_sActiveTool==BV_SELECT){if(isIE){$(BV_oSelection).css({"background-color":"#"+BV_SelectionColor,position:"absolute",overflow:"hidden",cursor:"default",opacity:".35",filter:"progid:DXImageTransform.Microsoft.Alpha(style=0,opacity=35)"});}else{$(BV_oSelection).css({"background-color":"#"+BV_SelectionColor,position:"absolute",overflow:"hidden",cursor:"default",opacity:".35"});}c=GetSelectionType(BV_SelectionColor);}else{BV_oSelection.className="BV_TocEntry";}BV_oSelection.nPageIndex=b;BV_oSelection.sType=BV_sActiveTool;BV_oSelection.bEditable=true;BV_oSelection.bIsOwned=true;BV_oSelection.bCanSetFolder=true;BV_oSelection.nPageID=BookPageState_GetPageID(b);BV_oSelection.sText="";BV_oSelection.sTitle="";BV_oSelection.sUrl="";BV_oSelection.nProjectID=BV_DefaultProjectID;BV_oSelection.sSubType=c;BV_oSelection.nAudience=BV_AUDIENCE_PERSONAL;BV_oSelection.nLayer=Layers_GetMatchingLayer(BV_sActiveTool,"",true,BV_AUDIENCE_PERSONAL);BV_oSelection.gLinkedItemID="";BV_aMarkers[BV_aMarkers.length]=BV_oSelection;BV_AddElementToPage(b,BV_oSelection);BV_SetSelectionParameters(b,mousePos.x,mousePos.y,true);a.cancelBubble=true;}function BV_StartLinkSelection(b,a){if(BV_sActiveTool!=BV_LINK){return;}UTILS_PreventBrowserDefaultAction(a);BV_oSelection=UTILS_CreateElement("DIV");BV_oSelection.id="BV_oMarker";BV_oSelection.className="BV_LinkMarker";BV_oSelection.nPageIndex=b;BV_oSelection.sType=BV_LINK;BV_oSelection.bEditable=true;BV_oSelection.bIsOwned=true;BV_oSelection.bCanSetFolder=true;BV_oSelection.nPageID=BookPageState_GetPageID(b);BV_oSelection.sText="";BV_oSelection.sTitle="";BV_oSelection.sUrl="";BV_oSelection.nProjectID=BV_DefaultProjectID;BV_oSelection.sSubType="";BV_oSelection.nAudience=BV_AUDIENCE_EVERYONE_ENRICHED;BV_oSelection.nLayer=Layers_GetMatchingLayer(BV_LINK,"",true,BV_AUDIENCE_EVERYONE_ENRICHED);BV_oSelection.gLinkedItemID="";BV_aMarkers[BV_aMarkers.length]=BV_oSelection;BV_AddElementToPage(b,BV_oSelection);BV_SetSelectionParameters(b,mousePos.x,mousePos.y,true);}function BV_SetSelectionParameters(c,b,d,a){var e=BV_GetPageImageElement(c);var f=UTILS_GetElementPos(e);BV_nSelectionMinX=0;BV_nSelectionMaxX=e.offsetWidth-1;BV_nSelectionMinY=0;BV_nSelectionMaxY=e.offsetHeight-1;BV_nSelectionPage=c;BV_nSelectionPageID=BookPageState_GetPageID(c);BV_nStartSelectionMouseX=b;BV_nStartSelectionMouseY=d;var f=UTILS_GetElementPos(e);BV_nStartSelectionX=b-f.nLeft-BV_nScrollbarWidth-2;BV_nStartSelectionY=d-f.nTop-2;if(a==true){BV_oSelection.style.width="1px";BV_oSelection.style.height="1px";BV_oSelection.style.left=BV_nStartSelectionX+"px";BV_oSelection.style.top=BV_nStartSelectionY+"px";BV_oSelection.style.display="inline";}BV_bOnSelection=true;}function BV_ContinueSelection(a){BV_ContinueRegionSelection(a);}function BV_EndSelection(a){if(BV_IsValidRegionSelection()){if(BV_EndRegionSelection(false)){BV_oSelection.sText="";BV_oSelection.sUrl="";BV_oSelection.nProjectID=BV_DefaultProjectID;BV_oSelection.name="BV_oMarker_temporary";BV_AddEditableMarkerEventHandlers(BV_oSelection);BV_AddTemporaryMarkerToPage(BV_oSelection);BV_LockBubbleOnEditModeUntilSaveOrCancel();BV_ShowMarkerBubble("BV_EndSelection",BV_oSelection,true,false);MarkersMgr_AddMarker(BV_oSelection,true);Marker_OnAdded();}}else{var c=BV_sActiveTool;var b="";if(BV_bOnSelection){b=TXT_SelectionAreaIsTooSmall;}else{b=TXT_SelectionAreaOutOfPage;}BV_EndRegionSelection(true);switch(c){case BV_TOC_ENTRY:ToolBar_OnTocEntryMode();break;case BV_SELECT:ToolBar_OnClickSelectMode();break;case BV_LINK:ToolBar_OnLinkMode();break;}ShowAjaxNotification(b);}}

/** ========== kotarapp\viewer\js\postload\markers\selectwords.js ========== **/
function WordsFrame_RemoveAllWireframeElements(){var a=BV_nTotalPages;for(n=0;n<a;n++){UTILS_RemoveDomElement(document.getElementById("BV_oWireframe"+n));}}function WordsFrame_LoadPageWireframe(c,a){if(c<0||c+1>=BV_nTotalPages){return;}var d=document.getElementById("BV_oWireframe"+c);if(d==null){d=UTILS_CreateElement("DIV");d.className="BV_oWireframeElements";d.id="BV_oWireframe"+c;BV_GetPageImageElement(c).appendChild(d);var e=new Array({name:"nBookID",value:BV_nBookID},{name:"nPageID",value:BookPageState_GetPageID(c)},{name:"nSizeStep",value:BV_nCurrentSizeStep},{name:"tmp",value:(Date())});var b=(a?"GetWordsWireframe":"GetLinesWireframe");executeWebRequest("Pages."+b,e,{onSuccessFunction:WordsFrame_OnComplete,onFailureFunction:WordsFrame_OnError,sTargetContainerID:d.id});}}function WordsFrame_OnError(){}function WordsFrame_OnComplete(a,f){var d=document.getElementById(f.sTargetContainerID);if(d==null){return;}d.innerHTML="";for(var b=0;b<a.length;b++){var c=a[b];if(WordsFrame_ElementIsValid(c)){var e=WordsFrame_CreateWireframePageElement(c.order,c.x,c.y,c.width,c.height,b,c.direction);if(e!=null){d.appendChild(e);}}}}function WordsFrame_CreateWireframePageElement(e,g,i,f,b,c,a){var d=UTILS_CreateElement("DIV");d.style.top=i*1+"px";d.style.left=g*1+"px";d.style.width=f*1+"px";d.style.height=b*1+"px";d.style.cursor="pointer";d.style.backgroundColor="white";d.className="primitiveWord";d.style.zIndex=1;d.title=e+" "+a;d.innerHTML=e;if((c+"").indexOf("wireframePageElement_")<0){c="wireframePageElement_"+c;}d.id=c;UTILS_AddHandler(d,"onclick",function(h){WireframePageElement_OnClick(h);});return d;}function WordsFrame_ElementIsValid(c){var b=c.i.split(":");c.order=b[0]*1;c.y=b[1]*1;c.x=b[2]*1;c.width=b[3]*1;c.height=b[4]*1;c.direction=(b[5]*1==1?"rtl":"ltr");var e=c.x*1;var f=c.y*1;var d=c.width*1;var a=c.height*1;return(e>=0&&f>=0&&d>0&&a>0&&e+d<=BV_nPageImageWidth&&f+a<=BV_nPageImageHeight);}function WireframePageElement_OnClick(a){if(window.event){a=window.event;}var b=a.srcElement?a.srcElement:a.target;if(b.style.backgroundColor=="white"){b.style.backgroundColor="";}else{b.style.backgroundColor="white";}}

/** ========== kotarapp\viewer\js\postload\markers\style.js ========== **/
function BV_SetMarkersStyle(){UTILS_UpdateStyleRule("div.BV_TocEntry",BV_GetStyleFor_Selection("purple"));UTILS_UpdateStyleRule("div.BV_SelectMarker",BV_GetStyleFor_Selection("yellow"));UTILS_UpdateStyleRule("div.BV_LinkMarker",BV_GetStyleFor_LinkMarker());UTILS_UpdateStyleRule("div.BV_LinkMarkerHighlighted",BV_GetStyleFor_LinkMarkerHighlighted());UTILS_UpdateStyleRule("div.BV_SelectCopy",BV_GetStyleFor_SelectCopy(),true);if(ieVer<9){UTILS_UpdateStyleRule("div.BV_oMarkerHandle",BV_GetStyleFor_oMarkerHandle());}}function BV_GetStyleFor_Selection(a){if(ieVer<9){return"background-color: "+a+"; position: absolute; overflow: hidden; display: none; cursor: default; filter: progid:DXImageTransform.Microsoft.Alpha(style=0,opacity=35); ";}else{return"background-color: "+a+"; position: absolute; overflow: hidden; display: none; cursor: default; opacity: .35;";}}function BV_GetStyleFor_LinkMarker(){if(ieVer<9){return"position: absolute; overflow: hidden; display: none; cursor: move; z-index: 2; background-color: #A8FFFF;  border-bottom: solid 2px #000063; filter: progid:DXImageTransform.Microsoft.Alpha(style=0,opacity=35);";}else{return"background-image: url(/KotarApp/Viewer/Images/transCyan.png); background-position: 0px 0px; background-repeat: repeat; position: absolute; z-index: 2; border-bottom: solid 2px #000063; ";}}function BV_GetStyleFor_LinkMarkerHighlighted(){if(ieVer<9){return"position: absolute; overflow: hidden; display: none; cursor: move; z-index: 2; background-color: #A8FFFF;  border-bottom: solid 2px #CC0000; filter: progid:DXImageTransform.Microsoft.Alpha(style=0,opacity=25);";}else{return"background-image: url(/KotarApp/Viewer/Images/transCyan.png); background-position: 0px 0px; background-repeat: repeat; position: absolute; z-index: 2; border-bottom: solid 2px #CC0000; ";}}function BV_GetStyleFor_SelectCopy(){if(ieVer<9){return"background-color: red; position: absolute; overflow: hidden; display: none; border: solid 1px black; cursor: move;  filter: progid:DXImageTransform.Microsoft.Alpha(style=0,opacity=35);";}else{return"background-image: url(/KotarApp/Viewer/Images/transRed.png); background-position: 0px 0px; background-repeat: repeat; position: absolute; border: solid 1px gray; ";}}function BV_GetStyleFor_oMarkerHandle(){if(isIE){return"visibility: hidden; overflow: hidden; width: 10px; height: 10px; position: absolute; border: solid 1px black; background-color: white;  filter: progid:DXImageTransform.Microsoft.Alpha( style=0,opacity=75);";}else{return"";}}

/** ========== kotarapp\viewer\js\postload\markers\taskformwrapper.js ========== **/
var taskFormWrapper=(function(){var d=null;var c=null;var b=function(g){var f="";switch(g){case"he":f="Hebrew";break;case"ar":f="Arabic";break;case"en":f="English";break;case"vi":f="Vietnamese";break;case"zh":f="Chinese";break;default:break;}return f;};var a=function(h){var f=h.indexOf("{");if(f<0){return null;}var g=h.substr(f);return JSON.parse(g);};var e=function(g,f){g.contentWindow.postMessage({action:"set_options",data:f},"*");};window.addEventListener("message",function(f){if(f&&typeof(f.data)==="string"){if(f.data.indexOf("mybagui|taskform|saved")>=0&&typeof(d)==="function"){d(a(f.data));d=null;c=null;}else{if(f.data.indexOf("mybagui|taskform|close")>=0&&typeof(c)==="function"){c();d=null;c=null;}}}});return{init:function(f,i,h,g){d=h;c=g;i.itemLanguage=b(i.language);f.onload=e.bind(null,f,i);f.contentWindow.location.replace("//mybagui."+i.cetDomain+"/Forms/TaskFormHost.aspx?is_options_by_msg=true");},getDefaultOptions:function(){return{language:"he",itemID:"",taskID:"",itemLanguage:"Hebrew",hasHeader:false,type:"create",cetDomain:"cet.ac.il",siteKey:"school",hostKey:"kotar",close:true,isCopy:false,kotarParams:{}};}};}());

/** ========== kotarapp\viewer\js\postload\tools\bookbibliography.js ========== **/
var BookBibliography=BookBibliography||{};(function(b){var a=null;function c(){if(a===null){d();}return a;}function d(){var g=new Array({name:"nBookID",value:BV_nBookID});callAppKotarCommandReadOnlySession("loadbibliography",g,{onSuccessFunction:e,onFailureFunction:f},false,true);}function e(g){a=g;}function f(){a="";}b.Get=c;})(BookBibliography);

/** ========== kotarapp\viewer\js\postload\tools\copy.js ========== **/
var CLIPBOARD_UNKNOWN=0;var CLIPBOARD_ACCESSIBLE_IE=1;var CLIPBOARD_ACCESSIBLE_CHROME=2;var CLIPBOARD_NOT_ACCESSIBLE=-1;var _clipboardAccessStatus=CLIPBOARD_UNKNOWN;function ClipboardIsAccessible(){if(_clipboardAccessStatus==CLIPBOARD_UNKNOWN){if(typeof(clipboardData)!="undefined"){var b=(new Date()).toString();clipboardData.setData("Text",b);var a=clipboardData.getData("Text");_clipboardAccessStatus=(b==a?CLIPBOARD_ACCESSIBLE_IE:CLIPBOARD_NOT_ACCESSIBLE);}}if(_clipboardAccessStatus==CLIPBOARD_ACCESSIBLE_IE){clipboardData.setData("Text","");return true;}return false;}function EstablishClipboardAccessMethod(){if(_clipboardAccessStatus==CLIPBOARD_UNKNOWN){if(typeof(clipboardData)!="undefined"){var b=(new Date()).toString();clipboardData.setData("Text",b);var a=clipboardData.getData("Text");_clipboardAccessStatus=(b==a?CLIPBOARD_ACCESSIBLE_IE:CLIPBOARD_NOT_ACCESSIBLE);}else{_clipboardAccessStatus=(document.queryCommandSupported("copy")===true&&typeof(window.getSelection())!="undefined")?CLIPBOARD_ACCESSIBLE_CHROME:CLIPBOARD_NOT_ACCESSIBLE;}}if(_clipboardAccessStatus==CLIPBOARD_ACCESSIBLE_IE){clipboardData.setData("Text","");}return _clipboardAccessStatus;}function ClipboardAccessMethod(){return EstablishClipboardAccessMethod();}var nReadyToCopy=0;function OnSelectCopyRegion(){StartCopyToClipBoard(false,true);ToolBar_SetDefaultTool();}var oCopyContainer=null;function CreateContainer(){var a=UTILS_CreateElement("div");a.style.display="block";a.style.textAlign=isRTL()?"right":"left";return a;}function NewCopyContainer(){oCopyContainer=CreateContainer();getElement("divBookClips").appendChild(oCopyContainer);}function CopyTheHTMLFromTheTempContentHolderToTheClipboard(){if(oCopyContainer!=null){if(ClipboardIsAccessible()){window.setTimeout("AutoCopyToClipboard()",200);}else{window.setTimeout("ShowManualCopyToClipboardPopup()",200);}}}function AutoCopyToClipboard(){CopySimpleTextToClipboard();oCopyContainer.contentEditable="true";var a;if(document.body.createControlRange){a=document.body.createControlRange();a.addElement(oCopyContainer);a.execCommand("Copy");}else{document.designMode="on";a=document.createRange();a.selectNode(oCopyContainer);var c=window.getSelection();if(c.rangeCount>0){c.removeAllRanges();}c.selectAllChildren(oCopyContainer);try{var d=document.execCommand("copy");if(d===true){ShowAjaxNotification(TXT_ContentCopyCompleted);}else{ShowAjaxNotification(TXT_ErrorCopyingSelection);}}catch(b){}c.removeAllRanges();document.designMode="off";}oCopyContainer.contentEditable="false";nReadyToCopy=0;}function CopySimpleTextToClipboard(){if(_clipboardAccessStatus==CLIPBOARD_ACCESSIBLE_IE){var a=UTILS_CreateElement("span");var b=oCopyContainer.innerHTML;b=b.replace("<br />","[LF]").replace("<BR>","[LF]").trim();while(b.indexOf("[LF]")==0){b=b.substring(4).trim();}a.innerHTML=b;clipboardData.setData("Text",a.innerText.replace("[LF]","\n"));}else{}}function GetContnetToCopy(a){if(a==true){return oCopyContainer.parentNode.innerHTML;}else{return oCopyContainer.innerHTML;}}function waitToCopy(a){if(nReadyToCopy<2){setTimeout(waitToCopy,200);}else{if(!is_mobile){CopyTheHTMLFromTheTempContentHolderToTheClipboard();}if(_clipboardAccessStatus==CLIPBOARD_ACCESSIBLE_IE){ShowAjaxNotification(TXT_ContentCopyCompleted);}}}function BV_GetTextToCopy_OnError(){ShowAjaxImportantMessageBox(TXT_ErrorCopyingSelection);}function BV_GetTextToCopy_OnComplete(b){var a=UTILS_CreateElement("div");a.innerHTML=b.get_responseData();oCopyContainer.appendChild(a);nReadyToCopy++;}function StartCopyToClipBoard(b,a){NewCopyContainer();var f=BV_GetLastSelection();if(b){var e=new Array({name:"nPageID",value:f.nPageID},{name:"nWidth",value:f.nCurrPageWidthPx},{name:"nHeight",value:f.nCurrPageHeightPx},{name:"nRectWidth",value:f.nSelectWidthPx},{name:"nRectHeight",value:f.nSelectHeightPx},{name:"nRectX",value:f.nSelectLeftPx},{name:"nRectY",value:f.nSelectTopPx},{name:"nBookID",value:BV_nBookID},{name:"tmp",value:"tmp"});executeWebRequest("Pages.GetTextInRegion",e,null,null,BV_GetTextToCopy_OnComplete);}else{var g=BV_sCropPageImageUrlFormat;g=g.replace("{gPageToken}",BookPageState_GetPageGuid(f.nPageIndex));g=g.replace("{nVersion}",BookPageState_GetPageImageVersion(f.nPageIndex));g=g.replace("{nSizeStep}",(f.nCurrSizeStep+1));g=g.replace("{nTop}",f.nSelectTopPx);g=g.replace("{nLeft}",f.nSelectLeftPx);g=g.replace("{nWidth}",f.nSelectWidthPx);g=g.replace("{nHeight}",f.nSelectHeightPx);if(is_mobile){g+="&download=true";window.open(g);}else{var d=UTILS_CreateElement("IMG");d.width=f.nSelectWidthPx;d.height=f.nSelectHeightPx;d.src=g;oCopyContainer.appendChild(d);}nReadyToCopy++;}if(a){var c=UTILS_CreateElement("DIV");c.style.fontSize="13px";c.innerHTML=BookBibliography.Get()+"<b>"+TXT_PageLabel+":</b>"+BookPageState_GetPageLabel(BV_nSelectionPage);oCopyContainer.appendChild(c);nReadyToCopy++;}else{nReadyToCopy++;}waitToCopy();}var BV_ONCOPY=false;function BV_StartCopySelection(b,a){if(BV_sActiveTool!=BV_COPY){return;}BV_ONCOPY=true;BV_StartRegionSelection(b,a,"BV_SelectCopy");}function BV_ContinueCopySelection(){BV_ContinueRegionSelection();}function BV_EndCopySelection(){if(BV_ONCOPY&&!BV_IsValidRegionSelection()){BV_EndRegionSelection(true);ToolBar_OnClickCopyMode();if(BV_bOnSelection){ShowAjaxNotification(TXT_SelectionAreaIsTooSmall);}else{ShowAjaxNotification(TXT_SelectionAreaOutOfPage);}return;}if(BV_EndRegionSelection(true)){OnSelectCopyRegion();}BV_ONCOPY=false;}

/** ========== kotarapp\viewer\js\postload\tools\print.js ========== **/
function BV_HighlightPageToBePrinted(a){nPageIndex=BV_CalcPageToPrint();if(!BookPageState_PageExists(nPageIndex)){return;}var b=BookPageState_GetIsPrintable(nPageIndex);var e=BV_GetPageImageElement(nPageIndex);var d=e.offsetWidth;var c=e.offsetHeight;e.style.border=(a?"solid 1px "+(b?"blue":"red"):"none");e.style.backgroundPosition=(a?"-1px -1px":"right top");if(!isIE){e.style.width=(a?BV_nPageImageWidth-2:BV_nPageImageWidth+2);}}function BV_CalcPageToPrint(){var c=BV_nTopPageInView;var a=c+1;var d=BV_ComputePageVisiblePortion(c);var b=BV_ComputePageVisiblePortion(a);if(d<50&&d<b){c=a;}return c;}function BV_PrintSomePages(b,a){var c="/KotarApp/Viewer/Popups/PrintPages.aspx?nBookID="+BV_nBookID+"&nPageStart="+b+"&nPageEnd="+a;for(i=b-1;i<a;i++){if(!BookPageState_GetIsPrintable(i)){ShowAjaxNotification(TXT_CantPrintThisPage);return;}}BV_ShowModalDialog(c);}function BV_PrintCurrentPage(){nPageIndex=BV_CalcPageToPrint();if(!BookPageState_PageExists(nPageIndex)){return;}if(!BookPageState_GetIsPrintable(nPageIndex)){ShowAjaxNotification(TXT_CantPrintThisPage);return;}var a="/KotarApp/Viewer/Popups/PrintPage.aspx?nBookID="+BV_nBookID+"&nPageNum="+(nPageIndex+1);BV_ShowModalDialog(a);}function BV_ShowModalDialog(a){window.open(a,"printdialog");}

/** ========== kotarapp\viewer\js\postload\windows\utils.js ========== **/
function BV_LockBubbleOnEditModeUntilSaveOrCancel(){BV_bInNewMarkerState=true;BV_bMarkerSelected=true;}var BV_sLastAutoHiddenMarkerID="";var BV_sLastAutoHiddenMarkerIsInEditMode=false;function BV_SmartHideMarkerBubble(b,a){BV_sLastAutoHiddenMarkerID="";BV_sLastAutoHiddenMarkerIsInEditMode=(BV_bInNewMarkerState||BV_bInBubbleEditMode);if(BV_oBubbledMarker==null){return;}BV_sLastAutoHiddenMarkerID=BV_oBubbledMarker.nMarkerID;BV_HideMarkerBubble(b,a);}function BV_SmartShowMarkerBubble(a){if(!BV_BOOKWALL_ENABLED){if(BV_sLastAutoHiddenMarkerID!=""){if(BV_sLastAutoHiddenMarkerIsInEditMode){if(a){window.setTimeout("BV_ShowMarkerBubbleInEditMode('"+BV_sLastAutoHiddenMarkerID+"')",2000);}else{BV_ShowMarkerBubbleInEditMode(BV_sLastAutoHiddenMarkerID);}}else{if(a){window.setTimeout("BV_ShowMarkerBubbleInViewMode('"+BV_sLastAutoHiddenMarkerID+"')",2000);}else{BV_ShowMarkerBubbleInViewMode(BV_sLastAutoHiddenMarkerID);}}BV_sLastAutoHiddenMarkerID="";}}}function BV_HideMarkerBubble(b,a){if(!a){BV_RestoreMarkerProperties(false,"BV_HideMarkerBubble");if(BV_bInNewMarkerState==true&&(b!="BV_SetAutoFitMode"&&b!="BV_SetDisplaySize")){BV_DeleteTemporaryMarker();}}if(BV_oBubbledMarker!=null){BV_ResetMarkerBackgroundImage(BV_oBubbledMarker.nMarkerID);switch(BV_oBubbledMarker.sType){case BV_PUSHPIN:case BV_TOC_ENTRY:case BV_SELECT:case BV_LMS_TASK:if(Notes.Editor.Visible()){Notes.Editor.Hide();}Notes.Viewer.Hide();break;case BV_LINK:LinksEditor_Hide();LinksViewer_Hide();break;}MarkersList_SetMarkerState(BV_oBubbledMarker.nMarkerID,false);BV_HideMarkerFrame();if(!a){BV_bInBubbleEditMode=false;BV_bMarkerSelected=false;BV_oBubbledMarker=null;}}}function BV_ShowMarkerBubbleInViewMode(a){BV_bInNewMarkerState=false;BV_bInBubbleEditMode=false;BV_ShowMarkerBubble("BV_ShowMarkerBubbleInViewMode",BV_GetMarkerByID(a),true,false);}function BV_ShowMarkerBubbleInEditMode(a){BV_bInNewMarkerState=(a==BV_TEMPORARY_MARKER_ID);BV_bInBubbleEditMode=!BV_bInNewMarkerState;BV_ShowMarkerBubble("BV_ShowMarkerBubbleInEditMode",BV_GetMarkerByID(a),true,true);}function BV_ShowMarkerBubble(g,f,e,a){if(f==null){return;}if(!f.bEditable&&f.sTitle==""&&f.sText==""&&f.sType!=BV_LMS_TASK){BV_SetMarkerBackgroundImage_Default(f);return;}if(BV_oBubbledMarker!=f&&BV_bMarkerSelected&&!e){return;}if(BV_oBubbledMarker!=null&&BV_oBubbledMarker==f){return;}WordSelectionMgr_ClearWordSelection();var c=(!a);if(c){BV_HideMarkerBubble("BV_ShowMarkerBubble",true);cet.wall.UnSelectPosts(true);}BV_oBubbledMarker=f;var d=(!BV_bInNewMarkerState&&!BV_bInBubbleEditMode);var b=NotesEditor_bMiniMode;switch(f.sType){case BV_PUSHPIN:case BV_TOC_ENTRY:case BV_SELECT:case BV_LMS_TASK:if(LMS_IsCloned){break;}if(d){if(BV_BOOKWALL_ENABLED){setTimeout(function(h){MarkerPostManager.ShowPost(h,false);},250,f.nMarkerID);}else{Notes.Viewer.Show(f);}}else{if(BV_BOOKWALL_ENABLED){setTimeout(function(h){MarkerPostManager.ShowPost(h,BV_bInNewMarkerState);},250,f.nMarkerID);}else{Notes.Editor.Show(f);}}break;case BV_LINK:if(d){LinksViewer_Show(f);}else{LinksEditor_Show(f);}break;}MarkersList_SetMarkerState(f.nMarkerID,true);if(e){if(BV_bInNewMarkerState==true||BV_bInBubbleEditMode==true){BV_SetMarkerBackgroundImage_Active(f);}else{BV_SetMarkerBackgroundImage_Hover(f);}BV_bMarkerSelected=true;}}function BV_UnHideMarkerBubble(b){var a=BV_oBubbledMarker;if(a==null){AddDebugMessage("BV_oBubbledMarker = null");return;}var c=UTILS_GetMarkerLogicalPos(b);switch(a.sType){case BV_PUSHPIN:case BV_TOC_ENTRY:case BV_SELECT:case BV_LMS_TASK:Notes.Editor.UnHide(a);Notes.Editor.SetNoteLocation(c);MarkersMgr_SetMarkerTemporaryPosition(b);break;case BV_LINK:LinksEditor_Show(a);break;case BV_EMBEDED:BV_ShowSquareMarkerFrame(b);BV_ShowMarkerHandles(b);b.nLeft=c.nLeft;b.nTop=c.nTop;b.nWidth=c.nWidth;b.nHeight=c.nHeight;if(!BV_Embeded_IsInResizeMode){ShowEmbededPopup(b,b.nID);}break;}if(BV_bInNewMarkerState==true||BV_bInBubbleEditMode==true){BV_SetMarkerBackgroundImage_Active(a);}else{BV_SetMarkerBackgroundImage_Hover(a);}BV_bMarkerSelected=true;}function CloseOtherElements(a){if(a!="toolbarsubmenu"&&Toolbar_AutoHide){}if(a!="multimedia"){}}

/** ========== kotarapp\viewer\js\postload\wordselection\copytoclipboard.js ========== **/
var markerTools_left={};var markerTools_top={};var markerTools_extraclass={};var markerTools_pageid={};var textToCopy={};function CopyToClipboard_SetText(c,g,a){if(WordsMgr_PageWords_bLoaded[BV_nSelectionPage]){if(!isValidElement(WordsMgr_PageWords,BV_nSelectionPage)||!isValidElement(WordsMgr_PageWords[BV_nSelectionPage],firstMakedWordIdx)||!isValidElement(WordsMgr_PageWords[BV_nSelectionPage],lastMarkedWordIdx)){return;}var d=BookPageState_GetPageID(BV_nSelectionPage);var b=WordsMgr_PageWords[BV_nSelectionPage][firstMakedWordIdx].nOrder;var h=WordsMgr_PageWords[BV_nSelectionPage][lastMarkedWordIdx].nOrder;if(b>h){var f=b;b=h;h=f;}var e=[];e.push({name:"nPageID",value:d});e.push({name:"nFromOrder",value:b});e.push({name:"nToOrder",value:h});e.push({name:"bIsHTML",value:!(ClipboardAccessMethod()>0)});markerTools_left=c;markerTools_top=g;markerTools_extraclass=a;markerTools_pageid=BV_nSelectionPage;callAppKotarCommandNoSession("Pages.GetPageTextRange",e,{onSuccessFunction:openMarkedWordsMenu_onComplete,onFailureFunction:CopyToClipboard_SetText_OnError},false);}else{ShowAjaxNotification(TXT_ErrorCopyingSelection);}}function openMarkedWordsMenu_onComplete(a){textToCopy=a;BV_OpenMarkedWordsMenu(markerTools_pageid,markerTools_left,markerTools_top,markerTools_extraclass);}function CopyToClipboard_OnClick(){var g=textToCopy;switch(ClipboardAccessMethod()){case 1:var a=CopyToClipboard_GetBibliography(true);var c=g+"\r\n"+a;clipboardData.setData("Text",c);ShowAjaxNotification(TXT_ContentCopyCompleted);break;case 2:document.designMode="on";var a=CopyToClipboard_GetBibliography(true);var h=document.createElement("div");h.innerText=g+"\r\n"+a;h.contentEditable=true;document.body.appendChild(h);var d=document.createRange();d.selectNode(h);var e=window.getSelection();if(e.rangeCount>0){e.removeAllRanges();}e.addRange(d);if(!e.rangeCount){WordEelectionMgr_PopManualCopy(g);}else{try{var f=document.execCommand("copy");if(f===true){ShowAjaxNotification(TXT_ContentCopyCompleted);}else{ShowAjaxNotification(TXT_ErrorCopyingSelection);}}catch(b){}e.removeAllRanges();}document.body.removeChild(h);document.designMode="off";break;default:WordEelectionMgr_PopManualCopy(g);}WordSelectionMgr_ClearWordSelection();}function CopyToClipboard_SetText_OnError(){ShowAjaxNotification(TXT_ErrorCopyingSelection);WordSelectionMgr_ClearWordSelection();}function CopyToClipboard_FlashError(){ShowAjaxNotification(TXT_ErrorNoFlash,5000);WordSelectionMgr_ClearWordSelection();}function CopyToClipboard_FlashNotLoaded(){ShowAjaxNotification(TXT_ErrorFlashNotLoaded,5000);WordSelectionMgr_ClearWordSelection();}function CopyToClipboard_GetBibliography(a){var b=BookBibliography.Get()+"<b>"+TXT_PageLabel+": </b>"+BookPageState_GetPageLabel(BV_nSelectionPage);if(a){b=b.replace(/<br\/>/gi,"\r\n");b=b.replace(/<\/?[^>]+(>|$)/g,"");}return b;}function WordEelectionMgr_PopManualCopy(d){var a=CopyToClipboard_GetBibliography(false);var c=d+"<br />"+a;var b=UTILS_CreateElement("div");NewCopyContainer();b.innerHTML=c;oCopyContainer.appendChild(b);ShowManualCopyToClipboardPopup();}

/** ========== kotarapp\viewer\js\postload\wordselection\dictionarymanager.js ========== **/
var DictionaryManager=DictionaryManager||{};(function(m){var a="<div id='dicfail'>    </div>";var n="http://promo.morfix.co.il/Campings/Ravmilim-cet-2014/ravmilimPrivl.html";function q(t){kmobj.KotarMultmideaDoAction({at:$("#dialog"),type:"html",html:"<div id='dictionarymain' class='preloading'></div>",title:""});b();AddUsageLog("WordsSelection.ShowDictionary");}function b(){if(!isValidElement(WordsMgr_PageWords,BV_nSelectionPage)||!isValidElement(WordsMgr_PageWords[BV_nSelectionPage],firstMakedWordIdx)||!isValidElement(WordsMgr_PageWords[BV_nSelectionPage],lastMarkedWordIdx)){return;}var u=BookPageState_GetPageID(BV_nSelectionPage);var t=WordsMgr_PageWords[BV_nSelectionPage][firstMakedWordIdx].nOrder;var x=WordsMgr_PageWords[BV_nSelectionPage][lastMarkedWordIdx].nOrder;if(t>x){var w=t;t=x;x=w;}var v=[];v.push({name:"nPageID",value:u});v.push({name:"nFromOrder",value:t});v.push({name:"nToOrder",value:x});callAppKotarCommandNoSession("Pages.GetPageTextRange",v,{onSuccessFunction:c,onFailureFunction:d});}function c(u){p();var t=document.getElementById("dictionarymain");t.classList.remove("preloading");t.innerHTML=k(u);i(u);}function p(){if(is_mobile){var t=document.getElementById("dictionarymain");var u=document.getElementById("kotaruidialog");t.classList.remove("preloading");t.style.width="100%";u.style.width="100%";u.style.left="0px";}}function k(u){var t=[];t.push('<div class="dictab ravmilim selected"><span>  </span></div>','<div class="dicbody">','<div class="content preloading"></div>',"<div id='linkto'>",TXT_Ravmilim," <a href='",n,"' target='_blank'> </a></div>",h(u),"</div>");return t.join("");}function f(u){var t=[];t.push('<div class="dictab ravmilim" onclick="DictionaryManager.FetchSeletionFromBookSuccess(\'',u,"')\"><span>  </span></div>",'<div class="dictab lingualy selected"><span>Your personal vocab!</span></div>','<div class="dicbody">','<div class="content">','<iframe id="lingualy" src="https://lingua.ly/cet/?tr=content&q=',encodeURI(u),"&tl=en&i=",g(),'" frameborder="0" scrolling="no" seamless="seamless"></iframe>',"</div>",h(u),"</div>");return t.join("");}function h(v){var u=[];var t=encodeURI(v);u.push('<div class="moresearch">','<span> <b>"',l(v),'"</b>  - ','<a href="https://www.google.com/search?q=',t,'" target="_blank" onclick="AddUsageLog(\'WordsSelection.ShowGoogle\');"><img src="/KotarApp/Resources/Images/Search/googleImg_l.png" alt="Google" /></a>','<a href="https://www.wikipedia.org/search-redirect.php?family=wikipedia&search=',t,"&language=",BV_LanguageCode,'" target="_blank" onclick="AddUsageLog(\'WordsSelection.ShowWikipedia\');"><img src="/KotarApp/Resources/Images/Search/wikiImg_l.png" alt="Wikipedia" /></a>',"</span></div>");return u.join("");}function l(u){var t=u;if(u.length>25){t=u.substr(0,21)+"...";}return t;}function o(t){var u=t.split("<br />");return u[0].replace(/[`~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]|[0-9]/gi," ");}function i(u){var t=[];t.push({name:"term",value:o(u)});callAppKotarCommandNoSession("Dictionary.Ravmilim",t,{onSuccessFunction:j,onFailureFunction:d});}function j(v){var u=e(v.isheb,s(v.result));var t=document.querySelectorAll("#dictionarymain .content")[0];t.classList.remove("preloading");t.innerHTML=u;}function e(v,w){var u=[];u.push("<div id='ravmilim' ",(v?"":"class='en'"),"><a href='",n,"' target='_blank'><div id='ravlogo'></div></a>");if(w&&w.ResultType==="Match"){var x=[];x.push("{{#Words}}<div class='word'><div class='entry'><span class='term'>{{InputWordEntry}}</span><span class='partofspeech'>{{PartOfSpeech}}</span></div>","<div class='explain'>{{{Explain}}}</div>","<div class='translation'>{{Translation}}</div></div>{{/Words}}");var t=Mustache.render(x.join(""),w);u.push(t);}else{u.push(a);}u.push("<div style='width: 100%; height: 1px;'></div>");u.push("</div>");return u.join("");}function d(){var u=document.querySelectorAll("#dictionarymain .content")[0];if(u){u.classList.remove("preloading");u.innerHTML=a;}else{var t=document.getElementById("dictionarymain");if(t){t.classList.remove("preloading");t.innerHTML=a;}}}function s(v){var u="";try{u=JSON.parse(v);}catch(t){u="";}return u;}function r(u){var t=document.getElementById("dictionarymain");t.classList.remove("preloading");t.innerHTML=f(u);AddUsageLog("WordsSelection.ShowLingualy");}function g(){var t="0";if(BaseMaster_bUserIsLoggedIn){t=CryptoJS.MD5(BaseMaster_gUserID).toString();}return t;}m.ShowDictionarySearch=q;m.ShowLingualy=r;m.FetchSeletionFromBookSuccess=c;})(DictionaryManager);

/** ========== kotarapp\viewer\js\postload\wordselection\list.js ========== **/
function WordsSelectList_RenderRow(f,e,a,d){var b=[];if(f.Title.length>Toolbar.BookLayers.MaxTitleLength){f.Title=f.Title.substring(0,Toolbar.BookLayers.MaxTitleLength)+" ...";}var c=WordsSelectList_GetImageName(f);b.push("<div class='layerrow'  onclick='WordSelectionMgr_ListOnClick(",e,", ",f.ID,")'><div class='layericon ",c,"'/><div class='layerinfo'>",f.Title,"</div></div>");return b.join("");}function WordsSelectList_GetImageName(b){var a=b.IsUnderline?"under":"marker";if(b.Color>1){a+="_"+b.Color;}return a;}

/** ========== kotarapp\viewer\js\postload\wordselection\manager.js ========== **/
function WordsSelectionMgr_LoadBookWordsSelection(){var a=new Array({name:"nBookID",value:BV_nBookID});callAppKotarCommand("bookwordsselections.getbookwordsselection",a,{onSuccessFunction:LoadBookWordsSelection_OnComplete,onFailureFunction:LoadBookWordsSelection_OnError},false);}function LoadBookWordsSelection_OnComplete(e){WordsMgr_PageSelections=new Array();var c=/-?\d+/;for(var a=0;a<e.length;a++){var d=e[a];var b=BookPageState_GetPageIndex(d.PageID);if(WordsMgr_PageSelections[b]===undefined){WordsMgr_PageSelections[b]=new Array();WordSelectionMgr_RenderedPages[b]=false;WordsMgr_LoadPageWords(b);}WordsMgr_PageSelections[b].push({ID:d.ID,BookID:d.BookID,FromWordOrder:d.FromWordOrder,ToWordOrder:d.ToWordOrder,Color:d.Color,sUpdateDate:d.sUpdateDate,Title:d.Title,IsUnderline:d.Type!==1,dtUpdateDate:new Date(parseInt(c.exec(d.UpdateDate)[0])),Body:d.Body});}WordSelectionMgr_bLoaded=true;}function LoadBookWordsSelection_OnError(){}function WordSelectionMgr_OnBookLayoutModification(){WordSelectionMgr_ClearAllSelection();}function WordSelectionMgr_ClearAllSelection(){for(var a=0;a<BV_nTotalPages;a++){WordSelectionMgr_RenderedPages[a]=false;}$(".Markedwords").remove();}function WordSelectionMgr_ClearAllSelectionInView(a,d){for(var b=0;b<BV_nTotalPages;b++){if(WordSelectionMgr_RenderedPages[b]){WordSelectionMgr_RenderedPages[b]=false;var c=$("#BV_oPage_"+b);if(b>=a&&b<=d){$("#BV_oPage_"+b+" > .Markedwords").fadeOut(150,function(){$(this).remove();});}else{$("#BV_oPage_"+b+" > .Markedwords").remove();}}}}function WordSelectionMgr_RenderPageMarkers(b){if(!BaseMaster_bUserIsLoggedIn){return;}if(WordSelectionMgr_bLoaded&&WordsMgr_PageWords_bLoaded[b]){if(WordSelectionMgr_RenderedPages[b]===undefined||WordSelectionMgr_RenderedPages[b]===false){var c=WordsMgr_PageSelections[b];if(c){for(var a=0;a<c.length;a++){WordSelectionMgr_DrawSelection(b,c[a]);}}}}else{WordSelectionMgr_LoadRetries++;if(WordSelectionMgr_LoadRetries<40){setTimeout(function(){WordSelectionMgr_RenderPageMarkers(b);},500);}}}function WordSelectionMgr_DrawSelection(h,i){var b,e;var d=WordsMgr_GetWordIdxByOrder(h,i.FromWordOrder);var g=WordsMgr_GetWordIdxByOrder(h,i.ToWordOrder);var c=WordsMgr_GetNormalizedBookWord(h,d);var f=WordsMgr_GetNormalizedBookWord(h,g);var a=(i.IsUnderline?"UnderlineWordsColor":"MarkedWordsColor")+i.Color;if(c!=null&&f!=null){WordSelectionMgr_RenderedPages[h]=true;b=[c.nLeft,c.nTop,c.nWidth,c.nHeight];e=[f.nLeft,f.nTop,f.nWidth,f.nHeight];BV_DrawSelectedWords(h,b,e,d,g,a);setTimeout(function(){$(".Markedwords").removeClass("load");},10);}}function WordsSelectionMgr_AddOrUpdate(c,a,f){c.preventDefault();var i=WordsMgr_PageWords[BV_nSelectionPage];if(i==null||firstMakedWordIdx>=i.Length||i[firstMakedWordIdx]==null||lastMarkedWordIdx>=i.Length||i[lastMarkedWordIdx]==null){return;}var d=i[firstMakedWordIdx].nOrder;var k=i[lastMarkedWordIdx].nOrder;if(d>k){var j=d;d=k;k=j;}var g=BookPageState_GetPageID(BV_nSelectionPage);var b=WordSelectionMgr_CheckForOtherSelections(BV_nSelectionPage,d,k,f);DrawTempSelection(BV_nSelectionPage,b,f,a);var h=new Array({name:"nBookID",value:BV_nBookID},{name:"PageID",value:g},{name:"FromWordOrder",value:b.from},{name:"ToWordOrder",value:b.to},{name:"Color",value:a},{name:"ToDelete",value:b.ids},{name:"IsUnderline",value:f});callAppKotarCommand("bookwordsselections.addbookwordsselection",h,{onSuccessFunction:AddWordsSelection_OnComplete,onFailureFunction:AddWordsSelection_OnError,params:h},false);}function DrawTempSelection(i,g,h,a){WordSelectionMgr_ClearWordSelection();if(WordsMgr_PageSelections[i]===undefined){WordsMgr_PageSelections[i]=new Array();}if(g.ids.length>0){WordSelectionMgr_RemoveSelectionsFromList(g.ids,i);}var f=new Date();var b=f.getDate();var c=f.getMonth();c++;var e=f.getFullYear();WordsMgr_PageSelections[i].push({ID:BV_TEMPORARY_SELECTION_ID,BookID:BV_nBookID,FromWordOrder:g.from,ToWordOrder:g.to,Color:a,sUpdateDate:(b+"/"+c+"/"+e),Title:"",IsUnderline:h,Body:""});WordSelectionMgr_ReRenderPageMarkers(i);BV_SetActiveTool(BV_DEFAULTTOOL);}function AddWordsSelection_OnComplete(d,a){var c=BookPageState_GetPageIndex(a.params[1].value);for(var b=0;b<WordsMgr_PageSelections[c].length;b++){var e=WordsMgr_PageSelections[c][b];if(e.ID===BV_TEMPORARY_SELECTION_ID){e.ID=d.ID;e.sUpdateDate=d.sUpdateDate;e.Title=d.Title;e.Body=d.Body;}}MarkersList_Render(true);}function AddWordsSelection_OnError(){WordSelectionMgr_ClearWordSelection();var b=BookPageState_GetPageID(BV_nSelectionPage);var d=WordsMgr_PageSelections[b];if(d!=undefined&&d.length>0){for(var a=0;a<WordsMgr_PageSelections[b].length;a++){var c=WordsMgr_PageSelections[b][a];if(c.ID===BV_TEMPORARY_SELECTION_ID){WordsMgr_PageSelections[b].splice(a,1);}}}ShowAjaxMessageBox(TXT_ServerError);}function WordSelectionMgr_CheckForOtherSelections(h,a,m,d){var n=false;var l=[];var f=a;var g=m;if(WordsMgr_PageSelections[h]!==undefined&&WordsMgr_PageSelections[h].length>0){var k=WordsMgr_PageSelections[h];for(var e=0;e<k.length;e++){n=false;var i=k[e];if(i.IsUnderline===d){var b=a>=i.FromWordOrder&&a<=i.ToWordOrder;var c=m>=i.FromWordOrder&&m<=i.ToWordOrder;if(b){l.push(i.ID);n=true;}else{if(c){l.push(i.ID);n=true;}else{if(a<i.FromWordOrder&&m>i.FromWordOrder){l.push(i.ID);n=true;}}}if(n){if(i.FromWordOrder<f){f=i.FromWordOrder;}if(i.ToWordOrder>g){g=i.ToWordOrder;}}}}}return{ids:l.join(";"),from:f,to:g};}function WordSelectionMgr_ReRenderPageMarkers(a){$("#BV_oPage_"+a+" .Markedwords").remove();WordSelectionMgr_RenderedPages[a]=false;WordSelectionMgr_RenderPageMarkers(a);}var WordSelectionMgr_MenuVisible=false;function WordSelectionMgr_ClearWordSelection(){WordSelectionMgr_MenuVisible=false;$(".wordSelectionMenuWrapper").remove();$(".currentMarkedwords").remove();}function WordSelectionMgr_DeleteWordSelection(c){if(!isValidElement(WordsMgr_PageWords,BV_nSelectionPage)||!isValidElement(WordsMgr_PageWords[BV_nSelectionPage],firstMakedWordIdx)||!isValidElement(WordsMgr_PageWords[BV_nSelectionPage],lastMarkedWordIdx)){return;}var b=WordsMgr_PageWords[BV_nSelectionPage][firstMakedWordIdx].nOrder;var e=WordsMgr_PageWords[BV_nSelectionPage][lastMarkedWordIdx].nOrder;var a=WordSelectionMgr_CheckForOtherSelections(BV_nSelectionPage,b,e,c);var d=new Array({name:"ToDelete",value:a.ids},{name:"PageIdx",value:BV_nSelectionPage});callAppKotarCommand("bookwordsselections.deletebookwordsselection",d,{onSuccessFunction:DeleteWordSelection_OnComplete,onFailureFunction:DeleteWordSelection_OnError,params:d},false);}function WordSelectionMgr_DeleteWordSelectionByID(a,b){var c=new Array({name:"ToDelete",value:a.toString()},{name:"PageIdx",value:b});callAppKotarCommand("bookwordsselections.deletebookwordsselection",c,{onSuccessFunction:DeleteWordSelection_OnComplete,onFailureFunction:DeleteWordSelection_OnError,params:c},false);}function DeleteWordSelection_OnComplete(c,a){WordSelectionMgr_ClearWordSelection();var d=a.params[0].value;var b=a.params[1].value;if(d.length>0){WordSelectionMgr_RemoveSelectionsFromList(d,b);}WordSelectionMgr_ReRenderPageMarkers(b);BV_SetActiveTool(BV_DEFAULTTOOL);cet.wall.DeletePost(Number(d));MarkersList_Render(true);}function DeleteWordSelection_OnError(){}function WordSelectionMgr_RemoveSelectionsFromList(e,c){var b=e.split(";");for(var a=WordsMgr_PageSelections[c].length-1;a>=0;a--){var d=WordsMgr_PageSelections[c][a];if(b.indexOf(d.ID.toString())>=0){WordsMgr_PageSelections[c].splice(a,1);}}}function WordSelectionMgr_ListOnClick(f,d){if(!Toolbar.SubMenu.scrolled){var e=0;if(WordSelectionMgr_bLoaded){var g=WordsMgr_PageSelections[f];for(var c=0;c<g.length;c++){var h=g[c];if(h.ID===d){var b=WordsMgr_GetWordIdxByOrder(f,h.FromWordOrder);var a=WordsMgr_GetNormalizedBookWord(f,b);e=a.nTop*3;break;}}}BV_GotoPage(f+1,e);}}function WordSelectionMgr_ExpandWordSelectionMenu(c){var b=$(".wordSelectionMenuWrapper .secondfloor");var d=b.length>0;b.remove();$wordSelectionMenu=$(".wordSelectionMenuWrapper");$wordSelectionMenu.find(".selected").removeClass("selected");$wordSelectionMenu.addClass("expanded");$(c).addClass("selected");var e=UTILS_CreateElement("DIV");e.className="secondfloor";var a=$(e);if($wordSelectionMenu.hasClass("flipdown")){$wordSelectionMenu.append(e);}else{$wordSelectionMenu.prepend(e);if(!d){$wordSelectionMenu.css("top","-=40");}}}function WordSelectionMgr_ShowMarkerColorMenu(c,d){if(BaseMaster_bUserIsLoggedIn){WordSelectionMgr_ExpandWordSelectionMenu(c);var a=$(".wordSelectionMenuWrapper .secondfloor");var e=UTILS_CreateElement("DIV");e.className="wordSelectionMenuSecondFloor wordSelectionColor1";$(e).on("click touchend",function(j){WordsSelectionMgr_AddOrUpdate(j,1,d);return false;});a.append(e);var f=UTILS_CreateElement("DIV");f.className="wordSelectionMenuSecondFloor wordSelectionColor2";$(f).on("click touchend",function(j){WordsSelectionMgr_AddOrUpdate(j,2,d);return false;});a.append(f);var g=UTILS_CreateElement("DIV");g.className="wordSelectionMenuSecondFloor wordSelectionColor3";$(g).on("click touchend",function(j){WordsSelectionMgr_AddOrUpdate(j,3,d);return false;});a.append(g);var h=UTILS_CreateElement("DIV");h.className="wordSelectionMenuSecondFloor wordSelectionColor4";$(h).on("click touchend",function(j){WordsSelectionMgr_AddOrUpdate(j,4,d);return false;});a.append(h);var i=UTILS_CreateElement("DIV");i.className="wordSelectionMenuSecondFloor wordSelectionErase";$(i).on("click touchend",function(j){j.preventDefault();WordSelectionMgr_DeleteWordSelection(d);return false;});a.append(i);var b=UTILS_CreateElement("DIV");b.className="clearboth";a.append(b);}else{OpenSmartTouchLoginPage("OnClickSelectMode");}}function WordSelectionMgr_ShowSearchMenu(c){WordSelectionMgr_ExpandWordSelectionMenu(c);var a=$(".wordSelectionMenuWrapper .secondfloor");var e=UTILS_CreateElement("DIV");e.className="searchSelectionMenuSecondFloor searchGoogle";$(e).bind("click touchend",function(f){WordsSelectionMgr_Search(f,"google");return false;});a.append(e);var d=UTILS_CreateElement("DIV");d.className="searchSelectionMenuSecondFloor seachWiki";$(d).bind("click touchend",function(f){WordsSelectionMgr_Search(f,"wiki");return false;});a.append(d);var b=UTILS_CreateElement("DIV");b.className="clearboth";a.append(b);}function WordsSelectionMgr_Search(a,f){a.preventDefault();if(!isValidElement(WordsMgr_PageWords,BV_nSelectionPage)||!isValidElement(WordsMgr_PageWords[BV_nSelectionPage],firstMakedWordIdx)||!isValidElement(WordsMgr_PageWords[BV_nSelectionPage],lastMarkedWordIdx)){return;}var c=BookPageState_GetPageID(BV_nSelectionPage);var b=WordsMgr_PageWords[BV_nSelectionPage][firstMakedWordIdx].nOrder;var h=WordsMgr_PageWords[BV_nSelectionPage][lastMarkedWordIdx].nOrder;if(b>h){var g=b;b=h;h=g;}var d=[];d.push({name:"nPageID",value:c});d.push({name:"nFromOrder",value:b});d.push({name:"nToOrder",value:h});d.push({name:"site",value:f});callAppKotarCommandNoSession("Pages.GetPageTextRange",d,{onSuccessFunction:WordsSelectionMgr_Search_OnComplete,onFailureFunction:WordsSelectionMgr_Search_OnError,params:d},false,false);}function WordsSelectionMgr_Search_OnComplete(d,a){var c=a.params[3].value;var b=encodeURI(d);var e="";if(c==="google"){e="https://www.google.com/search?q="+b;}else{if(c==="wiki"){e="https://www.wikipedia.org/search-redirect.php?family=wikipedia&search="+b+"&language="+BV_LanguageCode;}}window.open(e);WordSelectionMgr_ClearWordSelection();}function WordsSelectionMgr_Search_OnError(){WordSelectionMgr_ClearWordSelection();}function WordsSelectionMgr_GetByID(c){var a=false;var e=null;for(var b=0;b<BV_nTotalPages&&!a;b++){if(WordsMgr_PageSelections[b]!==undefined){for(var d=0;d<WordsMgr_PageSelections[b].length&&!a;d++){if(WordsMgr_PageSelections[b][d].ID===c){a=true;e=WordsMgr_PageSelections[b][d];}}}}return e;}function WordsSelectionMgr_UpdateSelection(c){var b=c.pagenum;for(var a=0;a<WordsMgr_PageSelections[b].length;a++){var d=WordsMgr_PageSelections[b][a];if(d.ID===c.id){d.sUpdateDate=c.sUpdateDate;d.Title=c.title;d.Body=c.content;}}}function WordsSelectionMgr_ReRender(){WordSelectionMgr_ClearAllSelection();for(var a=0;a<BV_nTotalPages;a++){WordSelectionMgr_RenderPageMarkers(a);}}

/** ========== kotarapp\viewer\js\postload\windows\newnote\audiences.js ========== **/
var Notes=Notes||{};Notes.audiences={};Notes.audiences.sharingLevels=[];var audiencesenum={EveryoneEnriching:0,Everyone:1,Private:2,Teachers:3,Students:4,MySchoolTeachers:5};(function(a){function g(){c();}function f(k){var l=new Array();for(var h=0;h<Notes.audiences.sharingLevels.length;h++){var j=Notes.audiences.sharingLevels[h];if(j.sExtensionType==k){l.push(j);}}return l;}function b(h){switch(h){case audiencesenum.EveryoneEnriching:return"public";case audiencesenum.Everyone:return"social";case audiencesenum.Private:return"private";case audiencesenum.Teachers:return"teachers";case audiencesenum.Students:return"students";case audiencesenum.MySchoolTeachers:return"mySchoolTeachers";default:return"private";}}function c(){var h=new Array({name:"nBookID",value:BV_nBookID});callAppKotarCommand("bookextensions.getsharinglevels",h,{onSuccessFunction:e,onFailureFunction:d},false);}function e(h){Notes.audiences.sharingLevels=h;}function d(){}a.Init=g;a.GetSharingLevelsByType=f;a.GetSharingLevel=b;})(Notes.audiences);

/** ========== kotarapp\viewer\js\postload\windows\newnote\editor.js ========== **/
jqEditorContainer=$("#BV_oNotesEditor");var Notes=Notes||{};Notes.Editor={};Notes.Editor.HTML="";(function(h){var z="BV_oNotesEditor";var w=528;var r=343;var s=450;var l=152;var m=14;var p=500;var q=0;var v=516;var t=40;function n(){if(Notes.Editor.HTML==""){var J=[];J.push("<div id='",z,"' style='width:",w,"px;height:",r,"px;position:",(is_IOS?"absolute":"fixed"),";display:none'>");J.push("<div id='noteHeader' class='theme-background-color'>");J.push("<div id='noteClose' title='",TXT_Close,"'></div>");J.push("<div id='noteButtons' class='note-buttons-background-color'>");J.push("</div>");J.push("<div id='noteIcon'></div>");J.push("</div>");J.push("<div id='noteBody' class='editmode'>");J.push("<div id='noteContent' style='height:",r-t-(m*2),"px'>");J.push("<iframe id='NotesEditor_RichTextIFrame' width='1px' height='1px' frameborder='0' scrolling='no' style='position: relative;'></iframe>");J.push("<div id='pleasewait' style='width:",w-(m*2),"px;height:",l,"px;top:98px;'>");J.push("<div id='waittext'>",TXT_PleaseWait,"</div>");J.push("</div>");J.push("</div>");J.push("</div>");J.push("</div>");Notes.Editor.HTML=J;}$(document.body).append(Notes.Editor.HTML.join(""));a();B();}function k(){if(is_IOS){b();}H();if(BV_oBubbledMarker!=null){EndMarkerDraggable(BV_GetMarkerByID(BV_oBubbledMarker.nMarkerID));}var J=document.getElementById(z);if(J){document.body.removeChild(J);}}function G(J){jqEditorContainer.show();Notes.Utils.AdjustPosition(J,EditorContainer,NotesEditor_nWidth,NotesEditor_nCurrentWindowHeight,true,is_IOS);BV_ShowResizableMarkerFrame(J);}function E(K){n();CloseOtherElements("note");var J=document.getElementById(z);J.style.display="";Notes.Utils.AdjustPosition(K,J,w,r,true,is_IOS);var L=document.getElementById("NotesEditor_RichTextIFrame");L.style.height=(r-t-(m*2)+4)+"px";L.style.width="100%";document.getElementById("noteIcon").className="simplyNote";if(document.getElementById("noteTitle")){document.getElementById("noteTitle").innerHTML=j(K.sTitle);}H();if(q>0){window.clearTimeout(q);}A(K);if(is_mobile){Toolbar.Remove();}q=window.setTimeout(function(){o(K);},p);}function B(){var J=$("#"+z);J.draggable({scroll:false,containment:"window"});J.draggable({stop:function(K,L){Notes_LastDraggedPosition={left:this.style.left,top:this.style.top};NotesWindowWasDragged=true;}});}function A(J){if((J.sType==BV_PUSHPIN&&J.bEditable)||(J.sType==BV_LMS_TASK&&LMSTasks_HasAdminRole(J))){SetMarkerDraggable(J);}}function a(){document.getElementById(z).addEventListener("click",function(J){PreventBookClick=true;});document.getElementById("noteClose").addEventListener("click",function(J){Notes.Utils.Close(J);});}function o(J){NotesEditor_IFrame=getElement("NotesEditor_RichTextIFrame");NotesEditor_IFrame.style.visibility="visible";if(BV_oBubbledMarker!=null&&BV_oBubbledMarker.nMarkerID==J.nMarkerID){var K=UTILS_GetMarkerLogicalPos(J);NotesEditor_IFrame.src="/KotarApp/Viewer/RichTextEditor.aspx?nIFrameWidth="+u(w)+"&nIFrameHeight="+r+"&nRichTextWidth="+v+"&bSimple=false&nMarkerID="+J.nMarkerID+"&gUserID="+BaseMaster_gUserID+"&bChangedMode=false&nBookID="+BV_nBookID+"&nPageID="+J.nPageID+"&nTop="+K.nTop+"&nLeft="+K.nLeft+"&nWidth="+K.nWidth+"&nHeight="+K.nHeight+"&nSelectionType="+GetSelectionType(BV_SelectionColor)+"&sType="+J.sType;}}function i(){getElement("pleasewait").style.display="none";}function H(){getElement("pleasewait").style.display="";NotesEditor_IFrame=getElement("NotesEditor_RichTextIFrame");if(NotesEditor_IFrame){NotesEditor_IFrame.style.visibility="hidden";NotesEditor_IFrame.src="about:blank";}}function j(J){if(J.length>Toolbar.BookLayers.MaxTitleLength){J=J.substring(0,Toolbar.BookLayers.MaxTitleLength)+" ...";}return J;}function e(J){$("#BV_oNotesEditor").css("height",$("#BV_oNotesEditor").height()+J+"px");$("#noteContent").css("height",$("#noteContent").height()+J+"px");$("#NotesEditor_RichTextIFrame").css("height",$("#NotesEditor_RichTextIFrame").height()+J+"px");}var c=0;function b(K){var J=document.getElementById("ios7focus");J.style.top=document.getElementById(z).offsetTop+"px";J.style.left=document.getElementById(z).offsetLeft+"px";if(c>0){clearTimeout(c);}if(K){c=setTimeout(function(){J.focus();J.blur();},10);}else{J.focus();J.blur();}}function I(){var K=false;var J=document.getElementById(z);if(J){K=true;}return K;}function f(K,J){if(K!=null){document.getElementById(z).style.top=K+"px";}if(J!=null){document.getElementById(z).style.left=J+"px";}}function u(J){return(J-25);}function C(J){NotesEditor_IFrame.contentWindow.SetMarkerLocation(J.nTop,J.nLeft,J.nWidth,J.nHeight);}function F(J){var K=BV_oBubbledMarker;K.bIsPublished=false;MarkersMgr_SetMarkerInfo(K,false);}function x(K,P,O,N,J,L){var M=y(K,P,O,N,J,L);MarkersMgr_SetIsBeingEdited(K,false);BV_ClearRestorePoint();BV_bInBubbleEditMode=false;BV_bMarkerSelected=false;BV_bInNewMarkerState=false;BV_SetMarkerBackgroundImage_Hover(BV_oBubbledMarker);k();Notes.Viewer.Show(BV_oBubbledMarker);}function y(L,Q,P,O,K,M){BV_nTemporaryMarkerID=0;BV_oBubbledMarker.sTitle=Q;BV_oBubbledMarker.sText=P;BV_oBubbledMarker.sSubType=O;BV_oBubbledMarker.bIsPublished=(K==BV_AUDIENCE_EVERYONE_ELSE);BV_oBubbledMarker.nAudience=K;BV_oBubbledMarker.nOrder=M;var N=BV_oBubbledMarker;var J=(N.nMarkerID==BV_TEMPORARY_MARKER_ID);if(J){N.name="BV_oMarker_"+L;N.nMarkerID=L;BV_ShowMarkerActionFeedback(TXT_Saved,TXT_fSaved);}N.bModified=false;MarkersMgr_SetMarkerInfo(N,J);return N;}function d(){openNote=null;BV_bInBubbleEditMode=false;BV_bBookAutoScrolledToAccommodateNoteWindow=false;var J=BV_oBubbledMarker.nMarkerID;if(J==BV_nTemporaryMarkerID){BV_DeleteTemporaryMarker();BV_bInNewMarkerState=false;}else{BV_bMarkerSelected=false;var K=BV_oBubbledMarker;MarkersMgr_SetIsBeingEdited(K.nMarkerID,false);BV_RestoreMarkerProperties(true,"Cancel_OnClick");}MarkersMgr_SetIsBeingEdited(J,false);BV_HideMarkerBubble("Notes.Editor.Cancel",false);BV_oBubbledMarker=null;window.focus();}function g(){BV_DeleteMarker(BV_oBubbledMarker);}function D(J){BV_bInNewMarkerState=false;BV_bInBubbleEditMode=true;var K=BV_oBubbledMarker;K.name="BV_oMarker_"+J;K.nMarkerID=J;if(NotesWindowWasDragged&&Notes_nDraggedMarkerWindowID==BV_TEMPORARY_MARKER_ID){Notes_nDraggedMarkerWindowID=J;}MarkersMgr_SetTemporaryMarkerID(K,J);MarkersMgr_SetIsBeingEdited(J,true);MarkersList_SetMarkerState(J,true);}h.BindEvents=a;h.Hide=k;h.Show=E;h.ChangeHeight=e;h.Blur=b;h.Visible=I;h.ChangePosition=f;h.FinishLoad=i;h.UnHide=G;h.SetNoteLocation=C;h.TurnToPrivate=F;h.Save=x;h.Cancel=d;h.Delete=g;h.SetTemporaryMarkerID=D;})(Notes.Editor);

/** ========== kotarapp\viewer\js\postload\windows\newnote\projects.js ========== **/
var Notes=Notes||{};Notes.projects={};Notes.projects.folders=[];(function(e){function d(){a();}function a(){callAppKotarCommand("projects.getuserprojects",null,{onSuccessFunction:c,onFailureFunction:b},false);}function c(f){Notes.projects.folders=f;}function b(){}e.Init=d;})(Notes.projects);

/** ========== kotarapp\viewer\js\postload\windows\newnote\utils.js ========== **/
var Notes=Notes||{};Notes.Utils={};(function(f){function a(u,w,s,l,g,k){if(e()){d(w);return;}if(NotesWindowWasDragged){d(w);return;}k=k||false;var v=BV_GetPageWrapperElement(u.nPageIndex);var t=BV_GetPageImageElement(u.nPageIndex);var r=BookScroll.ScrollTop();var p=BV_GetPagesPosDelta();var q=(r-BV_nFirstPagePos)-(u.nPageIndex*p);var n=BV_BookWrraper.offsetTop+u.offsetTop+(q*(-1));var m=u.offsetLeft+v.offsetLeft;var j=56;switch(u.sType){case BV_LINK:break;case BV_TOC_ENTRY:case BV_SELECT:n+=u.offsetHeight+11;m+=(u.offsetWidth/2+(isIE?16:1));break;case BV_PUSHPIN:case BV_LMS_TASK:n+=j;m+=(isRTL()?1:(-1))*(isIE?18:4);break;}m-=(s/3);var h=(typeof(BV_bIsInFullScreenMode)!="undefined"?BV_bIsInFullScreenMode:false);if(m<0){m=0;}else{if(m+s>clientWidth()){m=(clientWidth()-(s+10));}}var o=((n+l)-clientHeight());if(o>0){o=n-l-j;n=o;if(o<0){n=70;m=u.offsetLeft+v.offsetLeft+45;var i=clientWidth()-(s+m);if(i<0){m=m-s-25;}}}if(n<0){n=0;}w.style.left=m+"px";w.style.top=(k?n+r:n)+"px";}function b(g){g.style.left=((window.innerWidth-NotesViewer_nWidth)/2)+"px";g.style.top=((window.innerHeight-NotesViewer_nBasicHeight)/2)+"px";}function e(){if(NotesWindowWasDragged&&Notes_nDraggedMarkerWindowID==BV_oBubbledMarker.nMarkerID){return true;}NotesWindowWasDragged=false;Notes_nDraggedMarkerWindowID=0;}function d(g){g.style.left=Notes_LastDraggedPosition.left;g.style.top=Notes_LastDraggedPosition.top;}function c(g){if(window.event){g=window.event;}if(BV_oBubbledMarker==null&&NotesPreview_BubbledMarkerID==null){return;}if(BV_oBubbledMarker!=null){var h=BV_oBubbledMarker.nMarkerID;if(h==BV_nTemporaryMarkerID){BV_DeleteTemporaryMarker();}if(typeof(LMS_sConvertToHTML)!="undefined"&&LMS_sConvertToHTML!=""){LMS_sConvertTitle="";LMS_sConvertToHTML="";if(typeof(LMS_sConvertJItem)!="undefined"){LMS_sConvertJItem=null;}}MarkersMgr_SetIsBeingEdited(h,false);BV_HideMarkerBubble("Notes.Utils.Close",false);}else{if(NotesPreview_BubbledMarkerID!=null){NotesPreview_BubbledMarkerID=null;Notes.Viewer.Hide();}}g.cancelBubble=true;}f.AdjustPosition=a;f.AdjustPreviewPosition=b;f.Close=c;})(Notes.Utils);

/** ========== kotarapp\viewer\js\postload\windows\newnote\viewer.js ========== **/
var Notes=Notes||{};Notes.Viewer={};Notes.Viewer.HTML="";(function(K){var E="BV_oNotesViewer";var B=528;var v=242;var w=450;var m=152;var n=14;var s=500;var t=0;var x=40;var A=36;var y=0;function o(){if(Notes.Viewer.HTML==""){var L=[];L.push("<div id='",E,"' style='width:",B,"px;height:",v,"px;position:fixed;display:none'>");L.push("<div id='noteHeader' class='theme-background-color'>");L.push("<div id='noteClose' title='",TXT_Close,"'></div>");L.push("<div id='noteButtons' class='note-buttons-background-color'>");L.push("</div>");L.push("<div id='noteIcon'></div>");L.push("</div>");L.push("<div id='noteBody'>");L.push("<div id='noteTitle'>");L.push("</div>");L.push("<div id='noteContent'>");L.push("<iframe id='NotesViewer_RichTextIFrame' width='1px' height='1px' frameborder='0' scrolling='no' style='position: relative;'></iframe>");L.push("<div id='pleasewait' style='width:",B-(n*2),"px;height:",m,"px;top:",x+A,"px;'>");L.push("<div id='waittext'>",TXT_PleaseWait,"</div>");L.push("</div>");L.push("</div>");L.push("</div>");L.push("</div>");Notes.Viewer.HTML=L;}$(document.body).append(Notes.Viewer.HTML.join(""));b();G();}function l(){if(BV_oBubbledMarker!=null){EndMarkerDraggable(BV_GetMarkerByID(BV_oBubbledMarker.nMarkerID));}var L=document.getElementById(E);if(L){D();document.body.removeChild(L);}}function H(L){o();CloseOtherElements("note");var N=document.getElementById(E);N.style.display="";Notes.Utils.AdjustPosition(L,N,B,v,true);var M=document.getElementById("NotesViewer_RichTextIFrame");M.style.height=m+"px";M.style.width="100%";document.getElementById("noteIcon").className="simplyNote";document.getElementById("noteButtons").innerHTML=c(L);a(L);document.getElementById("noteTitle").innerHTML=j(L.sTitle);J();if(t>0){window.clearTimeout(t);}F(L);t=window.setTimeout(function(){r(L.nMarkerID,L.gLinkedItemID);},s);}function C(M,L,O){o();var P=document.getElementById(E);P.style.display="";Notes.Utils.AdjustPreviewPosition(P);var N=document.getElementById("NotesViewer_RichTextIFrame");N.style.height=m+"px";N.style.width="100%";document.getElementById("noteIcon").className="simplyNote";document.getElementById("noteButtons").innerHTML=c(null);a(null);document.getElementById("noteTitle").innerHTML=O;J();if(t>0){window.clearTimeout(t);}t=window.setTimeout(function(){r(M,L);},s);}function c(M){var L=[];if(M!=null){if(p(M)){L.push("<div id='noteEdit' title='",TXT_Edit,"'></div>");}else{if(q(M)){L.push("<div id='deleteShare' title='",TXT_Delete,"'></div>");}}if(BV_CanCloneNote&&!k(M)){L.push("<div id='noteClone' title='",TXT_CLONE,"'></div>");}if(d(M)){L.push("<div id='convertLMS' title='",TXT_ADDTASK,"'></div>");}if(k(M)){L.push("<div id='deleteLMS' title='",TXT_Delete,"'></div>");L.push("<div id='cloneLMS' title='",TXT_CLONE,"'></div>");}L.push("<div id='sendNote' title='",TXT_MAIL,"'></div>");}if(M==null||M.sType!=BV_LMS_TASK){L.push("<div id='magnify' class='zoomin' title='",TXT_ZOOMIN,"'></div>");}return L.join("");}function G(){var L=$("#"+E);L.draggable({scroll:false,containment:"window"});L.draggable({stop:function(M,N){Notes_LastDraggedPosition={left:this.style.left,top:this.style.top};NotesWindowWasDragged=true;}});}function F(L){if((L.sType==BV_PUSHPIN&&L.bEditable)||(L.sType==BV_LMS_TASK&&LMSTasks_HasAdminRole(L))){SetMarkerDraggable(L);}}function u(){var Q=2;var P=500;var X=$("#magnify");var R=$("#NotesViewer_RichTextIFrame").contents();if(X.hasClass("zoomin")){X.removeClass("zoomin").addClass("zoomout");X.prop("title",TXT_ZOOMOUT);}else{Q=1;X.removeClass("zoomout").addClass("zoomin");X.prop("title",TXT_ZOOMIN);}if(R.find("#dvNote")[0]!=null){var U=R.find("#noteHeader");var L=U.css("font-size");var M=parseFloat(L,10);if(X.attr("noteHeaderSize")==null){X.attr("noteHeaderSize",M);}var Y=X.attr("noteHeaderSize")*Q;U.stop().animate({"font-size":Y},P);var W=R.find("#RichTextViewer");L=W.css("font-size");M=parseFloat(L,10);if(X.attr("RichTextViewerSize")==null){X.attr("RichTextViewerSize",M);}Y=X.attr("RichTextViewerSize")*Q;W.stop().animate({"font-size":Y},P);var V=R.find("#noteTitle");var N=V.css("height");var O=parseFloat(N,10);if(X.attr("noteTitleHeight")==null){X.attr("noteTitleHeight",M);}var Z=X.attr("noteTitleHeight")*Q;V.stop().animate({height:Z},P);var T=R.find("#dvTalkbacks");L=T.css("font-size");M=parseFloat(L,10);if(X.attr("dvTalkbacksSize")==null){X.attr("dvTalkbacksSize",M);}Y=X.attr("dvTalkbacksSize")*Q;T.stop().animate({"font-size":Y},P);}else{var S=R.find(".wrapper");var L=S.css("font-size");var M=parseFloat(L,10);if(X.attr("originalSize")==null){X.attr("originalSize",M);}var Y=X.attr("originalSize")*Q;S.stop().animate({"font-size":Y,height:$("#NotesViewer_oBubbleReadOnlyContentBlock").height()},P,function(){$(this).css({overflow:"auto"});});}return false;}function p(M){var L=M.bEditable;if(M.sType==BV_LMS_TASK&&!LMS_IsLMSable){L=false;}return L;}function q(L){if(L.nAudience==BV_AUDIENCE_MYSCHOOL_TEACHERS){return true;}else{return false;}}function d(L){return(L.nAudience==BV_AUDIENCE_EVERYONE_ENRICHED||L.nAudience==BV_AUDIENCE_TEACHERS||L.nAudience==BV_AUDIENCE_MYSCHOOL_TEACHERS||L.bEditable)&&BV_bIsTeacher&&LMS_IsLMSable&&L.sType!=BV_LMS_TASK;}function k(L){return(L.bEditable&&L.nAudience==BV_AUDIENCE_STUDENTS&&L.sType==BV_LMS_TASK&&LMS_IsLMSable);}function D(){document.getElementById(E).style.height="";document.getElementById("noteBody").style.height="";document.getElementById("noteContent").style.height="";document.getElementById("NotesViewer_RichTextIFrame").style.height=m+"px";}function b(){TouchUtils.EventEnd.forEach(function(L){document.getElementById(E).addEventListener(L,function(M){PreventBookClick=true;});document.getElementById("noteClose").addEventListener(L,function(M){Notes.Utils.Close(M);});});}function a(Q){var S=document.getElementById("noteEdit");var O=document.getElementById("deleteShare");var R=document.getElementById("noteClone");var P=document.getElementById("magnify");var M=document.getElementById("convertLMS");var N=document.getElementById("deleteLMS");var L=document.getElementById("cloneLMS");var T=document.getElementById("sendNote");var U=null;if(Q!=null){var V=[];V.push("https://",window.location.host,"/KotarApp/Viewer.aspx?nBookID=",BV_nBookID,"&nMarkerID=",Q.nMarkerID,"&Source=share#ShowMarker.",((Q.nPageIndex*1)+1),".",Q.nMarkerID);U="nMarkerID="+encodeURIComponent(Q.nMarkerID)+"&url="+encodeURIComponent(V.join(""));}TouchUtils.EventEnd.forEach(function(W){if(S){S.addEventListener(W,function(X){I(X);});}if(O){O.addEventListener(W,function(X){BV_AddBookExtensionShareExclude(X);});}if(R){R.addEventListener(W,function(X){f(X);});}if(P){P.addEventListener(W,function(){u();});}if(M){M.addEventListener(W,function(X){g(X);});}if(N){N.addEventListener(W,function(X){h(X);});}if(L){L.addEventListener(W,function(X){e(X);});}if(T&&U){T.addEventListener(W,function(X){ShowMailPopup(U);});}});}function r(M,L){NotesViewer_IFrame=getElement("NotesViewer_RichTextIFrame");NotesViewer_IFrame.style.visibility="visible";if(L!=null&&L!=""){getElement("pleasewait").style.display="none";NotesViewer_IFrame.src="/KotarApp/Viewer/LMSGateway.aspx?gtaskid="+L+"&gUserID="+BaseMaster_gUserID;}else{if(NotesPreview_BubbledMarkerID>0||(BV_oBubbledMarker!=null&&BV_oBubbledMarker.nMarkerID==M)){NotesViewer_IFrame.src="/KotarApp/Viewer/RichTextViewer.aspx?nIFrameWidth="+z()+"&nIFrameHeight="+y+"&nMarkerID="+M+"&gUserID="+BaseMaster_gUserID+"&bWithTalkbacks=false&bAddNewTalkback=false";}}}function i(){getElement("pleasewait").style.display="none";}function J(){getElement("pleasewait").style.display="";NotesViewer_IFrame=getElement("NotesViewer_RichTextIFrame");if(NotesViewer_IFrame){NotesViewer_IFrame.style.visibility="hidden";NotesViewer_IFrame.src="about:blank";}}function j(L){if(L.length>Toolbar.BookLayers.MaxTitleLength){L=L.substring(0,Toolbar.BookLayers.MaxTitleLength)+" ...";}return L;}function z(){return(NotesViewer_nWidth-25);}function f(L){var M=BV_PlaceCloneIconExtension(L,BV_oBubbledMarker.nPageIndex);var N=TXT_CopyOf+" ";M.sTitle=N+BV_oBubbledMarker.sTitle;BV_CreateNewMarkerForClone(M,N);}function h(L){if(BV_oBubbledMarker.sSubType=="archive"){if(confirm(decodeKotar(TXT_ConfirmLMSTaskDeletion))){BV_DeleteMarker(BV_GetMarkerByID(BV_oBubbledMarker.nMarkerID));}}else{LMSTasks_GetDeletedLMSTaskGroups(BV_oBubbledMarker.gLinkedItemID);}}function e(L){var M=BV_PlaceLMSIconExtension(L,BV_oBubbledMarker.nPageIndex,500,500);LMSTasks_CloneTask(M,BV_oBubbledMarker.gLinkedItemID);}function g(L){var M=BV_PlaceLMSIconExtension(L,BV_oBubbledMarker.nPageIndex,500,500);LMSTasks_CreateNewTask(M);BV_HideMarkerBubble("BV_oBubbleConvertLMSButton_OnClick",false);}function I(L){if(BV_oBubbledMarker.bCanSetFolder==false){var O=ReplaceAll(TXT_OnlyOwnerCanEdit,"{0}",BV_oBubbledMarker.sOwnerFullName);Utils_ShowMessageDialog(O,TXT_SystemMessage);return;}if(BV_oBubbledMarker.sType==BV_LMS_TASK){if(BV_oBubbledMarker.sSubType=="archive"){var N=BV_PlaceLMSIconExtension(L,BV_oBubbledMarker.nPageIndex,500,500,BV_oBubbledMarker.style.left,BV_oBubbledMarker.style.top);LMSTasks_CloneTask(N,BV_oBubbledMarker.gLinkedItemID,BV_oBubbledMarker.nMarkerID);}else{LMSTasks_OnEditTask(BV_oBubbledMarker.nMarkerID,BV_oBubbledMarker.gLinkedItemID,false);BV_HideMarkerBubble("",false);}}else{if(window.event){L=window.event;}BV_SaveRestorePoint(BV_oBubbledMarker);BV_SetMarkerBackgroundImage_Active(BV_oBubbledMarker);BV_bMarkerSelected=true;BV_bInBubbleEditMode=true;MarkersMgr_SetIsBeingEdited(BV_oBubbledMarker.nMarkerID,true);var M=BV_oBubbledMarker;switch(BV_oBubbledMarker.sType){case BV_PUSHPIN:case BV_TOC_ENTRY:case BV_SELECT:Notes.Viewer.Hide();Notes.Editor.Show(M);break;case BV_LINK:LinksViewer_Hide();LinksEditor_Show(M);break;}L.cancelBubble=true;}}K.BindEvents=b;K.Hide=l;K.Show=H;K.Preview=C;K.FinishLoad=i;})(Notes.Viewer);

/** Created in 93.7322 ms **/
