<!DOCTYPE html>
<html lang="he" dir="rtl" data-theme="light" style=""><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××¢×¨×›×ª ×ª×¨×’×•×œ ×œ××©×™××” - ×××”</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Hebrew:wght@400;600;700&amp;display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Noto Sans Hebrew', Arial, sans-serif;
        background: #f5f7fa;
        margin: 0;
        padding: 20px;
        line-height: 1.6;
        max-width: none;
      }

      /* Section Management */
      .section {
        display: none;
      }
      
      .section.active {
        display: block;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 15px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      /* Home Button */
      .home-btn {
        position: fixed;
        top: 20px;
        left: 20px;
        background: #2196f3;
        color: white;
        font-size: 14pt;
        font-weight: 600;
        padding: 12px 20px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        z-index: 1000;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        font-family: 'Noto Sans Hebrew', Arial, sans-serif;
      }

      .home-btn:hover {
        background: #1976d2;
      }

      /* HOME SECTION STYLES */
      .header {
        background: linear-gradient(135deg, #2196f3, #64b5f6);
        color: white;
        padding: 40px;
        text-align: center;
        position: relative;
      }

      .mascot {
        font-size: 60px;
        margin-bottom: 20px;
      }

      .header h1 {
        margin: 0 0 15px 0;
        font-size: 32pt;
        font-weight: 700;
      }

      .subtitle {
        font-size: 18pt;
        margin: 10px 0;
        opacity: 0.9;
      }

      .motivation {
        font-size: 16pt;
        margin: 20px 0;
        font-weight: 600;
      }

      .stats-panel {
        background: #e3f2fd;
        padding: 25px;
        margin: 20px;
        border-radius: 12px;
        border: 2px solid #2196f3;
        text-align: center;
      }

      .stats-title {
        font-size: 20pt;
        font-weight: 700;
        color: #1976d2;
        margin-bottom: 20px;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
      }

      .stat-item {
        background: white;
        padding: 15px;
        border-radius: 8px;
        border: 2px solid #bbdefb;
      }

      .stat-number {
        font-size: 24pt;
        font-weight: 700;
        color: #1976d2;
        display: block;
      }

      .stat-label {
        font-size: 12pt;
        color: #666;
      }

      .encouragement-msg {
        font-size: 14pt;
        font-weight: 600;
        color: #2e7d32;
        background: #e8f5e9;
        padding: 15px;
        border-radius: 8px;
        margin-top: 15px;
      }

      .cards-container {
        padding: 40px;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 30px;
      }

      .exercise-card {
        background: white;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        position: relative;
        min-height: 400px;
        display: flex;
        flex-direction: column;
      }

      .card-decimal { border-right: 6px solid #2196f3; }
      .card-multiplication { border-right: 6px solid #4caf50; }
      .card-numberline { border-right: 6px solid #ff9800; }

      .card-icon {
        font-size: 80px;
        text-align: center;
        margin-bottom: 20px;
      }

      .card-title {
        font-size: 20pt;
        font-weight: 700;
        text-align: center;
        margin-bottom: 15px;
        color: #212121;
      }

      .card-description {
        font-size: 14pt;
        color: #666;
        text-align: center;
        line-height: 1.5;
        margin-bottom: 15px;
      }

      .card-topics {
        font-size: 12pt;
        color: #888;
        text-align: center;
        font-style: italic;
        margin-bottom: 20px;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 6px;
      }

      .progress-indicator {
        margin: 20px 0;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
      }

      .has-progress {
        background: #e8f5e9;
        border: 2px solid #4caf50;
      }

      .no-progress {
        background: #fff3e0;
        border: 2px solid #ff9800;
      }

      .progress-text {
        font-size: 13pt;
        font-weight: 600;
        margin-bottom: 10px;
      }

      .progress-bar {
        width: 100%;
        height: 8px;
        background: #e0e0e0;
        border-radius: 4px;
        margin: 8px 0;
      }

      .progress-fill {
        height: 100%;
      }
      .progress-fill.decimal { background: #2196f3; }
      .progress-fill.multiplication { background: #4caf50; }
      .progress-fill.numberline { background: #ff9800; }

      .start-button {
        background: #2196f3;
        color: white;
        font-size: 18pt;
        font-weight: 700;
        padding: 15px 25px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        width: 100%;
        margin-top: auto;
        font-family: 'Noto Sans Hebrew', Arial, sans-serif;
      }
      .start-button.multiplication { background: #4caf50; }
      .start-button.numberline { background: #ff9800; }

      .footer {
        background: #f8f9fa;
        padding: 30px;
        text-align: center;
        border-top: 3px solid #e0e0e0;
      }

      .tips {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
      }

      .tip-item {
        background: white;
        padding: 20px;
        border-radius: 10px;
        border-right: 4px solid #4caf50;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      }

      .countdown {
        font-size: 18pt;
        font-weight: 700;
        color: #d32f2f;
        background: #ffebee;
        padding: 15px;
        border-radius: 8px;
        border: 2px solid #f44336;
        margin-top: 20px;
      }

      /* TOOL SECTIONS STYLES */
      .tool-container {
        max-width: 1000px;
        margin: 0 auto;
        background: white;
        border-radius: 15px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        margin-top: 60px;
      }

      .tool-header {
        background: linear-gradient(135deg, #2196f3, #64b5f6);
        color: white;
        padding: 25px;
        text-align: center;
      }

      .tool-header.multiplication {
        background: linear-gradient(135deg, #4caf50, #81c784);
      }

      .tool-header.numberline {
        background: linear-gradient(135deg, #ff9800, #ffb74d);
      }

      .tool-header h1 {
        margin: 0;
        font-size: 28pt;
        font-weight: 700;
      }

      .stats-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #e3f2fd;
        padding: 15px 25px;
        font-size: 14pt;
        font-weight: 600;
        border-bottom: 3px solid #2196f3;
      }

      .stats-bar.multiplication {
        background: #e8f5e9;
        border-bottom-color: #4caf50;
      }

      .stats-bar.numberline {
        background: #fff3e0;
        border-bottom-color: #ff9800;
      }

      .level-indicator {
        padding: 8px 16px;
        border-radius: 20px;
        color: white;
        font-weight: 700;
        font-size: 12pt;
      }

      .level-easy { background: #81c784; }
      .level-medium { background: #ffb74d; }
      .level-hard { background: #e57373; }

      .main-content {
        display: grid;
        grid-template-columns: 1fr 300px;
        gap: 20px;
        padding: 25px;
      }

      .exercise-area {
        background: #fafafa;
        padding: 30px;
        border-radius: 12px;
        border: 2px solid #e0e0e0;
        min-height: 400px;
      }

      .question {
        font-size: 22pt;
        font-weight: 600;
        margin-bottom: 25px;
        padding: 20px;
        background: white;
        border-radius: 10px;
        border-right: 5px solid #2196f3;
        text-align: center;
        min-height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .question.multiplication {
        border-right-color: #4caf50;
      }

      .question.numberline {
        border-right-color: #ff9800;
      }

      .answer-area {
        text-align: center;
        margin: 25px 0;
      }

      .answer-input {
        font-size: 18pt;
        padding: 12px 20px;
        border: 3px solid #ddd;
        border-radius: 8px;
        width: 200px;
        text-align: center;
        font-family: 'Noto Sans Hebrew', Arial, sans-serif;
        margin: 10px;
      }

      .choice-buttons {
        display: flex;
        gap: 15px;
        justify-content: center;
        flex-wrap: wrap;
      }

      .choice-btn {
        font-size: 16pt;
        padding: 15px 25px;
        border: 3px solid #ddd;
        background: white;
        border-radius: 10px;
        cursor: pointer;
        font-family: 'Noto Sans Hebrew', Arial, sans-serif;
        min-width: 80px;
      }

      .check-btn {
        background: #4caf50;
        color: white;
        font-size: 18pt;
        font-weight: 700;
        padding: 15px 40px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        margin: 20px;
        font-family: 'Noto Sans Hebrew', Arial, sans-serif;
      }

      .check-btn.multiplication {
        background: #4caf50;
      }

      .check-btn.numberline {
        background: #ff9800;
      }

      .feedback {
        margin: 20px 0;
        padding: 20px;
        border-radius: 10px;
        font-size: 16pt;
        font-weight: 600;
        text-align: center;
        min-height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
      }

      .feedback.correct {
        background: #e8f5e9;
        color: #2e7d32;
        border: 3px solid #4caf50;
      }

      .feedback.wrong {
        background: #ffebee;
        color: #c62828;
        border: 3px solid #f44336;
      }

      .feedback.hidden {
        visibility: hidden;
      }

      .sidebar {
        background: white;
        padding: 20px;
        border-radius: 12px;
        border: 2px solid #e0e0e0;
      }

      .sidebar-title {
        font-size: 18pt;
        font-weight: 700;
        margin-bottom: 20px;
        text-align: center;
      }

      .progress-section {
        margin-bottom: 25px;
      }

      .progress-item {
        display: flex;
        justify-content: space-between;
        margin: 10px 0;
        font-size: 14pt;
      }

      .control-buttons {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-top: 20px;
      }

      .control-btn {
        padding: 12px;
        font-size: 14pt;
        font-weight: 600;
        border: 2px solid #ddd;
        background: white;
        border-radius: 8px;
        cursor: pointer;
        font-family: 'Noto Sans Hebrew', Arial, sans-serif;
      }

      /* Number Line Specific Styles */
      .number-line-container {
        margin: 30px 0;
        text-align: center;
      }

      .number-line {
        position: relative;
        height: 80px;
        background: #f0f0f0;
        border-radius: 8px;
        margin: 20px 0;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .line {
        width: 90%;
        height: 4px;
        background: #333;
        position: relative;
      }

      .marker {
        position: absolute;
        width: 2px;
        height: 20px;
        background: #333;
        top: -8px;
      }

      .marker-label {
        position: absolute;
        top: 25px;
        font-size: 12pt;
        font-weight: 600;
        transform: translateX(-50%);
      }

      .arrow {
        position: absolute;
        top: -15px;
        font-size: 20px;
        color: #f44336;
        transform: translateX(-50%);
      }

      /* Overlay and celebration */
      .overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
        display: none;
      }

      .celebration {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 40px;
        border-radius: 15px;
        text-align: center;
        font-size: 18pt;
        font-weight: 600;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        z-index: 1000;
        display: none;
      }

      @media (max-width: 768px) {
        .main-content {
          grid-template-columns: 1fr;
        }
        
        .cards-container {
          grid-template-columns: 1fr;
          padding: 20px;
        }

        .stats-grid {
          grid-template-columns: repeat(2, 1fr);
        }

        .header h1 {
          font-size: 24pt;
        }

        .tips {
          grid-template-columns: 1fr;
        }
      }
    </style>
</head>
<body style="">
    <!-- Overlay for celebrations -->
    <div class="overlay" id="overlay" style="display: block;"></div>
    <div class="celebration" id="celebration" style="display: block;">
                â¸ï¸ ×¡×™×›×•× ×‘×™× ×™×™×
                ×©××œ×•×ª: 7
                × ×›×•× ×•×ª: 6 (86%)
                ×¨×¦×£ ××§×¡×™××œ×™: 5
                ×¨××”: ×§×©×”
                <button class="check-btn" onclick="hideCelebration()">×”××©×š ×ª×¨×’×•×œ ğŸš€</button>
                <button class="check-btn" onclick="showSection('home')" style="background: #2196f3; margin-top: 10px;">×—×–×¨×” ×œ×“×£ ×”×‘×™×ª ğŸ </button>
            </div>

    <!-- HOME SECTION -->
    <div id="home-section" class="section active">
        <div class="container">
            <div class="header">
                <div class="mascot">ğŸ¯</div>
                <h1>ğŸ“ ××¢×¨×›×ª ×ª×¨×’×•×œ ×œ××©×™××” - ×××”</h1>
                <div class="subtitle">××©×™××ª ×”×¢×¨×›×”: ×©×œ×™×©×™ 18.11 ğŸ“</div>
                <div class="motivation">ğŸ’ª ××ª ×™×›×•×œ×” ×œ×”×¦×œ×™×— ×‘××©×™××”!</div>
            </div>

            <div class="stats-panel">
                <div class="stats-title">ğŸ“Š ×¡×™×›×•× ×”×ª×§×“××•×ª ×›×œ×œ×™</div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-number" id="total-questions-all">15</span>
                        <span class="stat-label">×¡×”"×› ×©××œ×•×ª</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="total-correct-all">12</span>
                        <span class="stat-label">×ª×©×•×‘×•×ª × ×›×•× ×•×ª</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="average-success">80%</span>
                        <span class="stat-label">×××•×¦×¢ ×”×¦×œ×—×”</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="study-time">47</span>
                        <span class="stat-label">×“×§×•×ª ×ª×¨×’×•×œ</span>
                    </div>
                </div>
                <div class="encouragement-msg" id="main-encouragement">ğŸ‰ ×›×œ ×”×›×‘×•×“! ××ª ×¢×•×©×” ×¢×‘×•×“×” ××¢×•×œ×” ×¢× 80% ×”×¦×œ×—×”!</div>
            </div>

            <div class="cards-container">
                <!-- Card 1: ××‘× ×” ×¢×©×¨×•× ×™ -->
                <div class="exercise-card card-decimal">
                    <div class="card-icon">ğŸ“Š</div>
                    <div class="card-title">××‘× ×” ×¢×©×¨×•× ×™ ×¢×“ 1,000</div>
                    <div class="card-description">×ª×¨×’×•×œ ××¡×¤×¨×™×, ×¤×™×¨×•×§ ××¡×¤×¨×™×, ×¢×¨×š ×¡×¤×¨×”, ××¡×¤×¨ ×¢×•×§×‘/×§×•×“×</div>
                    <div class="card-topics">×¢××•×“×™× 132-145, 126-131 | ××‘× ×” ×¢×©×¨×•× ×™, ×™×©×¨ ××¡×¤×¨×™×</div>
                    <div class="progress-indicator has-progress" id="decimal-progress">
                    <div class="progress-text">âœ… 8 ×©××œ×•×ª | 75% ×”×¦×œ×—×”</div>
                    <div class="progress-bar">
                        <div class="progress-fill decimal" style="width: 75%; border-radius: 4px;"></div>
                    </div>
                    <div class="progress-text" style="font-size: 11pt; margin-top: 5px;">×”××©×š ×××™×¤×” ×©×¢×¦×¨×ª</div>
                </div>
                    <button class="start-button" onclick="showSection('decimal')">ğŸš€ ×”×ª×—×œ ×ª×¨×’×•×œ</button>
                </div>

                <!-- Card 2: ×”×©×œ××ª ×’×•×¨× ×•××›×¤×œ×” -->
                <div class="exercise-card card-multiplication">
                    <div class="card-icon">âœ–ï¸</div>
                    <div class="card-title">×”×©×œ××ª ×’×•×¨× ×•××›×¤×œ×”</div>
                    <div class="card-description">×ª×¨×’×•×œ ×œ×•×— ×”×›×¤×œ, ×”×©×œ××ª ××¡×¤×¨×™× ×—×¡×¨×™× ×‘×›×¤×œ</div>
                    <div class="card-topics">×¢××•×“×™× 9-12 | ×’×•×¨×, ××›×¤×œ×”, ×œ×•×— ×”×›×¤×œ</div>
                    <div class="progress-indicator has-progress" id="multiplication-progress">
                    <div class="progress-text">âœ… 7 ×©××œ×•×ª | 86% ×”×¦×œ×—×”</div>
                    <div class="progress-bar">
                        <div class="progress-fill multiplication" style="width: 86%; border-radius: 4px;"></div>
                    </div>
                    <div class="progress-text" style="font-size: 11pt; margin-top: 5px;">×”××©×š ×××™×¤×” ×©×¢×¦×¨×ª</div>
                </div>
                    <button class="start-button multiplication" onclick="showSection('multiplication')">ğŸš€ ×”×ª×—×œ ×ª×¨×’×•×œ</button>
                </div>

                <!-- Card 3: ×™×©×¨ ×”××¡×¤×¨×™× -->
                <div class="exercise-card card-numberline">
                    <div class="card-icon">ğŸ“</div>
                    <div class="card-title">×™×©×¨ ×”××¡×¤×¨×™×</div>
                    <div class="card-description">××¦×™××ª ××™×§×•× ××¡×¤×¨×™× ×¢×œ ×”×™×©×¨, ×”×¢×¨×›×ª ××¨×—×§×™×</div>
                    <div class="card-topics">×¢××•×“×™× 126-131 | ×™×©×¨ ××¡×¤×¨×™×, ×¡×“×¨ ×’×•×“×œ</div>
                    <div class="progress-indicator no-progress" id="numberline-progress"><div class="progress-text">ğŸ†• ×”×ª×—×œ ×ª×¨×’×•×œ ×—×“×©</div></div>
                    <button class="start-button numberline" onclick="showSection('numberline')">ğŸš€ ×”×ª×—×œ ×ª×¨×’×•×œ</button>
                </div>
            </div>

            <div class="footer">
                <div class="tips">
                    <div class="tip-item">
                        <strong>ğŸ’¡ ×˜×™×¤:</strong><br>
                        ×ª×¨×’×œ×™ 15-20 ×“×§×•×ª ×›×œ ×™×•×!
                    </div>
                    <div class="tip-item">
                        <strong>ğŸ“š ×–×›×¨×™:</strong><br>
                        ×—×–×¨×™ ×’× ×¢×œ ×”××—×‘×¨×•×ª ×•×”×¡×¤×¨×™×
                    </div>
                    <div class="tip-item">
                        <strong>ğŸ¯ ××˜×¨×”:</strong><br>
                        ×”×©×œ×™××™ ×œ×¤×—×•×ª 20 ×©××œ×•×ª ×‘×›×œ × ×•×©×
                    </div>
                </div>
                <div class="countdown" id="countdown" style="background: rgb(200, 230, 201); border-color: rgb(102, 187, 106);">âœ… ×”××©×™××” ×”×™×™×ª×”! ×ª××©×™×›×™ ×œ×ª×¨×’×œ! ğŸ’ª</div>
            </div>
        </div>
    </div>

    <!-- DECIMAL SECTION -->
    <div id="decimal-section" class="section">
        <button class="home-btn" onclick="showSection('home')">ğŸ  ×—×–×¨×” ×œ×“×£ ×”×‘×™×ª</button>
        <div class="tool-container">
            <div class="tool-header">
                <h1>ğŸ¯ ×ª×¨×’×•×œ ××‘× ×” ×¢×©×¨×•× ×™ - ×××”</h1>
            </div>

            <div class="stats-bar">
                <div>
                    <span>× ×™×§×•×“: <strong><span id="decimal-score">6/8</span></strong></span>
                </div>
                <div>
                    <span class="level-indicator level-hard" id="decimal-level">×§×©×”</span>
                </div>
                <div>
                    <span>×¨×¦×£: <strong><span id="decimal-streak">3</span></strong></span>
                </div>
            </div>

            <div class="main-content">
                <div class="exercise-area">
                    <div class="question" id="decimal-question">××”×™ ×”×¡×¤×¨×” ×”×—×¡×¨×”? 7_4</div>

                    <div class="answer-area">
                        <input type="number" class="answer-input" id="decimal-answer-input" placeholder="×”×ª×©×•×‘×” ×©×œ×š" style="display: inline-block;">
                        <div class="choice-buttons" id="decimal-choice-buttons" style="display: none;"></div>
                    </div>

                    <div style="text-align: center;">
                        <button class="check-btn" id="decimal-check-btn" onclick="checkDecimalAnswer()" style="display: inline-block;">×‘×“×•×§ ×ª×©×•×‘×”</button>
                        <button class="check-btn" id="decimal-new-question-btn" onclick="generateDecimalQuestion()" style="display: none;">×©××œ×” ×—×“×©×”</button>
                    </div>

                    <div class="feedback hidden" id="decimal-feedback">âœ… ××ª ×’××•× ×™×ª! ×ª×©×•×‘×” × ×›×•× ×”!<br>ğŸ”Š ×›×œ ×”×›×‘×•×“ ×××”!</div>
                </div>

                <div class="sidebar">
                    <div class="sidebar-title">ğŸ“Š ×¡×˜×˜×™×¡×˜×™×§×•×ª</div>
                    <div class="progress-section">
                        <div class="progress-item">
                            <span>×©××œ×•×ª:</span>
                            <span><span id="decimal-total-questions">8</span></span>
                        </div>
                        <div class="progress-item">
                            <span>× ×›×•× ×•×ª:</span>
                            <span><span id="decimal-correct-answers">6</span> (<span id="decimal-percentage">75</span>%)</span>
                        </div>
                        <div class="progress-item">
                            <span>×¨×¦×£ × ×•×›×—×™:</span>
                            <span id="decimal-current-streak">3</span>
                        </div>
                        <div class="progress-item">
                            <span>×¨×¦×£ ×”×˜×•×‘ ×‘×™×•×ª×¨:</span>
                            <span id="decimal-best-streak">3</span>
                        </div>
                        <div class="progress-item">
                            <span>×¨××” × ×•×›×—×™×ª:</span>
                            <span id="decimal-current-level">×§×©×”</span>
                        </div>
                    </div>

                    <div class="control-buttons">
                        <button class="control-btn" onclick="pauseDecimalExercise()">â¸ï¸ ×¢×¦×•×¨ ×ª×¨×’×•×œ</button>
                        <button class="control-btn" onclick="exportDecimalReport()" style="background: #2196f3; color: white;">ğŸ“Š ×™×™×¦×•× ×“×•×—</button>
                        <button class="control-btn" onclick="viewDetailedHistory('decimal')" style="background: #9c27b0; color: white;">ğŸ“‹ ×™×•××Ÿ ××¤×•×¨×˜</button>
                        <button class="control-btn" onclick="backupProgress('decimal')" style="background: #ff9800; color: white;">ğŸ’¾ ×’×™×‘×•×™ × ×ª×•× ×™×</button>
                        <button class="control-btn" onclick="showResetOptions('decimal')" style="background: #f44336; color: white;">ğŸ”„ ××™×¤×•×¡</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MULTIPLICATION SECTION -->
    <div id="multiplication-section" class="section">
        <button class="home-btn" onclick="showSection('home')">ğŸ  ×—×–×¨×” ×œ×“×£ ×”×‘×™×ª</button>
        <div class="tool-container">
            <div class="tool-header multiplication">
                <h1>âœ–ï¸ ×ª×¨×’×•×œ ×”×©×œ××ª ×’×•×¨× ×•××›×¤×œ×” - ×××”</h1>
            </div>

            <div class="stats-bar multiplication">
                <div>
                    <span>× ×™×§×•×“: <strong><span id="multiplication-score">6/7</span></strong></span>
                </div>
                <div>
                    <span class="level-indicator level-hard" id="multiplication-level">×§×©×”</span>
                </div>
                <div>
                    <span>×¨×¦×£: <strong><span id="multiplication-streak">5</span></strong></span>
                </div>
            </div>

            <div class="main-content">
                <div class="exercise-area">
                    <div class="question multiplication" id="multiplication-question">10 Ã— ___ = 60</div>

                    <div class="answer-area">
                        <input type="number" class="answer-input" id="multiplication-answer-input" placeholder="×”×ª×©×•×‘×” ×©×œ×š" style="display: inline-block;">
                        <div class="choice-buttons" id="multiplication-choice-buttons" style="display: none;"></div>
                    </div>

                    <div style="text-align: center;">
                        <button class="check-btn multiplication" id="multiplication-check-btn" onclick="checkMultiplicationAnswer()" style="display: inline-block;">×‘×“×•×§ ×ª×©×•×‘×”</button>
                        <button class="check-btn multiplication" id="multiplication-new-question-btn" onclick="generateMultiplicationQuestion()" style="display: none;">×©××œ×” ×—×“×©×”</button>
                    </div>

                    <div class="feedback hidden" id="multiplication-feedback">âœ… ×›×œ ×”×›×‘×•×“! ×ª×©×•×‘×” × ×›×•× ×”!<br>ğŸ”Š ×›×œ ×”×›×‘×•×“ ×××”!</div>
                </div>

                <div class="sidebar">
                    <div class="sidebar-title">ğŸ“Š ×¡×˜×˜×™×¡×˜×™×§×•×ª</div>
                    <div class="progress-section">
                        <div class="progress-item">
                            <span>×©××œ×•×ª:</span>
                            <span><span id="multiplication-total-questions">7</span></span>
                        </div>
                        <div class="progress-item">
                            <span>× ×›×•× ×•×ª:</span>
                            <span><span id="multiplication-correct-answers">6</span> (<span id="multiplication-percentage">86</span>%)</span>
                        </div>
                        <div class="progress-item">
                            <span>×¨×¦×£ × ×•×›×—×™:</span>
                            <span id="multiplication-current-streak">5</span>
                        </div>
                        <div class="progress-item">
                            <span>×¨×¦×£ ×”×˜×•×‘ ×‘×™×•×ª×¨:</span>
                            <span id="multiplication-best-streak">5</span>
                        </div>
                        <div class="progress-item">
                            <span>×¨××” × ×•×›×—×™×ª:</span>
                            <span id="multiplication-current-level">×§×©×”</span>
                        </div>
                    </div>

                    <div class="control-buttons">
                        <button class="control-btn" onclick="pauseMultiplicationExercise()">â¸ï¸ ×¢×¦×•×¨ ×ª×¨×’×•×œ</button>
                        <button class="control-btn" onclick="exportMultiplicationReport()" style="background: #4caf50; color: white;">ğŸ“Š ×™×™×¦×•× ×“×•×—</button>
                        <button class="control-btn" onclick="viewDetailedHistory('multiplication')" style="background: #9c27b0; color: white;">ğŸ“‹ ×™×•××Ÿ ××¤×•×¨×˜</button>
                        <button class="control-btn" onclick="backupProgress('multiplication')" style="background: #ff9800; color: white;">ğŸ’¾ ×’×™×‘×•×™ × ×ª×•× ×™×</button>
                        <button class="control-btn" onclick="showResetOptions('multiplication')" style="background: #f44336; color: white;">ğŸ”„ ××™×¤×•×¡</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- NUMBER LINE SECTION -->
    <div id="numberline-section" class="section">
        <button class="home-btn" onclick="showSection('home')">ğŸ  ×—×–×¨×” ×œ×“×£ ×”×‘×™×ª</button>
        <div class="tool-container">
            <div class="tool-header numberline">
                <h1>ğŸ“ ×ª×¨×’×•×œ ×™×©×¨ ×”××¡×¤×¨×™× - ×××”</h1>
            </div>

            <div class="stats-bar numberline">
                <div>
                    <span>× ×™×§×•×“: <strong><span id="numberline-score">0</span></strong></span>
                </div>
                <div>
                    <span class="level-indicator" id="numberline-level">×‘×™× ×•× ×™</span>
                </div>
                <div>
                    <span>×¨×¦×£: <strong><span id="numberline-streak">0</span></strong></span>
                </div>
            </div>

            <div class="main-content">
                <div class="exercise-area">
                    <div class="question numberline" id="numberline-question">
                        ×œ×—×¦×™ ×¢×œ "×©××œ×” ×—×“×©×”" ×›×“×™ ×œ×”×ª×—×™×œ! ğŸš€
                    </div>

                    <div class="number-line-container" id="numberline-visual" style="display: none;">
                        <div class="number-line">
                            <div class="line" id="numberline-line"></div>
                        </div>
                    </div>

                    <div class="answer-area">
                        <input type="number" class="answer-input" id="numberline-answer-input" placeholder="×”×ª×©×•×‘×” ×©×œ×š" style="display: none;">
                        <div class="choice-buttons" id="numberline-choice-buttons" style="display: none;"></div>
                    </div>

                    <div style="text-align: center;">
                        <button class="check-btn numberline" id="numberline-check-btn" onclick="checkNumberlineAnswer()" style="display: none;">×‘×“×•×§ ×ª×©×•×‘×”</button>
                        <button class="check-btn numberline" id="numberline-new-question-btn" onclick="generateNumberlineQuestion()">×©××œ×” ×—×“×©×”</button>
                    </div>

                    <div class="feedback hidden" id="numberline-feedback"></div>
                </div>

                <div class="sidebar">
                    <div class="sidebar-title">ğŸ“Š ×¡×˜×˜×™×¡×˜×™×§×•×ª</div>
                    <div class="progress-section">
                        <div class="progress-item">
                            <span>×©××œ×•×ª:</span>
                            <span><span id="numberline-total-questions">0</span></span>
                        </div>
                        <div class="progress-item">
                            <span>× ×›×•× ×•×ª:</span>
                            <span><span id="numberline-correct-answers">0</span> (<span id="numberline-percentage">0</span>%)</span>
                        </div>
                        <div class="progress-item">
                            <span>×¨×¦×£ × ×•×›×—×™:</span>
                            <span id="numberline-current-streak">0</span>
                        </div>
                        <div class="progress-item">
                            <span>×¨×¦×£ ×”×˜×•×‘ ×‘×™×•×ª×¨:</span>
                            <span id="numberline-best-streak">0</span>
                        </div>
                        <div class="progress-item">
                            <span>×¨××” × ×•×›×—×™×ª:</span>
                            <span id="numberline-current-level">×‘×™× ×•× ×™</span>
                        </div>
                    </div>

                    <div class="control-buttons">
                        <button class="control-btn" onclick="pauseNumberlineExercise()">â¸ï¸ ×¢×¦×•×¨ ×ª×¨×’×•×œ</button>
                        <button class="control-btn" onclick="exportNumberlineReport()" style="background: #ff9800; color: white;">ğŸ“Š ×™×™×¦×•× ×“×•×—</button>
                        <button class="control-btn" onclick="viewDetailedHistory('numberline')" style="background: #9c27b0; color: white;">ğŸ“‹ ×™×•××Ÿ ××¤×•×¨×˜</button>
                        <button class="control-btn" onclick="backupProgress('numberline')" style="background: #ff9800; color: white;">ğŸ’¾ ×’×™×‘×•×™ × ×ª×•× ×™×</button>
                        <button class="control-btn" onclick="showResetOptions('numberline')" style="background: #f44336; color: white;">ğŸ”„ ××™×¤×•×¡</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let currentSection = 'home';

        // Game states for each tool
        let decimalState = {
            level: '×‘×™× ×•× ×™',
            totalQuestions: 0,
            correctAnswers: 0,
            currentStreak: 0,
            bestStreak: 0,
            consecutiveCorrect: 0,
            consecutiveWrong: 0,
            currentQuestion: null,
            currentAnswer: null,
            sessionHistory: [],
            startTime: Date.now(),
            lastSaved: null,
        };

        let multiplicationState = {
            level: '×‘×™× ×•× ×™',
            totalQuestions: 0,
            correctAnswers: 0,
            currentStreak: 0,
            bestStreak: 0,
            consecutiveCorrect: 0,
            consecutiveWrong: 0,
            currentQuestion: null,
            currentAnswer: null,
            sessionHistory: [],
            startTime: Date.now(),
            lastSaved: null,
        };

        let numberlineState = {
            level: '×‘×™× ×•× ×™',
            totalQuestions: 0,
            correctAnswers: 0,
            currentStreak: 0,
            bestStreak: 0,
            consecutiveCorrect: 0,
            consecutiveWrong: 0,
            currentQuestion: null,
            currentAnswer: null,
            sessionHistory: [],
            startTime: Date.now(),
            lastSaved: null,
        };

        // Section management
        function showSection(sectionName) {
            // Hide all sections
            const sections = ['home', 'decimal', 'multiplication', 'numberline'];
            sections.forEach(section => {
                const element = document.getElementById(`${section}-section`);
                if (element) {
                    element.classList.remove('active');
                }
            });

            // Show requested section
            const targetSection = document.getElementById(`${sectionName}-section`);
            if (targetSection) {
                targetSection.classList.add('active');
            }

            currentSection = sectionName;
            window.scrollTo(0, 0);

            // Initialize section
            if (sectionName !== 'home') {
                initializeTool(sectionName);
            } else {
                loadAllProgress();
            }
        }

        // Initialize specific tool
        function initializeTool(toolName) {
            loadProgress(toolName);
            updateStats(toolName);
        }

        // Load progress for specific tool
        function loadProgress(toolName) {
            const keys = {
                decimal: 'emmaDecimalProgress',
                multiplication: 'emmaMultiplicationProgress',
                numberline: 'emmaNumberLineProgress'
            };

            const states = {
                decimal: decimalState,
                multiplication: multiplicationState,
                numberline: numberlineState
            };

            const saved = localStorage.getItem(keys[toolName]);
            if (saved) {
                try {
                    const savedState = JSON.parse(saved);
                    const state = states[toolName];
                    
                    state.level = savedState.level || '×‘×™× ×•× ×™';
                    state.totalQuestions = savedState.totalQuestions || 0;
                    state.correctAnswers = savedState.correctAnswers || 0;
                    state.currentStreak = savedState.currentStreak || 0;
                    state.bestStreak = savedState.bestStreak || 0;
                    state.consecutiveCorrect = savedState.consecutiveCorrect || 0;
                    state.consecutiveWrong = savedState.consecutiveWrong || 0;
                    state.sessionHistory = savedState.sessionHistory || [];
                    state.startTime = savedState.startTime || Date.now();
                    state.lastSaved = savedState.lastSaved;

                    if (state.totalQuestions > 0) {
                        showWelcomeBack(toolName);
                    }
                } catch (e) {
                    console.error(`Error loading ${toolName} progress:`, e);
                }
            }
        }

        // Save progress for specific tool
        function saveProgress(toolName) {
            const keys = {
                decimal: 'emmaDecimalProgress',
                multiplication: 'emmaMultiplicationProgress',
                numberline: 'emmaNumberLineProgress'
            };

            const states = {
                decimal: decimalState,
                multiplication: multiplicationState,
                numberline: numberlineState
            };

            try {
                const state = states[toolName];
                const toSave = {
                    level: state.level,
                    totalQuestions: state.totalQuestions,
                    correctAnswers: state.correctAnswers,
                    currentStreak: state.currentStreak,
                    bestStreak: state.bestStreak,
                    consecutiveCorrect: state.consecutiveCorrect,
                    consecutiveWrong: state.consecutiveWrong,
                    sessionHistory: state.sessionHistory,
                    startTime: state.startTime,
                    lastSaved: Date.now(),
                };
                localStorage.setItem(keys[toolName], JSON.stringify(toSave));
                state.lastSaved = Date.now();
            } catch (e) {
                console.error(`Error saving ${toolName} progress:`, e);
            }
        }

        // Show welcome back message
        function showWelcomeBack(toolName) {
            const states = {
                decimal: decimalState,
                multiplication: multiplicationState,
                numberline: numberlineState
            };

            const state = states[toolName];
            const percentage = state.totalQuestions > 0 ? 
                Math.round((state.correctAnswers / state.totalQuestions) * 100) : 0;

            const celebration = document.getElementById('celebration');
            const overlay = document.getElementById('overlay');
            
            celebration.innerHTML = `
                ğŸ’š ×‘×¨×•×›×” ×”×©×‘×” ×××”!<br><br>
                ×”××©×›×ª ×××™×¤×” ×©×¢×¦×¨×ª:<br>
                ×©××œ×•×ª: ${state.totalQuestions}<br>
                × ×›×•× ×•×ª: ${state.correctAnswers} (${percentage}%)<br>
                ×¨×¦×£ ××§×¡×™××œ×™: ${state.bestStreak}<br>
                ×¨××”: ${state.level}<br><br>
                <button class="check-btn" onclick="hideCelebration()">×‘×•××™ × ××©×™×š! ğŸš€</button>
            `;
            celebration.style.display = 'block';
            overlay.style.display = 'block';
        }

        // Update statistics for specific tool
        function updateStats(toolName) {
            const states = {
                decimal: decimalState,
                multiplication: multiplicationState,
                numberline: numberlineState
            };

            const state = states[toolName];
            const percentage = state.totalQuestions > 0 ? 
                Math.round((state.correctAnswers / state.totalQuestions) * 100) : 0;

            // Update stats display
            document.getElementById(`${toolName}-total-questions`).textContent = state.totalQuestions;
            document.getElementById(`${toolName}-correct-answers`).textContent = state.correctAnswers;
            document.getElementById(`${toolName}-percentage`).textContent = percentage;
            document.getElementById(`${toolName}-current-streak`).textContent = state.currentStreak;
            document.getElementById(`${toolName}-best-streak`).textContent = state.bestStreak;
            document.getElementById(`${toolName}-current-level`).textContent = state.level;
            document.getElementById(`${toolName}-score`).textContent = `${state.correctAnswers}/${state.totalQuestions}`;
            document.getElementById(`${toolName}-streak`).textContent = state.currentStreak;

            // Update level indicator
            const levelIndicator = document.getElementById(`${toolName}-level`);
            levelIndicator.textContent = state.level;
            levelIndicator.className = 'level-indicator';
            if (state.level === '×§×œ') levelIndicator.classList.add('level-easy');
            else if (state.level === '×‘×™× ×•× ×™') levelIndicator.classList.add('level-medium');
            else levelIndicator.classList.add('level-hard');
        }

        // DECIMAL TOOL FUNCTIONS
        function generateDecimalQuestion() {
            const types = ['decomposition', 'digitValue', 'nextPrevious', 'compare', 'missingDigit'];
            const type = types[Math.floor(Math.random() * types.length)];
            
            let question = {};
            let answer;

            // Generate number based on level
            function getRandomNumber() {
                if (decimalState.level === '×§×œ') {
                    return Math.floor(Math.random() * 90) + 10; // 10-99
                } else if (decimalState.level === '×‘×™× ×•× ×™') {
                    return Math.floor(Math.random() * 400) + 100; // 100-499
                } else {
                    return Math.floor(Math.random() * 500) + 500; // 500-999
                }
            }

            const num = getRandomNumber();

            switch (type) {
                case 'decomposition':
                    const digits = num.toString().split('').map(Number);
                    const position = Math.floor(Math.random() * digits.length);
                    const placeValues = [];
                    
                    for (let i = 0; i < digits.length; i++) {
                        const placeValue = digits[i] * Math.pow(10, digits.length - 1 - i);
                        if (i === position) {
                            placeValues.push('?');
                            answer = placeValue;
                        } else {
                            placeValues.push(placeValue);
                        }
                    }
                    
                    question = {
                        question: `${num} = ${placeValues.join(' + ')}`,
                        type: 'input'
                    };
                    break;

                case 'digitValue':
                    const digitStr = num.toString();
                    const digitPos = Math.floor(Math.random() * digitStr.length);
                    const digit = parseInt(digitStr[digitPos]);
                    const value = digit * Math.pow(10, digitStr.length - 1 - digitPos);
                    
                    question = {
                        question: `××” ×¢×¨×š ×”×¡×¤×¨×” ${digit} ×‘××¡×¤×¨ ${num}?`,
                        type: 'input'
                    };
                    answer = value;
                    break;

                case 'nextPrevious':
                    const isNext = Math.random() < 0.5;
                    question = {
                        question: isNext ? `××”×• ×”××¡×¤×¨ ×”×¢×•×§×‘ ×©×œ ${num}?` : `××”×• ×”××¡×¤×¨ ×”×§×•×“× ×©×œ ${num}?`,
                        type: 'input'
                    };
                    answer = isNext ? num + 1 : num - 1;
                    break;

                case 'compare':
                    const num2 = getRandomNumber();
                    const symbols = ['<', '=', '>'];
                    let correctSymbol;
                    if (num < num2) correctSymbol = '<';
                    else if (num > num2) correctSymbol = '>';
                    else correctSymbol = '=';

                    question = {
                        question: `${num} ___ ${num2}`,
                        type: 'choice',
                        choices: ['<', '=', '>']
                    };
                    answer = correctSymbol;
                    break;

                case 'missingDigit':
                    const numStr = num.toString();
                    const missingPos = Math.floor(Math.random() * numStr.length);
                    const missingDigit = numStr[missingPos];
                    const numWithMissing = numStr.substring(0, missingPos) + '_' + numStr.substring(missingPos + 1);
                    
                    // Create range for context
                    const lowerBound = Math.floor(num / 100) * 100;
                    const upperBound = lowerBound + 100;
                    
                    question = {
                        question: `××”×™ ×”×¡×¤×¨×” ×”×—×¡×¨×”? ${numWithMissing}\n(×”××¡×¤×¨ × ××¦× ×‘×™×Ÿ ${lowerBound} ×œ-${upperBound})`,
                        type: 'input'
                    };
                    answer = parseInt(missingDigit);
                    break;
            }

            decimalState.currentQuestion = question;
            decimalState.currentAnswer = answer;

            // Display question
            document.getElementById('decimal-question').textContent = question.question;
            
            // Setup answer interface
            if (question.type === 'input') {
                document.getElementById('decimal-answer-input').style.display = 'inline-block';
                document.getElementById('decimal-choice-buttons').style.display = 'none';
                document.getElementById('decimal-answer-input').value = '';
                document.getElementById('decimal-answer-input').focus();
            } else {
                document.getElementById('decimal-answer-input').style.display = 'none';
                const choicesContainer = document.getElementById('decimal-choice-buttons');
                choicesContainer.style.display = 'flex';
                choicesContainer.innerHTML = '';
                
                question.choices.forEach(choice => {
                    const btn = document.createElement('button');
                    btn.className = 'choice-btn';
                    btn.textContent = choice;
                    btn.onclick = () => selectDecimalChoice(choice);
                    choicesContainer.appendChild(btn);
                });
            }

            document.getElementById('decimal-check-btn').style.display = 'inline-block';
            document.getElementById('decimal-new-question-btn').style.display = 'none';
            document.getElementById('decimal-feedback').className = 'feedback hidden';
        }

        function selectDecimalChoice(choice) {
            // Remove previous selections
            document.querySelectorAll('#decimal-choice-buttons .choice-btn').forEach(btn => {
                btn.style.background = 'white';
                btn.style.color = 'black';
            });
            
            // Highlight selected choice
            event.target.style.background = '#2196f3';
            event.target.style.color = 'white';
            decimalState.selectedChoice = choice;
        }

        function checkDecimalAnswer() {
            let userAnswer;
            
            if (decimalState.currentQuestion.type === 'input') {
                userAnswer = parseFloat(document.getElementById('decimal-answer-input').value);
            } else {
                userAnswer = decimalState.selectedChoice;
            }

            if (userAnswer === undefined || userAnswer === null || userAnswer === '') {
                alert('×× × ×”×›× ×™×¡×™ ×ª×©×•×‘×”!');
                return;
            }

            const isCorrect = userAnswer == decimalState.currentAnswer;
            
            // Update statistics
            decimalState.totalQuestions++;
            
            decimalState.sessionHistory.push({
                timestamp: Date.now(),
                question: decimalState.currentQuestion.question,
                userAnswer: userAnswer,
                correctAnswer: decimalState.currentAnswer,
                isCorrect: isCorrect,
                level: decimalState.level,
            });
            
            if (isCorrect) {
                decimalState.correctAnswers++;
                decimalState.currentStreak++;
                decimalState.consecutiveCorrect++;
                decimalState.consecutiveWrong = 0;

                if (decimalState.currentStreak > decimalState.bestStreak) {
                    decimalState.bestStreak = decimalState.currentStreak;
                }
            } else {
                decimalState.currentStreak = 0;
                decimalState.consecutiveWrong++;
                decimalState.consecutiveCorrect = 0;
            }
            
            saveProgress('decimal');

            // Show feedback
            const feedback = document.getElementById('decimal-feedback');
            if (isCorrect) {
                const encouragements = ['××¢×•×œ×”!', '×¤× ×˜×¡×˜×™!', '××ª ×’××•× ×™×ª!', '×›×œ ×”×›×‘×•×“!', '××•×©×œ×!'];
                const encouragement = encouragements[Math.floor(Math.random() * encouragements.length)];
                
                feedback.className = 'feedback correct';
                feedback.innerHTML = `âœ… ${encouragement} ×ª×©×•×‘×” × ×›×•× ×”!<br>ğŸ”Š ×›×œ ×”×›×‘×•×“ ×××”!`;
            } else {
                const encouragements = ['×œ× × ×•×¨×!', '× × ×¡×” ×©×•×‘!', '×›××¢×˜!', '××¤×©×¨ ×œ×œ××•×“ ××˜×¢×•×™×•×ª!', '×‘×¤×¢× ×”×‘××”!'];
                const encouragement = encouragements[Math.floor(Math.random() * encouragements.length)];
                
                feedback.className = 'feedback wrong';
                feedback.innerHTML = `âŒ ${encouragement}<br>×”×ª×©×•×‘×” ×”× ×›×•× ×”: ${decimalState.currentAnswer}<br>×”×”×¡×‘×¨: ${getDecimalExplanation()}`;
            }

            // Update level based on performance
            adjustDecimalDifficulty();
            updateStats('decimal');

            // Setup for next question
            document.getElementById('decimal-check-btn').style.display = 'none';
            document.getElementById('decimal-new-question-btn').style.display = 'inline-block';

            // Auto-generate next question after delay
            if (isCorrect) {
                setTimeout(() => {
                    generateDecimalQuestion();
                }, 1500);
            }

            // Check for celebrations
            if (decimalState.totalQuestions % 10 === 0) {
                showCelebration('decimal');
            }
        }

        function getDecimalExplanation() {
            const question = decimalState.currentQuestion;
            if (question.question.includes('=')) {
                return '×¤×¨×§ ××ª ×”××¡×¤×¨ ×œ×¤×™ ×¢×¨×š ×”××§×•× ×©×œ ×›×œ ×¡×¤×¨×”';
            } else if (question.question.includes('×¢×¨×š ×”×¡×¤×¨×”')) {
                return '×”×¡×¤×¨×” ×›×¤×•×œ ×¢×¨×š ×”××§×•× ×©×œ×”';
            } else if (question.question.includes('×¢×•×§×‘')) {
                return '×”××¡×¤×¨ ×”×¢×•×§×‘ ×”×•× ×”××¡×¤×¨ ×”×‘× ×‘×¨×¦×£ (+1)';
            } else if (question.question.includes('×§×•×“×')) {
                return '×”××¡×¤×¨ ×”×§×•×“× ×”×•× ×”××¡×¤×¨ ×”×§×•×“× ×‘×¨×¦×£ (-1)';
            } else {
                return '×‘×“×§×™ ××ª ×”×—×™×©×•×‘ ×©×•×‘';
            }
        }

        function adjustDecimalDifficulty() {
            if (decimalState.consecutiveCorrect >= 3 && decimalState.level !== '×§×©×”') {
                if (decimalState.level === '×§×œ') decimalState.level = '×‘×™× ×•× ×™';
                else if (decimalState.level === '×‘×™× ×•× ×™') decimalState.level = '×§×©×”';
                showLevelUp('decimal');
                decimalState.consecutiveCorrect = 0;
            } else if (decimalState.consecutiveWrong >= 2 && decimalState.level !== '×§×œ') {
                if (decimalState.level === '×§×©×”') decimalState.level = '×‘×™× ×•× ×™';
                else if (decimalState.level === '×‘×™× ×•× ×™') decimalState.level = '×§×œ';
                showLevelDown('decimal');
                decimalState.consecutiveWrong = 0;
            }
        }

        function showLevelUp(toolName) {
            const celebration = document.getElementById('celebration');
            const overlay = document.getElementById('overlay');
            
            celebration.innerHTML = `
                ğŸ‰ ×¢×œ×™×ª ×¨××”! ×›×œ ×”×›×‘×•×“!<br><br>
                ×¨××” ×—×“×©×”: <strong>${getState(toolName).level}</strong><br><br>
                <button class="check-btn" onclick="hideCelebration()">×”××©×™×›×™! ğŸ’ª</button>
            `;
            celebration.style.display = 'block';
            overlay.style.display = 'block';
        }

        function showLevelDown(toolName) {
            const celebration = document.getElementById('celebration');
            const overlay = document.getElementById('overlay');
            
            celebration.innerHTML = `
                ğŸ’™ ×™×•×¨×“×™× ×¨××” ×›×“×™ ×œ×ª×¨×’×œ ×™×•×ª×¨<br><br>
                ×¨××” ×—×“×©×”: <strong>${getState(toolName).level}</strong><br><br>
                <button class="check-btn" onclick="hideCelebration()">×‘×•××™ × ×ª×¨×’×œ! ğŸ’ª</button>
            `;
            celebration.style.display = 'block';
            overlay.style.display = 'block';
        }

        function getState(toolName) {
            const states = {
                decimal: decimalState,
                multiplication: multiplicationState,
                numberline: numberlineState
            };
            return states[toolName];
        }

        function showCelebration(toolName) {
            const state = getState(toolName);
            const celebration = document.getElementById('celebration');
            const overlay = document.getElementById('overlay');
            
            celebration.innerHTML = `
                ğŸŠ ×›×œ ×”×›×‘×•×“! ×¢×©×™×ª ${state.totalQuestions} ×©××œ×•×ª!<br><br>
                âœ… ${state.correctAnswers} × ×›×•× ×•×ª<br>
                ğŸ”¥ ×¨×¦×£: ${state.currentStreak}<br><br>
                <button class="check-btn" onclick="hideCelebration()">×”××©×™×›×™! ğŸš€</button>
            `;
            celebration.style.display = 'block';
            overlay.style.display = 'block';
        }

        function hideCelebration() {
            document.getElementById('celebration').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
        }

        // MULTIPLICATION TOOL FUNCTIONS
        function generateMultiplicationQuestion() {
            const types = ['missingMultiplier', 'missingMultiplicand', 'missingProduct', 'division'];
            const type = types[Math.floor(Math.random() * types.length)];
            
            let question = {};
            let answer;

            // Generate numbers based on level
            function getMultiplicationRange() {
                if (multiplicationState.level === '×§×œ') {
                    return { min: 1, max: 5 }; // 1-5
                } else if (multiplicationState.level === '×‘×™× ×•× ×™') {
                    return { min: 1, max: 10 }; // 1-10
                } else {
                    return { min: 1, max: 12 }; // 1-12
                }
            }

            const range = getMultiplicationRange();
            const num1 = Math.floor(Math.random() * range.max) + range.min;
            const num2 = Math.floor(Math.random() * range.max) + range.min;
            const product = num1 * num2;

            switch (type) {
                case 'missingMultiplier':
                    question = {
                        question: `${num1} Ã— ___ = ${product}`,
                        type: 'input'
                    };
                    answer = num2;
                    break;

                case 'missingMultiplicand':
                    question = {
                        question: `___ Ã— ${num2} = ${product}`,
                        type: 'input'
                    };
                    answer = num1;
                    break;

                case 'missingProduct':
                    question = {
                        question: `${num1} Ã— ${num2} = ___`,
                        type: 'input'
                    };
                    answer = product;
                    break;

                case 'division':
                    question = {
                        question: `×× ${num1} Ã— ${num2} = ${product}, ××– ${product} Ã· ${num1} = ___`,
                        type: 'input'
                    };
                    answer = num2;
                    break;
            }

            multiplicationState.currentQuestion = question;
            multiplicationState.currentAnswer = answer;

            // Display question
            document.getElementById('multiplication-question').textContent = question.question;
            
            // Setup answer interface
            document.getElementById('multiplication-answer-input').style.display = 'inline-block';
            document.getElementById('multiplication-choice-buttons').style.display = 'none';
            document.getElementById('multiplication-answer-input').value = '';
            document.getElementById('multiplication-answer-input').focus();

            document.getElementById('multiplication-check-btn').style.display = 'inline-block';
            document.getElementById('multiplication-new-question-btn').style.display = 'none';
            document.getElementById('multiplication-feedback').className = 'feedback hidden';
        }

        function checkMultiplicationAnswer() {
            const userAnswer = parseFloat(document.getElementById('multiplication-answer-input').value);

            if (isNaN(userAnswer)) {
                alert('×× × ×”×›× ×™×¡×™ ××¡×¤×¨!');
                return;
            }

            const isCorrect = userAnswer === multiplicationState.currentAnswer;
            
            // Update statistics
            multiplicationState.totalQuestions++;
            
            multiplicationState.sessionHistory.push({
                timestamp: Date.now(),
                question: multiplicationState.currentQuestion.question,
                userAnswer: userAnswer,
                correctAnswer: multiplicationState.currentAnswer,
                isCorrect: isCorrect,
                level: multiplicationState.level,
            });
            
            if (isCorrect) {
                multiplicationState.correctAnswers++;
                multiplicationState.currentStreak++;
                multiplicationState.consecutiveCorrect++;
                multiplicationState.consecutiveWrong = 0;

                if (multiplicationState.currentStreak > multiplicationState.bestStreak) {
                    multiplicationState.bestStreak = multiplicationState.currentStreak;
                }
            } else {
                multiplicationState.currentStreak = 0;
                multiplicationState.consecutiveWrong++;
                multiplicationState.consecutiveCorrect = 0;
            }
            
            saveProgress('multiplication');

            // Show feedback
            const feedback = document.getElementById('multiplication-feedback');
            if (isCorrect) {
                const encouragements = ['××¢×•×œ×”!', '×¤× ×˜×¡×˜×™!', '××ª ×’××•× ×™×ª!', '×›×œ ×”×›×‘×•×“!', '××•×©×œ×!'];
                const encouragement = encouragements[Math.floor(Math.random() * encouragements.length)];
                
                feedback.className = 'feedback correct';
                feedback.innerHTML = `âœ… ${encouragement} ×ª×©×•×‘×” × ×›×•× ×”!<br>ğŸ”Š ×›×œ ×”×›×‘×•×“ ×××”!`;
            } else {
                const encouragements = ['×œ× × ×•×¨×!', '× × ×¡×” ×©×•×‘!', '×›××¢×˜!', '××¤×©×¨ ×œ×œ××•×“ ××˜×¢×•×™×•×ª!', '×‘×¤×¢× ×”×‘××”!'];
                const encouragement = encouragements[Math.floor(Math.random() * encouragements.length)];
                
                feedback.className = 'feedback wrong';
                feedback.innerHTML = `âŒ ${encouragement}<br>×”×ª×©×•×‘×” ×”× ×›×•× ×”: ${multiplicationState.currentAnswer}<br>×”×”×¡×‘×¨: ×ª×¨×’×œ×™ ××ª ×œ×•×— ×”×›×¤×œ!`;
            }

            // Update level based on performance
            adjustMultiplicationDifficulty();
            updateStats('multiplication');

            // Setup for next question
            document.getElementById('multiplication-check-btn').style.display = 'none';
            document.getElementById('multiplication-new-question-btn').style.display = 'inline-block';

            // Auto-generate next question after delay
            if (isCorrect) {
                setTimeout(() => {
                    generateMultiplicationQuestion();
                }, 1500);
            }

            // Check for celebrations
            if (multiplicationState.totalQuestions % 10 === 0) {
                showCelebration('multiplication');
            }
        }

        function adjustMultiplicationDifficulty() {
            if (multiplicationState.consecutiveCorrect >= 3 && multiplicationState.level !== '×§×©×”') {
                if (multiplicationState.level === '×§×œ') multiplicationState.level = '×‘×™× ×•× ×™';
                else if (multiplicationState.level === '×‘×™× ×•× ×™') multiplicationState.level = '×§×©×”';
                showLevelUp('multiplication');
                multiplicationState.consecutiveCorrect = 0;
            } else if (multiplicationState.consecutiveWrong >= 2 && multiplicationState.level !== '×§×œ') {
                if (multiplicationState.level === '×§×©×”') multiplicationState.level = '×‘×™× ×•× ×™';
                else if (multiplicationState.level === '×‘×™× ×•× ×™') multiplicationState.level = '×§×œ';
                showLevelDown('multiplication');
                multiplicationState.consecutiveWrong = 0;
            }
        }

        // NUMBER LINE TOOL FUNCTIONS
        function generateNumberlineQuestion() {
            const types = ['whereIsNumber', 'whatIsNumber', 'betweenNumbers', 'closerTo'];
            const type = types[Math.floor(Math.random() * types.length)];
            
            let question = {};
            let answer;

            // Generate range based on level
            function getNumberlineRange() {
                if (numberlineState.level === '×§×œ') {
                    return { min: 0, max: 100, interval: 10 };
                } else if (numberlineState.level === '×‘×™× ×•× ×™') {
                    return { min: 0, max: 500, interval: 50 };
                } else {
                    return { min: 0, max: 1000, interval: 100 };
                }
            }

            const range = getNumberlineRange();

            switch (type) {
                case 'whereIsNumber':
                    const targetNum = Math.floor(Math.random() * (range.max / range.interval)) * range.interval;
                    question = {
                        question: `×”×™×›×Ÿ × ××¦× ×”××¡×¤×¨ ${targetNum} ×¢×œ ×”×™×©×¨?`,
                        type: 'visual',
                        range: range,
                        targetNum: targetNum
                    };
                    answer = targetNum;
                    break;

                case 'whatIsNumber':
                    const arrowPosition = Math.floor(Math.random() * (range.max / range.interval)) * range.interval;
                    question = {
                        question: `××™×–×” ××¡×¤×¨ ××¡×•××Ÿ ×‘×—×¥?`,
                        type: 'input',
                        range: range,
                        arrowPosition: arrowPosition
                    };
                    answer = arrowPosition;
                    break;

                case 'betweenNumbers':
                    const num1 = Math.floor(Math.random() * (range.max / range.interval / 2)) * range.interval;
                    const num2 = num1 + range.interval * 2;
                    const between = (num1 + num2) / 2;
                    question = {
                        question: `××™×–×” ××¡×¤×¨ × ××¦× ×‘×“×™×•×§ ×‘×××¦×¢ ×‘×™×Ÿ ${num1} ×œ-${num2}?`,
                        type: 'input'
                    };
                    answer = between;
                    break;

                case 'closerTo':
                    const baseNum = Math.floor(Math.random() * (range.max / range.interval)) * range.interval;
                    const testNum = baseNum + Math.floor(range.interval * 0.3);
                    const option1 = baseNum;
                    const option2 = baseNum + range.interval;
                    question = {
                        question: `×”××¡×¤×¨ ${testNum} ×§×¨×•×‘ ×™×•×ª×¨ ×œ-${option1} ××• ×œ-${option2}?`,
                        type: 'choice',
                        choices: [option1, option2]
                    };
                    answer = Math.abs(testNum - option1) < Math.abs(testNum - option2) ? option1 : option2;
                    break;
            }

            numberlineState.currentQuestion = question;
            numberlineState.currentAnswer = answer;

            // Display question
            document.getElementById('numberline-question').textContent = question.question;
            
            // Display number line if needed
            if (question.type === 'visual') {
                displayNumberLine(question);
            } else {
                document.getElementById('numberline-visual').style.display = 'none';
            }

            // Setup answer interface
            if (question.type === 'input') {
                document.getElementById('numberline-answer-input').style.display = 'inline-block';
                document.getElementById('numberline-choice-buttons').style.display = 'none';
                document.getElementById('numberline-answer-input').value = '';
                document.getElementById('numberline-answer-input').focus();
            } else if (question.type === 'choice') {
                document.getElementById('numberline-answer-input').style.display = 'none';
                const choicesContainer = document.getElementById('numberline-choice-buttons');
                choicesContainer.style.display = 'flex';
                choicesContainer.innerHTML = '';
                
                question.choices.forEach(choice => {
                    const btn = document.createElement('button');
                    btn.className = 'choice-btn';
                    btn.textContent = choice;
                    btn.onclick = () => selectNumberlineChoice(choice);
                    choicesContainer.appendChild(btn);
                });
            }

            document.getElementById('numberline-check-btn').style.display = 'inline-block';
            document.getElementById('numberline-new-question-btn').style.display = 'none';
            document.getElementById('numberline-feedback').className = 'feedback hidden';
        }

        function displayNumberLine(question) {
            const container = document.getElementById('numberline-visual');
            container.style.display = 'block';
            
            const lineElement = document.getElementById('numberline-line');
            lineElement.innerHTML = '';

            const range = question.range;
            const steps = range.max / range.interval;

            // Create markers
            for (let i = 0; i <= steps; i++) {
                const value = i * range.interval;
                const position = (i / steps) * 100;

                const marker = document.createElement('div');
                marker.className = 'marker';
                marker.style.left = position + '%';
                lineElement.appendChild(marker);

                const label = document.createElement('div');
                label.className = 'marker-label';
                label.style.left = position + '%';
                label.textContent = value;
                lineElement.appendChild(label);
            }

            // Add arrow if specified
            if (question.arrowPosition !== undefined) {
                const arrowPos = (question.arrowPosition / range.max) * 100;
                const arrow = document.createElement('div');
                arrow.className = 'arrow';
                arrow.textContent = 'â¬‡ï¸';
                arrow.style.left = arrowPos + '%';
                lineElement.appendChild(arrow);
            }
        }

        function selectNumberlineChoice(choice) {
            document.querySelectorAll('#numberline-choice-buttons .choice-btn').forEach(btn => {
                btn.style.background = 'white';
                btn.style.color = 'black';
            });
            
            event.target.style.background = '#ff9800';
            event.target.style.color = 'white';
            numberlineState.selectedChoice = choice;
        }

        function checkNumberlineAnswer() {
            let userAnswer;
            
            if (numberlineState.currentQuestion.type === 'input') {
                userAnswer = parseFloat(document.getElementById('numberline-answer-input').value);
            } else {
                userAnswer = numberlineState.selectedChoice;
            }

            if (userAnswer === undefined || userAnswer === null || userAnswer === '') {
                alert('×× × ×”×›× ×™×¡×™ ×ª×©×•×‘×”!');
                return;
            }

            const isCorrect = userAnswer == numberlineState.currentAnswer;
            
            // Update statistics
            numberlineState.totalQuestions++;
            
            numberlineState.sessionHistory.push({
                timestamp: Date.now(),
                question: numberlineState.currentQuestion.question,
                userAnswer: userAnswer,
                correctAnswer: numberlineState.currentAnswer,
                isCorrect: isCorrect,
                level: numberlineState.level,
            });
            
            if (isCorrect) {
                numberlineState.correctAnswers++;
                numberlineState.currentStreak++;
                numberlineState.consecutiveCorrect++;
                numberlineState.consecutiveWrong = 0;

                if (numberlineState.currentStreak > numberlineState.bestStreak) {
                    numberlineState.bestStreak = numberlineState.currentStreak;
                }
            } else {
                numberlineState.currentStreak = 0;
                numberlineState.consecutiveWrong++;
                numberlineState.consecutiveCorrect = 0;
            }
            
            saveProgress('numberline');

            // Show feedback
            const feedback = document.getElementById('numberline-feedback');
            if (isCorrect) {
                const encouragements = ['××¢×•×œ×”!', '×¤× ×˜×¡×˜×™!', '××ª ×’××•× ×™×ª!', '×›×œ ×”×›×‘×•×“!', '××•×©×œ×!'];
                const encouragement = encouragements[Math.floor(Math.random() * encouragements.length)];
                
                feedback.className = 'feedback correct';
                feedback.innerHTML = `âœ… ${encouragement} ×ª×©×•×‘×” × ×›×•× ×”!<br>ğŸ”Š ×›×œ ×”×›×‘×•×“ ×××”!`;
            } else {
                const encouragements = ['×œ× × ×•×¨×!', '× × ×¡×” ×©×•×‘!', '×›××¢×˜!', '××¤×©×¨ ×œ×œ××•×“ ××˜×¢×•×™×•×ª!', '×‘×¤×¢× ×”×‘××”!'];
                const encouragement = encouragements[Math.floor(Math.random() * encouragements.length)];
                
                feedback.className = 'feedback wrong';
                feedback.innerHTML = `âŒ ${encouragement}<br>×”×ª×©×•×‘×” ×”× ×›×•× ×”: ${numberlineState.currentAnswer}`;
            }

            // Update level based on performance
            adjustNumberlineDifficulty();
            updateStats('numberline');

            // Setup for next question
            document.getElementById('numberline-check-btn').style.display = 'none';
            document.getElementById('numberline-new-question-btn').style.display = 'inline-block';

            // Auto-generate next question after delay
            if (isCorrect) {
                setTimeout(() => {
                    generateNumberlineQuestion();
                }, 1500);
            }

            // Check for celebrations
            if (numberlineState.totalQuestions % 10 === 0) {
                showCelebration('numberline');
            }
        }

        function adjustNumberlineDifficulty() {
            if (numberlineState.consecutiveCorrect >= 3 && numberlineState.level !== '×§×©×”') {
                if (numberlineState.level === '×§×œ') numberlineState.level = '×‘×™× ×•× ×™';
                else if (numberlineState.level === '×‘×™× ×•× ×™') numberlineState.level = '×§×©×”';
                showLevelUp('numberline');
                numberlineState.consecutiveCorrect = 0;
            } else if (numberlineState.consecutiveWrong >= 2 && numberlineState.level !== '×§×œ') {
                if (numberlineState.level === '×§×©×”') numberlineState.level = '×‘×™× ×•× ×™';
                else if (numberlineState.level === '×‘×™× ×•× ×™') numberlineState.level = '×§×œ';
                showLevelDown('numberline');
                numberlineState.consecutiveWrong = 0;
            }
        }

        // PAUSE/RESET/EXPORT FUNCTIONS for all tools
        function pauseDecimalExercise() {
            showPauseSummary('decimal');
        }

        function pauseMultiplicationExercise() {
            showPauseSummary('multiplication');
        }

        function pauseNumberlineExercise() {
            showPauseSummary('numberline');
        }

        function showPauseSummary(toolName) {
            const state = getState(toolName);
            const percentage = state.totalQuestions > 0 ? 
                Math.round((state.correctAnswers / state.totalQuestions) * 100) : 0;
            
            const celebration = document.getElementById('celebration');
            const overlay = document.getElementById('overlay');
            
            celebration.innerHTML = `
                â¸ï¸ ×¡×™×›×•× ×‘×™× ×™×™×<br><br>
                ×©××œ×•×ª: ${state.totalQuestions}<br>
                × ×›×•× ×•×ª: ${state.correctAnswers} (${percentage}%)<br>
                ×¨×¦×£ ××§×¡×™××œ×™: ${state.bestStreak}<br>
                ×¨××”: ${state.level}<br><br>
                <button class="check-btn" onclick="hideCelebration()">×”××©×š ×ª×¨×’×•×œ ğŸš€</button>
                <button class="check-btn" onclick="showSection('home')" style="background: #2196f3; margin-top: 10px;">×—×–×¨×” ×œ×“×£ ×”×‘×™×ª ğŸ </button>
            `;
            celebration.style.display = 'block';
            overlay.style.display = 'block';
        }

        function resetDecimalProgress() {
            resetToolProgress('decimal', 'emmaDecimalProgress');
        }

        function resetMultiplicationProgress() {
            resetToolProgress('multiplication', 'emmaMultiplicationProgress');
        }

        function resetNumberlineProgress() {
            resetToolProgress('numberline', 'emmaNumberLineProgress');
        }

        // Show reset options
        function showResetOptions(toolName) {
            const celebration = document.getElementById('celebration');
            const overlay = document.getElementById('overlay');
            
            celebration.innerHTML = `
                <div style="font-size: 16pt;">âš ï¸ <strong>××¤×©×¨×•×™×•×ª ××™×¤×•×¡</strong></div><br>
                ×‘×—×¨×™ ××” ×œ××¤×¡:<br><br>
                <button class="check-btn" onclick="resetOnlyStats('${toolName}')" style="background: #ff9800; margin: 5px;">ğŸ“Š ×¨×§ ×¡×˜×˜×™×¡×˜×™×§×•×ª<br><small style="font-size: 12pt;">(×©×•××¨ ××ª ×”×™×•××Ÿ ×”××¤×•×¨×˜)</small></button><br>
                <button class="check-btn" onclick="resetEverything('${toolName}')" style="background: #f44336; margin: 5px;">ğŸ—‘ï¸ ×”×›×œ (×¡×˜×˜×™×¡×˜×™×§×•×ª + ×™×•××Ÿ)<br><small style="font-size: 12pt;">(××™×¤×•×¡ ××œ× - ×œ× × ×™×ª×Ÿ ×œ×©×—×–×¨!)</small></button><br>
                <button class="check-btn" onclick="hideCelebration()" style="background: #9e9e9e; margin: 5px;">âŒ ×‘×™×˜×•×œ</button>
            `;
            celebration.style.display = 'block';
            overlay.style.display = 'block';
        }

        // Reset only statistics (keep history)
        function resetOnlyStats(toolName) {
            if (confirm('ğŸ“Š ××™×¤×•×¡ ×¡×˜×˜×™×¡×˜×™×§×•×ª ×‘×œ×‘×“\n\n×–×” ×™××¤×¡:\nâœ“ × ×™×§×•×“\nâœ“ ×¨×¦×¤×™×\nâœ“ ×¨××”\n\n×–×” ×™×©××•×¨:\nâœ“ ×™×•××Ÿ ××¤×•×¨×˜ ×©×œ ×›×œ ×”×©××œ×•×ª\nâœ“ ×ª××¨×™×š ×”×ª×—×œ×”\n\n×œ×”××©×™×š?')) {
                const keys = {
                    decimal: 'emmaDecimalProgress',
                    multiplication: 'emmaMultiplicationProgress',
                    numberline: 'emmaNumberLineProgress'
                };
                
                const states = {
                    decimal: decimalState,
                    multiplication: multiplicationState,
                    numberline: numberlineState
                };
                
                const state = states[toolName];
                const savedHistory = state.sessionHistory;
                const savedStartTime = state.startTime;
                
                state.level = '×‘×™× ×•× ×™';
                state.totalQuestions = 0;
                state.correctAnswers = 0;
                state.currentStreak = 0;
                state.bestStreak = 0;
                state.consecutiveCorrect = 0;
                state.consecutiveWrong = 0;
                state.currentQuestion = null;
                state.currentAnswer = null;
                // Keep history!
                state.sessionHistory = savedHistory;
                state.startTime = savedStartTime;
                
                saveProgress(toolName);
                updateStats(toolName);
                
                hideCelebration();
                alert('âœ… ×¡×˜×˜×™×¡×˜×™×§×•×ª ××•×¤×¡×•!\nğŸ“‹ ×”×™×•××Ÿ ×”××¤×•×¨×˜ × ×©××¨.');
            } else {
                hideCelebration();
            }
        }

        // Reset everything
        function resetEverything(toolName) {
            if (confirm('âš ï¸ ××™×¤×•×¡ ××œ× - ××–×”×¨×”!\n\n×–×” ×™××—×§ ×œ×¦××™×ª×•×ª:\nâœ— ×›×œ ×”×¡×˜×˜×™×¡×˜×™×§×•×ª\nâœ— ×›×œ ×”×™×•××Ÿ ×”××¤×•×¨×˜\nâœ— ×›×œ ×”×ª×©×•×‘×•×ª\n\nâš ï¸ ×œ× × ×™×ª×Ÿ ×œ×©×—×–×¨!\n\nğŸ’¡ ××•××œ×¥ ×œ×™×™×¦× ×’×™×‘×•×™ ×œ×¤× ×™!\n\n×‘×˜×•×—×”?')) {
                const keys = {
                    decimal: 'emmaDecimalProgress',
                    multiplication: 'emmaMultiplicationProgress',
                    numberline: 'emmaNumberLineProgress'
                };
                
                resetToolProgress(toolName, keys[toolName]);
                hideCelebration();
            } else {
                hideCelebration();
            }
        }

        function resetToolProgress(toolName, storageKey) {
            localStorage.removeItem(storageKey);
            
            const states = {
                decimal: decimalState,
                multiplication: multiplicationState,
                numberline: numberlineState
            };
            
            const state = states[toolName];
            state.level = '×‘×™× ×•× ×™';
            state.totalQuestions = 0;
            state.correctAnswers = 0;
            state.currentStreak = 0;
            state.bestStreak = 0;
            state.consecutiveCorrect = 0;
            state.consecutiveWrong = 0;
            state.currentQuestion = null;
            state.currentAnswer = null;
            state.sessionHistory = [];
            state.startTime = Date.now();
            state.lastSaved = null;

            updateStats(toolName);
            
            document.getElementById(`${toolName}-question`).textContent = '×œ×—×¦×™ ×¢×œ "×©××œ×” ×—×“×©×”" ×›×“×™ ×œ×”×ª×—×™×œ! ğŸš€';
            document.getElementById(`${toolName}-feedback`).className = 'feedback hidden';
            document.getElementById(`${toolName}-check-btn`).style.display = 'none';
            document.getElementById(`${toolName}-new-question-btn`).style.display = 'inline-block';
            document.getElementById(`${toolName}-answer-input`).style.display = 'none';
        }

        function exportDecimalReport() {
            exportReport('decimal', '××‘× ×” ×¢×©×¨×•× ×™');
        }

        function exportMultiplicationReport() {
            exportReport('multiplication', '×”×©×œ××ª ×’×•×¨× ×•××›×¤×œ×”');
        }

        function exportNumberlineReport() {
            exportReport('numberline', '×™×©×¨ ×”××¡×¤×¨×™×');
        }

        function exportReport(toolName, toolTitle) {
            const state = getState(toolName);
            const percentage = state.totalQuestions > 0 ? 
                Math.round((state.correctAnswers / state.totalQuestions) * 100) : 0;
            
            const totalTime = Math.floor((Date.now() - state.startTime) / 1000 / 60);
            const avgTimePerQuestion = state.totalQuestions > 0 ? 
                Math.round((Date.now() - state.startTime) / 1000 / state.totalQuestions) : 0;
            
            const levelCounts = { ×§×œ: 0, ×‘×™× ×•× ×™: 0, ×§×©×”: 0 };
            state.sessionHistory.forEach(h => {
                if (levelCounts[h.level] !== undefined) levelCounts[h.level]++;
            });
            
            const reportText = `
ğŸ“Š ×“×•×— ×ª×¨×’×•×œ ${toolTitle} - ×××”
${'='.repeat(50)}

ğŸ“… ×ª××¨×™×š: ${new Date().toLocaleDateString('he-IL')}
â° ×©×¢×”: ${new Date().toLocaleTimeString('he-IL')}

ğŸ“ˆ ×¡×˜×˜×™×¡×˜×™×§×•×ª ×›×œ×œ×™×•×ª:
${'-'.repeat(50)}
âœ… ×¡×”"×› ×©××œ×•×ª: ${state.totalQuestions}
âœ… ×ª×©×•×‘×•×ª × ×›×•× ×•×ª: ${state.correctAnswers}
âŒ ×ª×©×•×‘×•×ª ×©×’×•×™×•×ª: ${state.totalQuestions - state.correctAnswers}
ğŸ“Š ××—×•×– ×”×¦×œ×—×”: ${percentage}%
ğŸ”¥ ×¨×¦×£ ××§×¡×™××œ×™: ${state.bestStreak}
â±ï¸ ×–××Ÿ ×›×•×œ×œ: ${totalTime} ×“×§×•×ª
âš¡ ×××•×¦×¢ ×–××Ÿ ×œ×©××œ×”: ${avgTimePerQuestion} ×©× ×™×•×ª

ğŸ“Š ×¤×™×œ×•×— ×œ×¤×™ ×¨××•×ª:
${'-'.repeat(50)}
ğŸŒ± ×¨××” ×§×œ×”: ${levelCounts['×§×œ']} ×©××œ×•×ª
ğŸ”¥ ×¨××” ×‘×™× ×•× ×™×ª: ${levelCounts['×‘×™× ×•× ×™']} ×©××œ×•×ª
âš¡ ×¨××” ×§×©×”: ${levelCounts['×§×©×”']} ×©××œ×•×ª

ğŸ¯ ×¨××” × ×•×›×—×™×ª: ${state.level}

ğŸ’ª ×”×¢×¨×›×”:
${'-'.repeat(50)}
${getPerformanceEvaluation(percentage, state.bestStreak)}

ğŸŒŸ ×”××œ×¦×•×ª:
${'-'.repeat(50)}
${getRecommendations(percentage, state.level)}

${'='.repeat(50)}
× ×•×¦×¨ ×¢×œ ×™×“×™: ××¢×¨×›×ª ×ª×¨×’×•×œ ×œ××©×™××”
×‘×”×¦×œ×—×” ×‘××©×™××”! ğŸ“
            `;
            
            const blob = new Blob([reportText], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `×“×•×—-${toolTitle}-×××”-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            const celebration = document.getElementById('celebration');
            const overlay = document.getElementById('overlay');
            
            celebration.innerHTML = `
                âœ… ×”×“×•×— ×™×•×¦× ×‘×”×¦×œ×—×”!<br><br>
                ğŸ“„ <strong>×©× ×”×§×•×‘×¥:</strong> ×“×•×—-${toolTitle}-×××”-${new Date().toISOString().split('T')[0]}.txt<br>
                ğŸ“ <strong>××™×§×•×:</strong> ×ª×™×§×™×™×ª ×”×”×•×¨×“×•×ª ×©×œ×š (Downloads)<br><br>
                ğŸ“Š ${state.totalQuestions} ×©××œ×•×ª<br>
                âœ… ${percentage}% ×”×¦×œ×—×”<br><br>
                <button class="check-btn" onclick="hideCelebration()">×¡×’×•×¨</button>
            `;
            celebration.style.display = 'block';
            overlay.style.display = 'block';
        }

        function getPerformanceEvaluation(percentage, bestStreak) {
            if (percentage >= 90) {
                return 'ğŸŒŸ ××¢×•×œ×”! ×××” ×©×•×œ×˜×ª ×‘× ×•×©× ×‘×¨××” ×’×‘×•×”×” ×××•×“!';
            } else if (percentage >= 75) {
                return 'ğŸ’ª ×˜×•×‘ ×××•×“! ×××” ××ª×§×“××ª × ×”×“×¨, ×”××©×™×›×™ ×›×š!';
            } else if (percentage >= 60) {
                return 'ğŸ‘ ×™×¤×”! ×™×© ×”×ª×§×“××•×ª ×˜×•×‘×”, ×›×“××™ ×œ×”××©×™×š ×œ×ª×¨×’×œ.';
            } else {
                return 'ğŸ’™ ×©×™××™ ×œ×‘ - ×›×“××™ ×œ×ª×¨×’×œ ×¢×•×“ ×•×œ×—×–×•×¨ ×¢×œ ×”×—×•××¨.';
            }
        }

        function getRecommendations(percentage, level) {
            let recs = [];
            
            if (percentage < 70) {
                recs.push('â€¢ ×ª×¨×’×œ×™ 15-20 ×“×§×•×ª ×›×œ ×™×•×');
                recs.push('â€¢ ×ª×ª××§×“×™ ×‘× ×•×©××™× ×©×˜×¢×™×ª ×‘×”×');
                recs.push('â€¢ ×§×¨××™ ××ª ×”×”×¡×‘×¨×™× ×‘×¢×™×•×Ÿ');
            }
            
            if (level === '×§×œ') {
                recs.push('â€¢ × ×¡×™ ×œ×”×’×™×¢ ×œ×¨××” ×‘×™× ×•× ×™×ª');
                recs.push('â€¢ ×ª×¨×’×œ×™ ×¢×•×“ ×›×“×™ ×œ×©×¤×¨');
            } else if (level === '×‘×™× ×•× ×™') {
                recs.push('â€¢ ×”××©×™×›×™ ×œ×ª×¨×’×œ - ××ª ×‘×“×¨×š ×”× ×›×•× ×”!');
                recs.push('â€¢ × ×¡×™ ×œ×”×’×™×¢ ×œ×¨××” ×§×©×”');
            } else {
                recs.push('â€¢ ××¦×•×™×Ÿ! ××ª ×‘×¨××” ×”×’×‘×•×”×” ×‘×™×•×ª×¨!');
                recs.push('â€¢ ×”××©×™×›×™ ×œ×©××•×¨ ×¢×œ ×”×¨××”');
            }
            
            recs.push('â€¢ ×—×–×¨×™ ×¢×œ ×”××—×‘×¨×•×ª ×•×”×¡×¤×¨×™×');
            
            return recs.join('\n');
        }

        // HOME PAGE FUNCTIONS
        function loadAllProgress() {
            const tools = ['decimal', 'multiplication', 'numberline'];
            const keys = {
                decimal: 'emmaDecimalProgress',
                multiplication: 'emmaMultiplicationProgress',
                numberline: 'emmaNumberLineProgress'
            };

            let totalQuestions = 0;
            let totalCorrect = 0;
            let totalTime = 0;

            tools.forEach(tool => {
                const saved = localStorage.getItem(keys[tool]);
                if (saved) {
                    try {
                        const data = JSON.parse(saved);
                        totalQuestions += data.totalQuestions || 0;
                        totalCorrect += data.correctAnswers || 0;
                        if (data.startTime) {
                            totalTime += (Date.now() - data.startTime);
                        }

                        // Update card progress
                        updateCardProgress(tool, data);
                    } catch (e) {
                        console.error(`Error loading ${tool}:`, e);
                    }
                } else {
                    // No progress - show new
                    updateCardProgress(tool, null);
                }
            });

            // Update overall stats
            document.getElementById('total-questions-all').textContent = totalQuestions;
            document.getElementById('total-correct-all').textContent = totalCorrect;
            
            const avgSuccess = totalQuestions > 0 ? Math.round((totalCorrect / totalQuestions) * 100) : 0;
            document.getElementById('average-success').textContent = avgSuccess + '%';
            
            const totalMinutes = Math.floor(totalTime / 1000 / 60);
            document.getElementById('study-time').textContent = totalMinutes;

            // Update encouragement message
            updateEncouragementMessage(totalQuestions, avgSuccess);

            // Update countdown
            updateCountdown();
        }

        function updateCardProgress(tool, data) {
            const progressDiv = document.getElementById(`${tool}-progress`);
            
            if (!data || data.totalQuestions === 0) {
                progressDiv.className = 'progress-indicator no-progress';
                progressDiv.innerHTML = '<div class="progress-text">ğŸ†• ×”×ª×—×œ ×ª×¨×’×•×œ ×—×“×©</div>';
            } else {
                const percentage = Math.round((data.correctAnswers / data.totalQuestions) * 100);
                progressDiv.className = 'progress-indicator has-progress';
                progressDiv.innerHTML = `
                    <div class="progress-text">âœ… ${data.totalQuestions} ×©××œ×•×ª | ${percentage}% ×”×¦×œ×—×”</div>
                    <div class="progress-bar">
                        <div class="progress-fill ${tool}" style="width: ${percentage}%; border-radius: 4px;"></div>
                    </div>
                    <div class="progress-text" style="font-size: 11pt; margin-top: 5px;">×”××©×š ×××™×¤×” ×©×¢×¦×¨×ª</div>
                `;
            }
        }

        function updateEncouragementMessage(totalQuestions, avgSuccess) {
            const msgElement = document.getElementById('main-encouragement');
            
            if (totalQuestions === 0) {
                msgElement.textContent = 'ğŸŒŸ ×‘×•××™ × ×ª×—×™×œ ×œ×ª×¨×’×œ! ×›×œ ×ª×¨×’×•×œ ××§×¨×‘ ××•×ª×š ×œ×”×¦×œ×—×” ×‘××©×™××”!';
            } else if (avgSuccess >= 80) {
                msgElement.textContent = `ğŸ‰ ×›×œ ×”×›×‘×•×“! ××ª ×¢×•×©×” ×¢×‘×•×“×” ××¢×•×œ×” ×¢× ${avgSuccess}% ×”×¦×œ×—×”!`;
            } else if (avgSuccess >= 60) {
                msgElement.textContent = `ğŸ’ª ×™×¤×”! ×”××©×™×›×™ ×›×š - ××ª ×‘×“×¨×š ×”× ×›×•× ×” ×¢× ${avgSuccess}% ×”×¦×œ×—×”!`;
            } else {
                msgElement.textContent = `ğŸ’™ ×ª××©×™×›×™ ×œ×ª×¨×’×œ - ×›×œ ×©××œ×” ××§×“××ª ××•×ª×š! ×›×¨×’×¢ ${avgSuccess}% ×”×¦×œ×—×”.`;
            }
        }

        function updateCountdown() {
            const examDate = new Date('2024-11-18');
            const today = new Date();
            const diffTime = examDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            const countdownElement = document.getElementById('countdown');
            
            if (diffDays > 0) {
                countdownElement.textContent = `â° ${diffDays} ×™××™× ×œ××©×™××”!`;
                if (diffDays <= 3) {
                    countdownElement.style.background = '#ffcdd2';
                    countdownElement.style.borderColor = '#e53935';
                }
            } else if (diffDays === 0) {
                countdownElement.textContent = 'â° ×”××©×™××” ×”×™×•×! ×‘×”×¦×œ×—×”! ğŸ‰';
                countdownElement.style.background = '#fff9c4';
                countdownElement.style.borderColor = '#fbc02d';
            } else {
                countdownElement.textContent = 'âœ… ×”××©×™××” ×”×™×™×ª×”! ×ª××©×™×›×™ ×œ×ª×¨×’×œ! ğŸ’ª';
                countdownElement.style.background = '#c8e6c9';
                countdownElement.style.borderColor = '#66bb6a';
            }
        }

        // View detailed history
        function viewDetailedHistory(toolName) {
            const state = getState(toolName);
            const titles = {
                decimal: '××‘× ×” ×¢×©×¨×•× ×™',
                multiplication: '×”×©×œ××ª ×’×•×¨× ×•××›×¤×œ×”',
                numberline: '×™×©×¨ ×”××¡×¤×¨×™×'
            };

            if (!state.sessionHistory || state.sessionHistory.length === 0) {
                alert('××™×Ÿ ×¢×“×™×™×Ÿ ×”×™×¡×˜×•×¨×™×” ×œ×ª×¦×•×’×”.\n×”×ª×—×™×œ×™ ×œ×ª×¨×’×œ!');
                return;
            }

            let historyHTML = `
                <div style="max-height: 500px; overflow-y: auto; text-align: right; font-size: 12pt;">
                <strong style="font-size: 18pt;">ğŸ“‹ ×™×•××Ÿ ××¤×•×¨×˜ - ${titles[toolName]}</strong><br>
                <small>×¡×”"×› ${state.sessionHistory.length} ×©××œ×•×ª</small><br><br>
                <table style="width: 100%; border-collapse: collapse; font-size: 11pt;">
                <tr style="background: #e3f2fd; font-weight: bold;">
                    <td style="padding: 8px; border: 1px solid #ddd;">#</td>
                    <td style="padding: 8px; border: 1px solid #ddd;">×©××œ×”</td>
                    <td style="padding: 8px; border: 1px solid #ddd;">×ª×©×•×‘×” ×©×œ×š</td>
                    <td style="padding: 8px; border: 1px solid #ddd;">×ª×©×•×‘×” × ×›×•× ×”</td>
                    <td style="padding: 8px; border: 1px solid #ddd;">×ª×•×¦××”</td>
                    <td style="padding: 8px; border: 1px solid #ddd;">×¨××”</td>
                </tr>
            `;

            state.sessionHistory.forEach((item, index) => {
                const bgColor = item.isCorrect ? '#e8f5e9' : '#ffebee';
                const resultIcon = item.isCorrect ? 'âœ…' : 'âŒ';
                historyHTML += `
                    <tr style="background: ${bgColor};">
                        <td style="padding: 6px; border: 1px solid #ddd;">${index + 1}</td>
                        <td style="padding: 6px; border: 1px solid #ddd;">${item.question}</td>
                        <td style="padding: 6px; border: 1px solid #ddd;"><strong>${item.userAnswer}</strong></td>
                        <td style="padding: 6px; border: 1px solid #ddd;">${item.correctAnswer}</td>
                        <td style="padding: 6px; border: 1px solid #ddd; text-align: center;">${resultIcon}</td>
                        <td style="padding: 6px; border: 1px solid #ddd;">${item.level}</td>
                    </tr>
                `;
            });

            historyHTML += `</table></div><br>`;
            historyHTML += `<button class="check-btn" onclick="exportDetailedHistory('${toolName}')">ğŸ“¥ ×”×•×¨×“ ×™×•××Ÿ</button> `;
            historyHTML += `<button class="check-btn" onclick="hideCelebration()" style="background: #9e9e9e;">×¡×’×•×¨</button>`;

            const celebration = document.getElementById('celebration');
            const overlay = document.getElementById('overlay');
            
            celebration.innerHTML = historyHTML;
            celebration.style.display = 'block';
            overlay.style.display = 'block';
        }

        // Export detailed history
        function exportDetailedHistory(toolName) {
            const state = getState(toolName);
            const titles = {
                decimal: '××‘× ×” ×¢×©×¨×•× ×™',
                multiplication: '×”×©×œ××ª ×’×•×¨× ×•××›×¤×œ×”',
                numberline: '×™×©×¨ ×”××¡×¤×¨×™×'
            };

            let historyText = `
ğŸ“‹ ×™×•××Ÿ ×ª×¨×’×•×œ ××¤×•×¨×˜ - ${titles[toolName]} - ×××”
${'='.repeat(70)}

ğŸ“… ×ª××¨×™×š ×™×™×¦×•×: ${new Date().toLocaleDateString('he-IL')} ${new Date().toLocaleTimeString('he-IL')}
ğŸ“Š ×¡×”"×› ×©××œ×•×ª ×‘×™×•××Ÿ: ${state.sessionHistory.length}

${'='.repeat(70)}

`;

            state.sessionHistory.forEach((item, index) => {
                const timestamp = new Date(item.timestamp).toLocaleString('he-IL');
                const result = item.isCorrect ? 'âœ… × ×›×•×Ÿ' : 'âŒ ×©×’×•×™';
                
                historyText += `
×©××œ×” #${index + 1} | ${timestamp}
${'-'.repeat(70)}
ğŸ“ ×©××œ×”: ${item.question}
ğŸ’­ ×ª×©×•×‘×” ×©× ×™×ª× ×”: ${item.userAnswer}
âœ“ ×ª×©×•×‘×” × ×›×•× ×”: ${item.correctAnswer}
ğŸ“Š ×ª×•×¦××”: ${result}
ğŸ¯ ×¨××”: ${item.level}

`;
            });

            historyText += `
${'='.repeat(70)}
×¡×•×£ ×”×™×•××Ÿ | × ×•×¦×¨ ×¢×œ ×™×“×™ ××¢×¨×›×ª ×ª×¨×’×•×œ ×××”
`;

            const blob = new Blob([historyText], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `×™×•××Ÿ-××¤×•×¨×˜-${titles[toolName]}-×××”-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            alert('âœ… ×”×™×•××Ÿ ×”××¤×•×¨×˜ ×”×•×¨×“ ×‘×”×¦×œ×—×”!\nğŸ“ ××™×§×•×: ×ª×™×§×™×™×ª Downloads');
        }

        // Backup progress
        function backupProgress(toolName) {
            const keys = {
                decimal: 'emmaDecimalProgress',
                multiplication: 'emmaMultiplicationProgress',
                numberline: 'emmaNumberLineProgress'
            };

            const titles = {
                decimal: '××‘× ×” ×¢×©×¨×•× ×™',
                multiplication: '×’×•×¨× ×•××›×¤×œ×”',
                numberline: '×™×©×¨ ×”××¡×¤×¨×™×'
            };

            const saved = localStorage.getItem(keys[toolName]);
            if (!saved) {
                alert('××™×Ÿ × ×ª×•× ×™× ×œ×’×™×‘×•×™ ×¢×“×™×™×Ÿ!');
                return;
            }

            const backupData = {
                tool: toolName,
                title: titles[toolName],
                backupDate: new Date().toISOString(),
                data: JSON.parse(saved)
            };

            const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `×’×™×‘×•×™-${titles[toolName]}-×××”-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            const celebration = document.getElementById('celebration');
            const overlay = document.getElementById('overlay');
            
            celebration.innerHTML = `
                âœ… ×’×™×‘×•×™ × ×•×¦×¨ ×‘×”×¦×œ×—×”!<br><br>
                ğŸ“ <strong>××™×§×•×:</strong> ×ª×™×§×™×™×ª Downloads<br>
                ğŸ“„ <strong>×©× ×§×•×‘×¥:</strong> ×’×™×‘×•×™-${titles[toolName]}-×××”-${new Date().toISOString().split('T')[0]}.json<br><br>
                ğŸ’¾ ×”×§×•×‘×¥ ××›×™×œ ××ª ×›×œ ×”× ×ª×•× ×™× ×©×œ×š!<br>
                ğŸ”’ ×©××¨×™ ××•×ª×• ×‘××§×•× ×‘×˜×•×—<br><br>
                <small>ğŸ’¡ ×˜×™×¤: ×©×œ×—×™ ××ª ×”×§×•×‘×¥ ×œ××™×™×œ ××• Google Drive ×œ×’×™×‘×•×™ × ×•×¡×£</small><br><br>
                <button class="check-btn" onclick="hideCelebration()">×¡×’×•×¨</button>
            `;
            celebration.style.display = 'block';
            overlay.style.display = 'block';
        }

        // Auto-backup every hour
        setInterval(() => {
            ['decimal', 'multiplication', 'numberline'].forEach(tool => {
                const state = getState(tool);
                if (state.totalQuestions > 0) {
                    // Silent backup to console
                    console.log(`ğŸ”„ Auto-backup: ${tool} - ${state.totalQuestions} questions`);
                }
            });
        }, 3600000); // Every hour

        // INITIALIZATION
        document.addEventListener('DOMContentLoaded', function() {
            // Load all progress on home page
            loadAllProgress();
            
            // Enable Enter key for inputs
            ['decimal', 'multiplication', 'numberline'].forEach(tool => {
                const input = document.getElementById(`${tool}-answer-input`);
                if (input) {
                    input.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            if (tool === 'decimal') checkDecimalAnswer();
                            else if (tool === 'multiplication') checkMultiplicationAnswer();
                            else if (tool === 'numberline') checkNumberlineAnswer();
                        }
                    });
                }
            });

            // Auto-save every 30 seconds
            setInterval(() => {
                if (decimalState.totalQuestions > 0) saveProgress('decimal');
                if (multiplicationState.totalQuestions > 0) saveProgress('multiplication');
                if (numberlineState.totalQuestions > 0) saveProgress('numberline');
            }, 30000);

            // Save before page unload
            window.addEventListener('beforeunload', () => {
                if (decimalState.totalQuestions > 0) saveProgress('decimal');
                if (multiplicationState.totalQuestions > 0) saveProgress('multiplication');
                if (numberlineState.totalQuestions > 0) saveProgress('numberline');
            });
        });
    </script>

</body></html>